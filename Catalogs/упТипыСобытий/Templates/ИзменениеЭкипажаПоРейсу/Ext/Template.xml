<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>НаборДанных1</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИзмененоСоглашение</dataPath>
			<field>ИзмененоСоглашение</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Изменено соглашение</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Экспедитор</dataPath>
			<field>Экспедитор</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ТипТС</dataPath>
			<field>ТипТС</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИзмененоТранспортноеСредство</dataPath>
			<field>ИзмененоТранспортноеСредство</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Изменено транспортное средство</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИзмененЭкспедитор</dataPath>
			<field>ИзмененЭкспедитор</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Изменен экспедитор</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИзмененВторойВодитель</dataPath>
			<field>ИзмененВторойВодитель</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Изменен второй водитель</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИзмененТипТС</dataPath>
			<field>ИзмененТипТС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Изменен тип ТС</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИзмененПеревозчик</dataPath>
			<field>ИзмененПеревозчик</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Изменен перевозчик</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КонтрагентПеревозчика</dataPath>
			<field>КонтрагентПеревозчика</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Перевозчик</dataPath>
			<field>Перевозчик</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ТранспортноеСредство</dataPath>
			<field>ТранспортноеСредство</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Рейс</dataPath>
			<field>Рейс</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Статус</dataPath>
			<field>Статус</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Соглашение</dataPath>
			<field>Соглашение</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Водитель1</dataPath>
			<field>Водитель1</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Первый водитель</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Ссылка</dataPath>
			<field>Ссылка</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Ссылка</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИзмененПервыйВодитель</dataPath>
			<field>ИзмененПервыйВодитель</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Изменен первый водитель</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Водитель2</dataPath>
			<field>Водитель2</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Второй водитель</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИзмененКонтрагентПеревозчика</dataPath>
			<field>ИзмененКонтрагентПеревозчика</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Изменен контрагент перевозчика</v8:content>
				</v8:item>
			</title>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ
	упПеревозчикПоРейсу.Период КАК Период,
	упПеревозчикПоРейсу.Регистратор КАК Ссылка,
	упПеревозчикПоРейсу.Рейс КАК Рейс,
	упПеревозчикПоРейсу.Перевозчик КАК Перевозчик,
	упПеревозчикПоРейсу.Соглашение КАК Соглашение,
	упПеревозчикПоРейсу.КонтрагентПеревозчика КАК КонтрагентПеревозчика,
	упПеревозчикПоРейсу.ТипТС КАК ТипТС,
	упПеревозчикПоРейсу.ТранспортноеСредство КАК ТранспортноеСредство,
	упПеревозчикПоРейсу.Водитель1 КАК Водитель1,
	упПеревозчикПоРейсу.Водитель2 КАК Водитель2,
	упПеревозчикПоРейсу.Экспедитор КАК Экспедитор
ПОМЕСТИТЬ втТекущиеЗаписи
ИЗ
	РегистрСведений.упПеревозчикПоРейсу КАК упПеревозчикПоРейсу
{ГДЕ
	упПеревозчикПоРейсу.Регистратор КАК Ссылка}
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	упПеревозчикПоРейсу.Рейс КАК Рейс,
	МАКСИМУМ(упПеревозчикПоРейсу.Перевозчик) КАК Перевозчик,
	МАКСИМУМ(упПеревозчикПоРейсу.Соглашение) КАК Соглашение,
	МАКСИМУМ(упПеревозчикПоРейсу.КонтрагентПеревозчика) КАК КонтрагентПеревозчика,
	МАКСИМУМ(упПеревозчикПоРейсу.ТипТС) КАК ТипТС,
	МАКСИМУМ(упПеревозчикПоРейсу.ТранспортноеСредство) КАК ТранспортноеСредство,
	МАКСИМУМ(упПеревозчикПоРейсу.Водитель1) КАК Водитель1,
	МАКСИМУМ(упПеревозчикПоРейсу.Водитель2) КАК Водитель2,
	МАКСИМУМ(упПеревозчикПоРейсу.Экспедитор) КАК Экспедитор
ПОМЕСТИТЬ втПредшествующиеЗаписи
ИЗ
	РегистрСведений.упПеревозчикПоРейсу КАК упПеревозчикПоРейсу
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			упПеревозчикПоРейсу.Рейс КАК Рейс,
			МАКСИМУМ(упПеревозчикПоРейсу.Период) КАК Период
		ИЗ
			РегистрСведений.упПеревозчикПоРейсу КАК упПеревозчикПоРейсу
				ВНУТРЕННЕЕ СОЕДИНЕНИЕ втТекущиеЗаписи КАК втТекущиеЗаписи
				ПО упПеревозчикПоРейсу.Рейс = втТекущиеЗаписи.Рейс
					И упПеревозчикПоРейсу.Период &lt; втТекущиеЗаписи.Период
		
		СГРУППИРОВАТЬ ПО
			упПеревозчикПоРейсу.Рейс) КАК ВложенныйЗапрос
		ПО упПеревозчикПоРейсу.Период = ВложенныйЗапрос.Период
			И упПеревозчикПоРейсу.Рейс = ВложенныйЗапрос.Рейс

СГРУППИРОВАТЬ ПО
	упПеревозчикПоРейсу.Рейс
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втТекущиеЗаписи.Ссылка,
	втТекущиеЗаписи.Рейс,
	упСтатусыРейсов.Статус,
	втТекущиеЗаписи.Перевозчик,
	втТекущиеЗаписи.Соглашение,
	втТекущиеЗаписи.КонтрагентПеревозчика,
	втТекущиеЗаписи.ТипТС,
	втТекущиеЗаписи.ТранспортноеСредство,
	втТекущиеЗаписи.Водитель1,
	втТекущиеЗаписи.Водитель2,
	втТекущиеЗаписи.Экспедитор,
	ВЫБОР
		КОГДА втТекущиеЗаписи.Перевозчик = ЕСТЬNULL(втПредшествующиеЗаписи.Перевозчик, ЗНАЧЕНИЕ(Справочник.упПартнеры.ПустаяСсылка))
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ИзмененПеревозчик,
	ВЫБОР
		КОГДА втТекущиеЗаписи.Соглашение = ЕСТЬNULL(втПредшествующиеЗаписи.Соглашение, ЗНАЧЕНИЕ(Справочник.упСоглашенияСПеревозчиками.ПустаяСсылка))
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ИзмененоСоглашение,
	ВЫБОР
		КОГДА втТекущиеЗаписи.КонтрагентПеревозчика = ЕСТЬNULL(втПредшествующиеЗаписи.КонтрагентПеревозчика, ЗНАЧЕНИЕ(Справочник.упКонтрагенты.ПустаяСсылка))
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ИзмененКонтрагентПеревозчика,
	ВЫБОР
		КОГДА втТекущиеЗаписи.ТипТС = ЕСТЬNULL(втПредшествующиеЗаписи.ТипТС, ЗНАЧЕНИЕ(Справочник.упТипыТС.ПустаяСсылка))
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ИзмененТипТС,
	ВЫБОР
		КОГДА втТекущиеЗаписи.ТранспортноеСредство = ЕСТЬNULL(втПредшествующиеЗаписи.ТранспортноеСредство, ЗНАЧЕНИЕ(Справочник.упТранспортныеСредства.ПустаяСсылка))
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ИзмененоТранспортноеСредство,
	ВЫБОР
		КОГДА втТекущиеЗаписи.Водитель1 = ЕСТЬNULL(втПредшествующиеЗаписи.Водитель1, ЗНАЧЕНИЕ(Справочник.упСотрудники.ПустаяСсылка))
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ИзмененПервыйВодитель,
	ВЫБОР
		КОГДА втТекущиеЗаписи.Водитель2 = ЕСТЬNULL(втПредшествующиеЗаписи.Водитель2, ЗНАЧЕНИЕ(Справочник.упСотрудники.ПустаяСсылка))
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ИзмененВторойВодитель,
	ВЫБОР
		КОГДА втТекущиеЗаписи.Экспедитор = ЕСТЬNULL(втПредшествующиеЗаписи.Экспедитор, ЗНАЧЕНИЕ(Справочник.упСотрудники.ПустаяСсылка))
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ИзмененЭкспедитор
ИЗ
	втТекущиеЗаписи КАК втТекущиеЗаписи
		ЛЕВОЕ СОЕДИНЕНИЕ втПредшествующиеЗаписи КАК втПредшествующиеЗаписи
		ПО втТекущиеЗаписи.Рейс = втПредшествующиеЗаписи.Рейс
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.упСтатусыРейсов.СрезПоследних(
				,
				Документ В
					(ВЫБРАТЬ
						втТекущиеЗаписи.Рейс
					ИЗ
						втТекущиеЗаписи)) КАК упСтатусыРейсов
		ПО втТекущиеЗаписи.Рейс = упСтатусыРейсов.Документ</query>
	</dataSet>
	<parameter>
		<name>Период</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Период</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="xs:string">Основной</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Ссылка</dcsset:field>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
				</dcsset:selection>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>