<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>НаборДанных1</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>Рейс</dataPath>
			<field>Рейс</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Ссылка</dataPath>
			<field>Ссылка</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Ссылка</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Экспедитор</dataPath>
			<field>Экспедитор</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Экспедитор</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ТипТС</dataPath>
			<field>ТипТС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Тип ТС</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КоличествоОтмененныхТочек</dataPath>
			<field>КоличествоОтмененныхТочек</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Количество отмененных точек</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КоличествоПройденныхТочек</dataPath>
			<field>КоличествоПройденныхТочек</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Количество пройденных точек</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КоличествоНовыхПланируюмыхОпозданийВТочкахМаршрутов</dataPath>
			<field>КоличествоНовыхПланируюмыхОпозданийВТочкахМаршрутов</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Количество новых планируюмых опозданий в точках маршрутов</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Перевозчик</dataPath>
			<field>Перевозчик</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Перевозчик</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПланируютсяНовыеОпозданияВТочкахМаршрутов</dataPath>
			<field>ПланируютсяНовыеОпозданияВТочкахМаршрутов</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Планируются новые опоздания в точках маршрутов</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ТранспортноеСредство</dataPath>
			<field>ТранспортноеСредство</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Транспортное средство</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Статус</dataPath>
			<field>Статус</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КоличествоНовыхОпозданийВТочкиПоФакту</dataPath>
			<field>КоличествоНовыхОпозданийВТочкиПоФакту</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Количество новых опозданий в точки по факту</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Соглашение</dataPath>
			<field>Соглашение</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Соглашение</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Водитель1</dataPath>
			<field>Водитель1</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Первый водитель</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Водитель2</dataPath>
			<field>Водитель2</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Второй водитель</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ОтмененыТочки</dataPath>
			<field>ОтмененыТочки</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Отменены точки</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПройденыТочки</dataPath>
			<field>ПройденыТочки</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Пройдены точки</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗафиксированыФактическиеОпозданияВТочкахМаршрутов</dataPath>
			<field>ЗафиксированыФактическиеОпозданияВТочкахМаршрутов</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Зафиксированы фактические опоздания в точках маршрутов</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КоличествоДобавленныхТочек</dataPath>
			<field>КоличествоДобавленныхТочек</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Количество добавленных точек</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДобавленыТочки</dataPath>
			<field>ДобавленыТочки</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Добавлены точки</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИзмененПорядокТочек</dataPath>
			<field>ИзмененПорядокТочек</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Изменен порядок точек</v8:content>
				</v8:item>
			</title>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ
	упМаршрутПоРейсу.Период КАК Период,
	упМаршрутПоРейсу.Регистратор КАК Ссылка,
	упМаршрутПоРейсу.Рейс КАК Рейс,
	упМаршрутПоРейсу.Идентификатор КАК Идентификатор,
	упМаршрутПоРейсу.Адрес КАК Адрес,
	упМаршрутПоРейсу.ВременноеОкноНачало КАК ВременноеОкноНачало,
	упМаршрутПоРейсу.ВременноеОкноОкончание КАК ВременноеОкноОкончание,
	упМаршрутПоРейсу.Отменена КАК Отменена,
	упМаршрутПоРейсу.Пройдена КАК Пройдена,
	упМаршрутПоРейсу.СтрокаНомер КАК ПорядокПрохождения,
	ВЫБОР
		КОГДА упМаршрутПоРейсу.ВременноеОкноНачало = ДАТАВРЕМЯ(1, 1, 1)
				И упМаршрутПоРейсу.ВременноеОкноОкончание = ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА ИСТИНА
		КОГДА упМаршрутПоРейсу.ВременноеОкноНачало = ДАТАВРЕМЯ(1, 1, 1)
				И ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.ПлановоеУбытие, СЕКУНДА, -60) &lt;= упМаршрутПоРейсу.ВременноеОкноОкончание
			ТОГДА ИСТИНА
		КОГДА упМаршрутПоРейсу.ВременноеОкноОкончание = ДАТАВРЕМЯ(1, 1, 1)
				И ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.ПлановоеПрибытие, СЕКУНДА, упМаршрутПоРейсу.ВремяОжиданияВТочке * 3600 + 60) &gt;= упМаршрутПоРейсу.ВременноеОкноНачало
			ТОГДА ИСТИНА
		КОГДА ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.ПлановоеУбытие, СЕКУНДА, -60) &lt;= упМаршрутПоРейсу.ВременноеОкноОкончание
				И ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.ПлановоеПрибытие, СЕКУНДА, упМаршрутПоРейсу.ВремяОжиданияВТочке * 3600 + 60) &gt;= упМаршрутПоРейсу.ВременноеОкноНачало
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ПопадаетВоВременноеОкноПлан,
	ВЫБОР
		КОГДА упМаршрутПоРейсу.ВременноеОкноНачало = ДАТАВРЕМЯ(1, 1, 1)
				И упМаршрутПоРейсу.ВременноеОкноОкончание = ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА ИСТИНА
		КОГДА упМаршрутПоРейсу.ВременноеОкноНачало = ДАТАВРЕМЯ(1, 1, 1)
				И ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.УбытиеФакт, СЕКУНДА, -60) &lt;= упМаршрутПоРейсу.ВременноеОкноОкончание
			ТОГДА ИСТИНА
		КОГДА упМаршрутПоРейсу.ВременноеОкноОкончание = ДАТАВРЕМЯ(1, 1, 1)
				И ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.ПрибытиеФакт, СЕКУНДА, упМаршрутПоРейсу.ВремяОжиданияВТочке * 3600 + 60) &gt;= упМаршрутПоРейсу.ВременноеОкноНачало
			ТОГДА ИСТИНА
		КОГДА ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.УбытиеФакт, СЕКУНДА, -60) &lt;= упМаршрутПоРейсу.ВременноеОкноОкончание
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ПопадаетВоВременноеОкноФакт
ПОМЕСТИТЬ втТекущиеЗаписи
ИЗ
	РегистрСведений.упМаршрутПоРейсу КАК упМаршрутПоРейсу
{ГДЕ
	упМаршрутПоРейсу.Регистратор КАК Ссылка}
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	упМаршрутПоРейсу.Рейс КАК Рейс,
	упМаршрутПоРейсу.Идентификатор КАК Идентификатор,
	МАКСИМУМ(упМаршрутПоРейсу.Адрес) КАК Адрес,
	МАКСИМУМ(упМаршрутПоРейсу.ВременноеОкноНачало) КАК ВременноеОкноНачало,
	МАКСИМУМ(упМаршрутПоРейсу.ВременноеОкноОкончание) КАК ВременноеОкноОкончание,
	МАКСИМУМ(упМаршрутПоРейсу.Отменена) КАК Отменена,
	МАКСИМУМ(упМаршрутПоРейсу.Пройдена) КАК Пройдена,
	МАКСИМУМ(упМаршрутПоРейсу.СтрокаНомер) КАК ПорядокПрохождения,
	МИНИМУМ(ВЫБОР
			КОГДА упМаршрутПоРейсу.ВременноеОкноНачало = ДАТАВРЕМЯ(1, 1, 1)
					И упМаршрутПоРейсу.ВременноеОкноОкончание = ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА ИСТИНА
			КОГДА упМаршрутПоРейсу.ВременноеОкноНачало = ДАТАВРЕМЯ(1, 1, 1)
					И ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.ПлановоеУбытие, СЕКУНДА, -60) &lt;= упМаршрутПоРейсу.ВременноеОкноОкончание
				ТОГДА ИСТИНА
			КОГДА упМаршрутПоРейсу.ВременноеОкноОкончание = ДАТАВРЕМЯ(1, 1, 1)
					И ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.ПлановоеПрибытие, СЕКУНДА, упМаршрутПоРейсу.ВремяОжиданияВТочке * 3600 + 60) &gt;= упМаршрутПоРейсу.ВременноеОкноНачало
				ТОГДА ИСТИНА
			КОГДА ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.ПлановоеУбытие, СЕКУНДА, -60) &lt;= упМаршрутПоРейсу.ВременноеОкноОкончание
					И ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.ПлановоеПрибытие, СЕКУНДА, упМаршрутПоРейсу.ВремяОжиданияВТочке * 3600 + 60) &gt;= упМаршрутПоРейсу.ВременноеОкноНачало
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ПопадаетВоВременноеОкноПлан,
	МИНИМУМ(ВЫБОР
			КОГДА упМаршрутПоРейсу.ВременноеОкноНачало = ДАТАВРЕМЯ(1, 1, 1)
					И упМаршрутПоРейсу.ВременноеОкноОкончание = ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА ИСТИНА
			КОГДА упМаршрутПоРейсу.ВременноеОкноНачало = ДАТАВРЕМЯ(1, 1, 1)
					И ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.УбытиеФакт, СЕКУНДА, -60) &lt;= упМаршрутПоРейсу.ВременноеОкноОкончание
				ТОГДА ИСТИНА
			КОГДА упМаршрутПоРейсу.ВременноеОкноОкончание = ДАТАВРЕМЯ(1, 1, 1)
					И ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.ПрибытиеФакт, СЕКУНДА, упМаршрутПоРейсу.ВремяОжиданияВТочке * 3600 + 60) &gt;= упМаршрутПоРейсу.ВременноеОкноНачало
				ТОГДА ИСТИНА
			КОГДА ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.УбытиеФакт, СЕКУНДА, -60) &lt;= упМаршрутПоРейсу.ВременноеОкноОкончание
					И ДОБАВИТЬКДАТЕ(упМаршрутПоРейсу.ПрибытиеФакт, СЕКУНДА, упМаршрутПоРейсу.ВремяОжиданияВТочке * 3600 + 60) &gt;= упМаршрутПоРейсу.ВременноеОкноНачало
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ПопадаетВоВременноеОкноФакт
ПОМЕСТИТЬ втПредшествующиеЗаписи
ИЗ
	РегистрСведений.упМаршрутПоРейсу КАК упМаршрутПоРейсу
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			упМаршрутПоРейсу.Рейс КАК Рейс,
			упМаршрутПоРейсу.Идентификатор КАК Идентификатор,
			МАКСИМУМ(упМаршрутПоРейсу.Период) КАК Период
		ИЗ
			РегистрСведений.упМаршрутПоРейсу КАК упМаршрутПоРейсу
				ВНУТРЕННЕЕ СОЕДИНЕНИЕ втТекущиеЗаписи КАК втТекущиеЗаписи
				ПО упМаршрутПоРейсу.Рейс = втТекущиеЗаписи.Рейс
					И упМаршрутПоРейсу.Идентификатор = втТекущиеЗаписи.Идентификатор
					И упМаршрутПоРейсу.Период &lt; втТекущиеЗаписи.Период
		
		СГРУППИРОВАТЬ ПО
			упМаршрутПоРейсу.Рейс,
			упМаршрутПоРейсу.Идентификатор) КАК ВложенныйЗапрос
		ПО упМаршрутПоРейсу.Период = ВложенныйЗапрос.Период
			И упМаршрутПоРейсу.Рейс = ВложенныйЗапрос.Рейс
			И упМаршрутПоРейсу.Идентификатор = ВложенныйЗапрос.Идентификатор

СГРУППИРОВАТЬ ПО
	упМаршрутПоРейсу.Рейс,
	упМаршрутПоРейсу.Идентификатор
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втТекущиеЗаписи.Ссылка,
	втТекущиеЗаписи.Рейс,
	упСтатусыРейсов.Статус,
	ЕСТЬNULL(упПеревозчикПоРейсу.ТранспортноеСредство, ЗНАЧЕНИЕ(Справочник.упТранспортныеСредства.ПустаяСсылка)) КАК ТранспортноеСредство,
	ЕСТЬNULL(упПеревозчикПоРейсу.Перевозчик, ЗНАЧЕНИЕ(Справочник.упПартнеры.ПустаяСсылка)) КАК Перевозчик,
	ЕСТЬNULL(упПеревозчикПоРейсу.Соглашение, ЗНАЧЕНИЕ(Справочник.упСоглашенияСПеревозчиками.ПустаяСсылка)) КАК Соглашение,
	ЕСТЬNULL(упПеревозчикПоРейсу.ТипТС, ЗНАЧЕНИЕ(Справочник.упТипыТС.ПустаяСсылка)) КАК ТипТС,
	ЕСТЬNULL(упПеревозчикПоРейсу.Водитель1, ЗНАЧЕНИЕ(Справочник.упСотрудники.ПустаяСсылка)) КАК Водитель1,
	ЕСТЬNULL(упПеревозчикПоРейсу.Водитель2, ЗНАЧЕНИЕ(Справочник.упСотрудники.ПустаяСсылка)) КАК Водитель2,
	ЕСТЬNULL(упПеревозчикПоРейсу.Экспедитор, ЗНАЧЕНИЕ(Справочник.упСотрудники.ПустаяСсылка)) КАК Экспедитор,
	МАКСИМУМ(ВЫБОР
			КОГДА втПредшествующиеЗаписи.Идентификатор ЕСТЬ NULL
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ДобавленыТочки,
	СУММА(ВЫБОР
			КОГДА втПредшествующиеЗаписи.Идентификатор ЕСТЬ NULL
				ТОГДА 1
			ИНАЧЕ 0
		КОНЕЦ) КАК КоличествоДобавленныхТочек,
	МАКСИМУМ(ВЫБОР
			КОГДА втТекущиеЗаписи.Пройдена
					И НЕ ЕСТЬNULL(втПредшествующиеЗаписи.Пройдена, ИСТИНА)
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ПройденыТочки,
	СУММА(ВЫБОР
			КОГДА втТекущиеЗаписи.Пройдена
					И НЕ ЕСТЬNULL(втПредшествующиеЗаписи.Пройдена, ИСТИНА)
				ТОГДА 1
			ИНАЧЕ 0
		КОНЕЦ) КАК КоличествоПройденныхТочек,
	МАКСИМУМ(ВЫБОР
			КОГДА втТекущиеЗаписи.Отменена
					И НЕ ЕСТЬNULL(втПредшествующиеЗаписи.Отменена, ИСТИНА)
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ОтмененыТочки,
	СУММА(ВЫБОР
			КОГДА втТекущиеЗаписи.Отменена
					И НЕ ЕСТЬNULL(втПредшествующиеЗаписи.Отменена, ИСТИНА)
				ТОГДА 1
			ИНАЧЕ 0
		КОНЕЦ) КАК КоличествоОтмененныхТочек,
	МАКСИМУМ(ВЫБОР
			КОГДА втТекущиеЗаписи.Пройдена
					И НЕ ЕСТЬNULL(втПредшествующиеЗаписи.Пройдена, ИСТИНА)
					И НЕ втТекущиеЗаписи.ПопадаетВоВременноеОкноФакт
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ЗафиксированыФактическиеОпозданияВТочкахМаршрутов,
	СУММА(ВЫБОР
			КОГДА втТекущиеЗаписи.Пройдена
					И НЕ ЕСТЬNULL(втПредшествующиеЗаписи.Пройдена, ИСТИНА)
					И НЕ втТекущиеЗаписи.ПопадаетВоВременноеОкноФакт
				ТОГДА 1
			ИНАЧЕ 0
		КОНЕЦ) КАК КоличествоНовыхОпозданийВТочкиПоФакту,
	МАКСИМУМ(ВЫБОР
			КОГДА НЕ втТекущиеЗаписи.Пройдена
					И НЕ втТекущиеЗаписи.ПопадаетВоВременноеОкноПлан
					И ЕСТЬNULL(втПредшествующиеЗаписи.ПопадаетВоВременноеОкноПлан, ЛОЖЬ)
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ПланируютсяНовыеОпозданияВТочкахМаршрутов,
	СУММА(ВЫБОР
			КОГДА НЕ втТекущиеЗаписи.Пройдена
					И НЕ втТекущиеЗаписи.ПопадаетВоВременноеОкноПлан
					И ЕСТЬNULL(втПредшествующиеЗаписи.ПопадаетВоВременноеОкноПлан, ЛОЖЬ)
				ТОГДА 1
			ИНАЧЕ 0
		КОНЕЦ) КАК КоличествоНовыхПланируюмыхОпозданийВТочкахМаршрутов,
	МАКСИМУМ(ВЫБОР
			КОГДА НЕ втПредшествующиеЗаписи.ПорядокПрохождения ЕСТЬ NULL
					И втТекущиеЗаписи.ПорядокПрохождения &lt;&gt; втПредшествующиеЗаписи.ПорядокПрохождения
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ИзмененПорядокТочек
ИЗ
	втТекущиеЗаписи КАК втТекущиеЗаписи
		ЛЕВОЕ СОЕДИНЕНИЕ втПредшествующиеЗаписи КАК втПредшествующиеЗаписи
		ПО втТекущиеЗаписи.Рейс = втПредшествующиеЗаписи.Рейс
			И втТекущиеЗаписи.Идентификатор = втПредшествующиеЗаписи.Идентификатор
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.упСтатусыРейсов.СрезПоследних(
				,
				Документ В
					(ВЫБРАТЬ
						втТекущиеЗаписи.Рейс
					ИЗ
						втТекущиеЗаписи)) КАК упСтатусыРейсов
		ПО втТекущиеЗаписи.Рейс = упСтатусыРейсов.Документ
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упПеревозчикПоРейсу.СрезПоследних(
				,
				Рейс В
					(ВЫБРАТЬ
						втТекущиеЗаписи.Рейс
					ИЗ
						втТекущиеЗаписи)) КАК упПеревозчикПоРейсу
		ПО втТекущиеЗаписи.Рейс = упПеревозчикПоРейсу.Рейс

СГРУППИРОВАТЬ ПО
	втТекущиеЗаписи.Ссылка,
	втТекущиеЗаписи.Рейс,
	упСтатусыРейсов.Статус,
	ЕСТЬNULL(упПеревозчикПоРейсу.ТранспортноеСредство, ЗНАЧЕНИЕ(Справочник.упТранспортныеСредства.ПустаяСсылка)),
	ЕСТЬNULL(упПеревозчикПоРейсу.Перевозчик, ЗНАЧЕНИЕ(Справочник.упПартнеры.ПустаяСсылка)),
	ЕСТЬNULL(упПеревозчикПоРейсу.Соглашение, ЗНАЧЕНИЕ(Справочник.упСоглашенияСПеревозчиками.ПустаяСсылка)),
	ЕСТЬNULL(упПеревозчикПоРейсу.ТипТС, ЗНАЧЕНИЕ(Справочник.упТипыТС.ПустаяСсылка)),
	ЕСТЬNULL(упПеревозчикПоРейсу.Водитель1, ЗНАЧЕНИЕ(Справочник.упСотрудники.ПустаяСсылка)),
	ЕСТЬNULL(упПеревозчикПоРейсу.Водитель2, ЗНАЧЕНИЕ(Справочник.упСотрудники.ПустаяСсылка)),
	ЕСТЬNULL(упПеревозчикПоРейсу.Экспедитор, ЗНАЧЕНИЕ(Справочник.упСотрудники.ПустаяСсылка))</query>
	</dataSet>
	<parameter>
		<name>Период</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Период</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="xs:string">Основной</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Ссылка</dcsset:field>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
				</dcsset:selection>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>