#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
	
#Область ПрограммныйИнтерфейс

////////////////////////////////////////////////////////////////////////////////
// Интерфейс для работы с подсистемой ЗапретРедактированияРеквизитовОбъектов.

// Возвращает описание блокируемых реквизитов.
//
// Возвращаемое значение:
//     Массив - содержит строки в формате ИмяРеквизита[;ИмяЭлементаФормы,...]
//              где ИмяРеквизита - имя реквизита объекта, ИмяЭлементаФормы - имя элемента формы, связанного с
//              реквизитом.
//
Функция ПолучитьБлокируемыеРеквизитыОбъекта() Экспорт
	
	БлокируемыеРеквизиты = Новый Массив;
	
	Для каждого текРек из Метаданные.Справочники.упТипыСобытийМониторинга.Реквизиты цикл
		Если НЕ текРек.Имя = "Комментарий" тогда
			БлокируемыеРеквизиты.Добавить(текРек.Имя);	
		КонецЕсли;
	КонецЦикла;
	
	Возврат БлокируемыеРеквизиты;
	
КонецФункции
	
#КонецОбласти
	
#Область СлужебныеПроцедурыИФункции
	
// Процедура производит первоначальное заполнение предопределенных элементов справочника.
//
// Параметры:
//  Параметры  - Структура - Параметры.
//
Процедура ПервоначальноеЗаполнение(Параметры = Неопределено) Экспорт
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ВходящийЗвонок.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.ВходящийЗвонок;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ИсходящийЗвонок.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.ИсходящийЗвонок;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.НачалоРаботВТочкеМаршрута.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.НачалоРаботВТочкеМаршрута;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ПрибытиеВТочкуМаршрута.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.ПрибытиеВТочкуМаршрута;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.СообщениеДиспетчеру.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.СообщениеДиспетчеру;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.СообщениеОтДиспетчера.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.СообщениеОтДиспетчера;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.УбытиеСТочкиМаршрута.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.УбытиеСТочкиМаршрута;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ТочкаПропущена.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.ТочкаПропущена;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ОпозданиеВТочкеМаршрута.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.ОпозданиеВТочкеМаршрута;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ПланируемоеОпозданиеВТочкеМаршрута.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.ПланируемоеОпозданиеВТочкеМаршрута;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ЗадержкаВТочкеМаршрута.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.ЗадержкаВТочкеМаршрута;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ИзменениеСледующейТочкиПоМаршруту.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.ИзменениеСледующейТочкиПоМаршруту;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ОтсутствиеЛицензииНаПодключение.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.ОтсутствиеЛицензииНаПодключение;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ЗапросНаОптимизациюМаршрута.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.СобытиеМониторинга;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ЗапросНаДосрочноеУбытиеИзТочкиМаршрута.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.СобытиеМониторинга;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ЗапросНаДосрочноеЗавершениеРейса.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.СобытиеМониторинга;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ЗапросНаНазначениеТочкиСледующейПоМаршруту.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.СобытиеМониторинга;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ЗапросОтчетаПоЗадолженностямВодителя.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.СобытиеМониторинга;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ЗаправкаТоплива.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеВнешнейСистемыМониторинга;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.СобытиеМониторинга;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.СливТоплива.ПолучитьОбъект();
	текЭлемент.Активно            = Истина;
	текЭлемент.ВидСобытия         = Перечисления.упВидыСобытийМониторинга.СобытиеВнешнейСистемыМониторинга;
	текЭлемент.СтильМаркера       = Справочники.упСтилиМаркеров.СобытиеМониторинга;
	текЭлемент.Записать();
	
	#Область НастраиваемыеСобытияAndroidКлиента	
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ПревышениеВремениОжиданияНачалаРаботВТочкеМаршрута.ПолучитьОбъект();
	текЭлемент.Активно                            = Истина;
	текЭлемент.НастраиваемоеСобытиеAndroidКлиента = Истина;
	текЭлемент.ВидСобытия                         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера                       = Справочники.упСтилиМаркеров.СобытиеМониторинга;
	текЭлемент.ТаймаутОтсрочки                    = 900;
	текЭлемент.ИнициирующиеМониторингДействия.Очистить();
	текЭлемент.ОтменяющиеМониторингДействия.Очистить();
	текЭлемент.ФиксирующиеСобытиеДействия.Очистить();
	НоваяСтрока = текЭлемент.ИнициирующиеМониторингДействия.Добавить();
	НоваяСтрока.ТипДействия = Перечисления.упТипыДействийСобытийМониторинга.ВодительПрибылВТочку;
	НоваяСтрока = текЭлемент.ОтменяющиеМониторингДействия.Добавить();
	НоваяСтрока.ТипДействия = Перечисления.упТипыДействийСобытийМониторинга.ВодительНачалРаботыВТочке;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ПроверкаПрибытияВТочкуМаршрута.ПолучитьОбъект();
	текЭлемент.Активно                            = Истина;
	текЭлемент.НастраиваемоеСобытиеAndroidКлиента = Истина;
	текЭлемент.ВидСобытия                         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера                       = Справочники.упСтилиМаркеров.СобытиеМониторинга;
	текЭлемент.ТаймаутОтсрочки                    = 60;
	текЭлемент.ИнициирующиеМониторингДействия.Очистить();
	текЭлемент.ОтменяющиеМониторингДействия.Очистить();
	текЭлемент.ФиксирующиеСобытиеДействия.Очистить();
	НоваяСтрока = текЭлемент.ИнициирующиеМониторингДействия.Добавить();
	НоваяСтрока.ТипДействия = Перечисления.упТипыДействийСобытийМониторинга.ГеографическоеПрибытиеВТочку;
	НоваяСтрока = текЭлемент.ОтменяющиеМониторингДействия.Добавить();
	НоваяСтрока.ТипДействия = Перечисления.упТипыДействийСобытийМониторинга.ВодительПрибылВТочку;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ПроверкаУбытияСТочкиМаршрута.ПолучитьОбъект();
	текЭлемент.Активно                            = Истина;
	текЭлемент.НастраиваемоеСобытиеAndroidКлиента = Истина;
	текЭлемент.ВидСобытия                         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера                       = Справочники.упСтилиМаркеров.СобытиеМониторинга;
	текЭлемент.ТаймаутОтсрочки                    = 60;
	текЭлемент.ИнициирующиеМониторингДействия.Очистить();
	текЭлемент.ОтменяющиеМониторингДействия.Очистить();
	текЭлемент.ФиксирующиеСобытиеДействия.Очистить();	
	НоваяСтрока = текЭлемент.ИнициирующиеМониторингДействия.Добавить();
	НоваяСтрока.ТипДействия = Перечисления.упТипыДействийСобытийМониторинга.ВодительОтчиталсяПоВсемРаботамВТочке;
	НоваяСтрока = текЭлемент.ОтменяющиеМониторингДействия.Добавить();
	НоваяСтрока.ТипДействия = Перечисления.упТипыДействийСобытийМониторинга.ВодительУбылИзТочки;
	НоваяСтрока = текЭлемент.ФиксирующиеСобытиеДействия.Добавить();
	НоваяСтрока.ТипДействия = Перечисления.упТипыДействийСобытийМониторинга.ВыездИзРадиусаТочки;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.НепредусмотреннаяОстановка.ПолучитьОбъект();
	текЭлемент.Активно                            = Истина;
	текЭлемент.НастраиваемоеСобытиеAndroidКлиента = Истина;
	текЭлемент.ВидСобытия                         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера                       = Справочники.упСтилиМаркеров.СобытиеМониторинга;
	текЭлемент.ТаймаутОтсрочки                    = 600;
	текЭлемент.ИнициирующиеМониторингДействия.Очистить();
	текЭлемент.ОтменяющиеМониторингДействия.Очистить();
	текЭлемент.ФиксирующиеСобытиеДействия.Очистить();
	НоваяСтрока = текЭлемент.ИнициирующиеМониторингДействия.Добавить();
	НоваяСтрока.ТипДействия = Перечисления.упТипыДействийСобытийМониторинга.ОстановкаВнеТочки;
	НоваяСтрока = текЭлемент.ОтменяющиеМониторингДействия.Добавить();
	НоваяСтрока.ТипДействия = Перечисления.упТипыДействийСобытийМониторинга.ВодительПрибылВТочку;
	НоваяСтрока = текЭлемент.ОтменяющиеМониторингДействия.Добавить();
	НоваяСтрока.ТипДействия = Перечисления.упТипыДействийСобытийМониторинга.ВозобновлениеДвиженияВнеТочки;
	текЭлемент.Записать();
	
	текЭлемент = Справочники.упТипыСобытийМониторинга.ПревышениеВремениВыполненияРаботВТочкеМаршрута.ПолучитьОбъект();
	текЭлемент.Активно                            = Истина;
	текЭлемент.НастраиваемоеСобытиеAndroidКлиента = Истина;
	текЭлемент.ВидСобытия                         = Перечисления.упВидыСобытийМониторинга.СобытиеAndroidКлиента;
	текЭлемент.СтильМаркера                       = Справочники.упСтилиМаркеров.СобытиеМониторинга;
	текЭлемент.ТаймаутОтсрочки                    = 600;
	текЭлемент.ИнициирующиеМониторингДействия.Очистить();
	текЭлемент.ОтменяющиеМониторингДействия.Очистить();
	текЭлемент.ФиксирующиеСобытиеДействия.Очистить();	
	НоваяСтрока = текЭлемент.ИнициирующиеМониторингДействия.Добавить();
	НоваяСтрока.ТипДействия = Перечисления.упТипыДействийСобытийМониторинга.ВодительНачалРаботыВТочке;
	НоваяСтрока = текЭлемент.ОтменяющиеМониторингДействия.Добавить();
	НоваяСтрока.ТипДействия = Перечисления.упТипыДействийСобытийМониторинга.ВодительУбылИзТочки;
	текЭлемент.Записать();
	
	#КонецОбласти 
		
КонецПроцедуры // ПервоначальноеЗаполнение()
		
#КонецОбласти
	
#КонецЕсли

#Область ОбработчикиСобытий

Процедура ОбработкаПолученияДанныхВыбора(ДанныеВыбора, Параметры, СтандартнаяОбработка)
	
	ВидПравила = Неопределено;
	Если Параметры.Отбор.Свойство("ВидПравила", ВидПравила) Тогда 
		СтандартнаяОбработка = Ложь;
		ДанныеВыбора = ПолучитьДанныеВыбораПоВидуПравил(ВидПравила);
	КонецЕсли;	
		
КонецПроцедуры

// Функция подготавливает доступные типы событий мониторинга по виду правила
//
Функция ПолучитьДанныеВыбораПоВидуПравил(ВидПравила) Экспорт
	
	ДанныеВыбора = Новый СписокЗначений;
	
	Если ВидПравила = ПредопределенноеЗначение("Перечисление.упВидыПравилМобильныйКлиент.ПравилаВыполненияРейса")  Тогда
		ДанныеВыбора.Добавить(Справочники.упТипыСобытийМониторинга.НепредусмотреннаяОстановка);	
		
	ИначеЕсли ВидПравила = ПредопределенноеЗначение("Перечисление.упВидыПравилМобильныйКлиент.ПравилаПрохожденияТочек") Тогда
		ДанныеВыбора.Добавить(Справочники.упТипыСобытийМониторинга.ПревышениеВремениОжиданияНачалаРаботВТочкеМаршрута);
		ДанныеВыбора.Добавить(Справочники.упТипыСобытийМониторинга.ПроверкаПрибытияВТочкуМаршрута);
		ДанныеВыбора.Добавить(Справочники.упТипыСобытийМониторинга.ПроверкаУбытияСТочкиМаршрута);
		ДанныеВыбора.Добавить(Справочники.упТипыСобытийМониторинга.ПревышениеВремениВыполненияРаботВТочкеМаршрута);
	КонецЕсли;
	
	СписокИсключений = Новый СписокЗначений;
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	упТипыСобытийМониторинга.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.упТипыСобытийМониторинга КАК упТипыСобытийМониторинга
	|ГДЕ
	|	упТипыСобытийМониторинга.НастраиваемоеСобытиеAndroidКлиента
	|	И НЕ упТипыСобытийМониторинга.Предопределенный
	|	И НЕ упТипыСобытийМониторинга.ПометкаУдаления";
	РезультатЗапроса = Запрос.Выполнить();
	Если Не РезультатЗапроса.Пустой() Тогда
		Выборка = РезультатЗапроса.Выбрать();
		Пока Выборка.Следующий() Цикл
			ДанныеВыбора.Добавить(Выборка.Ссылка);
		КонецЦикла;
	КонецЕсли;
	
	Возврат ДанныеВыбора;
	
КонецФункции

#КонецОбласти

