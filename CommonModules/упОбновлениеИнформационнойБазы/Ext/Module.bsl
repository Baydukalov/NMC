
#Область ПрограммныйИнтерфейс

////////////////////////////////////////////////////////////////////////////////
// Сведения о библиотеке (или конфигурации).

// Заполняет основные сведения о библиотеке или основной конфигурации.
// Библиотека, имя которой имя совпадает с именем конфигурации в метаданных, определяется как основная конфигурация.
// 
// Параметры:
//  Описание - Структура - сведения о библиотеке:
//
//   Имя                 - Строка - имя библиотеки, например, "СтандартныеПодсистемы".
//   Версия              - Строка - версия в формате из 4-х цифр, например, "2.1.3.1".
//
//   ТребуемыеПодсистемы - Массив - имена других библиотек (Строка), от которых зависит данная библиотека.
//          Обработчики обновления таких библиотек должны быть вызваны ранее.
//          обработчиков обновления данной библиотеки.
//          При циклических зависимостях или, напротив, отсутствии каких-либо зависимостей,
//          порядок вызова обработчиков обновления определяется порядком добавления модулей,
//          в процедуре ПриДобавленииПодсистем общего модуля ПодсистемыКонфигурацииПереопределяемый.
//
Процедура ПриДобавленииПодсистемы(Описание) Экспорт
	
	Описание.Имя = "УправлениеПеревозками";
	Описание.Версия = "4.0.1.6";
	
	// Требуется библиотека стандартных подсистем.
	Описание.ТребуемыеПодсистемы.Добавить("СтандартныеПодсистемы");
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Обработчики обновления информационной базы.

// Возвращает менеджер объекта по имени.
// Ограничение: не обрабатываются точки маршрутов бизнес-процессов.
//
// Параметры:
//  Имя - Строка - имя например, "Справочник", "Справочники", "Справочник.Организации".
//
// Возвращаемое значение:
//  СправочникиМенеджер, СправочникМенеджер, ДокументыМенеджер, ДокументМенеджер, ...
// 
Функция МенеджерОбъектаПоИмени(Имя)
	Перем КлассОМ, ИмяОМ, Менеджер;
	
	ЧастиИмени = СтрРазделить(Имя, ".");
	
	Если ЧастиИмени.Количество() > 0 Тогда
		КлассОМ = ВРег(ЧастиИмени[0]);
	КонецЕсли;
	
	Если ЧастиИмени.Количество() > 1 Тогда
		ИмяОМ = ЧастиИмени[1];
	КонецЕсли;
	
	Если      КлассОМ = "ПЛАНОБМЕНА"
	 Или      КлассОМ = "ПЛАНЫОБМЕНА" Тогда
		Менеджер = ПланыОбмена;
		
	ИначеЕсли КлассОМ = "СПРАВОЧНИК"
	      Или КлассОМ = "СПРАВОЧНИКИ" Тогда
		Менеджер = Справочники;
		
	ИначеЕсли КлассОМ = "ДОКУМЕНТ"
	      Или КлассОМ = "ДОКУМЕНТЫ" Тогда
		Менеджер = Документы;
		
	ИначеЕсли КлассОМ = "ЖУРНАЛДОКУМЕНТОВ"
	      Или КлассОМ = "ЖУРНАЛЫДОКУМЕНТОВ" Тогда
		Менеджер = ЖурналыДокументов;
		
	ИначеЕсли КлассОМ = "ПЕРЕЧИСЛЕНИЕ"
	      Или КлассОМ = "ПЕРЕЧИСЛЕНИЯ" Тогда
		Менеджер = Перечисления;
		
	ИначеЕсли КлассОМ = "ОТЧЕТ"
	      Или КлассОМ = "ОТЧЕТЫ" Тогда
		Менеджер = Отчеты;
		
	ИначеЕсли КлассОМ = "ОБРАБОТКА"
	      Или КлассОМ = "ОБРАБОТКИ" Тогда
		Менеджер = Обработки;
		
	ИначеЕсли КлассОМ = "ПЛАНВИДОВХАРАКТЕРИСТИК"
	      Или КлассОМ = "ПЛАНЫВИДОВХАРАКТЕРИСТИК" Тогда
		Менеджер = ПланыВидовХарактеристик;
		
	ИначеЕсли КлассОМ = "ПЛАНСЧЕТОВ"
	      Или КлассОМ = "ПЛАНЫСЧЕТОВ" Тогда
		Менеджер = ПланыСчетов;
		
	ИначеЕсли КлассОМ = "ПЛАНВИДОВРАСЧЕТА"
	      Или КлассОМ = "ПЛАНЫВИДОВРАСЧЕТА" Тогда
		Менеджер = ПланыВидовРасчета;
		
	ИначеЕсли КлассОМ = "РЕГИСТРСВЕДЕНИЙ"
	      Или КлассОМ = "РЕГИСТРЫСВЕДЕНИЙ" Тогда
		Менеджер = РегистрыСведений;
		
	ИначеЕсли КлассОМ = "РЕГИСТРНАКОПЛЕНИЯ"
	      Или КлассОМ = "РЕГИСТРЫНАКОПЛЕНИЯ" Тогда
		Менеджер = РегистрыНакопления;
		
	ИначеЕсли КлассОМ = "РЕГИСТРБУХГАЛТЕРИИ"
	      Или КлассОМ = "РЕГИСТРЫБУХГАЛТЕРИИ" Тогда
		Менеджер = РегистрыБухгалтерии;
		
	ИначеЕсли КлассОМ = "РЕГИСТРРАСЧЕТА"
	      Или КлассОМ = "РЕГИСТРЫРАСЧЕТА" Тогда
		
		Если ЧастиИмени.Количество() < 3 Тогда
			// Регистр расчета
			Менеджер = РегистрыРасчета;
		Иначе
			КлассПодчиненногоОМ = ВРег(ЧастиИмени[2]);
			Если ЧастиИмени.Количество() > 3 Тогда
				ИмяПодчиненногоОМ = ЧастиИмени[3];
			КонецЕсли;
			Если КлассПодчиненногоОМ = "ПЕРЕРАСЧЕТ"
			 Или КлассПодчиненногоОМ = "ПЕРЕРАСЧЕТЫ" Тогда
				// Перерасчет
				Попытка
					Менеджер = РегистрыРасчета[ИмяОМ].Перерасчеты;
					ИмяОМ = ИмяПодчиненногоОМ;
				Исключение
					Менеджер = Неопределено;
				КонецПопытки;
			КонецЕсли;
		КонецЕсли;
		
	ИначеЕсли КлассОМ = "БИЗНЕСПРОЦЕСС"
	      Или КлассОМ = "БИЗНЕСПРОЦЕССЫ" Тогда
		Менеджер = БизнесПроцессы;
		
	ИначеЕсли КлассОМ = "ЗАДАЧА"
	      Или КлассОМ = "ЗАДАЧИ" Тогда
		Менеджер = Задачи;
		
	ИначеЕсли КлассОМ = "КОНСТАНТА"
	      Или КлассОМ = "КОНСТАНТЫ" Тогда
		Менеджер = Константы;
		
	ИначеЕсли КлассОМ = "ПОСЛЕДОВАТЕЛЬНОСТЬ"
	      Или КлассОМ = "ПОСЛЕДОВАТЕЛЬНОСТИ" Тогда
		Менеджер = Последовательности;
	КонецЕсли;
	
	Если Менеджер <> Неопределено Тогда
		Если ЗначениеЗаполнено(ИмяОМ) Тогда
			Попытка
				Возврат Менеджер[ИмяОМ];
			Исключение
				Менеджер = Неопределено;
			КонецПопытки;
		Иначе
			Возврат Менеджер;
		КонецЕсли;
	КонецЕсли;
	
	ВызватьИсключение СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru = 'Не удалось получить менеджер для объекта ""%1""'"), Имя);
	
КонецФункции

// Проверяет, что переданное имя является именем экспортной процедуры конфигурации.
//  Может использоваться для проверки, что переданная строка не содержит произвольного алгоритма
//  на встроенном языке 1С:Предприятия перед использованием его в операторах Выполнить() и Вычислить()
//  при их использовании для динамического вызова методов код конфигурации.
//  Взято из БСП ОбщийМодуль.РаботаВБезопасномРежиме и доработано
//  
//  В случае, если переданная строка не соответствует имени метода конфигурации - генерируется.
//
// Параметры:
//  ИмяМетода	 - Строка	 - имя метода.
//
Процедура ПроверитьИмяМетодаКонфигурации(Знач ИмяМетода) Экспорт
	
	// Проверка предусловий на формат ИмяЭкспортнойПроцедуры.
	ЧастиИмени = СтрРазделить(ИмяМетода, ".");
	Если ЧастиИмени.Количество() <> 2 И ЧастиИмени.Количество() <> 3 Тогда
		ВызватьИсключение СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru = 'Неправильный формат параметра ИмяМетода (передано значение: ""%1"") в РаботаВБезопасномРежиме.ПроверитьИмяМетодаКонфигурации'"), ИмяМетода);
	КонецЕсли;
	
	ИмяОбъекта = ЧастиИмени[0];
	Если ЧастиИмени.Количество() = 2 Тогда
		Если Метаданные.ОбщиеМодули.Найти(ИмяОбъекта) = Неопределено Тогда
			ВызватьИсключение СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				НСтр("ru = 'Неправильный формат параметра ИмяМетода (передано значение: ""%1"") в РаботаВБезопасномРежиме.ПроверитьИмяМетодаКонфигурации:
					|Не найден общий модуль ""%2"".'"),
				ИмяМетода,
				ИмяОбъекта);
		Иначе
			Менеджер = Вычислить(ИмяОбъекта);
		КонецЕсли; 
	КонецЕсли;
	
	Если ЧастиИмени.Количество() = 3 Тогда
		ПолноеИмяОбъекта = ЧастиИмени[0] + "." + ЧастиИмени[1];
		Попытка
			Менеджер = МенеджерОбъектаПоИмени(ПолноеИмяОбъекта);
		Исключение
			Менеджер = Неопределено;
		КонецПопытки;
		Если Менеджер = Неопределено Тогда
			ВызватьИсключение СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				НСтр("ru = 'Неправильный формат параметра ИмяМетода (передано значение: ""%1"") в РаботаВБезопасномРежиме.ПроверитьИмяМетодаКонфигурации:
				           |Не найден менеджер объекта ""%2"".'"),
				ИмяМетода,
				ПолноеИмяОбъекта);
		КонецЕсли;
	КонецЕсли;
	
	ИмяМетодаОбъекта = ЧастиИмени[ЧастиИмени.ВГраница()];
	ВременнаяСтруктура = Новый Структура;
	Попытка
		// Проверка того, что ИмяМетодаОбъекта является допустимым идентификатором.
		// Например: МояПроцедура.
		ВременнаяСтруктура.Вставить(ИмяМетодаОбъекта);
	Исключение
		ЗаписьЖурналаРегистрации(НСтр("ru = 'Безопасное выполнение метода'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка()),
			УровеньЖурналаРегистрации.Ошибка, , , ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		ВызватьИсключение СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru = 'Неправильный формат параметра ИмяМетода (передано значение: ""%1"") в РаботаВБезопасномРежиме.ПроверитьИмяМетодаКонфигурации:
			           |Имя метода ""%2"" не соответствует требованиям образования имен процедур и функций.'"),
			ИмяМетода,
			ИмяМетодаОбъекта);
	КонецПопытки;
	Если Не упСервисныеФункции.МетодРеализован(Менеджер, ИмяМетодаОбъекта) Тогда 
		ВызватьИсключение "У объекта """ + ПолноеИмяОбъекта + """ нет метода """ + ИмяМетодаОбъекта + """";
	КонецЕсли; 
	
КонецПроцедуры

// Добавляет в список процедуры-обработчики обновления данных ИБ
// для всех поддерживаемых версий библиотеки или конфигурации.
// Вызывается перед началом обновления данных ИБ для построения плана обновления.
//
// Параметры:
//  Обработчики - ТаблицаЗначений - описание полей, см. в процедуре
//                ОбновлениеИнформационнойБазы.НоваяТаблицаОбработчиковОбновления.
//
// Пример добавления процедуры-обработчика в список:
//  Обработчик = Обработчики.Добавить();
//  Обработчик.Версия              = "1.1.0.0";
//  Обработчик.Процедура           = "ОбновлениеИБ.ПерейтиНаВерсию_1_1_0_0";
//  Обработчик.РежимВыполнения     = "Монопольно";
//
Процедура ПриДобавленииОбработчиковОбновления(Обработчики) Экспорт
	
	Если НЕ (Истина
		И ОбщегоНазначенияПовтИсп.РазделениеВключено()
		И ОбщегоНазначенияПовтИсп.СеансЗапущенБезРазделителей())
	Тогда
		// Удаляем залипшие в константе некорректные обработчики от тупиковой ветки БСП
		ЗначениеКонстанты = Константы.СведенияОбОбновленииИБ.Получить().Получить();
		КонстантаИзменена = Ложь;
		Если ЗначениеКонстанты <> Неопределено И ЗначениеКонстанты.ДеревоОбработчиков.Колонки.Количество() > 0 Тогда
			СтрокаБСП = ЗначениеКонстанты.ДеревоОбработчиков.Строки.Найти("СтандартныеПодсистемы", "ИмяБиблиотеки");
			Если СтрокаБСП <> Неопределено Тогда
				Для Каждого СтрокаВерсии Из СтрокаБСП.Строки Цикл
					НачальноеКоличество = СтрокаВерсии.Строки.Количество(); 
					Для СчетчикСтрокаВерсии = 1 По НачальноеКоличество Цикл
						СтрокаОбработчика = СтрокаВерсии.Строки[НачальноеКоличество - СчетчикСтрокаВерсии];
						Попытка
							Если ЗначениеЗаполнено(СтрокаОбработчика.ИмяОбработчика) Тогда
								ПроверитьИмяМетодаКонфигурации(СтрокаОбработчика.ИмяОбработчика);
							КонецЕсли; 
							Если ЗначениеЗаполнено(СтрокаОбработчика.ПроцедураЗаполненияДанныхОбновления) Тогда
								ПроверитьИмяМетодаКонфигурации(СтрокаОбработчика.ПроцедураЗаполненияДанныхОбновления);
							КонецЕсли; 
						Исключение
							ИмяОбработчика 	= СтрокаОбработчика.ИмяОбработчика;
							НомерВерсии		= СтрокаОбработчика.НомерВерсии;
							СтрокаВерсии.Строки.Удалить(СтрокаОбработчика);
							ТекстСообщения = "Удален некорректный обработчик обновления """ + ИмяОбработчика + """ для версии " + НомерВерсии;
							ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
							ЗаписьЖурналаРегистрации("УдаленНекорректныйОбработчикОбновления", УровеньЖурналаРегистрации.Предупреждение,,, ТекстСообщения);
							КонстантаИзменена = Истина;
						КонецПопытки;
					КонецЦикла;
				КонецЦикла;
			КонецЕсли; 
		КонецЕсли; 
		Если КонстантаИзменена Тогда
			Константы.СведенияОбОбновленииИБ.Установить(Новый ХранилищеЗначения(ЗначениеКонстанты));
		КонецЕсли; 
	КонецЕсли; 
	
	Обработчик = Обработчики.Добавить();                         
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.2";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенного стиля полигонов географических карт'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упСтилиПолигонов.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.8";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенного стиля линий географических карт'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упСтилиЛиний.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.9";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенного вида перевозки'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упВидыПеревозок.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.10";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенных правил доступности географических зон'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упПравилаДоступностиГеографическихЗон.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.12";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение классов опасности'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упКлассыОпасности.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.12";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Количество потоков обработки событий'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УстановитьКоличествоПотоковОбработкиСобытий";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.13";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение справочника Назначения Датчиков'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упНазначенияДатчиков.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.14";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Установка дельты отклонения от маршрута'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УстановитьДельтуОтклоненияОтМаршрута";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.14";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Установка широты для определения количества метров в градусе'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УстановитьШиротуДляОпределенияКоличестваМетровВГрадусе";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.18";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенных состояний транспортных средств'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УстановитьСостоянияТС";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.19";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение доступности ресурсов для предопределенного правила ""Доступно все""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УстановитьПравилаДоступностиРесурсовДоступноВсе";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.21";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение типа расчета у показателей и правил расчета (Подсистема ""Тарификация"")'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьТипРасчетаПравилПоказателейРасчета";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.23";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление сохраненных параметров планирования (РМ ""Планирование рейсов"")'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПараметрыПланирования";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.26";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Удаление сохраненных настроек для загрузки заявок на перевозку из файла, в связи с их не актуальностью'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УдалитьНастройкиЗагрузкиИзФайлаИзХранилищаОбщихНастроек";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.27";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'По заявке на ТС может быть только одно проведенное предложение и подтверждение. У лишних документов проведение будет отменено'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОтменаПроведенияЛишнихПредложенийИПодтверждений";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.34";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенных видов контактной информации'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПредопределенныеВидыКонтактнойИнформации";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.34";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезаполнение событий по оповещению пользователей'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерезаполнитьСкладскоеСобытиеОповеститьПользователя";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.34";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление сохраненных параметров планирования (РМ ""Планирование рейсов"")'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПараметрыПланирования_НастройкиКарты";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.37";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление общих настроек (РМ ""Планирование рейсов"")'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьОбщиеНастройкиРабочегоМестаПланирования";
   
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.42";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перепроведение документов ""Задание на перевозку груза"" и связанных с ними рейсов. Для корректного перерасчета статуса заданий.'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерепроведениеЗаданийНаПеревозкуГруза";
			
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.51";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перенос данных по рейсам из документа в регистры'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерезаполнитьДанныеПоРейсам";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.55";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезаполнение макетов СКД'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерезаполнитьТипыСобытийПоЗаявкеНаТС";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.57";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение видов транспорта'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УстановитьВидыТранспорта";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.58";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление библиотеки подключаемого оборудования'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "МенеджерОборудованияВызовСервераПереопределяемый.ОбновлениеБиблиотеки";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.59";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление настроек РМ: Назначение ТС на рейсы'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьНастройкиНазначениеТСНаРейсы";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.60";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление сохраненных настроек РМ: Планирование рейсов'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ДобавитьВидПеревозкиВариантамНастроек";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.62";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Допроведение документов ""Рейс"" и ""Подтверждение заявки на ТС""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОтразитьПеревозчикаПоРейсу";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.64";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение иерархии партнеров'");
	Обработчик.РежимВыполнения         = "Отложенно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьИерархиюПартнеров";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.66";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезапись расстояний между точками с учетом времени в пути по дням недели'");
	Обработчик.РежимВыполнения         = "Отложенно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерезаполнитьРасстоянияМеждуТочками";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.67";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление макетов СКД Видов перевозки");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьСКДВидовПеревозки";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.70";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенной модели трекеров'");
	Обработчик.РежимВыполнения         = "Отложенно";
	Обработчик.Процедура               = "Справочники.упМоделиТрекеров.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.70";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенного сервера сбора данных'");
	Обработчик.РежимВыполнения         = "Отложенно";
	Обработчик.Процедура               = "Справочники.упСервераСбораДанных.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.76";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение новых констант'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПроверитьУстановкуИспользованияПартионногоУчетаМатериалов";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.1.77";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенных стилей маркеров'");
	Обработчик.РежимВыполнения         = "Отложенно";
	Обработчик.Процедура               = "Справочники.упСтилиМаркеров.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.80";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Создание простых маркеров'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упСтилиМаркеров.СформироватьПростыеМаркеры";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.1.80";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Создание простых цветовых схем'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упЦветовыеСхемы.СформироватьЦветовыеСхемыПоУмолчанию";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.2";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение статусов соглашений'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнениеСтатусовСоглашений";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.5";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение учетных параметров транспортных средств'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнениеУчетныхПараметровТранспортныхСредств";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.6";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение видов проишествий в справочнике ""Проблемы в пути""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнениеВидаПроишествияУПроблемВПути";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.7";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение типа расчета в справочнике ""Оценочные шкалы""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнениеТипаРасчетаОценочныеШкалы";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.2.11";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение способов учета выработки в учетной политике'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнениеСпособовУчетаВыработкиВУчетнойПолитике";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.12";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Добавление новых параметров планирования'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПараметрыПланированияЗональноеПланирование";	
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.14";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение способов распределения расходов в служебных расследованиях'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьСпособыРасходовВСлужебныхРасследованиях";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.15";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление общих настроек (РМ ""Планирование рейсов"")'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьОбщиеНастройкиРабочегоМестаПланирования_3_0_2_15";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.2.16";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение константы Параметры Маршрутизации СитиГИД'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьПараметрыМаршрутизацииСитиГИД";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.21";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Добавление новых параметров планирования'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПараметрыПланированияМестаИнтереса";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.22";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Добавление новых параметров планирования'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПараметрыПланированияКоличествоВидимыхРейсов";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.26";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Установка активности использования серверов сбора данных'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УстановитьАктивностьСерверовСбораДанных";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.37";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление профилей групп доступа'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьДанныеПрофилейГруппДоступа";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.39";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение данных о пройденных ТО'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьДанныеОПройденныхТО";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.40";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление профилей групп доступа'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ДобавитьРазделТопология";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.43";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезаполнение регистра сведений ""Даты событий""'");
	Обработчик.РежимВыполнения         = "Отложенно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерезаполнениеРегистраДатыСобытий";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.43";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезаполнение регистра сведений ""Даты событий""'");
	Обработчик.РежимВыполнения         = "Отложенно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерезаполнениеРегистраДатыСобытий";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.49";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Формирование движений по регистрам ""Состояние по заданиям"" и ""План по заданиям""'");
	Обработчик.РежимВыполнения         = "Отложенно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьДвиженияВсехДокументовПоСостояниюПоЗаданиям";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.51";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление настроек параметров режимов мониторинга ""Мониторинг рейсов"" и ""Мониторинг транспорта""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПараметрыМониторингаОтсутствиеСвязи";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.52";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Проведение документов ""Рейс"" для заполнения движений по регистру ""Расписание работы водителей""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПроведениеДокументовРейсДляЗаполненияРасписаниеРаботыВодителей";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.54";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление калибровочных графиков'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьКалибровочныеГрафики";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.56";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение реквизита ""Собственное транспортное средство"" у транспортных средств'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьРеквизитСобственноеТранспортноеСредство";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.61";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Фомирование движений по транспортным средствам к планированиюt");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьДвиженияВсехДокументовПоЗанятостиТранспорта";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.63";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Фомирование движений по транспортным средствам к планированиюt");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьДвиженияВсехДокументовПоЗанятостиТранспорта";
		
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.64";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление записей регистра сведений ""Плановые параметры рейса""");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьРегистрСведенийПлановыеПараметрыРейса";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.66";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Удаление записей регистра сведений ""Расписание работы ТС""");
	Обработчик.РежимВыполнения         = "Отложенно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьРегистрСведенийРасписаниеРаботыТС";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.68";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Добавление новых параметров спутникового мониторинга'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПараметрыСпутниковогоМониторингаМестаИнтереса";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.77";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Фомирование движений по транспортным средствам к планированиюt");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьДвиженияВсехДокументовПоЗанятостиТранспорта";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.82";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение реквизита организация в путевом листе");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьОрганизациюПутевогоЛиста";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.83";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление настроек параметров режимов мониторинга ""Мониторинг рейсов"" и ""Мониторинг транспорта""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПараметрыМониторингаОтображатьТрекЦветомПоСкоростиДвижения";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.2.88";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполняется регистр ""НепереданныеДокументы"" по данным документов рейс в статусах ""КВыполнению"" и ""Выполняется""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьОстаткамиРегистрНепереданныеДокументы";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.3.21";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенных видов контактной информации'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПредопределенныеВидыКонтактнойИнформации";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.3.23";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение способа расчета у правил расчета'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьСпособыРасчетаУПравилРасчета";
		
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.3.29";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление данных трекеров'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновлениеДанныхТрекеров";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.3.35";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенных типов документов транспортных средств / водителей'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПредопределенныеТипыДокументовТСВодителей";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.3.36";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезапись показателей расчета'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерезаписатьПоказателиРасчета";
	
	//Обработчик = Обработчики.Добавить();
	//Обработчик.НачальноеЗаполнение     = Истина;
	//Обработчик.Версия                  = "3.0.3.38";
	//Обработчик.ОбщиеДанные             = Ложь;
	//Обработчик.УправлениеОбработчиками = Ложь;
	//Обработчик.Комментарий             = НСтр("ru = 'Перезапись параметров ограничения маршрутизатора СитиГИД'");
	//Обработчик.РежимВыполнения         = "Оперативно";
	//Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьПараметрыМаршрутизацииСитиГИД_3_0_3_38";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.53";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполняется табличная часть ""Рейсы"" непомеченных на удаление путевых листов'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьТабличнуюЧастьРейсыДокументаПутевойЛист";
		
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.53";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезапись параметров ограничения маршрутизатора СитиГИД'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьПараметрыМаршрутизацииСитиГИД_3_0_3_38";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.53";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение реквизита ""Способ учета инкассируемых ценностей"" у видов перевозки'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьСпособУчетаИнкассируемыхЦенностейВидаПеревозки";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.53";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение реквизита ""Вид груза"" в справочнике ""Типы грузов""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьВидГрузаУТипаГруза";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.56";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновляется реквизит ""Пытаться рассчитать снова"" в регистре ""Расстояния между точками""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПытатьсяРассчитатьСноваВРегистреРасстояний";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.56";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновляется реквизит ""Вид транспорта"" в справочниках ""Траспортные средства"" и ""Типы транспорта""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьВидТранспортаВСправочниках";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.3.57";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновляется реквизит ""Ограничение маршрутизатора"" в справочнике ""Виды пропусков на проезд через зону""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьОграничениеМаршрутизаторовВидовПропусков";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.65";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление периода формирования движений документом ""Прохождение точки""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПериодДвиженияМаршрутРаботыПоРейсам";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.71";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение реквизита ""Варианты формирования маршрута"" у видов перевозки'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьВариантФормированияМаршрутаВидаПеревозки";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.72";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезаполнение типов событий по заявке на перевозку груза'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерезаполнитьТипыСобытийПоЗаявкеНаПеревозкуГруза";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.75";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезаполнение реквизитов табличной части грузы ""Заявки на перевозку""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьРеквизитыГрузовВЗаявкеНаПеревозку";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.78";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезаполнение типов событий по рейсу'");
	Обработчик.РежимВыполнения         = "Отложенно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерезаполнитьТипыСобытийПоРейсу";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.3.87";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Замена пустого реквизита правила доступности на ДоступныВсе'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерезаписатьВсеПартнерыИГеографическиеЗоны";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.103";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение реквизита ""Способ учета возвращенных документов"" в справочнике ""Виды перевозок""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьСпособУчетаВозвращенныхДокументов";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.109";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезапись всех правил доступности ресурсов'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерезаписатьПравилаДоступностиРесурсов";

	//Обработчик = Обработчики.Добавить();
	//Обработчик.НачальноеЗаполнение     = Ложь;
	//Обработчик.Версия = "3.0.3.116";
	//Обработчик.НачальноеЗаполнение = Истина;
	//Обработчик.Процедура = "ОрганизацииСлужебный.ОбновитьПредопределенныеВидыКонтактнойИнформацииОрганизаций"; // такого метода и в старом и новом БСП нет, но он указан документации "Переход на версию 2.3.3 с версии 2.3.2"

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.3.119";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение типа контактной информации'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьТипКонтактнойИнформации";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение = Истина;
	Обработчик.Версия = "3.0.4.1";
	Обработчик.ОбщиеДанные = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Процедура = "Справочники.Организации.ОбновитьПредопределенныеВидыКонтактнойИнформацииОрганизаций";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение = Истина;
	Обработчик.Версия = "3.0.4.1";
	Обработчик.ОбщиеДанные = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Процедура = "Справочники.Организации.ЗаполнитьКонстантуИспользоватьНесколькоОрганизаций";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение = Истина;
	Обработчик.Версия = "3.0.4.8";
	Обработчик.ОбщиеДанные = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Процедура = "упОбновлениеИнформационнойБазы.ДобавитьСоглашенияВАналитическиеРазрезыПоПартнерамНаСервере";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение = Истина;
	Обработчик.Версия = "3.0.4.8";
	Обработчик.ОбщиеДанные = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Процедура = "упОбновлениеИнформационнойБазы.ЗаполнитьРесурсСуммаРНРасчетыСЗаказчикамиНаСервере";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение = Ложь;
	Обработчик.Версия = "3.0.4.10";
	Обработчик.ОбщиеДанные = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Процедура = "Справочники.упСхемыОплатыУслуг.ЗаполнитьУчетОтсрочки";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение = Ложь;
	Обработчик.Версия = "3.0.4.15";
	Обработчик.ОбщиеДанные = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий     = НСтр("ru = 'Заполнение табличной части ""Заявки на перевозку груза"" в документах ""Фактические доходы""");
	Обработчик.РежимВыполнения = "Отложенно";
	Обработчик.Процедура = "упОбновлениеИнформационнойБазы.ЗаполнитьЗаявкиНаПеревозкуГрузаВФактическихДоходах";	
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение = Истина;
	Обработчик.Версия = "3.0.4.17";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенного показателя расчета ""Рейс""'");
	Обработчик.Процедура = "упОбновлениеИнформационнойБазы.ЗаполнитьПоказательРасчетаРейс";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.18";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезапись параметров ограничения маршрутизатора СитиГИД'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьПараметрыМаршрутизацииСитиГИД_3_0_3_38";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.26";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезапись параметров спутникового мониторинга'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьСоставПараметровВариантовНастроекРежимовСпутникогоМониторинга";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.4.29";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов у справочника ""Виды перевозок""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовУВидаПеревозки";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.4.37";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение опции ""Разбирать по копиям"" в шаблонах печатных форма");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УстановитьРазборПоКопиямВШаблонахПечатныхФорм";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.47";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'На основании существующих правил расчета с типом расчета ""Произвольный"" формируются тарифные сетки");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.СформироватьТарифныеСеткиИзПравилРасчета";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.48";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Удаление сохраненных настроек для загрузки заявок на перевозку из файла, в связи с их не актуальностью'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УдалитьНастройкиЗагрузкиИзФайлаИзХранилищаОбщихНастроек";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.61";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение версий файлов'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьВерсииФайлов";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.62";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение табл. части ""Рейсы"" фактических расходов с способом ввода расходов ""Расходы по одному рейсу"" и ""Расходы по нескольким рейсам""'");
	Обработчик.РежимВыполнения 		   = "Отложенно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьРейсыВФактическихРасходах";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.4.66";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов у документа ""Пересчет грузовых мест""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовУДокументаПересчетГрузовыхМест";
			
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.68";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Перезаполнение типов событий по маршруту рейса'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерезаполнитьТипыСобытийПоМаршруту";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.69";
	Обработчик.ОбщиеДанные             = Истина;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования альтернативных сайтов'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеАльтернативныхСайтов";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.75";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение регистра сведений ""Аналитические разрезы по партнерам"" элементами справочника""Аналитические разрезы по партнерам""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ФормированиеЗаписейВРСАналитическиеРазрезыПоПартнерам";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.4.85";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенных событий мониторинга'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упТипыСобытийМониторинга.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.4.85";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенных стилей маркеров'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упСтилиМаркеров.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.86";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Установка имен настройкам планирования рейсов'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УстановитьИменаНастройкамПланированияРейсов";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.95";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение реквизита ""Количество грузовых мест"" в заявке на первозку груза и задании на перевозку груза'");
	Обработчик.РежимВыполнения         = "Отложенно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьКоличествоГрузовыхМестВЗаявках";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.95";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение ""Количества грузовых мест"" в плановых/фактических параметрах рейса'");
	Обработчик.РежимВыполнения         = "Отложенно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьКоличествоГрузовыхМестВПлановыхИФактическихПараметрах";
		
	//Обработчик = Обработчики.Добавить();
	//Обработчик.НачальноеЗаполнение     = Ложь;
	//Обработчик.Версия                  = "3.0.4.93";
	//Обработчик.ОбщиеДанные             = Ложь;
	//Обработчик.УправлениеОбработчиками = Ложь;
	//Обработчик.Комментарий             = НСтр("ru = 'Включение компонент");
	//Обработчик.РежимВыполнения         = "Оперативно";
	//Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьОшибочноВыключенныеКомпоненты";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.99";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение способа прохождения точек в видах перевозок'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьСпособыПрохожденияТочек";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.4.101";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение варианта расходов в статьях расходов.'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьВариантРасходовВСтатьяхРасходов";
				
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.5.23";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение зональных настроек маршрутизации по умолчанию.'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьЗональныеНастройкиМаршрутизацииПоУмолчанию";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.29";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Установка режима использования дополнительного оборудования.'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УстановитьРежимИспользованияДополнительногоОборудования";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.5.35";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов у документа ""Установка норм расхода ГСМ""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовУстановкаНормРасходаГСМ";
	
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.5.37";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов у документа ""Лимиты расхода ГСМ""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовУстановкаЛимитовРасходаГСМ";
			
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.5.54";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов у документа ""Заявка на ремонт и ТО транспортного средства""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовЗаявкаНаРемонтИТОТС";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.5.59";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов у документа ""Заявка на ремонт и ТО транспортного средства""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовИзменениеНаправленияДеятельностиТранспортногоСредства";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.66";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполняется новый реквизит ""Тип нормы ГСМ"" справочника ""Нормы ГСМ""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьТипНормыГСМ";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.66";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполняются виды ГСМ в доп. оборудовании, устанавливаются нормы ГСМ.'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнениеНормРасходаГСМДополнительногоОборудования";
	
		
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.66";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполняется табличная часть ""Виды ГСМ"" в транспортных средствах'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьВидыГСМВТранспортныхСредствах";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.69";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение представления координат адресов'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьПредставлениеКоординатыВАдресах";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.71";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Надбавка ""Отопитель"" переносится из шапки документа в табличную часть.'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьНадбавкуРасходаТопливаОтопитель";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.5.72";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов у документа ""Авансовый отчет""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовАвансовыйОтчет";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.5.75";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов для объектов конфигурации Подключение документов и справочников к системам БСП'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитов_3_0_5_75";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.76";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение объекта ремонта в документах ""Ремонт (ТО)""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьОбъектРемонтаВДокументахРемонтИТОТС";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.76";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление состава параметров вариантов настроек управления ремонтами'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьСоставПараметровВариантовНастроекУправленияРемонтами";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.79";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение реквизитов ""Порядок исполнения заявки"" и ""Вид транспортной услуги"" в виде перевозки'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьПорядокИсполненияВВидеПеревозки";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.80";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение реквизитов ""Порядок исполнения заявки"" и ""Вид транспортной услуги"" в документе ""Запрос условий перевозки""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьПорядокИсполненияВДокументеЗапросУсловийПеревозки";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.80";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение реквизитов ""Порядок исполнения заявки"" и ""Вид транспортной услуги"" в документе ""Заявка на перевозку груза""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьПорядокИсполненияВДокументеЗаявкаНаПеревозкуГруза";
		
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.80";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение реквизитов ""Вид транспортной услуги"" в документеЗаданиеНаПеревозкуГруза'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьПорядокИсполненияВДокументеЗаданиеНаПеревозкуГруза";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.80";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение реквизитов ""Порядок исполнения заявки"" и ""Вид транспортной услуги"" в документе ""Рейс""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьПорядокИсполненияВДокументеРейс";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.80";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение реквизитов ""Вид транспортной услуги"" в документе ""Путевой лист""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьПорядокИсполненияВДокументеПутевойЛист";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.86";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Обновление сохраненных настроек отбора списка объектов ремонта (РМ ""Управление ремонтами"")'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьНастройкиОтбораОбъектыРемонта";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.5.88";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов у документа ""Распределение прочих расходов""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовРаспределениеПрочихРасходов";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.5.90";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение настроек ""Используются заявки на пассажирские перевозки"" и ""Используются заявки на спецтехнику""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключититьИспользованиеВидовТранспортныхУслуг";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.5.91";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенных состояний оборудования'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УстановитьСостоянияОборудования";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.92";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Перенос данных из табличной части ""ВидыГСМ"" транспортного средства в регистр сведений ""ВидыГСМТранспортногоСредства""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПереносДанныхВРСВидыГСМ";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.93";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Формирование состояния оборудывания для текущего обновления'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.СформироватьДвиженияСостоянияОборудования";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.95";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Перенос данных по доп. оборудованию из регистра накопления ""Пробеги ТС"" в регистр ""Наработки оборудования""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПереносДанныхИзПробегиТСВНаработкуОборудования";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.97";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Обновляется схема компоновки данных в вариантах распределений'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьСхемуКомпоновкиВВариантахРаспределений";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.100";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Обновляется схема компоновки данных в вариантах распределений'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьСхемуКомпоновкиВВариантахРаспределенийПерезаполнитьПараметры";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.102";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Обновить порядок расчета географически близких точек'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьПорядокПрямогоРасчетаГеографическиБлизкихТочек";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.103";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Обновляется схема компоновки данных в вариантах распределений(используется отбор по подразделениям)'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьСхемуКомпоновкиВВариантахРаспределенийПерезаполнитьПараметрПодразделение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.105";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'По умолчанию у всех вариантов распределения заполняется вариант расходов как ""косвенные расходы""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьВариантРасходовВариантовРаспределения";
	
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.108";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов у документа ""Распределение прямых расходов""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовУРаспределенияПрямыхРасходов";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.5.110";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Установка Ресурс СитиГИД'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УстановитьРесурсСитиГИД";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.112";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Обновляется схема компоновки данных в вариантах распределений(фактические расходы)'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьСхемуКомпоновкиВВариантахРаспределенийФактическаяСуммаРасходов";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.5.114";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Включить использование доп. реквизитов у документа ""Списание прочих расходов""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовУСписаниеПрочихРасходов";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.6.9";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Первоначальное заполнение табличной части ""Виды точек отправления"" видов перевозок.'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнениеВидовТочекОтправленияВидаПеревозки";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.6.12";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов у справочника ""Ввод начальных остатков""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовУВводаНачальныхОстатков";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.6.15";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Удаляются строки из табличной части ""Виды точек отправления"" видов перевозок, с незаполнеными значениями видов точек отправления. Присутствуют в видах перевозки упрощенного порядка исполнения.'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.УдалениеПустыхСтрокВидовТочекОтправленияВидаПеревозки";	
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.6.24";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение вида кассовой техники в справочнике ""Кассы КММ"" значение по умолчанию (АТОЛ).'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнениеВидаКассовойТехникиПоУмолчанию";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.6.33";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'По умолчанию устанавливается признак подбора гаража при возвращении, для всех ТС у которых автоматически подбирались гаражи.'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнениеПризнакаПодбораГаражаПриВозвращении";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.6.51";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление настроек доступного транспорта планирования рейсов'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьНастройкиДоступногоТранспортаПланированияРейсов";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.6.66";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов у документа ""Изменение параметров грузовых мест""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовУИзменениеПараметровГрузовыхМест";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.6.68";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Заполняет в регистрах и документе задание номер конечной точки прибытия для заявок мультимодальной перевозки'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьНомерВЦепиПоставокКонец";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение= Ложь;
	Обработчик.Версия                  = "3.0.6.77";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Заполняет значение измерения ""Документ"" в регистре сведений ""Расписание работы экипажей"" регистратором'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьИзмерениеДокументРСупРасписаниеРаботыЭкипажей";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение= Ложь;
	Обработчик.Версия                  = "3.0.6.78";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов для объектов конфигурации Подключение справочника к системам БСП'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитов_3_0_6_78";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение= Ложь;
	Обработчик.Версия                  = "3.0.6.80";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Заполняются реквизиты роли исполнителя ""Ответственный за подтверждение адресов""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьРеквизитыРолиОтветственныйЗаПодтверждениеАдресов";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.6.81";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Для всех заданий заполняются параметры грузовых мест'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнениеПараметровГрузовПоЗаданиям";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение= Ложь;
	Обработчик.Версия                  = "3.0.6.83";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Перезаполняются схемы в элементах событий с типом исходных действий ""Запись события мониторинга""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ПерезаполнитьТипыСобытийПоСобытиямМониторинга";
	
	Обработчик.НачальноеЗаполнение= Ложь;
	Обработчик.Версия                  = "3.0.6.84";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Заполняет табличную часть""Прочие расходы"" документов ""Распределение расходов будущих периодов""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьПрочиеРасходыПоДокументамРБП";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение= Ложь;
	Обработчик.Версия                  = "3.0.6.85";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Заполняется по умолчанию способ регистрации задолженности по документам в справочнике ""Виды перевозок""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьСпособРегистраЗадолженностиПоДокументамВидаПеревозки";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение= Ложь;
	Обработчик.Версия                  = "3.0.6.87";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов у документа ""Регистрация задолженности по документам рейса""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовУДокументаРегистрацияЗадолженностиПоДокументамРейса";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.6.88";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Заполняется действие у предопределенной проблемы ""Досрочное прохождение""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьДействиеУПредопределеннойПроблемы";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.6.90";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Включение использования доп. реквизитов у документа ""Запрос условий перевозки""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ВключитьИспользованиеДопРеквизитовЗапросУсловийПеревозки";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.6.97";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление состава параметров вариантов настроек планирования рейсов'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьСоставПараметровВариантовНастроекПланированияРейсов";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.6.102";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенных событий мониторинга'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упТипыСобытийМониторинга.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение= Ложь;
	Обработчик.Версия                  = "3.0.6.106";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Заполняются реквизиты роли исполнителя ""Ответственный за согласование изменений маршрута""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьРеквизитыРолиОтветственныйЗаСогласованиеИзмененийМаршрута";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.6.116";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенных событий мониторинга'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упТипыСобытийМониторинга.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение= Ложь;
	Обработчик.Версия                  = "3.0.7.6";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Заполняется исходный родитель в регистре разделения грузовых мест'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьИсходногоРодителяВРегистреРазделенияГрузовыхМест";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.7.7";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение предопределенного стиля маркеров географических карт'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упСтилиМаркеров.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.7.9";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Добавление возможности хранения настроек рабочих мест в разрезе видов услуг перевозки'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьНаименованияОбъектовВариантовНастроек";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.7.10";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Обновление сохраненных настроек отбора списка заданий (РМ ""Планирование рейсов"").'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ОбновитьНастройкиОтбораСпискаЗаданий";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Истина;
	Обработчик.Версия                  = "3.0.7.12";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Начальное заполнение предопределенных статусов документов в WMS.'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "Справочники.упСтатусыДокументовWMS.ПервоначальноеЗаполнение";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "3.0.7.12";
	Обработчик.ОбщиеДанные             = Ложь;
	Обработчик.УправлениеОбработчиками = Ложь;
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение регистров статусов документов в WMS.'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьРегистрыСтатусовWMS";

	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение= Ложь;
	Обработчик.Версия                  = "3.0.7.26";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Заполняется вид транспортной услуги в документе Прохождении точки'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьВидТранспортнойУслугиВПрохожденииТочки";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение= Ложь;
	Обработчик.Версия                  = "4.0.1.5";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Заполняется действие у предопределенной проблемы ""Нет действий""'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьДействиеУПредопределеннойПроблемыНетДействийСлужебная";
		
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "4.0.1.6";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение типа транспортного средства в подтверждениях заявок на ТС.'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнениеПодтвержденийЗаявокНаТСТипомТС";
	
	Обработчик = Обработчики.Добавить();
	Обработчик.НачальноеЗаполнение     = Ложь;
	Обработчик.Версия                  = "4.0.1.6";
	Обработчик.ОбщиеДанные             = Ложь;                                                                  
	Обработчик.УправлениеОбработчиками = Ложь;                    
	Обработчик.Комментарий             = НСтр("ru = 'Заполнение версии мобильного клиента'");
	Обработчик.РежимВыполнения         = "Оперативно";
	Обработчик.Процедура               = "упОбновлениеИнформационнойБазы.ЗаполнитьВерсиюМобильногоКлиента";
	
КонецПроцедуры

// Вызывается перед процедурами-обработчиками обновления данных ИБ.
//
Процедура ПередОбновлениемИнформационнойБазы() Экспорт
	
	
КонецПроцедуры

// Вызывается после завершения обновления данных ИБ.
// 
// Параметры:
//   ПредыдущаяВерсия       - Строка - версия до обновления. "0.0.0.0" для "пустой" ИБ.
//   ТекущаяВерсия          - Строка - версия после обновления.
//   ВыполненныеОбработчики - ДеревоЗначений - список выполненных процедур-обработчиков обновления,
//                                             сгруппированных по номеру версии.
//   ВыводитьОписаниеОбновлений - Булево - (возвращаемое значение) если установить Истина,
//                                то будет выведена форма с описанием обновлений. По умолчанию, Истина.
//   МонопольныйРежим           - Булево - Истина, если обновление выполнялось в монопольном режиме.
//
// Пример обхода выполненных обработчиков обновления:
//
//	Для Каждого Версия Из ВыполненныеОбработчики.Строки Цикл
//		
//		Если Версия.Версия = "*" Тогда
//			// Обработчик, который может выполнятся при каждой смене версии.
//		Иначе
//			// Обработчик, который выполняется для определенной версии.
//		КонецЕсли;
//		
//		Для Каждого Обработчик Из Версия.Строки Цикл
//			...
//		КонецЦикла;
//		
//	КонецЦикла;
//
Процедура ПослеОбновленияИнформационнойБазы(Знач ПредыдущаяВерсия, Знач ТекущаяВерсия,
	Знач ВыполненныеОбработчики, ВыводитьОписаниеОбновлений, МонопольныйРежим) Экспорт
	
	
КонецПроцедуры

// Вызывается при подготовке табличного документа с описанием изменений в программе.
//
// Параметры:
//   Макет - ТабличныйДокумент - описание обновления всех библиотек и конфигурации.
//           Макет можно дополнить или заменить.
//           См. также общий макет ОписаниеИзмененийСистемы.
//
Процедура ПриПодготовкеМакетаОписанияОбновлений(Знач Макет) Экспорт
	
	
КонецПроцедуры

// Позволяет переопределить режим обновления данных информационной базы.
// Для использования в редких (нештатных) случаях перехода, не предусмотренных в
// стандартной процедуре определения режима обновления.
//
// Параметры:
//   РежимОбновленияДанных - Строка - в обработчике можно присвоить одно из значений:
//              "НачальноеЗаполнение"     - если это первый запуск пустой базы (области данных);
//              "ОбновлениеВерсии"        - если выполняется первый запуск после обновление конфигурации базы данных;
//              "ПереходСДругойПрограммы" - если выполняется первый запуск после обновление конфигурации базы данных, 
//                                          в которой изменилось имя основной конфигурации.
//
//   СтандартнаяОбработка  - Булево - если присвоить Ложь, то стандартная процедура
//                                    определения режима обновления не выполняется, 
//                                    а используется значение РежимОбновленияДанных.
//
Процедура ПриОпределенииРежимаОбновленияДанных(РежимОбновленияДанных, СтандартнаяОбработка) Экспорт
	
КонецПроцедуры

// Добавляет в список процедуры-обработчики перехода с другой программы (с другим именем конфигурации).
// Например, для перехода между разными, но родственными конфигурациями: базовая -> проф -> корп.
// Вызывается перед началом обновления данных ИБ.
//
// Параметры:
//  Обработчики - ТаблицаЗначений - с колонками:
//    * ПредыдущееИмяКонфигурации - Строка - имя конфигурации, с которой выполняется переход;
//                                           или "*", если нужно выполнять при переходе с любой конфигурации.
//    * Процедура                 - Строка - полное имя процедуры-обработчика перехода с программы
//                                           ПредыдущееИмяКонфигурации.
//                                  Например, "ОбновлениеИнформационнойБазыУПП.ЗаполнитьУчетнуюПолитику"
//                                  Обязательно должна быть экспортной.
//
// Пример добавления процедуры-обработчика в список:
//  Обработчик = Обработчики.Добавить();
//  Обработчик.ПредыдущееИмяКонфигурации  = "УправлениеТорговлей";
//  Обработчик.Процедура                  = "ОбновлениеИнформационнойБазыУПП.ЗаполнитьУчетнуюПолитику";
//
Процедура ПриДобавленииОбработчиковПереходаСДругойПрограммы(Обработчики) Экспорт

	Обработчик = Обработчики.Добавить();
	Обработчик.ПредыдущееИмяКонфигурации  = "УправлениеПеревозками";
	Обработчик.Процедура                  = "упОбновлениеИнформационнойБазы.ПриЗагрузкеОбластиДанных";
	
КонецПроцедуры

// Вызывается после выполнения всех процедур-обработчиков перехода с другой программы (с другим именем конфигурации),
// и до начала выполнения обновления данных ИБ.
//
// Параметры:
//  ПредыдущееИмяКонфигурации    - Строка - имя конфигурации до перехода.
//  ПредыдущаяВерсияКонфигурации - Строка - имя предыдущей конфигурации (до перехода).
//  Параметры                    - Структура - 
//    * ВыполнитьОбновлениеСВерсии   - Булево - по умолчанию Истина. Если установить Ложь, 
//        то будут выполнена только обязательные обработчики обновления (с версией "*").
//    * ВерсияКонфигурации           - Строка - номер версии после перехода. 
//        По умолчанию, равен значению версии конфигурации в свойствах метаданных.
//        Для того чтобы выполнить, например, все обработчики обновления с версии ПредыдущаяВерсияКонфигурации, 
//        следует установить значение параметра в ПредыдущаяВерсияКонфигурации.
//        Для того чтобы выполнить вообще все обработчики обновления, установить значение "0.0.0.1".
//    * ОчиститьСведенияОПредыдущейКонфигурации - Булево - по умолчанию Истина. 
//        Для случаев когда предыдущая конфигурация совпадает по имени с подсистемой текущей конфигурации, следует
//        указать Ложь.
//
Процедура ПриЗавершенииПереходаСДругойПрограммы(Знач ПредыдущееИмяКонфигурации, 
	Знач ПредыдущаяВерсияКонфигурации, Параметры) Экспорт
	
КонецПроцедуры

#КонецОбласти 

#Область СлужебныеПроцедурыИФункции

// Вызывается при переходе на версию конфигурации 3.0.1.11
//
Процедура ОбновитьРолиИсполнителей() Экспорт
	
	Перевозчик = ПланыВидовХарактеристик.ОбъектыАдресацииЗадач.ВсеОбъектыАдресации;
	
	РольОбъект = Справочники.РолиИсполнителей.ОтветственныйЗаДокументыТСВодителей.ПолучитьОбъект();
	ЗаблокироватьДанныеДляРедактирования(РольОбъект.Ссылка);
	РольОбъект.ИспользуетсяБезОбъектовАдресации = Истина;
	РольОбъект.ИспользуетсяСОбъектамиАдресации  = Истина;
	РольОбъект.ТипыОсновногоОбъектаАдресации    = Перевозчик;
	РольОбъект.Записать();
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.12
//
Процедура УстановитьКоличествоПотоковОбработкиСобытий() Экспорт
	
	Константы.упКоличествоПотоковОбработкиСобытий.Установить(1);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.14
//
Процедура УстановитьДельтуОтклоненияОтМаршрута() Экспорт
	
	Константы.упДельтаОтклоненияОтТочкиМаршрута.Установить(100);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.14
//
Процедура УстановитьШиротуДляОпределенияКоличестваМетровВГрадусе() Экспорт
	
	Константы.упШиротаДляРасчетаКоличестваМетровВГрадусе.Установить(55.666000);	
	Константы.упДолготаНачальная.Установить(37.649500);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.16
//
Процедура ОбновитьПредопределенныеВидыКонтактнойИнформации() Экспорт
	
	Справочники.ВидыКонтактнойИнформации.ЗаполнитьСвойстваВидовКонтактнойИнформации();
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.18
//
Процедура УстановитьСостоянияТС() Экспорт
	
	Справочники.упСостоянияТС.ПервоначальноеЗаполнение();
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.5.90
//
Процедура УстановитьСостоянияОборудования() Экспорт
	
	Справочники.упСостоянияОборудования.ПервоначальноеЗаполнение();
	
КонецПроцедуры // УстановитьСостоянияОборудования()

// Вызывается при переходе на версию конфигурации 3.0.1.19
//
Процедура УстановитьПравилаДоступностиРесурсовДоступноВсе() Экспорт
	
	ОбъектДоступноВсе = Справочники.упПравилаДоступностиРесурсов.ДоступныВсе.ПолучитьОбъект();
	ОбъектДоступноВсе.Записать();
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.21.
//
Процедура ЗаполнитьТипРасчетаПравилПоказателейРасчета() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упПоказателиРасчета.Ссылка
	               |ИЗ
	               |	Справочник.упПоказателиРасчета КАК упПоказателиРасчета
	               |ГДЕ
	               |	упПоказателиРасчета.ТипРасчета = ЗНАЧЕНИЕ(Перечисление.упТипРасчета.ПустаяСсылка)";
	
	текВыборка	= Запрос.Выполнить().Выбрать();
	
	Пока текВыборка.Следующий() Цикл
		ОбъектПоказатель = текВыборка.Ссылка.ПолучитьОбъект();
		ОбъектПоказатель.ТипРасчета = Перечисления.упТипРасчета.Тарификация;
		ОбновлениеИнформационнойБазы.ЗаписатьОбъект(ОбъектПоказатель);
	КонецЦикла;
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упПравилаРасчета.Ссылка
	               |ИЗ
	               |	Справочник.упПравилаРасчета КАК упПравилаРасчета
	               |ГДЕ
	               |	упПравилаРасчета.ТипРасчета = ЗНАЧЕНИЕ(Перечисление.упТипРасчета.ПустаяСсылка)";
	
	текВыборка	= Запрос.Выполнить().Выбрать();
	
	Пока текВыборка.Следующий() Цикл
		ОбъектПравило = текВыборка.Ссылка.ПолучитьОбъект();
		ОбъектПравило.ТипРасчета = Перечисления.упТипРасчета.Тарификация;
		ОбновлениеИнформационнойБазы.ЗаписатьОбъект(ОбъектПравило);
	КонецЦикла;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.23
//
Процедура ОбновитьПараметрыПланирования() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = ""Обработка.упРМПланированиеРейсов.ПараметрыПланирования""
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить("Обработка.упРМПланированиеРейсов.ПараметрыПланирования", Выборка.КлючВарианта);
			Если СохраненныеНастройки <> Неопределено Тогда
				ПараметрыПланирования = СохраненныеНастройки.Результат;	
				Если Не ПараметрыПланирования.Свойство("ПространственныйВес") Тогда
					ПараметрыПланирования.Вставить("ПространственныйВес", 0.4);
				КонецЕсли;
				Если Не ПараметрыПланирования.Свойство("ВременнойВес") Тогда
					ПараметрыПланирования.Вставить("ВременнойВес", 0.4);
				КонецЕсли;
				Если Не ПараметрыПланирования.Свойство("ВесСрочности") Тогда
					ПараметрыПланирования.Вставить("ВесСрочности", 0.2);
				КонецЕсли;
				Если Не ПараметрыПланирования.Свойство("УменьшатьВремяОжидания") Тогда
					ПараметрыПланирования.Вставить("УменьшатьВремяОжидания", Истина);
				КонецЕсли;
				ХранилищаНастроек.упХранилищеНастроек.Сохранить("Обработка.упРМПланированиеРейсов.ПараметрыПланирования", Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры // ОбновитьПараметрыПланирования()

// Вызывается при переходе на версию конфигурации 3.0.1.26
//
Процедура УдалитьНастройкиЗагрузкиИзФайлаИзХранилищаОбщихНастроек() Экспорт
	
   ХранилищеОбщихНастроек.Удалить("ЗагрузкаДанныхИзФайла", "Документ.упЗаявкаНаПеревозкуГруза", Неопределено);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.27.
//  Связано с ошибкой, которая появляется на РМ:НазначениеТСнаРейсы при переходе на закладку "Тендеры".
//	Ошибка - следствие того что существует несколько подтверждений или предложений по одной и той же заявке на ТС.
//
Процедура ОтменаПроведенияЛишнихПредложенийИПодтверждений() Экспорт
	
     // Отменяется проведение подтверждений
	 
	 Запрос = Новый Запрос;
	 Запрос.Текст = "ВЫБРАТЬ
	                |	упЗаявкаНаТС.Ссылка КАК ЗаявкаНаТС,
	                |	упПодтверждениеЗаявкиНаТС.Ссылка
	                |ПОМЕСТИТЬ втПодтверждения
	                |ИЗ
	                |	Документ.упПодтверждениеЗаявкиНаТС КАК упПодтверждениеЗаявкиНаТС
	                |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.упЗаявкаНаТС КАК упЗаявкаНаТС
	                |			ЛЕВОЕ СОЕДИНЕНИЕ Документ.упПредложениеПеревозчика КАК упПредложениеПеревозчика
	                |			ПО (упПредложениеПеревозчика.ЗаявкаНаТС = упЗаявкаНаТС.Ссылка)
	                |		ПО (упЗаявкаНаТС.Ссылка = упПодтверждениеЗаявкиНаТС.Основание
	                |				ИЛИ упПредложениеПеревозчика.Ссылка = упПодтверждениеЗаявкиНаТС.Основание)
	                |			И (упПодтверждениеЗаявкиНаТС.Проведен)
	                |;
	                |
	                |////////////////////////////////////////////////////////////////////////////////
	                |ВЫБРАТЬ
	                |	втПодтверждения.ЗаявкаНаТС
	                |ПОМЕСТИТЬ втЗаявки
	                |ИЗ
	                |	втПодтверждения КАК втПодтверждения
	                |
	                |СГРУППИРОВАТЬ ПО
	                |	втПодтверждения.ЗаявкаНаТС
	                |
	                |ИМЕЮЩИЕ
	                |	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ втПодтверждения.Ссылка) > 1
	                |;
	                |
	                |////////////////////////////////////////////////////////////////////////////////
	                |ВЫБРАТЬ
	                |	втПодтверждения.Ссылка,
	                |	втПодтверждения.ЗаявкаНаТС
	                |ИЗ
	                |	втПодтверждения КАК втПодтверждения
	                |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втЗаявки КАК втЗаявки
	                |		ПО втПодтверждения.ЗаявкаНаТС = втЗаявки.ЗаявкаНаТС
	                |
	                |УПОРЯДОЧИТЬ ПО
	                |	втПодтверждения.Ссылка.МоментВремени УБЫВ
	                |ИТОГИ ПО
	                |	втПодтверждения.ЗаявкаНаТС";
	 
	 текВыборкаЗаявкаНаТС	= Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	 
	 Пока текВыборкаЗаявкаНаТС.Следующий() Цикл
		 
		 йй = 0;
		 текВыборкаДокумент = текВыборкаЗаявкаНаТС.Выбрать();
		 
		 Пока текВыборкаДокумент.Следующий() Цикл
			 
			 // Остается последний на временной оси дкумент, остальные отменяются.
			 Если йй > 0 Тогда
				 ДокументОбъект = текВыборкаДокумент.Ссылка.ПолучитьОбъект();
				 ДокументОбъект.Записать(РежимЗаписиДокумента.ОтменаПроведения);
			 КонецЕсли;
			 
			 йй = йй + 1;
			 
		 КонецЦикла;
		 
	 КонецЦикла;
	 	 
	 // Отменяется проведение предложений.
	 
	 Запрос = Новый Запрос;
	 Запрос.Текст = "ВЫБРАТЬ
	                |	упПредложениеПеревозчика.ЗаявкаНаТС КАК ЗаявкаНаТС
	                |ПОМЕСТИТЬ ЗаявкиНаТС
	                |ИЗ
	                |	Документ.упПредложениеПеревозчика КАК упПредложениеПеревозчика
	                |ГДЕ
	                |	упПредложениеПеревозчика.Проведен
	                |
	                |СГРУППИРОВАТЬ ПО
	                |	упПредложениеПеревозчика.ЗаявкаНаТС
	                |
	                |ИМЕЮЩИЕ
	                |	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ упПредложениеПеревозчика.Ссылка) > 1
	                |;
	                |
	                |////////////////////////////////////////////////////////////////////////////////
	                |ВЫБРАТЬ
	                |	упПредложениеПеревозчика.Ссылка КАК Ссылка,
	                |	упПредложениеПеревозчика.ЗаявкаНаТС КАК ЗаявкаНаТС,
	                |	ВЫБОР
	                |		КОГДА упПодтверждениеЗаявкиНаТС.Ссылка ЕСТЬ NULL 
	                |			ТОГДА 0
	                |		ИНАЧЕ 1
	                |	КОНЕЦ КАК ЕстьПроведенноеПодтверждение
	                |ИЗ
	                |	ЗаявкиНаТС КАК ЗаявкиНаТС
	                |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.упПредложениеПеревозчика КАК упПредложениеПеревозчика
	                |		ПО ЗаявкиНаТС.ЗаявкаНаТС = упПредложениеПеревозчика.ЗаявкаНаТС
	                |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.упПодтверждениеЗаявкиНаТС КАК упПодтверждениеЗаявкиНаТС
	                |		ПО (упПодтверждениеЗаявкиНаТС.Основание = упПредложениеПеревозчика.Ссылка)
	                |			И (упПодтверждениеЗаявкиНаТС.Проведен)
	                |
	                |УПОРЯДОЧИТЬ ПО
	                |	ЕстьПроведенноеПодтверждение УБЫВ,
	                |	упПредложениеПеревозчика.МоментВремени УБЫВ
	                |ИТОГИ ПО
	                |	ЗаявкаНаТС";
	 
	 текВыборкаЗаявкаНаТС	= Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	 
	 Пока текВыборкаЗаявкаНаТС.Следующий() Цикл
		 
		 йй = 0;
		 текВыборкаДокумент = текВыборкаЗаявкаНаТС.Выбрать();
		 
		 Пока текВыборкаДокумент.Следующий() Цикл
			 
			 // Остается последний на временной оси дкумент, остальные отменяются.
			 Если йй > 0 Тогда
				 ДокументОбъект = текВыборкаДокумент.Ссылка.ПолучитьОбъект();
				 ДокументОбъект.Записать(РежимЗаписиДокумента.ОтменаПроведения);
			 КонецЕсли;
			 
			 йй = йй + 1;
			 
		 КонецЦикла;
		 
	 КонецЦикла;
	 
 КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.34
//
Процедура ПерезаполнитьСкладскоеСобытиеОповеститьПользователя() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	упТипыСобытий.Ссылка,
	|	упТипыСобытий.Получатели
	|ИЗ
	|	Справочник.упТипыСобытий КАК упТипыСобытий
	|ГДЕ
	|	упТипыСобытий.АлгоритмОбработки = ЗНАЧЕНИЕ(Перечисление.упАлгоритмыОбработкиСобытия.ОповеститьПользователя)
	|	И упТипыСобытий.ВидПолучателей = ЗНАЧЕНИЕ(Перечисление.упВидыПолучателейСообщений.ПустаяСсылка)";
	Выборка = Запрос.Выполнить().Выбрать();             
	
	Пока Выборка.Следующий() Цикл 
		текОбъект = Выборка.Ссылка.ПолучитьОбъект();
		Если ТипЗнч(Выборка.Получатели) = Тип("СправочникСсылка.Пользователи") тогда
			текОбъект.ВидПолучателей = Перечисления.упВидыПолучателейСообщений.Пользователь;
		ИначеЕсли ТипЗнч(Выборка.Получатели) = Тип("СправочникСсылка.ГруппыПользователей") тогда
			текОбъект.ВидПолучателей = Перечисления.упВидыПолучателейСообщений.ГруппаПользователей;
		Иначе
			текОбъект.ВидПолучателей = Перечисления.упВидыПолучателейСообщений.Строка;
		КонецЕсли;
		текОбъект.Записать();
	КонецЦикла;
	
КонецПроцедуры	

// Вызывается при переходе на версию конфигурации 3.0.5.83
//
Процедура ОбновитьНастройкиОтбораОбъектыРемонта() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = ""Обработка.упРМУправлениеРемонтами.НастройкаСпискаОбъектовРемонта""
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		
		СхемаКомпоновкиДанных = Обработки.упРМУправлениеРемонтами.ПолучитьМакет("ОбъектыРемонта");
		АдресСхемыКомпоновкиДанных = ПоместитьВоВременноеХранилище(СхемаКомпоновкиДанных, Новый УникальныйИдентификатор);
		ИсточникНастроек = Новый ИсточникДоступныхНастроекКомпоновкиДанных(АдресСхемыКомпоновкиДанных);
		КомпоновщикНастроек = Новый КомпоновщикНастроекКомпоновкиДанных;
		КомпоновщикНастроек.Инициализировать(ИсточникНастроек);
		
		Пока Выборка.Следующий() Цикл
			сткНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить("Обработка.упРМУправлениеРемонтами.НастройкаСпискаОбъектовРемонта", Выборка.КлючВарианта);
			КомпоновщикНастроек.ЗагрузитьНастройки(СхемаКомпоновкиДанных.НастройкиПоУмолчанию);
			упСервисныеФункцииВызовСервера.СкопироватьЭлементы(КомпоновщикНастроек.Настройки.Отбор, сткНастройки.НастройкиКомпоновкиДанных.Отбор);
			сткНастройки.НастройкиКомпоновкиДанных = КомпоновщикНастроек.Настройки;
			ХранилищаНастроек.упХранилищеНастроек.Сохранить("Обработка.упРМУправлениеРемонтами.НастройкаСпискаОбъектовРемонта", Выборка.КлючВарианта, сткНастройки);
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры // ОбновитьНастройкиОтбораОбъектыРемонта()

// Вызывается при переходе на версию конфигурации 3.0.1.34
//
Процедура ОбновитьПараметрыПланирования_НастройкиКарты() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = ""Обработка.упРМПланированиеРейсов.ПараметрыПланирования""
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить("Обработка.упРМПланированиеРейсов.ПараметрыПланирования", Выборка.КлючВарианта);
			Если СохраненныеНастройки <> Неопределено Тогда
				ПараметрыПланирования = СохраненныеНастройки.Результат;	
				Если Не ПараметрыПланирования.Свойство("ВыделятьКрупныеГрузы") Тогда
					ПараметрыПланирования.Вставить("ВыделятьКрупныеГрузы", Ложь);
				КонецЕсли;
				Если Не ПараметрыПланирования.Свойство("ПоказательКрупногоГруза") Тогда
					ПараметрыПланирования.Вставить("ПоказательКрупногоГруза", 0);
				КонецЕсли;
				Если Не ПараметрыПланирования.Свойство("РазмерКрупногоГруза") Тогда
					ПараметрыПланирования.Вставить("РазмерКрупногоГруза", 1000);
				КонецЕсли;
				Если Не ПараметрыПланирования.Свойство("ВыделятьСрочныеГрузы") Тогда
					ПараметрыПланирования.Вставить("ВыделятьСрочныеГрузы", Ложь);
				КонецЕсли;
				ХранилищаНастроек.упХранилищеНастроек.Сохранить("Обработка.упРМПланированиеРейсов.ПараметрыПланирования", Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры // ОбновитьПараметрыПланирования_НастройкиКарты()

// Вызывается при переходе на версию конфигурации 3.0.1.37
//
Процедура ОбновитьОбщиеНастройкиРабочегоМестаПланирования() Экспорт
	
	КлючОбъекта =  "Обработка.упРМПланированиеРейсов.ОбщиеНастройки";
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = &Объект
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Запрос.УстановитьПараметр("Объект", КлючОбъекта);
	
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить(КлючОбъекта, Выборка.КлючВарианта);
			Если СохраненныеНастройки <> Неопределено И ТипЗнч(СохраненныеНастройки) = Тип("Структура") Тогда
				ПериодПланирования = СохраненныеНастройки.ПериодПланирования;
				СохраненныеНастройки.Вставить("НачалоПериода"   , '00010101');
				СохраненныеНастройки.Вставить("ОкончаниеПериода", '00010101');
				Если ТипЗнч(ПериодПланирования) = Тип("СтандартныйПериод") Тогда
					СохраненныеНастройки.НачалоПериода  = ПериодПланирования.ДатаНачала;
					СохраненныеНастройки.ОкончаниеПериода = ПериодПланирования.Датаокончания;
				КонецЕсли;
				ХранилищаНастроек.упХранилищеНастроек.Сохранить(КлючОбъекта, Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.42
//
Процедура ПерепроведениеЗаданийНаПеревозкуГруза() Экспорт
	
	мсвСтатусыЗаданий = Новый Массив();
	мсвСтатусыЗаданий.Добавить(Перечисления.упСтатусыЗаданияНаПеревозкуГруза.КПланированию);
	мсвСтатусыЗаданий.Добавить(Перечисления.упСтатусыЗаданияНаПеревозкуГруза.ВключеноВРейс);
	мсвСтатусыЗаданий.Добавить(Перечисления.упСтатусыЗаданияНаПеревозкуГруза.КВыполнению);
	мсвСтатусыЗаданий.Добавить(Перечисления.упСтатусыЗаданияНаПеревозкуГруза.ВПути);
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упЗаданиеНаПеревозкуГруза.Ссылка,
	               |	упЗаданиеНаПеревозкуГруза.Представление,
	               |	упСтатусыЗаданийНаПеревозкуГрузаСрезПоследних.Статус
	               |ИЗ
	               |	Документ.упЗаданиеНаПеревозкуГруза КАК упЗаданиеНаПеревозкуГруза
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упСтатусыЗаданийНаПеревозкуГруза.СрезПоследних КАК упСтатусыЗаданийНаПеревозкуГрузаСрезПоследних
	               |		ПО (упСтатусыЗаданийНаПеревозкуГрузаСрезПоследних.Документ = упЗаданиеНаПеревозкуГруза.Ссылка)
	               |ГДЕ
	               |	упСтатусыЗаданийНаПеревозкуГрузаСрезПоследних.Статус В(&мсвСтатусы)";
	Запрос.УстановитьПараметр("мсвСтатусы", мсвСтатусыЗаданий);
	ТекстСообщения = Нстр("ru = 'Начало перепроведения заданий на перевозку'");
	ЗаписьЖурналаРегистрации("РезультатВыполненияПерепроведенияЗаданийНачало", УровеньЖурналаРегистрации.Предупреждение,,,ТекстСообщения);
	РезультатЗапроса = Запрос.Выполнить();
	тбзЗадания 	= РезультатЗапроса.Выгрузить();
	текВыборка	= Запрос.Выполнить().Выбрать();
	текНеУдалосьЗаписатьЗаданий = 0;
	текНеУдалосьЗаписатьРейсов	= 0;
	текВсегоЗаданий	= текВыборка.Количество();
	текЗаданияНеУдалосьЗаписать = "";
	Пока текВыборка.Следующий() Цикл
		текЗаданиеНаПеревозкуГруза 	= текВыборка.Ссылка;
		текПредставление 			= текВыборка.Представление;
		
		Отказ = Ложь;
		НачатьТранзакцию(РежимУправленияБлокировкойДанных.Управляемый);
		
		ЗаданиеНаПеревозкуГрузаОбъект = текЗаданиеНаПеревозкуГруза.ПолучитьОбъект();
		ЗаданиеНаПеревозкуГрузаОбъект.ДополнительныеСвойства.Вставить("ЗаписыватьСтатус", Истина);
		ЗаданиеНаПеревозкуГрузаОбъект.ДополнительныеСвойства.Вставить("Статус", Перечисления.упСтатусыЗаданияНаПеревозкуГруза.КПланированию);
		Попытка
			ЗаданиеНаПеревозкуГрузаОбъект.Записать(РежимЗаписиДокумента.Проведение);	
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Отказ = Истина;
			текЗаданияНеУдалосьЗаписать = текЗаданияНеУдалосьЗаписать + текПредставление + Символы.ПС;
			ТекстСообщения = Нстр("ru = 'Ошибка при проведении задания на перевозку %1. Описание ошибки: %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			текНеУдалосьЗаписатьЗаданий = текНеУдалосьЗаписатьЗаданий + 1;
			ЗаписьЖурналаРегистрации("ОшибкаПриПроведенииЗаданияНаПеревозку", УровеньЖурналаРегистрации.Ошибка,,ЗаданиеНаПеревозкуГрузаОбъект,ТекстСообщения,РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
		КонецПопытки;
		
		Если НЕ Отказ Тогда
			ЗапросРейс = Новый Запрос;
			ЗапросРейс.Текст = "ВЫБРАТЬ
			                   |	упРейсЗадания.Ссылка,
			                   |	упРейсЗадания.Ссылка.Представление КАК Представление
			                   |ИЗ
			                   |	Документ.упРейс.Задания КАК упРейсЗадания
			                   |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.упСтатусыРейсов.СрезПоследних КАК упСтатусыРейсовСрезПоследних
			                   |		ПО упРейсЗадания.Ссылка = упСтатусыРейсовСрезПоследних.Документ
			                   |ГДЕ
			                   |	упРейсЗадания.Задание = &Задание";
			ЗапросРейс.УстановитьПараметр("Задание", текЗаданиеНаПеревозкуГруза);
			
			текВыборкаРейс	= ЗапросРейс.Выполнить().Выбрать();
			
			Пока текВыборкаРейс.Следующий() Цикл
				РейсОбъект = текВыборкаРейс.Ссылка.ПолучитьОбъект();		
				текПредставление = текВыборкаРейс.Представление;
				Попытка
					РейсОбъект.Записать(РежимЗаписиДокумента.Проведение);	
				Исключение
					ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
					Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
						ОписаниеОшибки = ОписаниеОшибки();
					КонецЕсли;

					текНеУдалосьЗаписатьРейсов = текНеУдалосьЗаписатьРейсов + 1;
					Отказ = Истина;
					ТекстСообщения = Нстр("ru = 'Ошибка при проведении задания на перевозку %1. Описание ошибки: %2'");
					ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
					ЗаписьЖурналаРегистрации("ОшибкаПриПроведенииРейс", УровеньЖурналаРегистрации.Ошибка,,РейсОбъект,ТекстСообщения,РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
				КонецПопытки;
				
				Если Отказ Тогда
					Прервать;
				КонецЕсли;
				
			КонецЦикла;
		КонецЕсли;
		Если НЕ Отказ Тогда
			ЗафиксироватьТранзакцию();
		Иначе
			ОтменитьТранзакцию();
		КонецЕсли;
	КонецЦикла;	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	тбЗадания.Ссылка,
	               |	тбЗадания.Статус
	               |ПОМЕСТИТЬ втЗадания
	               |ИЗ
	               |	&тбЗадания КАК тбЗадания
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втЗадания.Ссылка,
	               |	втЗадания.Статус,
	               |	упСтатусыЗаданийНаПеревозкуГрузаСрезПоследних.Статус КАК НовыйСтатус
	               |ИЗ
	               |	втЗадания КАК втЗадания
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упСтатусыЗаданийНаПеревозкуГруза.СрезПоследних КАК упСтатусыЗаданийНаПеревозкуГрузаСрезПоследних
	               |		ПО втЗадания.Ссылка = упСтатусыЗаданийНаПеревозкуГрузаСрезПоследних.Документ
	               |ГДЕ
	               |	втЗадания.Статус <> упСтатусыЗаданийНаПеревозкуГрузаСрезПоследних.Статус";
	Запрос.УстановитьПараметр("тбЗадания", тбзЗадания);
	текРезультат = Запрос.Выполнить(); 
	Если НЕ текРезультат.Пустой() Тогда
		ТекстСообщения = Нстр("ru = 'Результат выполнения перепроведения заданий'");
		ЗаписьЖурналаРегистрации("РезультатВыполненияПерепроведенияЗаданий", УровеньЖурналаРегистрации.Информация,,,ТекстСообщения);
	Иначе	
		ТекстСообщения = Нстр("ru = 'Результат выполнения перепроведения заданий: ни одно задание на перевозку статус не поменяло'");
		ЗаписьЖурналаРегистрации("РезультатВыполненияПерепроведенияЗаданий", УровеньЖурналаРегистрации.Информация,,,ТекстСообщения);
	КонецЕсли;
	
	текВыборка	= Запрос.Выполнить().Выбрать();
	
	Пока текВыборка.Следующий() Цикл
		
		ТекстСообщения = Нстр("ru = 'Задание %1 изменило статус с %2 на %3'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текВыборка.Ссылка, текВыборка.Статус, текВыборка.НовыйСтатус);
		ЗаписьЖурналаРегистрации("РезультатВыполненияПерепроведенияЗаданий", УровеньЖурналаРегистрации.Информация,,,ТекстСообщения);
	   		
	КонецЦикла;
	ТекстСообщения = Нстр("ru = 'Всего заданий: %1;Не удалось провести заданий:%2; Не удалось провести рейсов:%3'");
	ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текВсегоЗаданий, текНеУдалосьЗаписатьЗаданий, текНеУдалосьЗаписатьРейсов);
	ЗаписьЖурналаРегистрации("РезультатВыполненияПерепроведенияЗаданийКонец", УровеньЖурналаРегистрации.Предупреждение,,,ТекстСообщения);
	
	Если текНеУдалосьЗаписатьЗаданий > 0  Тогда
		ТекстСообщения = Нстр("ru = 'Не удалось записать задания %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текЗаданияНеУдалосьЗаписать);
		ЗаписьЖурналаРегистрации("РезультатВыполненияПерепроведенияЗаданийКонец", УровеньЖурналаРегистрации.Предупреждение,,,ТекстСообщения);	
	КонецЕсли;

	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.51
//
Процедура ПерезаполнитьДанныеПоРейсам() Экспорт
	
	// по возможности отменяем рейсы
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упРейс.Ссылка
	|ИЗ
	|	Документ.упРейс КАК упРейс
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.упСтатусыРейсов.СрезПоследних КАК упСтатусыРейсовСрезПоследних
	|		ПО (упСтатусыРейсовСрезПоследних.Документ = упРейс.Ссылка)
	|			И (НЕ упСтатусыРейсовСрезПоследних.Статус В (ЗНАЧЕНИЕ(Перечисление.упСтатусыРейса.Выполнен), ЗНАЧЕНИЕ(Перечисление.упСтатусыРейса.Завершен)))";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			РейсОбъект = Выборка.Ссылка.ПолучитьОбъект();
			РейсОбъект.ДополнительныеСвойства.Вставить("Статус", Перечисления.упСтатусыРейса.Отменен);
			Попытка
				РейсОбъект.Записать(РежимЗаписиДокумента.Проведение);
			Исключение
				Отказ = Истина;                                                                                                                                                                                                                                                                                                                                                                                                                                                 
				ТекстСообщения = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ТекстСообщения) Тогда 
					ТекстСообщения = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Отмена рейса", УровеньЖурналаРегистрации.Ошибка, Метаданные.Документы.упРейс,, ТекстСообщения);
			КонецПопытки;
		КонецЦикла; 
	КонецЕсли; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.55
//
Процедура ПерезаполнитьТипыСобытийПоЗаявкеНаТС() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упТипыСобытий.Ссылка
	|ИЗ
	|	Справочник.упТипыСобытий КАК упТипыСобытий
	|ГДЕ
	|	упТипыСобытий.ТипИсходногоДействия = ЗНАЧЕНИЕ(Перечисление.упТипыДействийСобытий.ИзменениеСтатусаЗаявкиНаТС)";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			ТипСобытияОбъект = Выборка.Ссылка.ПолучитьОбъект();
			СхемаКомпоновкиДанных = ТипСобытияОбъект.СхемаКомпоновкиДанных.Получить();
			
			СхемаКомпоновкиДанныхНовая = Справочники.упТипыСобытий.ПолучитьМакет("ЗаявкаНаТС");
			Если СхемаКомпоновкиДанных <> Неопределено Тогда 
				упСервисныеФункцииВызовСервера.СкопироватьЭлементы(СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.Отбор, СхемаКомпоновкиДанных.НастройкиПоУмолчанию.Отбор);
			КонецЕсли;
			
			ТипСобытияОбъект.СхемаКомпоновкиДанных = Новый ХранилищеЗначения(СхемаКомпоновкиДанныхНовая);
			ТипСобытияОбъект.Записать(); 
		КонецЦикла;
	КонецЕсли; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.57
//
Процедура УстановитьВидыТранспорта() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упТранспортныеСредства.Ссылка
	|ИЗ
	|	Справочник.упТранспортныеСредства КАК упТранспортныеСредства
	|ГДЕ
	|	НЕ упТранспортныеСредства.ПометкаУдаления
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	упТипыТС.Ссылка
	|ИЗ
	|	Справочник.упТипыТС КАК упТипыТС
	|ГДЕ
	|	НЕ упТипыТС.ПометкаУдаления";
	Результат = Запрос.ВыполнитьПакет();
	Если Не Результат[0].Пустой() Тогда
		Выборка = Результат[0].Выбрать();
		Пока Выборка.Следующий() Цикл
			текОбъект = Выборка.Ссылка.ПолучитьОбъект();
			текОбъект.ВидТранспорта = Перечисления.упВидыТранспорта.ЛегковойАвтомобиль;
			Попытка
				текОбъект.Записать();
			Исключение
				ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
					ОписаниеОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Ошибка записи", УровеньЖурналаРегистрации.Ошибка,, текОбъект, ОписаниеОшибки);
			КонецПопытки;
		КонецЦикла; 
	КонецЕсли;
	
	Если Не Результат[1].Пустой() Тогда
		Выборка = Результат[1].Выбрать();
		Пока Выборка.Следующий() Цикл
			текОбъект = Выборка.Ссылка.ПолучитьОбъект();
			текОбъект.ВидТранспорта = Перечисления.упВидыТранспорта.ЛегковойАвтомобиль;
			Попытка
				текОбъект.Записать();
			Исключение
				ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
					ОписаниеОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Ошибка записи", УровеньЖурналаРегистрации.Ошибка,, текОбъект, ОписаниеОшибки);
			КонецПопытки;
		КонецЦикла; 
	КонецЕсли; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.59
//
Процедура ОбновитьНастройкиНазначениеТСНаРейсы() Экспорт
	
	ЗаполнитьПараметрыПоУмолчанию = Истина;
	СписокПараметров = ОбщегоНазначенияВызовСервера.ХранилищеНастроекДанныхФормЗагрузить("упРМНазначенияТСНаРейсы", "ПараметрыКонтроляСовместимости", Неопределено);
	Если СписокПараметров <> Неопределено И ТипЗнч(СписокПараметров) = Тип("Структура") Тогда
		СписокПараметров.Вставить("КонтрольРасписанияРаботыТС", Ложь);	
		ОбщегоНазначенияВызовСервера.ХранилищеНастроекДанныхФормСохранить("упРМНазначенияТСНаРейсы", "ПараметрыКонтроляСовместимости", СписокПараметров);
	КонецЕсли;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.60
//
Процедура ДобавитьВидПеревозкиВариантамНастроек() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	упВариантыНастроек.Ссылка,
	|	упВариантыНастроек.Настройки
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	НЕ упВариантыНастроек.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			сткНастройки = Выборка.Настройки.Получить();
			Если ТипЗнч(сткНастройки) = Тип("Структура") И сткНастройки.Свойство("ВидПеревозки") Тогда
				ВыборкаОбъект = Выборка.Ссылка.ПолучитьОбъект();
				ВыборкаОбъект.ВидПеревозки = сткНастройки.ВидПеревозки;
				сткНастройки.Удалить("ВидПеревозки");
				ВыборкаОбъект.Настройки = Новый ХранилищеЗначения(сткНастройки);
				ВыборкаОбъект.Записать();
			КонецЕсли; 
		КонецЦикла; 
	КонецЕсли; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.62
//
Процедура ОтразитьПеревозчикаПоРейсу() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст ="ВЫБРАТЬ
	|	упПодтверждениеЗаявкиНаТС.Ссылка,
	|	упПодтверждениеЗаявкиНаТС.Дата,
	|	упПодтверждениеЗаявкиНаТС.Рейс,
	|	упПодтверждениеЗаявкиНаТС.Перевозчик,
	|	упПодтверждениеЗаявкиНаТС.ТранспортноеСредство,
	|	упПодтверждениеЗаявкиНаТС.ТранспортноеСредство.ТипТС КАК ТипТС,
	|	упПодтверждениеЗаявкиНаТС.Соглашение,
	|	упПодтверждениеЗаявкиНаТС.КонтрагентПеревозчика,
	|	упПодтверждениеЗаявкиНаТС.Водитель1,
	|	упПодтверждениеЗаявкиНаТС.Водитель2,
	|	упПодтверждениеЗаявкиНаТС.Экспедитор
	|ИЗ
	|	Документ.упПодтверждениеЗаявкиНаТС КАК упПодтверждениеЗаявкиНаТС
	|ГДЕ
	|	упПодтверждениеЗаявкиНаТС.Проведен";
	
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		НаборЗаписей = РегистрыСведений.упПеревозчикПоРейсу.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.Регистратор.Установить(Выборка.Ссылка); 
		НоваяЗапись = НаборЗаписей.Добавить(); 
		НоваяЗапись.Период = Выборка.Дата;
		ЗаполнитьЗначенияСвойств(НоваяЗапись, Выборка);
		Попытка
			НаборЗаписей.Записать(); 
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			ЗаписьЖурналаРегистрации("ЗаписьПеревозчикаПоРейсу", УровеньЖурналаРегистрации.Ошибка,, Выборка.Ссылка, ОписаниеОшибки);
		КонецПопытки;
	КонецЦикла;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.64
//
Процедура ЗаполнитьИерархиюПартнеров(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упПартнеры.Ссылка
	|ИЗ
	|	Справочник.упПартнеры КАК упПартнеры
	|ГДЕ
	|	упПартнеры.Родитель = ЗНАЧЕНИЕ(Справочник.упПартнеры.ПустаяСсылка)";
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		Справочники.упПартнеры.ЗаписатьИерархиюПартнера(Выборка.Ссылка);
	КонецЦикла;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.66
//
Процедура ПерезаполнитьРасстоянияМеждуТочками(Параметры) Экспорт
	
	Пока Истина Цикл
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ ПЕРВЫЕ 1000
		|	упРасстоянияМеждуТочками.НачальнаяШирота,
		|	упРасстоянияМеждуТочками.НачальнаяДолгота,
		|	упРасстоянияМеждуТочками.КонечнаяШирота,
		|	упРасстоянияМеждуТочками.КонечнаяДолгота,
		|	упРасстоянияМеждуТочками.Ограничение
		|ИЗ
		|	РегистрСведений.упРасстоянияМеждуТочками КАК упРасстоянияМеждуТочками
		|ГДЕ
		|	упРасстоянияМеждуТочками.Время <> 0
		|	И упРасстоянияМеждуТочками.ВремяПонедельник = 0
		|	И упРасстоянияМеждуТочками.ПопыткаРасчета = 0
		|	И упРасстоянияМеждуТочками.АвтоматическийРасчет = ИСТИНА";
		Результат = Запрос.Выполнить();
		Если Не Результат.Пустой() Тогда
			
			Выборка = Результат.Выбрать();
			Пока Выборка.Следующий() Цикл
				Запись = РегистрыСведений.упРасстоянияМеждуТочками.СоздатьМенеджерЗаписи();
				Запись.НачальнаяШирота      = Выборка.НачальнаяШирота;
				Запись.НачальнаяДолгота     = Выборка.НачальнаяДолгота;
				Запись.КонечнаяШирота       = Выборка.КонечнаяШирота;
				Запись.КонечнаяДолгота      = Выборка.КонечнаяДолгота;
				Запись.Ограничение = Выборка.Ограничение;
				Запись.Прочитать();
				
				Запись.ВремяПонедельник = Запись.Время;
				Запись.ВремяВторник     = Запись.Время;
				Запись.ВремяСреда       = Запись.Время;
				Запись.ВремяЧетверг     = Запись.Время;
				Запись.ВремяПятница     = Запись.Время;
				Запись.ВремяСуббота     = Запись.Время;
				Запись.ВремяВоскресенье = Запись.Время;
				
				Запись.Записать();
			КонецЦикла;
		Иначе
			Прервать;
		КонецЕсли; 
	КонецЦикла; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.67
//
Процедура ОбновитьСКДВидовПеревозки() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВидыПеревозок.Ссылка
	|ИЗ
	|	Справочник.упВидыПеревозок КАК упВидыПеревозок
	|ГДЕ
	|	НЕ упВидыПеревозок.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			ВидПеревозкиОбъект = Выборка.Ссылка.ПолучитьОбъект();
			
			СхемаКомпоновкиДанных = ВидПеревозкиОбъект.СхемаЗапросУсловийПеревозки.Получить();
			СхемаКомпоновкиДанныхНовая = Справочники.упВидыПеревозок.ПолучитьМакет("ЗапросУсловийПеревозки");
			Если СхемаКомпоновкиДанных <> Неопределено Тогда 
				упСервисныеФункцииВызовСервера.СкопироватьЭлементы(СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.Отбор, СхемаКомпоновкиДанных.НастройкиПоУмолчанию.Отбор);
			КонецЕсли;
			ВидПеревозкиОбъект.СхемаЗапросУсловийПеревозки = Новый ХранилищеЗначения(СхемаКомпоновкиДанныхНовая);
			
			СхемаКомпоновкиДанных = ВидПеревозкиОбъект.СхемаЗаявкаНаПеревозкуГруза.Получить();
			СхемаКомпоновкиДанныхНовая = Справочники.упВидыПеревозок.ПолучитьМакет("ЗаявкаНаПеревозкуГруза");
			Если СхемаКомпоновкиДанных <> Неопределено Тогда 
				упСервисныеФункцииВызовСервера.СкопироватьЭлементы(СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.Отбор, СхемаКомпоновкиДанных.НастройкиПоУмолчанию.Отбор);
			КонецЕсли;
			ВидПеревозкиОбъект.СхемаЗаявкаНаПеревозкуГруза = Новый ХранилищеЗначения(СхемаКомпоновкиДанныхНовая);
			
			ВидПеревозкиОбъект.Записать();
		КонецЦикла; 
	КонецЕсли; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.1.76
//
Процедура ПроверитьУстановкуИспользованияПартионногоУчетаМатериалов() Экспорт
	
	МетодОценки = упСервисныеФункции.ПолучитьЗначениеКонстанты("упМетодОценкиСтоимостиМатериалов");
	Константы.упИспользуетсяПартионныйУчетМатериалов.Установить(МетодОценки <> Перечисления.упМетодыОценкиСтоимости.ПоСредней);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.2
//
Процедура ЗаполнениеСтатусовСоглашений() Экспорт
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	упПрочиеСоглашения.Ссылка КАК Соглашение,
	|	упПрочиеСоглашения.ДатаНачалаДействия КАК ДатаНачала,
	|	упПрочиеСоглашения.ДатаОкончанияДействия КАК ДатаОкончания
	|ИЗ
	|	Справочник.упПрочиеСоглашения КАК упПрочиеСоглашения
	|ГДЕ
	|	упПрочиеСоглашения.ПометкаУдаления = ЛОЖЬ
	|	И упПрочиеСоглашения.Статус = ЗНАЧЕНИЕ(Перечисление.упСтатусыСоглашений.ПустаяСсылка)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	упСоглашенияСКлиентами.Ссылка,
	|	упСоглашенияСКлиентами.ДатаНачалаДействия,
	|	упСоглашенияСКлиентами.ДатаОкончанияДействия
	|ИЗ
	|	Справочник.упСоглашенияСКлиентами КАК упСоглашенияСКлиентами
	|ГДЕ
	|	упСоглашенияСКлиентами.ПометкаУдаления = ЛОЖЬ
	|	И упСоглашенияСКлиентами.Статус = ЗНАЧЕНИЕ(Перечисление.упСтатусыСоглашений.ПустаяСсылка)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	упСоглашенияСПеревозчиками.Ссылка,
	|	упСоглашенияСПеревозчиками.ДатаНачалаДействия,
	|	упСоглашенияСПеревозчиками.ДатаОкончанияДействия
	|ИЗ
	|	Справочник.упСоглашенияСПеревозчиками КАК упСоглашенияСПеревозчиками
	|ГДЕ
	|	упСоглашенияСПеревозчиками.ПометкаУдаления = ЛОЖЬ
	|	И упСоглашенияСПеревозчиками.Статус = ЗНАЧЕНИЕ(Перечисление.упСтатусыСоглашений.ПустаяСсылка)";
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Если НЕ РезультатЗапроса.Пустой() Тогда
		Выборка = РезультатЗапроса.Выбрать();	 
		пТекущаяДата = ТекущаяДата();
		Пока Выборка.Следующий() Цикл
			// Определим статус.
			Если Выборка.ДатаОкончания < пТекущаяДата И ЗначениеЗаполнено(Выборка.ДатаОкончания) Тогда
				Статус = Перечисления.упСтатусыСоглашений.Закрыто;
			Иначе
				Статус = Перечисления.упСтатусыСоглашений.Действует;
			КонецЕсли;
			
			ОбъектСоглашение = Выборка.Соглашение.ПолучитьОбъект();
			
			Если ОбъектСоглашение<>Неопределено Тогда
				ОбъектСоглашение.Статус = Статус;
				Попытка 				
					ОбъектСоглашение.Записать();				
				Исключение
					
				КонецПопытки;
			КонецЕсли;
			
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.5
//
Процедура ЗаполнениеУчетныхПараметровТранспортныхСредств() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упПринятиеКУчетуТранспортногоСредства.Ссылка
	|ИЗ
	|	Документ.упПринятиеКУчетуТранспортногоСредства КАК упПринятиеКУчетуТранспортногоСредства
	|ГДЕ
	|	упПринятиеКУчетуТранспортногоСредства.Проведен";	
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			упПринятиеКУчетуОбъект = Выборка.Ссылка.ПолучитьОбъект();
			
			Попытка
				упПринятиеКУчетуОбъект.Записать(РежимЗаписиДокумента.Проведение);	
			Исключение
				ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
					ОписаниеОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Проведение документа", УровеньЖурналаРегистрации.Ошибка,,упПринятиеКУчетуОбъект,ОписаниеОшибки,РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			КонецПопытки;
		КонецЦикла; 
	КонецЕсли; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.6
//
Процедура ЗаполнениеВидаПроишествияУПроблемВПути() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упПроблемыВПути.Ссылка
	               |ИЗ
	               |	Справочник.упПроблемыВПути КАК упПроблемыВПути
	               |ГДЕ
	               |	упПроблемыВПути.ВидПроисшествия = ЗНАЧЕНИЕ(Перечисление.упВидыПроисшествийВПути.ПустаяСсылка)";
	
	текВыборка	= Запрос.Выполнить().Выбрать();
	
	Пока текВыборка.Следующий() Цикл
		текПроблемаВПутиОбъект = текВыборка.Ссылка.ПолучитьОбъект();			
		текПроблемаВПутиОбъект.ВидПроисшествия = Перечисления.упВидыПроисшествийВПути.Прочее;
		Попытка
			текПроблемаВПутиОбъект.Записать();	
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			ЗаписьЖурналаРегистрации("Запись справочника", УровеньЖурналаРегистрации.Ошибка,,текВыборка.Ссылка,ОписаниеОшибки,РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
		КонецПопытки;
	КонецЦикла;
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.7
//
Процедура ЗаполнениеТипаРасчетаОценочныеШкалы() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упОценочнаяШкала.Ссылка
	               |ИЗ
	               |	Справочник.упОценочнаяШкала КАК упОценочнаяШкала
	               |ГДЕ
	               |	упОценочнаяШкала.ТипРасчета = ЗНАЧЕНИЕ(Перечисление.упТипРасчета.ПустаяСсылка)";
	
	текВыборка	= Запрос.Выполнить().Выбрать();
	
	Пока текВыборка.Следующий() Цикл
		
		текОбъект = текВыборка.Ссылка.ПолучитьОбъект();			
		текОбъект.ТипРасчета = Перечисления.упТипРасчета.Тарификация;
		Попытка
			текОбъект.Записать();	
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			ЗаписьЖурналаРегистрации("Запись справочника", УровеньЖурналаРегистрации.Ошибка,,текВыборка.Ссылка,ОписаниеОшибки,РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
		КонецПопытки;
	КонецЦикла;
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.11
//
Процедура ЗаполнениеСпособовУчетаВыработкиВУчетнойПолитике() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упУчетнаяПолитика.Период
	               |ИЗ
	               |	РегистрСведений.упУчетнаяПолитика КАК упУчетнаяПолитика
	               |ГДЕ
	               |	упУчетнаяПолитика.СпособУчетаВыработкиТранспортногоСредства = ЗНАЧЕНИЕ(Перечисление.упСпособыУчетаВыработкиТранспортногоСредства.ПустаяСсылка)";
	
	текВыборка	= Запрос.Выполнить().Выбрать();
	
	Пока текВыборка.Следующий() Цикл
		текЗапись = РегистрыСведений.упУчетнаяПолитика.СоздатьМенеджерЗаписи();
		текЗапись.Период = текВыборка.Период;
		текЗапись.Прочитать();
		Если текЗапись.Выбран() Тогда
			текЗапись.СпособУчетаВыработкиТранспортногоСредства = Перечисления.упСпособыУчетаВыработкиТранспортногоСредства.ПоСрокуИспользования;
			текЗапись.Записать();
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.12
//
Процедура ОбновитьПараметрыПланированияЗональноеПланирование() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = ""Обработка.упРМПланированиеРейсов.ПараметрыПланирования""
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить("Обработка.упРМПланированиеРейсов.ПараметрыПланирования", Выборка.КлючВарианта);
			Если СохраненныеНастройки <> Неопределено Тогда
				ПараметрыПланирования = СохраненныеНастройки.Результат;	
				Если Не ПараметрыПланирования.Свойство("КонтролироватьПревышениеЗагрузки") Тогда
					ПараметрыПланирования.Вставить("КонтролироватьПревышениеЗагрузки", Истина);
				КонецЕсли;
				Если Не ПараметрыПланирования.Свойство("ОграничиватьСписокЗон") Тогда
					ПараметрыПланирования.Вставить("ОграничиватьСписокЗон", Ложь);
				КонецЕсли;
				Если Не ПараметрыПланирования.Свойство("ДоступныеЗоны") Тогда
					ПараметрыПланирования.Вставить("ДоступныеЗоны", Новый Соответствие);
				КонецЕсли;
				ХранилищаНастроек.упХранилищеНастроек.Сохранить("Обработка.упРМПланированиеРейсов.ПараметрыПланирования", Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры // ОбновитьПараметрыПланирования()

// Вызывается при переходе на версию конфигурации 3.0.2.14
//
Процедура ЗаполнитьСпособыРасходовВСлужебныхРасследованиях() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упСлужебноеРасследование.Ссылка
	               |ИЗ
	               |	Документ.упСлужебноеРасследование КАК упСлужебноеРасследование
	               |ГДЕ
	               |	упСлужебноеРасследование.Проведен
	               |	И упСлужебноеРасследование.СпособРаспределенияРасходов = ЗНАЧЕНИЕ(Перечисление.упСпособыВводаФактическихРасходов.ПустаяСсылка)";
	
	текВыборка	= Запрос.Выполнить().Выбрать();
	
	Пока текВыборка.Следующий() Цикл
		
		ДокументОбъект = текВыборка.Ссылка.ПолучитьОбъект();
		ДокументОбъект.СпособРаспределенияРасходов = Перечисления.упСпособыВводаФактическихРасходов.РасходыЗаПериод;
		
		Попытка
			ДокументОбъект.Записать(РежимЗаписиДокумента.Проведение);	
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			ЗаписьЖурналаРегистрации("Проведение документа", УровеньЖурналаРегистрации.Ошибка,,ДокументОбъект,ОписаниеОшибки,РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
		КонецПопытки;
		
	КонецЦикла;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.15
//
Процедура ОбновитьОбщиеНастройкиРабочегоМестаПланирования_3_0_2_15() Экспорт
	
	КлючОбъекта =  "Обработка.упРМПланированиеРейсов.ОбщиеНастройки";
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = &Объект
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Запрос.УстановитьПараметр("Объект", КлючОбъекта);
	
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить(КлючОбъекта, Выборка.КлючВарианта);
			Если СохраненныеНастройки <> Неопределено И ТипЗнч(СохраненныеНастройки) = Тип("Структура") Тогда
				СохраненныеНастройки.Вставить("ОтображатьЗоны"           , Ложь);
				СохраненныеНастройки.Вставить("ИспользоватьКластеризацию", Ложь);
				ХранилищаНастроек.упХранилищеНастроек.Сохранить(КлючОбъекта, Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.16
//
Процедура ЗаполнитьПараметрыМаршрутизацииСитиГИД() Экспорт
	
	ПараметрыМаршрутизацииСитиГИД = Константы.упПараметрыМаршрутизацииСитиГИД.Получить();
	
	ТекущаяСтруктура = ПараметрыМаршрутизацииСитиГИД.Получить();
	
	Если ТекущаяСтруктура = Неопределено Тогда
		
		Структура = Новый Структура;
		Структура.Вставить("type","OptimizeLength");
		Структура.Вставить("allowYards",Истина);
		Структура.Вставить("allowSideWays",Истина);
		Структура.Вставить("allowGroundRoads",Истина);
		Структура.Вставить("allowPaidRoads",Истина);
		Структура.Вставить("useJams",Ложь);
		Структура.Вставить("useLimitsUpd",Ложь);
		Структура.Вставить("limitsName","");
		Структура.Вставить("useForecast",Ложь);	
		Структура.Вставить("forecastDateTimeUtc",ДАТА("00010101000000"));
		
		ХранилищеЗначения = Новый ХранилищеЗначения(Структура);
		
		Константы.упПараметрыМаршрутизацииСитиГИД.Установить(ХранилищеЗначения);
		
	КонецЕсли;
	
КонецПроцедуры // ЗаполнитьПараметрыМаршрутизацииСитиГИД()

// Вызывается при переходе на версию конфигурации 3.0.3.38
//
Процедура ЗаполнитьПараметрыМаршрутизацииСитиГИД_3_0_3_38() Экспорт
	
	ПараметрыМаршрутизацииСитиГИД = Константы.упПараметрыМаршрутизацииСитиГИД.Получить();
	
	ТекущаяСтруктура = ПараметрыМаршрутизацииСитиГИД.Получить();
	
	Если ТекущаяСтруктура = Неопределено Тогда
		
		Структура = Новый Структура;
		Структура.Вставить("type","OptimizeLength");
		Структура.Вставить("allowYards",Истина);
		Структура.Вставить("allowSideWays",Истина);
		Структура.Вставить("allowGroundRoads",Истина);
		Структура.Вставить("allowPaidRoads",Истина);
		Структура.Вставить("useJams",Ложь);
		Структура.Вставить("useLimitsUpd",Ложь);
		Структура.Вставить("limitsName","");
		Структура.Вставить("useForecast",Ложь);	
		Структура.Вставить("forecastDateTimeUtc",ДАТА("00010101000000"));
		
		ДополнительныеОграниченияСитиГИД = Новый ТаблицаЗначений;
		ДополнительныеОграниченияСитиГИД.Колонки.Добавить("Ограничение",,"Ограничение");
		ДополнительныеОграниченияСитиГИД.Колонки.Добавить("Пометка",,"Пометка");
		
		Для каждого МетаЗначение Из Метаданные.Перечисления.упОграниченияМаршрутизаторов.ЗначенияПеречисления Цикл
			ТекущийПропуск = Перечисления.упОграниченияМаршрутизаторов[МетаЗначение.Имя];
			НоваяСтрока = ДополнительныеОграниченияСитиГИД.Добавить();
			НоваяСтрока.Ограничение = ТекущийПропуск;
			НоваяСтрока.Пометка = Ложь;
		КонецЦикла;
		
		Структура.Вставить("ДополнительныеОграниченияСитиГИД",ДополнительныеОграниченияСитиГИД);
		
		ХранилищеЗначения = Новый ХранилищеЗначения(Структура);
		
		Константы.упПараметрыМаршрутизацииСитиГИД.Установить(ХранилищеЗначения);
		
	Иначе
		
		ДополнительныеОграниченияСитиГИД = Новый ТаблицаЗначений;
		ДополнительныеОграниченияСитиГИД.Колонки.Добавить("Ограничение",,"Ограничение");
		ДополнительныеОграниченияСитиГИД.Колонки.Добавить("Пометка",,"Пометка");
		
		Для каждого МетаЗначение Из Метаданные.Перечисления.упОграниченияМаршрутизаторов.ЗначенияПеречисления Цикл
			ТекущийПропуск = Перечисления.упОграниченияМаршрутизаторов[МетаЗначение.Имя];
			НоваяСтрока = ДополнительныеОграниченияСитиГИД.Добавить();
			НоваяСтрока.Ограничение = ТекущийПропуск;
			НоваяСтрока.Пометка = Ложь;
		КонецЦикла;
		
		ТекущаяСтруктура.Вставить("ДополнительныеОграниченияСитиГИД",ДополнительныеОграниченияСитиГИД);
		ТекущаяСтруктура.Вставить("limitsName","");
		
		ХранилищеЗначения = Новый ХранилищеЗначения(ТекущаяСтруктура);
		
		Константы.упПараметрыМаршрутизацииСитиГИД.Установить(ХранилищеЗначения);
		
	КонецЕсли;
	
КонецПроцедуры // ЗаполнитьПараметрыМаршрутизацииСитиГИД_3_0_3_38()

// Вызывается при переходе на версию конфигурации 3.0.2.21
//
Процедура ОбновитьПараметрыПланированияМестаИнтереса() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = ""Обработка.упРМПланированиеРейсов.ПараметрыПланирования""
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить("Обработка.упРМПланированиеРейсов.ПараметрыПланирования", Выборка.КлючВарианта);
			Если НЕ СохраненныеНастройки = Неопределено Тогда
				ПараметрыПланирования = СохраненныеНастройки.Результат;	
				Если НЕ ПараметрыПланирования.Свойство("МестаИнтереса") Тогда
					ПараметрыПланирования.Вставить("МестаИнтереса", Новый Массив);
				КонецЕсли;				
				ХранилищаНастроек.упХранилищеНастроек.Сохранить("Обработка.упРМПланированиеРейсов.ПараметрыПланирования", Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
	КлючОбъекта =  "Обработка.упРМПланированиеРейсов.ОбщиеНастройки";
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = &Объект
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Запрос.УстановитьПараметр("Объект", КлючОбъекта);
	
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить(КлючОбъекта, Выборка.КлючВарианта);
			Если СохраненныеНастройки <> Неопределено И ТипЗнч(СохраненныеНастройки) = Тип("Структура") Тогда
				СохраненныеНастройки.Вставить("ОтображатьМестаИнтереса", Ложь);
				ХранилищаНастроек.упХранилищеНастроек.Сохранить(КлючОбъекта, Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры // ОбновитьПараметрыПланированияМестаИнтереса()

// Вызывается при переходе на версию конфигурации 3.0.2.22
//
Процедура ОбновитьПараметрыПланированияКоличествоВидимыхРейсов() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = ""Обработка.упРМПланированиеРейсов.ПараметрыПланирования""
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить("Обработка.упРМПланированиеРейсов.ПараметрыПланирования", Выборка.КлючВарианта);
			Если СохраненныеНастройки <> Неопределено Тогда
				ПараметрыПланирования = СохраненныеНастройки.Результат;	
				Если Не ПараметрыПланирования.Свойство("КоличествоВидимыхРейсов") Тогда
					ПараметрыПланирования.Вставить("КоличествоВидимыхРейсов", 0);
				КонецЕсли;
				ХранилищаНастроек.упХранилищеНастроек.Сохранить("Обработка.упРМПланированиеРейсов.ПараметрыПланирования", Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры // ОбновитьПараметрыПланирования()

// Вызывается при переходе на версию конфигурации 3.0.2.26
//
Процедура УстановитьАктивностьСерверовСбораДанных() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упСервераСбораДанных.Ссылка
	|ИЗ
	|	Справочник.упСервераСбораДанных КАК упСервераСбораДанных
	|ГДЕ
	|	НЕ упСервераСбораДанных.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СерверОбъект = Выборка.Ссылка.ПолучитьОбъект();
			СерверОбъект.Активен = Истина;
			СерверОбъект.Записать();
		КонецЦикла; 
	КонецЕсли; 
	
КонецПроцедуры // УстановитьАктивностьСерверовСбораДанных()

// Вызывается при переходе на версию конфигурации 3.0.2.37
//
Процедура ОбновитьДанныеПрофилейГруппДоступа() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |	ПрофилиГруппДоступаРоли.Ссылка КАК Ссылка
	               |ПОМЕСТИТЬ втПрофильСодержащийРоль
	               |ИЗ
	               |	Справочник.ПрофилиГруппДоступа.Роли КАК ПрофилиГруппДоступаРоли
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ИдентификаторыОбъектовМетаданных КАК ИдентификаторыОбъектовМетаданных
	               |		ПО ПрофилиГруппДоступаРоли.Роль = ИдентификаторыОбъектовМетаданных.Ссылка
	               |ГДЕ
	               |	ИдентификаторыОбъектовМетаданных.Имя В(&мсвПолноеИмя)
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |	ИдентификаторыОбъектовМетаданных.Ссылка КАК ДобавляемаяРоль,
	               |	втПрофильСодержащийРоль.Ссылка КАК Профиль
	               |ПОМЕСТИТЬ втДобавляемыеРоли
	               |ИЗ
	               |	Справочник.ИдентификаторыОбъектовМетаданных КАК ИдентификаторыОбъектовМетаданных,
	               |	втПрофильСодержащийРоль КАК втПрофильСодержащийРоль
	               |ГДЕ
	               |	ИдентификаторыОбъектовМетаданных.Имя В(&мсвДобавляемыеРоли)
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втДобавляемыеРоли.ДобавляемаяРоль КАК ДобавляемаяРоль,
	               |	втДобавляемыеРоли.Профиль КАК Профиль
	               |ИЗ
	               |	втДобавляемыеРоли КАК втДобавляемыеРоли
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ПрофилиГруппДоступа.Роли КАК ПрофилиГруппДоступаРоли
	               |		ПО втДобавляемыеРоли.ДобавляемаяРоль = ПрофилиГруппДоступаРоли.Роль
	               |			И втДобавляемыеРоли.Профиль = ПрофилиГруппДоступаРоли.Ссылка
	               |ГДЕ
	               |	ПрофилиГруппДоступаРоли.Роль ЕСТЬ NULL 
	               |ИТОГИ ПО
	               |	Профиль";
	
	
	// Если есть роль Базовые права ТМС, то добавить роли.
	// У упРазделНСИТранспортныеСредства.
	// У упРазделНСИПартнеры.
	мсвРоли = Новый Массив;
	мсвРоли.Добавить("упБазовыеПрава");
	
	мсвДобавляемыеРоли = Новый Массив;
	мсвДобавляемыеРоли.Добавить("упРазделНСИПартнеры");
	мсвДобавляемыеРоли.Добавить("упРазделНСИТранспортныеСредства");
	
	Запрос.УстановитьПараметр("мсвПолноеИмя", 		мсвРоли);
	Запрос.УстановитьПараметр("мсвДобавляемыеРоли", мсвДобавляемыеРоли);
	текРезультат = Запрос.Выполнить(); 
	
	текПрофильОбъект = Неопределено;
	
	текВыборкаПрофиль = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	Пока текВыборкаПрофиль.Следующий() Цикл
		
		текПрофильОбъект = текВыборкаПрофиль.Профиль.ПолучитьОбъект();
		
		текВыборкаРоли = текВыборкаПрофиль.Выбрать();
		
		Пока текВыборкаРоли.Следующий() цикл
			НоваяСтрока = текПрофильОбъект.Роли.Добавить();
			НоваяСтрока.Роль = текВыборкаРоли.ДобавляемаяРоль;
		КонецЦикла;	
		
		Попытка
			текПрофильОбъект.Записать();
		Исключение
			Отказ = Истина;                                                                                                                                                                                                                                                                                                                                                                                                                                                 
			ТекстСообщения = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ТекстСообщения) Тогда 
				ТекстСообщения = ОписаниеОшибки();
			КонецЕсли;
			ЗаписьЖурналаРегистрации("Попытка обновить профиль группы доступа", УровеньЖурналаРегистрации.Ошибка, Метаданные.Справочники.ПрофилиГруппДоступа,текПрофильОбъект, ТекстСообщения);
		КонецПопытки;
			
	КонецЦикла;
		
	// Если есть роль Добавление изменение НСИ, то добавить роли.
	// У упРазделНСИКалендарныеГрафики.
	// У упРазделНСИНоменклатура.
	// У упРазделНСИПредприятие.
	// У упРазделНСИСотрудники.	
	
	мсвРоли = Новый Массив;
	мсвРоли.Добавить("упДобавлениеИзменениеНСИ");
	
	мсвДобавляемыеРоли = Новый Массив;
	мсвДобавляемыеРоли.Добавить("упРазделНСИПредприятие");
	мсвДобавляемыеРоли.Добавить("упРазделНСИНоменклатура");
	мсвДобавляемыеРоли.Добавить("упРазделНСИСотрудники");
	мсвДобавляемыеРоли.Добавить("упРазделНСИКалендарныеГрафики");
	
	Запрос.УстановитьПараметр("мсвПолноеИмя", 		мсвРоли);
	Запрос.УстановитьПараметр("мсвДобавляемыеРоли", мсвДобавляемыеРоли);
	текРезультат = Запрос.Выполнить(); 
	
	текПрофильОбъект = Неопределено;
	
	текВыборкаПрофиль = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	Пока текВыборкаПрофиль.Следующий() Цикл
		
		текПрофильОбъект = текВыборкаПрофиль.Профиль.ПолучитьОбъект();
		
		текВыборкаРоли = текВыборкаПрофиль.Выбрать();
		
		Пока текВыборкаРоли.Следующий() цикл
			НоваяСтрока = текПрофильОбъект.Роли.Добавить();
			НоваяСтрока.Роль = текВыборкаРоли.ДобавляемаяРоль;
		КонецЦикла;	
		
		Попытка
			текПрофильОбъект.Записать();
		Исключение
			Отказ = Истина;                                                                                                                                                                                                                                                                                                                                                                                                                                                 
			ТекстСообщения = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ТекстСообщения) Тогда 
				ТекстСообщения = ОписаниеОшибки();
			КонецЕсли;
			ЗаписьЖурналаРегистрации("Попытка обновить профиль группы доступа", УровеньЖурналаРегистрации.Ошибка, Метаданные.Справочники.ПрофилиГруппДоступа,текПрофильОбъект, ТекстСообщения);
		КонецПопытки;
			
	КонецЦикла;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.39
//
Процедура ЗаполнитьДанныеОПройденныхТО() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упРемонтИТОТС.Ссылка,
	|	упРемонтИТОТС.ВидРемонта,
	|	упРемонтИТОТС.НачалоРемонтаФакт,
	|	упРемонтИТОТС.ОкончаниеРемонтаФакт,
	|	упСтатусыРемонтов.Статус,
	|	упРемонтИТОТС.ТранспортноеСредство
	|ИЗ
	|	Документ.упРемонтИТОТС КАК упРемонтИТОТС
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.упСтатусыРемонтовИТОТС.СрезПоследних(, ) КАК упСтатусыРемонтов
	|		ПО упРемонтИТОТС.Ссылка = упСтатусыРемонтов.Документ
	|			И (упСтатусыРемонтов.Статус В (ЗНАЧЕНИЕ(Перечисление.упСтатусыРемонтаИТОТС.Начат), ЗНАЧЕНИЕ(Перечисление.упСтатусыРемонтаИТОТС.Завершен)))
	|			И (упРемонтИТОТС.ВидРемонта.ТипРемонта = ЗНАЧЕНИЕ(Перечисление.упТипыРемонтов.ПлановоеТО))";
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	Пока Выборка.Следующий() Цикл
		НаборЗаписей = РегистрыСведений.упПройденныеТО.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.Регистратор.Установить(Выборка.Ссылка); 
		НаборЗаписей.Очистить();
		НоваяЗапись = НаборЗаписей.Добавить(); 
		НоваяЗапись.Период = ?(Выборка.Статус = Перечисления.упСтатусыРемонтаИТОТС.Начат, Выборка.НачалоРемонтаФакт, Выборка.ОкончаниеРемонтаФакт);;
		НоваяЗапись.ТранспортноеСредство = Выборка.ТранспортноеСредство;
		НоваяЗапись.ВидРемонта = Выборка.ВидРемонта;
		Попытка
			НаборЗаписей.Записать(); 
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			ЗаписьЖурналаРегистрации("Запись о факте прохождения ТО", УровеньЖурналаРегистрации.Ошибка,, Выборка.Ссылка, ОписаниеОшибки);
		КонецПопытки;
	КонецЦикла;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.40
//
Процедура ДобавитьРазделТопология() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |	ПрофилиГруппДоступаРоли.Ссылка КАК Ссылка
	               |ПОМЕСТИТЬ втПрофильСодержащийРоль
	               |ИЗ
	               |	Справочник.ПрофилиГруппДоступа.Роли КАК ПрофилиГруппДоступаРоли
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ИдентификаторыОбъектовМетаданных КАК ИдентификаторыОбъектовМетаданных
	               |		ПО ПрофилиГруппДоступаРоли.Роль = ИдентификаторыОбъектовМетаданных.Ссылка
	               |ГДЕ
	               |	ИдентификаторыОбъектовМетаданных.Имя В(&мсвПолноеИмя)
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |	ИдентификаторыОбъектовМетаданных.Ссылка КАК ДобавляемаяРоль,
	               |	втПрофильСодержащийРоль.Ссылка КАК Профиль
	               |ПОМЕСТИТЬ втДобавляемыеРоли
	               |ИЗ
	               |	Справочник.ИдентификаторыОбъектовМетаданных КАК ИдентификаторыОбъектовМетаданных,
	               |	втПрофильСодержащийРоль КАК втПрофильСодержащийРоль
	               |ГДЕ
	               |	ИдентификаторыОбъектовМетаданных.Имя В(&мсвДобавляемыеРоли)
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втДобавляемыеРоли.ДобавляемаяРоль КАК ДобавляемаяРоль,
	               |	втДобавляемыеРоли.Профиль КАК Профиль
	               |ИЗ
	               |	втДобавляемыеРоли КАК втДобавляемыеРоли
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ПрофилиГруппДоступа.Роли КАК ПрофилиГруппДоступаРоли
	               |		ПО втДобавляемыеРоли.ДобавляемаяРоль = ПрофилиГруппДоступаРоли.Роль
	               |			И втДобавляемыеРоли.Профиль = ПрофилиГруппДоступаРоли.Ссылка
	               |ГДЕ
	               |	ПрофилиГруппДоступаРоли.Роль ЕСТЬ NULL 
	               |ИТОГИ ПО
	               |	Профиль";
	
	
	// Если есть роль Базовые права ТМС, то добавить роли.
	// У упРазделСервисТопология.
	
	мсвРоли = Новый Массив;
	мсвРоли.Добавить("упБазовыеПрава");
	
	мсвДобавляемыеРоли = Новый Массив;
	мсвДобавляемыеРоли.Добавить("упРазделСервисТопология");
		
	Запрос.УстановитьПараметр("мсвПолноеИмя", 		мсвРоли);
	Запрос.УстановитьПараметр("мсвДобавляемыеРоли", мсвДобавляемыеРоли);
	текРезультат = Запрос.Выполнить(); 
	
	текПрофильОбъект = Неопределено;
	
	текВыборкаПрофиль = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	Пока текВыборкаПрофиль.Следующий() Цикл
		
		текПрофильОбъект = текВыборкаПрофиль.Профиль.ПолучитьОбъект();
		
		текВыборкаРоли = текВыборкаПрофиль.Выбрать();
		
		Пока текВыборкаРоли.Следующий() цикл
			НоваяСтрока = текПрофильОбъект.Роли.Добавить();
			НоваяСтрока.Роль = текВыборкаРоли.ДобавляемаяРоль;
		КонецЦикла;	
		
		Попытка
			текПрофильОбъект.Записать();
		Исключение
			Отказ = Истина;                                                                                                                                                                                                                                                                                                                                                                                                                                                 
			ТекстСообщения = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ТекстСообщения) Тогда 
				ТекстСообщения = ОписаниеОшибки();
			КонецЕсли;
			ЗаписьЖурналаРегистрации("Попытка обновить профиль группы доступа", УровеньЖурналаРегистрации.Ошибка, Метаданные.Справочники.ПрофилиГруппДоступа,текПрофильОбъект, ТекстСообщения);
		КонецПопытки;
			
	КонецЦикла;
		
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.43
//
Процедура ПерезаполнениеРегистраДатыСобытий(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упСобытиеМониторинга.Ссылка
	|ИЗ
	|	Документ.упСобытиеМониторинга КАК упСобытиеМониторинга
	|ГДЕ
	|	упСобытиеМониторинга.Проведен
	|	И НЕ упСобытиеМониторинга.Рейс = ЗНАЧЕНИЕ(Документ.упРейс.ПустаяСсылка)";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СобытиеОбъект = Выборка.Ссылка.ПолучитьОбъект();
			Попытка
				СобытиеОбъект.Записать(РежимЗаписиДокумента.Проведение);
			Исключение
				Отказ = Истина;                                                                                                                                                                                                                                                                                                                                                                                                                                                 
				ТекстСообщения = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ТекстСообщения) Тогда 
					ТекстСообщения = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Проведение события мониторинга по рейсу", УровеньЖурналаРегистрации.Ошибка, Метаданные.Документы.упСобытиеМониторинга, СобытиеОбъект, ТекстСообщения);
			КонецПопытки;
		КонецЦикла; 
	КонецЕсли; 
	 		
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.49
Процедура ОбновитьДвиженияВсехДокументовПоСостояниюПоЗаданиям(Параметры = Неопределено) Экспорт 
	
	Этап = "Фомирование движений заданий на перевозку";
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Начало", УровеньЖурналаРегистрации.Предупреждение,,, Этап);	
	текНеУдалосьЗаписатьЗаданий = 0;
    Выборка = Документы.упЗаданиеНаПеревозкуГруза.Выбрать();
	Пока Выборка.Следующий() Цикл
		НачатьТранзакцию();
		Попытка
			БлокировкаДанных = Новый БлокировкаДанных;
			ЭлементБлокировки = БлокировкаДанных.Добавить("Документ.упЗаданиеНаПеревозкуГруза");
			ЭлементБлокировки.УстановитьЗначение("Ссылка", Выборка.Ссылка);
			ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
			БлокировкаДанных.Заблокировать();
			ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
			Если Не ДокументОбъект.Проведен Тогда
				ЗафиксироватьТранзакцию();
				Продолжить;
			КонецЕсли; 
			Отказ = Ложь;
			упРаботаСоСтатусами.УстановкаСтатуса(ДокументОбъект.ДополнительныеСвойства, ДокументОбъект.Ссылка, Отказ);
			Если Истина
				И ДокументОбъект.ДополнительныеСвойства.Статус <> Перечисления.упСтатусыЗаданияНаПеревозкуГруза.Новое
				И ДокументОбъект.ДополнительныеСвойства.Статус <> Перечисления.упСтатусыЗаданияНаПеревозкуГруза.Отказ
				И ДокументОбъект.ДополнительныеСвойства.Статус <> Перечисления.упСтатусыЗаданияНаПеревозкуГруза.Отменено
			Тогда
				ДокументОбъект.ДополнительныеСвойства.Статус = Перечисления.упСтатусыЗаданияНаПеревозкуГруза.КПланированию; // Иначе движения не сформируются
			КонецЕсли; 
			ДокументОбъект.ДополнительныеСвойства.Вставить("ЗаписыватьСтатус", Истина); // Иначе движения не сформируются
			ДокументОбъект.ДополнительныеСвойства.Вставить("КонтролироватьСостояниеЗадания");
			упЗаданиеНаПеревозку.СформироватьДвиженияПланПоЗаданиям(ДокументОбъект.ДополнительныеСвойства, ДокументОбъект.Ссылка, ДокументОбъект.Движения, ДокументОбъект.Ссылка, Отказ);
			упЗаданиеНаПеревозку.СформироватьДвиженияСостояниеПоЗаданиям(ДокументОбъект.ДополнительныеСвойства, ДокументОбъект.Ссылка, ДокументОбъект.Движения, ДокументОбъект.Ссылка, Отказ);
			ДокументОбъект.Движения.упПланПоЗаданиям.Записать();
			ДокументОбъект.Движения.упСостояниеПоЗаданиям.Записать();
		Исключение
			ОтменитьТранзакцию();
			ОписаниеОшибки = ОписаниеОшибки();
			Отказ = Истина;
			текПредставление = "" + Выборка.Ссылка;
			ТекстСообщения = Нстр("ru = 'Ошибка при фомировании движений ""%1"": %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			текНеУдалосьЗаписатьЗаданий = текНеУдалосьЗаписатьЗаданий + 1;
			ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,, Выборка.Ссылка, ТекстСообщения, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			Продолжить;
		КонецПопытки;
		ЗафиксироватьТранзакцию();
	КонецЦикла; 
	Если текНеУдалосьЗаписатьЗаданий > 0 Тогда
		ТекстСообщения = Нстр("ru = 'Не удалось записать движения заданий на перевозку: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текНеУдалосьЗаписатьЗаданий);
	Иначе
		ТекстСообщения = Нстр("ru = 'Движения всех заданий на перевозку успешно сформированы'");
	КонецЕсли;
	текНеУдалосьЗаписатьПрохождений = 0;
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Конец", УровеньЖурналаРегистрации.Предупреждение,,, Этап + Символы.ПС + ТекстСообщения);	
	
	Этап = "Фомирование движений прохождений точек";
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Начало", УровеньЖурналаРегистрации.Предупреждение,,, Этап);	
    Выборка = Документы.упПрохождениеТочки.Выбрать();
	Пока Выборка.Следующий() Цикл
		НачатьТранзакцию();
		Попытка
			БлокировкаДанных = Новый БлокировкаДанных;
			ЭлементБлокировки = БлокировкаДанных.Добавить("Документ.упПрохождениеТочки");
			ЭлементБлокировки.УстановитьЗначение("Ссылка", Выборка.Ссылка);
			ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
			БлокировкаДанных.Заблокировать();
			ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
			Если Не ДокументОбъект.Проведен Тогда
				ЗафиксироватьТранзакцию();
				Продолжить;
			КонецЕсли; 
			БлокировкаДанных = Новый БлокировкаДанных;
			ЭлементБлокировки = БлокировкаДанных.Добавить("РегистрСведений.упПланПоЗаданиям");
			ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
			ЭлементБлокировки.ИсточникДанных	= ДокументОбъект.Работы;
			ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Задание", "Задание");
			ЭлементБлокировки.ИспользоватьИзИсточникаДанных("ГрузовоеМесто", "ГрузовоеМесто");
			БлокировкаДанных.Заблокировать();
			Отказ = Ложь;
			упПрохождениеТочки.СформироватьДвиженияСостояниеПоЗаданиямИПланПоЗаданиям(ДокументОбъект.ДополнительныеСвойства, ДокументОбъект.Ссылка, ДокументОбъект.Движения, ДокументОбъект.Ссылка, Отказ);
			ДокументОбъект.Движения.упПланПоЗаданиям.Записать();
			ДокументОбъект.Движения.упСостояниеПоЗаданиям.Записать();
		Исключение
			ОтменитьТранзакцию();
			ОписаниеОшибки = ОписаниеОшибки();
			Отказ = Истина;
			текПредставление = "" + Выборка.Ссылка;
			ТекстСообщения = Нстр("ru = 'Ошибка при фомировании движений ""%1"": %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			текНеУдалосьЗаписатьПрохождений = текНеУдалосьЗаписатьПрохождений + 1;
			ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,, Выборка.Ссылка, ТекстСообщения, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			Продолжить;
		КонецПопытки;
		ЗафиксироватьТранзакцию();
	КонецЦикла; 
	Если текНеУдалосьЗаписатьПрохождений > 0 Тогда
		ТекстСообщения = Нстр("ru = 'Не удалось записать движения прохождений точек: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текНеУдалосьЗаписатьПрохождений);
	Иначе
		ТекстСообщения = Нстр("ru = 'Движения всех прохождений точек успешно сформированы'");
	КонецЕсли;
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Конец", УровеньЖурналаРегистрации.Предупреждение,,, Этап + Символы.ПС + ТекстСообщения);
	 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.51
//
Процедура ОбновитьПараметрыМониторингаОтсутствиеСвязи() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = ""Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторингаРейсов""
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить("Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторингаРейсов", Выборка.КлючВарианта);
			Если СохраненныеНастройки <> Неопределено Тогда
				СохраненныеНастройки.Вставить("ДопустимыйПериодОтсутствияСвязиСТрекером"            , 10); // в минутах
				СохраненныеНастройки.Вставить("ОтображатьПериодыОтсутствияСвязи"                    , Истина);
				ХранилищаНастроек.упХранилищеНастроек.Сохранить("Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторингаРейсов", Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = ""Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторингаТранспорта""
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить("Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторингаТранспорта", Выборка.КлючВарианта);
			Если СохраненныеНастройки <> Неопределено Тогда
				СохраненныеНастройки.Вставить("ДопустимыйПериодОтсутствияСвязиСТрекером"            , 10); // в минутах
				СохраненныеНастройки.Вставить("ОтображатьПериодыОтсутствияСвязи"                    , Истина);
				ХранилищаНастроек.упХранилищеНастроек.Сохранить("Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторингаТранспорта", Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры // ОбновитьПараметрыМониторингаОтсутствиеСвязи()

// Вызывается при переходе на версию конфигурации 3.0.2.52
//
Процедура ПроведениеДокументовРейсДляЗаполненияРасписаниеРаботыВодителей(Параметры = Неопределено) Экспорт
	
	Этап = "Формирование движений документов ""Рейс"" по регистру ""Расписание работы экипажей""'";
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Начало", УровеньЖурналаРегистрации.Предупреждение,,, Этап);	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упРейс.Ссылка
	               |ИЗ
	               |	Документ.упРейс КАК упРейс
	               |ГДЕ
	               |	упРейс.Проведен";
	Выборка = Запрос.Выполнить().Выбрать();
	текНеУдалосьОбработатьДокументов = 0;
	Пока Выборка.Следующий() Цикл
		НачатьТранзакцию();
		Попытка
			БлокировкаДанных = Новый БлокировкаДанных;
			ЭлементБлокировки = БлокировкаДанных.Добавить("Документ.упРейс");
			ЭлементБлокировки.УстановитьЗначение("Ссылка", Выборка.Ссылка);
			ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
			БлокировкаДанных.Заблокировать();
			ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
			Если Ложь Тогда // Для контекстной подсказки
			    ДокументОбъект = Документы.упРейс.СоздатьДокумент();
			КонецЕсли;
			Если Не ДокументОбъект.Проведен Тогда
				ЗафиксироватьТранзакцию();
				Продолжить;
			КонецЕсли;
			Отказ = Ложь;
			упРаботаСоСтатусами.УстановкаСтатусаРейса(ДокументОбъект.ДополнительныеСвойства, ДокументОбъект.Ссылка, Отказ);
			Если Истина
				И ДокументОбъект.ДополнительныеСвойства.Статус <> Перечисления.упСтатусыРейса.Новый
				И ДокументОбъект.ДополнительныеСвойства.Статус <> Перечисления.упСтатусыРейса.Отменен
			Тогда
				ДокументОбъект.ДополнительныеСвойства.Статус = Перечисления.упСтатусыРейса.КПланированиюТС; // Иначе движения не сформируются
			КонецЕсли; 

			сткЭкипаж = упРейс.ПолучитьЭкипажРейса(Выборка.Ссылка);
			текТранспортноеСредство = сткЭкипаж.ТранспортноеСредство;
			Водитель1 = сткЭкипаж.Водитель1;
			Водитель2 = сткЭкипаж.Водитель2;
			Экспедитор = сткЭкипаж.Экспедитор;
			РеквизитыОбъекта = Новый Структура();
			РеквизитыОбъекта.Вставить("ТранспортноеСредство"                    , текТранспортноеСредство);
			РеквизитыОбъекта.Вставить("Водитель1"                               , Водитель1);
			РеквизитыОбъекта.Вставить("Водитель2"                               , Водитель2);
			РеквизитыОбъекта.Вставить("Экспедитор"                              , Экспедитор);
			РеквизитыОбъекта.Вставить("Рейс"                                    , ДокументОбъект.Ссылка);
			РеквизитыОбъекта.Вставить("Маршрут"                                 , Неопределено);
			РеквизитыОбъекта.Вставить("Работы"                                  , Неопределено);
			РеквизитыОбъекта.Вставить("ПлановыеПараметры"                       , Новый Структура());	
			Если НЕ ДокументОбъект.ДополнительныеСвойства.Свойство("Маршрут") Тогда
				ДокументОбъект.ДополнительныеСвойства.Вставить("Маршрут", Неопределено);
			КонецЕсли;
			Если НЕ ДокументОбъект.ДополнительныеСвойства.Свойство("Работы") Тогда
				ДокументОбъект.ДополнительныеСвойства.Вставить("Работы", Неопределено);
			КонецЕсли;
			упРейс.СформироватьДвижениеРасписаниеРаботыВодителей(ДокументОбъект.ДополнительныеСвойства, ДокументОбъект.Ссылка, ДокументОбъект.Движения, РеквизитыОбъекта, Отказ);
			ДокументОбъект.Движения.упРасписаниеРаботыЭкипажей.Записать();
		Исключение
			ОтменитьТранзакцию();
			ОписаниеОшибки = ОписаниеОшибки();
			текПредставление = "" + Выборка.Ссылка;
			ТекстСообщения = Нстр("ru = 'Ошибка формирования движений документа ""%1"": %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			текНеУдалосьОбработатьДокументов = текНеУдалосьОбработатьДокументов + 1;
			ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,, Выборка.Ссылка, ТекстСообщения, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			Продолжить;
		КонецПопытки;
		ЗафиксироватьТранзакцию();
	КонецЦикла; 
	Если текНеУдалосьОбработатьДокументов > 0 Тогда
		ТекстСообщения = Нстр("ru = 'Не удалось сформировать движения документов: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текНеУдалосьОбработатьДокументов);
	Иначе
		ТекстСообщения = Нстр("ru = 'Движения всех документов были сформированы'");
	КонецЕсли;
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Конец", УровеньЖурналаРегистрации.Предупреждение,,, Этап + Символы.ПС + ТекстСообщения);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.54
//
Процедура ОбновитьКалибровочныеГрафики() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	упКалибровочныеГрафики.Ссылка
	|ИЗ
	|	Справочник.упКалибровочныеГрафики КАК упКалибровочныеГрафики";

	Выборка = Запрос.Выполнить().Выбрать(); 
	Пока Выборка.Следующий() Цикл
		СправочникОбъект = Выборка.Ссылка.ПолучитьОбъект();
		СправочникОбъект.Записать();
	КонецЦикла; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.*
Процедура ОбновитьДвиженияВсехДокументовПоМестоположениямТС(Параметры = Неопределено) Экспорт 
	
	Этап = "Фомирование движений по местоположениям ТС";
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Начало", УровеньЖурналаРегистрации.Предупреждение,,, Этап);	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упРейс.Ссылка
	               |ИЗ
	               |	Документ.упРейс КАК упРейс";
	Выборка = Запрос.Выполнить().Выбрать();
	текНеУдалосьОбработатьДокументов = 0;
	Пока Выборка.Следующий() Цикл
		НачатьТранзакцию();
		Попытка
			БлокировкаДанных = Новый БлокировкаДанных;
			ЭлементБлокировки = БлокировкаДанных.Добавить("Документ.упРейс");
			ЭлементБлокировки.УстановитьЗначение("Ссылка", Выборка.Ссылка);
			ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
			БлокировкаДанных.Заблокировать();
			ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
			Если Ложь Тогда // Для контекстной подсказки
			    ДокументОбъект = Документы.упРейс.СоздатьДокумент();
			КонецЕсли;
			Если Не ДокументОбъект.Проведен Тогда
				ЗафиксироватьТранзакцию();
				Продолжить;
			КонецЕсли;
			Отказ = Ложь;
			упРаботаСоСтатусами.УстановкаСтатусаРейса(ДокументОбъект.ДополнительныеСвойства, ДокументОбъект.Ссылка, Отказ);
			Если Истина
				И ДокументОбъект.ДополнительныеСвойства.Статус <> Перечисления.упСтатусыРейса.Новый
				И ДокументОбъект.ДополнительныеСвойства.Статус <> Перечисления.упСтатусыРейса.Отменен
			Тогда
				ДокументОбъект.ДополнительныеСвойства.Статус = Перечисления.упСтатусыРейса.КПланированиюТС; // Иначе движения не сформируются
			КонецЕсли; 

			сткЭкипаж = упРейс.ПолучитьЭкипажРейса(Выборка.Ссылка);
			текТранспортноеСредство = сткЭкипаж.ТранспортноеСредство;
			Водитель1 = сткЭкипаж.Водитель1;
			Водитель2 = сткЭкипаж.Водитель2;
			Экспедитор = сткЭкипаж.Экспедитор;
			РеквизитыОбъекта = Новый Структура();
			РеквизитыОбъекта.Вставить("ТранспортноеСредство"                    , текТранспортноеСредство);
			РеквизитыОбъекта.Вставить("Водитель1"                               , Водитель1);
			РеквизитыОбъекта.Вставить("Водитель2"                               , Водитель2);
			РеквизитыОбъекта.Вставить("Экспедитор"                              , Экспедитор);
			РеквизитыОбъекта.Вставить("Рейс"                                    , ДокументОбъект.Ссылка);
			РеквизитыОбъекта.Вставить("Маршрут"                                 , Неопределено);
			РеквизитыОбъекта.Вставить("Работы"                                  , Неопределено);
			РеквизитыОбъекта.Вставить("ПлановыеПараметры"                       , Новый Структура());	
			Если НЕ ДокументОбъект.ДополнительныеСвойства.Свойство("Маршрут") Тогда
				ДокументОбъект.ДополнительныеСвойства.Вставить("Маршрут", Неопределено);
			КонецЕсли;
			Если НЕ ДокументОбъект.ДополнительныеСвойства.Свойство("Работы") Тогда
				ДокументОбъект.ДополнительныеСвойства.Вставить("Работы", Неопределено);
			КонецЕсли;
			упРейс.СформироватьДвижениеРасписаниеРаботыВодителей(ДокументОбъект.ДополнительныеСвойства, ДокументОбъект.Ссылка, ДокументОбъект.Движения, РеквизитыОбъекта, Отказ);
			ДокументОбъект.Движения.упРасписаниеРаботыЭкипажей.Записать();
		Исключение
			ОтменитьТранзакцию();
			ОписаниеОшибки = ОписаниеОшибки();
			текПредставление = "" + Выборка.Ссылка;
			ТекстСообщения = Нстр("ru = 'Ошибка формирования движений документа ""%1"": %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			текНеУдалосьОбработатьДокументов = текНеУдалосьОбработатьДокументов + 1;
			ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,, Выборка.Ссылка, ТекстСообщения, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			Продолжить;
		КонецПопытки;
		ЗафиксироватьТранзакцию();
	КонецЦикла; 
	Если текНеУдалосьОбработатьДокументов > 0 Тогда
		ТекстСообщения = Нстр("ru = 'Не удалось сформировать движения документов: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текНеУдалосьОбработатьДокументов);
	Иначе
		ТекстСообщения = Нстр("ru = 'Движения всех документов были сформированы'");
	КонецЕсли;
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Конец", УровеньЖурналаРегистрации.Предупреждение,,, Этап + Символы.ПС + ТекстСообщения);
	 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.56
//
Процедура ЗаполнитьРеквизитСобственноеТранспортноеСредство(Параметры = Неопределено) Экспорт

	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	Отказ			= Ложь;
	
	Этап	= Нстр("ru = 'Заполнение реквизита ""Собственное транспортное средство"" у транспортных средств'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упТранспортныеСредства.Ссылка
	               |ИЗ
	               |	Справочник.упТранспортныеСредства КАК упТранспортныеСредства
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.упПартнеры КАК упПартнеры
	               |		ПО упТранспортныеСредства.Партнер = упПартнеры.Ссылка
	               |ГДЕ
	               |	НЕ упПартнеры.Организация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	               |	И НЕ упТранспортныеСредства.СобственноеТранспортноеСредство";
	текВыборка	= Запрос.Выполнить().Выбрать();
	
	КоличествоТС = 0;
	
	Пока текВыборка.Следующий() Цикл
		
		ТранспортноеСредствоОбъект = текВыборка.Ссылка.ПолучитьОбъект();
		ТранспортноеСредствоОбъект.СобственноеТранспортноеСредство = Истина;
		
		Попытка
		    ТранспортноеСредствоОбъект.Записать();
			КоличествоТС = КоличествоТС + 1;
		Исключение
			Отказ = Истина;
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Ошибка при заполнении реквизита СобственноеТС'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,,ТранспортноеСредствоОбъект, ОписаниеОшибки);    
		КонецПопытки;

	КонецЦикла;
	
	Если Отказ Тогда
		Комментарий = Нстр("ru = 'При заполнении реквизита произошли ошибки. Реквизит заполнен у %1 ТС'");
	Иначе
		Комментарий = Нстр("ru = 'Реквизит заполнен у %1 ТС'");
		Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоТС);
	КонецЕсли;
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры	

// Вызывается при переходе на версию конфигурации 3.0.2.61
Процедура ОбновитьДвиженияВсехДокументовПоЗанятостиТранспорта(Параметры = Неопределено) Экспорт 
	
	Этап = "Фомирование движений по транспортным средствам к планированию";
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Начало", УровеньЖурналаРегистрации.Предупреждение,,, Этап);	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упРейс.Ссылка
	               |ИЗ
	               |	Документ.упРейс КАК упРейс
	               |ГДЕ
	               |	упРейс.Проведен
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	упРейс.Дата";
	Выборка = Запрос.Выполнить().Выбрать();
	НеУдалосьОбработатьДокументов = 0;
	Пока Выборка.Следующий() Цикл
		НачатьТранзакцию();
		Попытка
			БлокировкаДанных = Новый БлокировкаДанных;
			ЭлементБлокировки = БлокировкаДанных.Добавить("Документ.упРейс");
			ЭлементБлокировки.УстановитьЗначение("Ссылка", Выборка.Ссылка);
			ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
			БлокировкаДанных.Заблокировать();
			ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
			Если Ложь Тогда // Для контекстной подсказки
			    ДокументОбъект = Документы.упРейс.СоздатьДокумент();
			КонецЕсли;
			Если Не ДокументОбъект.Проведен Тогда
				ЗафиксироватьТранзакцию();
				Продолжить;
			КонецЕсли;
			Отказ = Ложь;
			упРаботаСоСтатусами.УстановкаСтатусаРейса(ДокументОбъект.ДополнительныеСвойства, ДокументОбъект.Ссылка, Отказ);
			Если Истина
				И ДокументОбъект.ДополнительныеСвойства.Статус <> Перечисления.упСтатусыРейса.Новый
				И ДокументОбъект.ДополнительныеСвойства.Статус <> Перечисления.упСтатусыРейса.Отменен
			Тогда
				ДокументОбъект.ДополнительныеСвойства.Статус = Перечисления.упСтатусыРейса.КПланированиюТС; // Иначе движения не сформируются
			КонецЕсли; 

			сткЭкипаж = упРейс.ПолучитьЭкипажРейса(Выборка.Ссылка);
			текТранспортноеСредство = сткЭкипаж.ТранспортноеСредство;
			Водитель1 = сткЭкипаж.Водитель1;
			Водитель2 = сткЭкипаж.Водитель2;
			Экспедитор = сткЭкипаж.Экспедитор;
			РеквизитыОбъекта = Новый Структура();
			РеквизитыОбъекта.Вставить("ТранспортноеСредство"                    , текТранспортноеСредство);
			РеквизитыОбъекта.Вставить("Водитель1"                               , Водитель1);
			РеквизитыОбъекта.Вставить("Водитель2"                               , Водитель2);
			РеквизитыОбъекта.Вставить("Экспедитор"                              , Экспедитор);
			РеквизитыОбъекта.Вставить("Рейс"                                    , ДокументОбъект.Ссылка);
			РеквизитыОбъекта.Вставить("Маршрут"                                 , Неопределено);
			РеквизитыОбъекта.Вставить("Работы"                                  , Неопределено);
			РеквизитыОбъекта.Вставить("ПлановыеПараметры"                       , Новый Структура());	
			Если НЕ ДокументОбъект.ДополнительныеСвойства.Свойство("Маршрут") Тогда
				ДокументОбъект.ДополнительныеСвойства.Вставить("Маршрут", Неопределено);
			КонецЕсли;
			Если НЕ ДокументОбъект.ДополнительныеСвойства.Свойство("Работы") Тогда
				ДокументОбъект.ДополнительныеСвойства.Вставить("Работы", Неопределено);
			КонецЕсли;
			упРейс.СформироватьДвиженияЗанятостиТранспорта(ДокументОбъект.ДополнительныеСвойства, ДокументОбъект.Ссылка, ДокументОбъект.Движения, РеквизитыОбъекта, Отказ);
			ДокументОбъект.Движения.упЗанятостьТранспорта.Записать();
		Исключение
			ОтменитьТранзакцию();
			ОписаниеОшибки = ОписаниеОшибки();
			текПредставление = "" + Выборка.Ссылка;
			ТекстСообщения = Нстр("ru = 'Ошибка формирования движений документа ""%1"": %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			НеУдалосьОбработатьДокументов = НеУдалосьОбработатьДокументов + 1;
			ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,, Выборка.Ссылка, ТекстСообщения, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			Продолжить;
		КонецПопытки;
		ЗафиксироватьТранзакцию();
	КонецЦикла; 
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упКорректировкаРейса.Ссылка
	               |ИЗ
	               |	Документ.упКорректировкаРейса КАК упКорректировкаРейса
	               |ГДЕ
	               |	упКорректировкаРейса.Проведен
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	упКорректировкаРейса.Дата";
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		НачатьТранзакцию();
		Попытка
			БлокировкаДанных = Новый БлокировкаДанных;
			ЭлементБлокировки = БлокировкаДанных.Добавить("Документ.упКорректировкаРейса");
			ЭлементБлокировки.УстановитьЗначение("Ссылка", Выборка.Ссылка);
			ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
			БлокировкаДанных.Заблокировать();
			ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
			Если Ложь Тогда // Для контекстной подсказки
			    ДокументОбъект = Документы.упКорректировкаРейса.СоздатьДокумент();
			КонецЕсли;
			Если Не ДокументОбъект.Проведен Тогда
				ЗафиксироватьТранзакцию();
				Продолжить;
			КонецЕсли;
			Отказ = Ложь;
			упКорректировкаМаршрута.СформироватьДвиженияПлановаяЗанятостьТС(ДокументОбъект.ДополнительныеСвойства, ДокументОбъект.Ссылка, ДокументОбъект.Движения, Выборка.Ссылка, Отказ);
			ДокументОбъект.Движения.упЗанятостьТранспорта.Записать();
		Исключение
			ОтменитьТранзакцию();
			ОписаниеОшибки = ОписаниеОшибки();
			текПредставление = "" + Выборка.Ссылка;
			ТекстСообщения = Нстр("ru = 'Ошибка формирования движений документа ""%1"": %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			НеУдалосьОбработатьДокументов = НеУдалосьОбработатьДокументов + 1;
			ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,, Выборка.Ссылка, ТекстСообщения, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			Продолжить;
		КонецПопытки;
		ЗафиксироватьТранзакцию();
	КонецЦикла; 
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упРемонтИТОТС.Ссылка
	               |ИЗ
	               |	Документ.упРемонтИТОТС КАК упРемонтИТОТС ГДЕ упРемонтИТОТС.Проведен";
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		НачатьТранзакцию();
		Попытка
			БлокировкаДанных = Новый БлокировкаДанных;
			ЭлементБлокировки = БлокировкаДанных.Добавить("Документ.упРемонтИТОТС");
			ЭлементБлокировки.УстановитьЗначение("Ссылка", Выборка.Ссылка);
			ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
			БлокировкаДанных.Заблокировать();
			ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
			Если Ложь Тогда // Для контекстной подсказки
			    ДокументОбъект = Документы.упРемонтИТОТС.СоздатьДокумент();
			КонецЕсли;
			Если Не ДокументОбъект.Проведен Тогда
				ЗафиксироватьТранзакцию();
				Продолжить;
			КонецЕсли;
			Отказ = Ложь;
			ДокументОбъект.ДополнительныеСвойства.Вставить("Статус", Документы.упРемонтИТОТС.ПолучитьСтатус(Выборка.Ссылка));
			упРемонтИТОТС.СформироватьДвиженияЗанятостьТранспорта(ДокументОбъект.ДополнительныеСвойства, ДокументОбъект.Ссылка, ДокументОбъект.Движения, Выборка.Ссылка, Отказ);
			ДокументОбъект.Движения.упЗанятостьТранспорта.Записать();
		Исключение
			ОтменитьТранзакцию();
			ОписаниеОшибки = ОписаниеОшибки();
			текПредставление = "" + Выборка.Ссылка;
			ТекстСообщения = Нстр("ru = 'Ошибка формирования движений документа ""%1"": %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			НеУдалосьОбработатьДокументов = НеУдалосьОбработатьДокументов + 1;
			ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,, Выборка.Ссылка, ТекстСообщения, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			Продолжить;
		КонецПопытки;
		ЗафиксироватьТранзакцию();
	КонецЦикла; 
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упИзменениеСостоянияТранспортногоСредства.Ссылка
	               |ИЗ
	               |	Документ.упИзменениеСостоянияТранспортногоСредства КАК упИзменениеСостоянияТранспортногоСредства
	               |ГДЕ
	               |	упИзменениеСостоянияТранспортногоСредства.Проведен
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	упИзменениеСостоянияТранспортногоСредства.Дата";
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		НачатьТранзакцию();
		Попытка
			БлокировкаДанных = Новый БлокировкаДанных;
			ЭлементБлокировки = БлокировкаДанных.Добавить("Документ.упРемонтИТОТС");
			ЭлементБлокировки.УстановитьЗначение("Ссылка", Выборка.Ссылка);
			ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
			БлокировкаДанных.Заблокировать();
			ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
			Если Ложь Тогда // Для контекстной подсказки
			    ДокументОбъект = Документы.упИзменениеСостоянияТранспортногоСредства.СоздатьДокумент();
			КонецЕсли;
			Если Не ДокументОбъект.Проведен Тогда
				ЗафиксироватьТранзакцию();
				Продолжить;
			КонецЕсли;
			Отказ = Ложь;
			Документы.упИзменениеСостоянияТранспортногоСредства.СформироватьДвиженияЗанятостьТранспорта(ДокументОбъект.ДополнительныеСвойства, ДокументОбъект.Ссылка,
				ДокументОбъект.Движения, Выборка.Ссылка, Отказ);
			ДокументОбъект.Движения.упЗанятостьТранспорта.Записать();
		Исключение
			ОтменитьТранзакцию();
			ОписаниеОшибки = ОписаниеОшибки();
			текПредставление = "" + Выборка.Ссылка;
			ТекстСообщения = Нстр("ru = 'Ошибка формирования движений документа ""%1"": %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			НеУдалосьОбработатьДокументов = НеУдалосьОбработатьДокументов + 1;
			ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,, Выборка.Ссылка, ТекстСообщения, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			Продолжить;
		КонецПопытки;
		ЗафиксироватьТранзакцию();
	КонецЦикла;
		
	Если НеУдалосьОбработатьДокументов > 0 Тогда
		ТекстСообщения = Нстр("ru = 'Не удалось сформировать движения документов: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, НеУдалосьОбработатьДокументов);
	Иначе
		ТекстСообщения = Нстр("ru = 'Движения всех документов были сформированы'");
	КонецЕсли;
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Конец", УровеньЖурналаРегистрации.Предупреждение,,, Этап + Символы.ПС + ТекстСообщения);

	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.64
//
Процедура ОбновитьРегистрСведенийПлановыеПараметрыРейса(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполнение ресурса ""ПлановоеОкончаниеВыполненияИсходное"" в регистре ""упПлановыеПараметрыРейса""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	упПлановыеПараметрыРейса.Рейс,
	|	упПлановыеПараметрыРейса.ПлановоеОкончаниеВыполнения
	|ИЗ
	|	РегистрСведений.упПлановыеПараметрыРейса КАК упПлановыеПараметрыРейса
	|ГДЕ
	|	упПлановыеПараметрыРейса.ПлановоеОкончаниеВыполненияИсходное = ДАТАВРЕМЯ(1, 1, 1)";
	
	текВыборка	= Запрос.Выполнить().Выбрать();
	
	Сч = 0;
	
	Пока текВыборка.Следующий() Цикл
		
		текЗапись = РегистрыСведений.упПлановыеПараметрыРейса.СоздатьМенеджерЗаписи();
		текЗапись.Рейс = текВыборка.Рейс;
		текЗапись.Прочитать();
		Если текЗапись.Выбран() Тогда
			текЗапись.ПлановоеОкончаниеВыполненияИсходное = текВыборка.ПлановоеОкончаниеВыполнения;
			текЗапись.Записать();
		КонецЕсли;
		
		Сч = Сч + 1;
		
	КонецЦикла;

	Этап	= Нстр("ru = 'Заполнено %1 записей'");
	Этап = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Этап, Сч);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.66
//
Процедура ОбновитьРегистрСведенийРасписаниеРаботыТС(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап = Нстр("ru = 'Удаление плановых движений в регистре ""упРасписаниеРаботыТС""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	упРасписаниеРаботыТС.Регистратор КАК Ссылка
	|ИЗ
	|	РегистрСведений.упРасписаниеРаботыТС КАК упРасписаниеРаботыТС
	|ГДЕ
	|	упРасписаниеРаботыТС.ТипРасписания = ЗНАЧЕНИЕ(Перечисление.упТипыРасписанийРаботыТС.План)
	|";
	Выборка = Запрос.Выполнить().Выбрать();
	НеУдалосьОбработатьДокументов = 0;
	Пока Выборка.Следующий() Цикл
		НачатьТранзакцию();
		Попытка
			Набор = РегистрыСведений.упРасписаниеРаботыТС.СоздатьНаборЗаписей();
			Набор.Отбор.Регистратор.Установить(Выборка.Ссылка);
			Набор.Прочитать();
			ТаблицаНабора = Набор.Выгрузить();
			//ТаблицаНабора = ТаблицаНабора.Скопировать(Новый Структура("ТипРасписания", Перечисления.упТипыРасписанийРаботыТС.Факт));
			НачальноеКоличество = ТаблицаНабора.Количество(); 
			Для СчетчикТаблицаНабора = 1 По НачальноеКоличество Цикл
				СтрокаНабора = ТаблицаНабора[НачальноеКоличество - СчетчикТаблицаНабора];
				Если СтрокаНабора.ТипРасписания = Перечисления.упТипыРасписанийРаботыТС.План Тогда
					ТаблицаНабора.Удалить(СтрокаНабора);
				КонецЕсли;
			КонецЦикла;
			Набор.Загрузить(ТаблицаНабора);
			Набор.Записать();
		Исключение
			ОтменитьТранзакцию();
			ОписаниеОшибки = ОписаниеОшибки();
			текПредставление = "" + Выборка.Ссылка;
			ТекстСообщения = Нстр("ru = 'Ошибка записи движений документа ""%1"": %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			НеУдалосьОбработатьДокументов = НеУдалосьОбработатьДокументов + 1;
			ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,, Выборка.Ссылка, ТекстСообщения, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			Продолжить;
		КонецПопытки;
		ЗафиксироватьТранзакцию();
	КонецЦикла;
	Если НеУдалосьОбработатьДокументов > 0 Тогда
		ТекстСообщения = Нстр("ru = 'Не удалось обработать движения документов: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, НеУдалосьОбработатьДокументов);
	Иначе
		ТекстСообщения = Нстр("ru = 'Движения всех документов были обработаны'");
	КонецЕсли;
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Предупреждение,,, Этап + Символы.ПС + ТекстСообщения);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.2.68
//
Процедура ОбновитьПараметрыСпутниковогоМониторингаМестаИнтереса() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = ""Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторинга""
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить("Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторинга", Выборка.КлючВарианта);
			Если НЕ СохраненныеНастройки = Неопределено Тогда
				ПараметрыМониторинга = СохраненныеНастройки;
				Если НЕ ПараметрыМониторинга.Свойство("МестаИнтереса") Тогда
					ПараметрыМониторинга.Вставить("МестаИнтереса", Новый Массив);
				КонецЕсли;				
				ХранилищаНастроек.упХранилищеНастроек.Сохранить("Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторинга", Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
	КлючОбъекта =  "Обработка.упРМСпутниковыйМониторинг.ОбщиеНастройки";
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = &Объект
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Запрос.УстановитьПараметр("Объект", КлючОбъекта);
	
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить(КлючОбъекта, Выборка.КлючВарианта);
			Если НЕ СохраненныеНастройки = Неопределено И ТипЗнч(СохраненныеНастройки) = Тип("Структура") Тогда
				СохраненныеНастройки.Вставить("ОтображатьМестаИнтереса", Ложь);
				ХранилищаНастроек.упХранилищеНастроек.Сохранить(КлючОбъекта, Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры // ОбновитьПараметрыСпутниковогоМониторингаМестаИнтереса()

// Вызывается при переходе на версию конфигурации 3.0.2.82
//
Процедура ЗаполнитьОрганизациюПутевогоЛиста(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполнение реквизита ""Организация"" в путевом листе'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упПутевойЛист.Рейс.Организация КАК Организация,
	               |	упПутевойЛист.Ссылка
				   |ИЗ
	               |	Документ.упПутевойЛист КАК упПутевойЛист
	               |ГДЕ
	               |	упПутевойЛист.Организация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)";
	Выборка	= Запрос.Выполнить().Выбрать();
	
	КоличествоДокументов 							 = 0;
	КоличествоДокументовНеУдалосьИзменитьОрганизацию = 0;
	КоличествоДокументовРейсБезОрганизации 			 = 0;
	
	Пока Выборка.Следующий() Цикл
		
		Организация = Выборка.Организация;
		
		Если ЗначениеЗаполнено(Организация) Тогда
			
			ПутевойЛистОбъект = Выборка.Ссылка.ПолучитьОбъект();
			ПутевойЛистОбъект.Организация = Организация;
			
			Попытка
				ПутевойЛистОбъект.Записать(РежимЗаписиДокумента.Запись);
				КоличествоДокументов = КоличествоДокументов + 1;
			Исключение
				ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
					ОписаниеОшибки = ОписаниеОшибки();
				КонецЕсли;
				Событие = Нстр("ru = 'Не удалось записать документ'");
				ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
				КоличествоДокументовНеУдалосьИзменитьОрганизацию = КоличествоДокументовНеУдалосьИзменитьОрганизацию + 1;    
			КонецПопытки;
		Иначе
			Событие = Нстр("ru = 'Не удалось получить организацию'");
			ТекстСообщения = Нстр("ru = 'В %1 не заполнена организация у рейса'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, Выборка.Ссылка);
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Предупреждение,,, ТекстСообщения); 
			КоличествоДокументовРейсБезОрганизации = КоличествоДокументовРейсБезОрганизации + 1;
		КонецЕсли;
	КонецЦикла;
	
	Комментарий = Нстр("ru = 'Количество документов: успешно обработано-%1, не удалось записать-%2, не удалось получить организацию-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоДокументов, 
														КоличествоДокументовНеУдалосьИзменитьОрганизацию, КоличествоДокументовРейсБезОрганизации);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
КонецПроцедуры // ЗаполнитьОрганизациюПутевогоЛиста()

// Вызывается при переходе на версию конфигурации 3.0.2.83
//
Процедура ОбновитьПараметрыМониторингаОтображатьТрекЦветомПоСкоростиДвижения(Параметры = Неопределено) Экспорт
	                                   
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = ""Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторингаРейсов""
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить("Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторингаРейсов", Выборка.КлючВарианта);
			Если СохраненныеНастройки <> Неопределено Тогда
				СохраненныеНастройки.Вставить("ОтображатьТрекЦветомПоСкоростиДвиженияРейсы",Ложь);
				СохраненныеНастройки.Вставить("ЦветоваяШкалаРейсы", Справочники.упЦветовыеШкалы.ПустаяСсылка());
				ХранилищаНастроек.упХранилищеНастроек.Сохранить("Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторингаРейсов", Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = ""Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторингаТранспорта""
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			СохраненныеНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить("Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторингаТранспорта", Выборка.КлючВарианта);
			Если СохраненныеНастройки <> Неопределено Тогда
				СохраненныеНастройки.Вставить("ОтображатьТрекЦветомПоСкоростиДвиженияТС",Ложь);
				СохраненныеНастройки.Вставить("ЦветоваяШкалаТС", Справочники.упЦветовыеШкалы.ПустаяСсылка());
				ХранилищаНастроек.упХранилищеНастроек.Сохранить("Обработка.упРМСпутниковыйМониторинг.ПараметрыМониторингаТранспорта", Выборка.КлючВарианта, СохраненныеНастройки);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры // ОбновитьПараметрыМониторингаОтображатьТрекЦветомПоСкоростиДвижения()

// Вызывается при переходе на версию конфигурации 3.0.2.88
//
Процедура ЗаполнитьОстаткамиРегистрНепереданныеДокументы(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется регистр ""НепереданныеДокументы"" по данным документов рейс в статусах ""КВыполнению"" и ""Выполняется""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упРейсЗадания.Задание КАК Задание,
	               |	упЗаданиеНаПеревозкуГруза.Заказчик КАК Заказчик,
	               |	упРейсЗадания.Ссылка КАК Рейс
	               |ПОМЕСТИТЬ втЗадания
	               |ИЗ
	               |	Документ.упРейс.Задания КАК упРейсЗадания
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.упЗаданиеНаПеревозкуГруза КАК упЗаданиеНаПеревозкуГруза
	               |		ПО упРейсЗадания.Задание = упЗаданиеНаПеревозкуГруза.Ссылка
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.упСтатусыРейсов.СрезПоследних КАК упСтатусыРейсовСрезПоследних
	               |		ПО упРейсЗадания.Ссылка = упСтатусыРейсовСрезПоследних.Документ
	               |			И (упСтатусыРейсовСрезПоследних.Статус = ЗНАЧЕНИЕ(Перечисление.упСтатусыРейса.КВыполнению)
	               |				ИЛИ упСтатусыРейсовСрезПоследних.Статус = ЗНАЧЕНИЕ(Перечисление.упСтатусыРейса.Выполняется))
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втЗадания.Задание КАК ЗаданиеНаПеревозку,
	               |	упПакетДокументов.ТипРегламентногоДокумента КАК ТипРегламентногоДокумента,
	               |	СУММА(упПакетДокументов.КоличествоПолучитьОтУчастника) КАК КоличествоПолучить,
	               |	СУММА(упПакетДокументов.КоличествоПередатьУчастнику) КАК КоличествоПередать,
	               |	втЗадания.Рейс КАК Рейс
	               |ПОМЕСТИТЬ втДокументы
	               |ИЗ
	               |	втЗадания КАК втЗадания
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.упПакетыРегламентныхДокументов.ПакетДокументов КАК упПакетДокументов
	               |		ПО втЗадания.Заказчик.ПакетРегламентныхДокументов = упПакетДокументов.Ссылка
	               |			И (упПакетДокументов.Участник = ЗНАЧЕНИЕ(Перечисление.упУчастникиДокументооборотаПеревозки.Заказчик))
	               |			И (упПакетДокументов.ВозвратДокументовПослеИсполненияРейса)
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	втЗадания.Задание,
	               |	упПакетДокументов.ТипРегламентногоДокумента,
	               |	втЗадания.Рейс
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	упНепереданныеДокументы.Рейс,
	               |	упНепереданныеДокументы.ЗаданиеНаПеревозку,
	               |	упНепереданныеДокументы.ТипРегламентногоДокумента,
	               |	упНепереданныеДокументы.Операция,
	               |	упНепереданныеДокументы.Количество
	               |ПОМЕСТИТЬ втДвиженияПоРейсам
	               |ИЗ
	               |	РегистрНакопления.упНепереданныеДокументы КАК упНепереданныеДокументы
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втЗадания КАК втЗадания
	               |		ПО упНепереданныеДокументы.Регистратор = втЗадания.Рейс
	               |			И упНепереданныеДокументы.ЗаданиеНаПеревозку = втЗадания.Задание
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втДокументы.ЗаданиеНаПеревозку КАК ЗаданиеНаПеревозку,
	               |	втДокументы.ТипРегламентногоДокумента КАК ТипРегламентногоДокумента,
	               |	ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.ПолучениеДокументов) КАК Операция,
	               |	втДокументы.КоличествоПолучить КАК Количество,
	               |	втДокументы.Рейс КАК Рейс
	               |ПОМЕСТИТЬ втДокументыДляПрихода
	               |ИЗ
	               |	втДокументы КАК втДокументы
	               |ГДЕ
	               |	втДокументы.КоличествоПолучить > 0
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	втДокументы.ЗаданиеНаПеревозку,
	               |	втДокументы.ТипРегламентногоДокумента,
	               |	ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.ПередачаДокументов),
	               |	втДокументы.КоличествоПередать,
	               |	втДокументы.Рейс
	               |ИЗ
	               |	втДокументы КАК втДокументы
	               |ГДЕ
	               |	втДокументы.КоличествоПередать > 0
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	втДвиженияПоРейсам.ЗаданиеНаПеревозку,
	               |	втДвиженияПоРейсам.ТипРегламентногоДокумента,
	               |	втДвиженияПоРейсам.Операция,
	               |	-втДвиженияПоРейсам.Количество,
	               |	втДвиженияПоРейсам.Рейс
	               |ИЗ
	               |	втДвиженияПоРейсам КАК втДвиженияПоРейсам
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втДокументыДляПрихода.ЗаданиеНаПеревозку,
	               |	втДокументыДляПрихода.ТипРегламентногоДокумента,
	               |	втДокументыДляПрихода.Рейс КАК Рейс,
	               |	СУММА(втДокументыДляПрихода.Количество) КАК Количество,
	               |	втДокументыДляПрихода.Операция,
	               |	упРейс.Дата
	               |ИЗ
	               |	втДокументыДляПрихода КАК втДокументыДляПрихода
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.упРейс КАК упРейс
	               |		ПО втДокументыДляПрихода.Рейс = упРейс.Ссылка
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	втДокументыДляПрихода.ЗаданиеНаПеревозку,
	               |	втДокументыДляПрихода.Операция,
	               |	втДокументыДляПрихода.Рейс,
	               |	втДокументыДляПрихода.ТипРегламентногоДокумента,
	               |	упРейс.Дата
	               |
	               |ИМЕЮЩИЕ
	               |	СУММА(втДокументыДляПрихода.Количество) > 0
	               |ИТОГИ ПО
	               |	Рейс";
				   
	НачатьТранзакцию();
		
	Отказ = Ложь;
	
	КоличествоЗаписей = 0;
	
	ВыборкаРейс	= Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаРейс.Следующий() Цикл
		
		ВыборкаЗапись = ВыборкаРейс.Выбрать();
		
		НаборЗаписей = РегистрыНакопления.упНепереданныеДокументы.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.Регистратор.Установить(ВыборкаРейс.Рейс); 
		
		Пока ВыборкаЗапись.Следующий() Цикл
			КоличествоЗаписей = КоличествоЗаписей + 1;
			НоваяЗапись = НаборЗаписей.Добавить(); 
			НоваяЗапись.Период = ВыборкаЗапись.Дата;
			ЗаполнитьЗначенияСвойств(НоваяЗапись, ВыборкаЗапись);
			Попытка
				НаборЗаписей.Записать(); 
			Исключение
				Отказ = Истина;
				ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
					ОписаниеОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("ЗаписьНепереданныеДокументы", УровеньЖурналаРегистрации.Ошибка,, ВыборкаЗапись.Рейс, ОписаниеОшибки);
			КонецПопытки;
			
			Если Отказ Тогда
				Прервать;
			КонецЕсли;
			
		КонецЦикла;
						
		Если Отказ Тогда
				Прервать;
		КонецЕсли;

	КонецЦикла;
	
	Если НЕ Отказ Тогда
		Попытка
			ЗафиксироватьТранзакцию();	
		Исключение
			ОтменитьТранзакцию();
		    ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			ЗаписьЖурналаРегистрации("ЗаписьНепереданныеДокументы", УровеньЖурналаРегистрации.Ошибка,,, ОписаниеОшибки);
		КонецПопытки;
	Иначе
		ОтменитьТранзакцию();
	КонецЕсли;
	
	Если НЕ Отказ Тогда
		Комментарий = Нстр("ru = 'Заполнение регистра успешно завершено. Добавлено %1 записей'");	
		Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей);
	Иначе	
		Комментарий = Нстр("ru = 'При заполнении регистра произошли ошибки, регистр не заполнен'");		
	КонецЕсли;
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
	
КонецПроцедуры //ЗаполнитьОстаткамиРегистрНепереданныеДокументы()

// Вызывается при переходе на версию конфигурации 3.0.3.23
//
Процедура ОбновитьСпособыРасчетаУПравилРасчета(Параметры = Неопределено) Экспорт
	                                   
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упПравилаРасчета.Ссылка
	|ИЗ
	|	Справочник.упПравилаРасчета КАК упПравилаРасчета
	|ГДЕ
	|	НЕ упПравилаРасчета.ПометкаУдаления
	|	И упПравилаРасчета.СпособРасчета = &ПустойСпособРасчета";
	Запрос.УстановитьПараметр("ПустойСпособРасчета", Перечисления.упСпособыРасчета.ПустаяСсылка());
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	Пока Выборка.Следующий() Цикл
		СправочникОбъект = Выборка.Ссылка.ПолучитьОбъект();
		Если Ложь Тогда // Для контекстной подсказки
		    СправочникОбъект = Справочники.упПравилаРасчета.СоздатьЭлемент();
		КонецЕсли;
		СправочникОбъект.СпособРасчета = Перечисления.упСпособыРасчета.Формула;
		СправочникОбъект.ОбменДанными.Загрузка = Истина;
		СправочникОбъект.Записать();
	КонецЦикла;
	
КонецПроцедуры // ОбновитьПараметрыМониторингаОтображатьТрекЦветомПоСкоростиДвижения()

// Вызывается при переходе на версию конфигурации 3.0.3.29
//
Процедура ОбновлениеДанныхТрекеров(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Обновление данных трекеров'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |	упДанныеТрекеровТ.ТранспортноеСредство КАК ТранспортноеСредство
	               |ИЗ
	               |	РегистрСведений.упДанныеТрекеров КАК упДанныеТрекеровТ
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	упДанныеТрекеровТ.ТранспортноеСредство";
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоТранспорта = 0;
	КоличествоНеуспехов = 0;
	РегистрыСведений.упДанныеТрекеров.УстановитьИспользованиеИтогов(Ложь);
	Пока Выборка.Следующий() Цикл
		Попытка
			НаборДвижений = РегистрыСведений.упДанныеТрекеров.СоздатьНаборЗаписей();
			НаборДвижений.Отбор.ТранспортноеСредство.Установить(Выборка.ТранспортноеСредство);
			НаборДвижений.Прочитать();
			НаборДвижений.Записать();
			КоличествоТранспорта = КоличествоТранспорта + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			КоличествоНеуспехов = КоличествоНеуспехов + 1;
			Комментарий = Нстр("ru = 'Не удалось записать набор по транспорту ""%1""'");
			Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, Выборка.ТранспортноеСредство);
			ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,, Выборка.ТранспортноеСредство, ОписаниеОшибки); 
		КонецПопытки;
	КонецЦикла;
	РегистрыСведений.упДанныеТрекеров.УстановитьИспользованиеИтогов(Истина);
	Комментарий = Нстр("ru = 'Количество элементов: успешно обработано %1, не удалось записать %2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоТранспорта, КоличествоНеуспехов);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
КонецПроцедуры // ЗаполнитьОрганизациюПутевогоЛиста()

// Вызывается при переходе на версию конфигурации 3.0.3.35
//
Процедура ОбновитьПредопределенныеТипыДокументовТСВодителей() Экспорт
	
	Справочники.упТипыДокументовТСВодителей.ПервоначальноеЗаполнение();
	
КонецПроцедуры // ОбновитьПредопределенныеТипыДокументовТСВодителей()

// Вызывается при переходе на версию конфигурации 3.0.3.36
//
Процедура ПерезаписатьПоказателиРасчета() Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	Этап = Нстр("ru = 'Перезапись показателей расчета'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);
	Выборка = Справочники.упПоказателиРасчета.Выбрать();
	КоличествоОбъектов = 0;
	КоличествоНеуспехов = 0;
	Пока Выборка.Следующий() Цикл
		Попытка
			СправочникОбъект = Выборка.ПолучитьОбъект();
			СправочникОбъект.Записать();
			КоличествоОбъектов = КоличествоОбъектов + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			КоличествоНеуспехов = КоличествоНеуспехов + 1;
			Комментарий = Нстр("ru = 'Не удалось записать показатель расчета ""%1""'");
			Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, СправочникОбъект);
			ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,, Выборка.Ссылка, ОписаниеОшибки); 
		КонецПопытки;
	КонецЦикла;
	Комментарий = Нстр("ru = 'Количество элементов: успешно обработано %1, не удалось записать %2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоОбъектов, КоличествоНеуспехов);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры // ОбновитьПредопределенныеТипыДокументовТСВодителей()

// Вызывается при переходе на версию конфигурации 3.0.3.43
//
Процедура ЗаполнитьТабличнуюЧастьРейсыДокументаПутевойЛист(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется табличная часть ""Рейсы"" непомеченных на удаление путевых листов'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упПутевойЛист.Ссылка КАК Ссылка,
	               |	упПутевойЛист.Рейс КАК Рейс,
	               | 	упПутевойЛист.Пробег
	               |ИЗ
	               |	Документ.упПутевойЛист КАК упПутевойЛист
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.упПутевойЛист.Рейсы КАК упПутевойЛистРейсы
	               |		ПО (упПутевойЛистРейсы.Ссылка = упПутевойЛист.Ссылка)
	               |ГДЕ
	               |	НЕ упПутевойЛист.ПометкаУдаления
	               |	И упПутевойЛистРейсы.Ссылка ЕСТЬ NULL
	               |	И НЕ упПутевойЛист.Рейс = ЗНАЧЕНИЕ(Документ.упРейс.ПустаяСсылка)";
				   
	НачатьТранзакцию();
		
	Отказ = Ложь;
	
	КоличествоЗаписей = 0;
	
	ВыборкаПутевойЛист	= Запрос.Выполнить().Выбрать();
	Пока ВыборкаПутевойЛист.Следующий() Цикл
		
		ПутевойЛистОбъект  = ВыборкаПутевойЛист.Ссылка.ПолучитьОбъект();
		НоваяСтрокаРейс	   = ПутевойЛистОбъект.Рейсы.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрокаРейс, ВыборкаПутевойЛист);
		
		Попытка
			ПутевойЛистОбъект.Записать(РежимЗаписиДокумента.Запись); 
			КоличествоЗаписей = КоличествоЗаписей + 1;
		Исключение
			Отказ = Истина;
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			ЗаписьЖурналаРегистрации("ЗаписьПутевойЛист", УровеньЖурналаРегистрации.Ошибка,, ВыборкаПутевойЛист.Ссылка, ОписаниеОшибки);
		КонецПопытки;
			
		Если Отказ Тогда
			Прервать;
		КонецЕсли;
			
	КонецЦикла;
	
	Если НЕ Отказ Тогда
		Попытка
			ЗафиксироватьТранзакцию();	
		Исключение
			ОтменитьТранзакцию();
		    ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			ЗаписьЖурналаРегистрации("ЗаписьПутевойЛист", УровеньЖурналаРегистрации.Ошибка,,, ОписаниеОшибки);
		КонецПопытки;
	Иначе
		ОтменитьТранзакцию();
	КонецЕсли;
	
	Если НЕ Отказ Тогда
		Комментарий = Нстр("ru = 'Заполнение табличной части ""Рейсы"" путевых листов успешно завершено. Добавлено %1 записей'");	
		Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей);
	Иначе	
		Комментарий = Нстр("ru = 'При заполнении табличной части ""Рейсы"" путевых листов произошли ошибки. Табличная часть осталась не заполненной.'");		
	КонецЕсли;
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
КонецПроцедуры //ЗаполнитьТабличнуюЧастьРейсыДокументаПутевойЛист()

// Вызывается при переходе на версию конфигурации 3.0.3.52
//
Процедура ЗаполнитьСпособУчетаИнкассируемыхЦенностейВидаПеревозки(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется реквизит ""СпособУчетаИнкассируемыхЦенностей"" в справочнике ""Виды перевозок""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упВидыПеревозок.Ссылка
	               |ИЗ
	               |	Справочник.упВидыПеревозок КАК упВидыПеревозок
	               |ГДЕ
	               |	упВидыПеревозок.ИспользуютсяУслугиИнкассации
	               |	И упВидыПеревозок.СпособУчетаИнкассируемыхЦенностей = ЗНАЧЕНИЕ(Перечисление.упСпособыУчетаИнкассируемыхЦенностей.ПустаяСсылка)";
				   

	КоличествоЗаписей = 0;
	
	Выборка	= Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		
		ВидПеревозкиОбъект  = Выборка.Ссылка.ПолучитьОбъект();
		ВидПеревозкиОбъект.СпособУчетаИнкассируемыхЦенностей = Перечисления.упСпособыУчетаИнкассируемыхЦенностей.ВЦеломПоЗаявкеНаПеревозкуГруза;
	
		ВидПеревозкиОбъект.Записать(); 
		КоличествоЗаписей = КоличествоЗаписей + 1;
		
	КонецЦикла;
	
	Комментарий = Нстр("ru = 'Заполнение реквизита ""СпособУчетаИнкассируемыхЦенностей"" в справочнике ""Виды перевозок"" успешно завершено. Изменено %1 элементов'");	
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей);
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
КонецПроцедуры //ЗаполнитьТабличнуюЧастьРейсыДокументаПутевойЛист()

// Вызывается при переходе на версию конфигурации 3.0.3.52
//
Процедура ЗаполнитьВидГрузаУТипаГруза(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется реквизит ""Вид груза"" справочника ""Типы грузов""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упТипыГрузов.Ссылка
	               |ИЗ
	               |	Справочник.упТипыГрузов КАК упТипыГрузов
	               |ГДЕ
	               |	упТипыГрузов.ВидГруза = ЗНАЧЕНИЕ(Перечисление.упВидыГрузов.ПустаяСсылка)";
				   
	
	КоличествоЗаписей = 0;
	
	Выборка	= Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		
		ТипГрузаОбъект  = Выборка.Ссылка.ПолучитьОбъект();
		ТипГрузаОбъект.ВидГруза = Перечисления.упВидыГрузов.Груз;
	
		ТипГрузаОбъект.Записать(); 
		КоличествоЗаписей = КоличествоЗаписей + 1;
		
	КонецЦикла;
	
	Комментарий = Нстр("ru = 'Заполнение реквизита ""Вид груза"" в справочнике ""Типы грузов"" успешно завершено. Изменено %1 элементов'");	
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей);
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
КонецПроцедуры //ЗаполнитьТабличнуюЧастьРейсыДокументаПутевойЛист()

// Вызывается при переходе на версию конфигурации 3.0.3.56
//
Процедура ОбновитьПытатьсяРассчитатьСноваВРегистреРасстояний(Параметры = Неопределено) Экспорт
	                                   
	ЗаполнитьЗональныеНастройкиМаршрутизацииПоУмолчанию(); // Иначе будет ошибка при записи менеджера в режиме Не Загрузка
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	Этап	= Нстр("ru = 'Заполняется реквизит ""Пытаться рассчитать снова"" регистра ""Расстояния между точками""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упРасстоянияМеждуТочками.НачальнаяШирота,
	|	упРасстоянияМеждуТочками.НачальнаяДолгота,
	|	упРасстоянияМеждуТочками.КонечнаяШирота,
	|	упРасстоянияМеждуТочками.КонечнаяДолгота,
	|	упРасстоянияМеждуТочками.Ограничение
	|ИЗ
	|	РегистрСведений.упРасстоянияМеждуТочками КАК упРасстоянияМеждуТочками
	|ГДЕ
	|	упРасстоянияМеждуТочками.ПопыткаРасчета > 0
	|	И упРасстоянияМеждуТочками.ПопыткаРасчета < 10";
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	МенеджерЗаписи = РегистрыСведений.упРасстоянияМеждуТочками.СоздатьМенеджерЗаписи();
	КоличествоЗаписей = 0;
	Пока Выборка.Следующий() Цикл
		ЗаполнитьЗначенияСвойств(МенеджерЗаписи, Выборка); 
		МенеджерЗаписи.Прочитать();
		МенеджерЗаписи.ПытатьсяРассчитатьСнова = Истина;
		МенеджерЗаписи.Записать();
		КоличествоЗаписей = КоличествоЗаписей + 1;
	КонецЦикла;
	Комментарий = Нстр("ru = 'Заполнение реквизита ""Пытаться рассчитать снова"" регистра ""Расстояния между точками"". Изменено %1 элементов'");	
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры // ОбновитьПараметрыМониторингаОтображатьТрекЦветомПоСкоростиДвижения()

// Вызывается при переходе на версию конфигурации 3.0.3.56
//
Процедура ОбновитьВидТранспортаВСправочниках(Параметры = Неопределено) Экспорт

	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	Отказ			= Ложь;
	
	Этап = Нстр("ru = 'Обновляется реквизит ""Вид транспорта"" в справочнике транспорта");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);
	Выборка = Справочники.упТранспортныеСредства.Выбрать();
	КоличествоТС = 0;
	КоличествоОшибок = 0;
	Пока Выборка.Следующий() Цикл
		ТранспортноеСредствоОбъект = Выборка.ПолучитьОбъект();
		Если ТранспортноеСредствоОбъект.Грузоподъемность >= 3500 Тогда
			НовыйВидТранспорта = Перечисления.упВидыТранспорта.ГрузовойАвтомобиль;
		Иначе
			НовыйВидТранспорта = Перечисления.упВидыТранспорта.ЛегковойАвтомобиль;
		КонецЕсли; 
		упСервисныеФункции.ПрисвоитьЕслиНеРавно(ТранспортноеСредствоОбъект.ВидТранспорта, НовыйВидТранспорта);
		Если ТранспортноеСредствоОбъект.Модифицированность() Тогда
			Попытка
			    ТранспортноеСредствоОбъект.Записать();
				КоличествоТС = КоличествоТС + 1;
			Исключение
				Отказ = Истина;
				ОписаниеОшибки = ОписаниеОшибки();
				Событие = Нстр("ru = 'Ошибка выполнения'");
				ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,,ТранспортноеСредствоОбъект, ОписаниеОшибки);    
				КоличествоОшибок = КоличествоОшибок + 1;
			КонецПопытки;
		КонецЕсли; 
	КонецЦикла;
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Этап);
	
	Этап = Нстр("ru = 'Обновляется реквизит ""Вид транспорта"" в справочнике типы транспорта");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);
	Выборка = Справочники.упТипыТС.Выбрать();
	КоличествоТС = 0;
	КоличествоОшибок = 0;
	Пока Выборка.Следующий() Цикл
		ТипТранспортаОбъект = Выборка.ПолучитьОбъект();
		Если ТипТранспортаОбъект.Грузоподъемность >= 3500 Тогда
			НовыйВидТранспорта = Перечисления.упВидыТранспорта.ГрузовойАвтомобиль;
		Иначе
			НовыйВидТранспорта = Перечисления.упВидыТранспорта.ЛегковойАвтомобиль;
		КонецЕсли; 
		упСервисныеФункции.ПрисвоитьЕслиНеРавно(ТипТранспортаОбъект.ВидТранспорта, НовыйВидТранспорта);
		Если ТипТранспортаОбъект.Модифицированность() Тогда
			Попытка
			    ТипТранспортаОбъект.Записать();
				КоличествоТС = КоличествоТС + 1;
			Исключение
				Отказ = Истина;
				ОписаниеОшибки = ОписаниеОшибки();
				Событие = Нстр("ru = 'Ошибка выполнения'");
				ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,,ТипТранспортаОбъект, ОписаниеОшибки);    
				КоличествоОшибок = КоличествоОшибок + 1;
			КонецПопытки;
		КонецЕсли; 
	КонецЦикла;
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Этап);
	
КонецПроцедуры	

// Вызывается при переходе на версию конфигурации 3.0.3.57
//
Процедура ОбновитьОграничениеМаршрутизаторовВидовПропусков(Параметры = Неопределено) Экспорт

	ВидПропускаОбъект = Справочники.упВидыПропусковНаПроездЧерезЗону.МоскваТТК.ПолучитьОбъект();
	ВидПропускаОбъект.ОграничениеМаршрутизатора = Перечисления.упОграниченияМаршрутизаторов.КромеСадовогоКольца;
	ВидПропускаОбъект.Записать();
	ВидПропускаОбъект = Справочники.упВидыПропусковНаПроездЧерезЗону.МоскваМКАД.ПолучитьОбъект();
	ВидПропускаОбъект.ОграничениеМаршрутизатора = Перечисления.упОграниченияМаршрутизаторов.КромеТТК;
	ВидПропускаОбъект.Записать();
	ВидПропускаОбъект = Справочники.упВидыПропусковНаПроездЧерезЗону.МоскваСадовоеКольцо.ПолучитьОбъект();
	ВидПропускаОбъект.ОграничениеМаршрутизатора = Перечисления.упОграниченияМаршрутизаторов.ПустаяСсылка();
	ВидПропускаОбъект.Записать();
	
КонецПроцедуры	

// Вызывается при переходе на версию конфигурации 3.0.3.65
//
Процедура ОбновитьПериодДвиженияМаршрутРаботыПоРейсам(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упСтатусыРейсовСрезПоследних.Документ
	|ПОМЕСТИТЬ втРейсы
	|ИЗ
	|	РегистрСведений.упСтатусыРейсов.СрезПоследних КАК упСтатусыРейсовСрезПоследних
	|ГДЕ
	|	упСтатусыРейсовСрезПоследних.Статус = ЗНАЧЕНИЕ(Перечисление.упСтатусыРейса.Выполняется)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	упПрохождениеТочки.Ссылка,
	|	упПрохождениеТочки.ОкончаниеВыполнения
	|ИЗ
	|	Документ.упПрохождениеТочки КАК упПрохождениеТочки
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втРейсы КАК втРейсы
	|		ПО упПрохождениеТочки.Рейс = втРейсы.Документ
	|			И (упПрохождениеТочки.Проведен)
	|			И (НЕ упПрохождениеТочки.ОкончаниеВыполнения = ДАТАВРЕМЯ(1, 1, 1))";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			
			// перезапись движений по РС "упМаршрутПоРейсу"
			НаборЗаписей = РегистрыСведений.упМаршрутПоРейсу.СоздатьНаборЗаписей();  			
			НаборЗаписей.Отбор.Регистратор.Установить(Выборка.Ссылка);
			НаборЗаписей.Прочитать();
			Если НаборЗаписей.Количество() Тогда
				Для каждого Запись Из НаборЗаписей Цикл
					Запись.Период = Выборка.ОкончаниеВыполнения;
				КонецЦикла; 
				НаборЗаписей.Записать();
			КонецЕсли;	
			
			// перезапись движений по РС "упРаботоыПоРейсу"
			НаборЗаписей = РегистрыСведений.упРаботыПоРейсу.СоздатьНаборЗаписей();  			
			НаборЗаписей.Отбор.Регистратор.Установить(Выборка.Ссылка);
			НаборЗаписей.Прочитать();
			Если НаборЗаписей.Количество() Тогда
				Для каждого Запись Из НаборЗаписей Цикл
					Запись.Период = Выборка.ОкончаниеВыполнения;
				КонецЦикла; 
				НаборЗаписей.Записать();
			КонецЕсли;
			
		КонецЦикла; 
	КонецЕсли; 
	
КонецПроцедуры	

// Вызывается при переходе на версию конфигурации 3.0.3.71
//
Процедура ЗаполнитьВариантФормированияМаршрутаВидаПеревозки(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется реквизит ""ВариантФормированияМаршрута"" в справочнике ""Виды перевозок""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упВидыПеревозок.Ссылка
	               |ИЗ
	               |	Справочник.упВидыПеревозок КАК упВидыПеревозок";
				   
	КоличествоЗаписей = 0;
	
	Выборка	= Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		
		ВидПеревозкиОбъект  = Выборка.Ссылка.ПолучитьОбъект();
		ВидПеревозкиОбъект.ВариантФормированияМаршрута = Перечисления.упВариантыФормированияМаршрута.Полный;
		Попытка
			ВидПеревозкиОбъект.Записать(); 	
			КоличествоЗаписей = КоличествоЗаписей + 1;
		Исключение
			ТекстОшибки = НСтр("ru = 'Во время выполнения действия над ""%1"" произошла неизвестная ошибка.'");
			ТекстОшибки = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстОшибки, Выборка.Ссылка);
		    ЗаписьЖурналаРегистрации(НСтр("ru = 'ВыполнениеПроцедурыОбновления.Ошибка'"),УровеньЖурналаРегистрации.Ошибка, ,Выборка.Ссылка,
  			ТекстОшибки + Символы.ПС + ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		КонецПопытки;
	КонецЦикла;
	
	Комментарий = Нстр("ru = 'Заполнение реквизита ""ВариантФормированияМаршрута"" в справочнике ""Виды перевозок"" успешно завершено. Изменено %1 элементов'");	
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей);
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
КонецПроцедуры //ЗаполнитьТабличнуюЧастьРейсыДокументаПутевойЛист()

// Вызывается при переходе на версию конфигурации 3.0.3.72
//
Процедура ПерезаполнитьТипыСобытийПоЗаявкеНаПеревозкуГруза(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упТипыСобытий.Ссылка
	|ИЗ
	|	Справочник.упТипыСобытий КАК упТипыСобытий
	|ГДЕ
	|	упТипыСобытий.ТипИсходногоДействия В (ЗНАЧЕНИЕ(Перечисление.упТипыДействийСобытий.ЗаписьЗаявкиНаПеревозкуГруза), ЗНАЧЕНИЕ(Перечисление.упТипыДействийСобытий.ИзменениеСтатусаЗаявкиНаПеревозку))";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			ТипСобытияОбъект = Выборка.Ссылка.ПолучитьОбъект();
			СхемаКомпоновкиДанных = ТипСобытияОбъект.СхемаКомпоновкиДанных.Получить();
			
			СхемаКомпоновкиДанныхНовая = Справочники.упТипыСобытий.ПолучитьМакет("ЗаявкаНаПеревозкуГруза");
			Если СхемаКомпоновкиДанных <> Неопределено Тогда 
				упСервисныеФункцииВызовСервера.СкопироватьЭлементы(СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.Отбор, СхемаКомпоновкиДанных.НастройкиПоУмолчанию.Отбор);
			КонецЕсли;
			
			ТипСобытияОбъект.СхемаКомпоновкиДанных = Новый ХранилищеЗначения(СхемаКомпоновкиДанныхНовая);
			ТипСобытияОбъект.Записать(); 
		КонецЦикла;
	КонецЕсли; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.3.75
//
Процедура ЗаполнитьРеквизитыГрузовВЗаявкеНаПеревозку(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняются реквизиты табличной части грузовые места по заявке на перевозку'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	упЗаявкаНаПеревозкуГруза.Ссылка,
	|	упЗаявкаНаПеревозкуГруза.ГрафикРаботыАдресаОтправления,
	|	упЗаявкаНаПеревозкуГруза.ГрафикРаботыАдресаПолучения,
	|	упЗаявкаНаПеревозкуГруза.ОтправлениеГрузаС,
	|	упЗаявкаНаПеревозкуГруза.ОтправлениеГрузаПо,
	|	упЗаявкаНаПеревозкуГруза.ПолучениеГрузаС,
	|	упЗаявкаНаПеревозкуГруза.ПолучениеГрузаПо,
	|	упЗаявкаНаПеревозкуГруза.Отправитель,
	|	упЗаявкаНаПеревозкуГруза.КонтрагентОтправителя,
	|	упЗаявкаНаПеревозкуГруза.КонтактноеЛицоОтправителя,
	|	упЗаявкаНаПеревозкуГруза.Получатель,
	|	упЗаявкаНаПеревозкуГруза.КонтрагентПолучателя,
	|	упЗаявкаНаПеревозкуГруза.КонтактноеЛицоПолучателя
	|ИЗ
	|	Документ.упЗаявкаНаПеревозкуГруза КАК упЗаявкаНаПеревозкуГруза
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упСтатусыЗаявокНаПеревозкуГруза.СрезПоследних КАК упСтатусыЗаявокНаПеревозкуГрузаСрезПоследних
	|		ПО (упСтатусыЗаявокНаПеревозкуГрузаСрезПоследних.Документ = упЗаявкаНаПеревозкуГруза.Ссылка)
	|ГДЕ
	|	НЕ ЕСТЬNULL(упСтатусыЗаявокНаПеревозкуГрузаСрезПоследних.Статус, ЗНАЧЕНИЕ(Перечисление.упСтатусыЗаявкиНаПеревозкуГруза.Новая)) В (ЗНАЧЕНИЕ(Перечисление.упСтатусыЗаявкиНаПеревозкуГруза.Отменена), ЗНАЧЕНИЕ(Перечисление.упСтатусыЗаявкиНаПеревозкуГруза.Выполнена))";
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоЗаписей = 0;
	
	Пока Выборка.Следующий() Цикл
		
		НачатьТранзакцию();
		
		ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
		
		ГрузовыеМеста = ДокументОбъект.ГрузовыеМеста;
		мсвИзменяемыеПоля = Новый Массив;
		мсвИзменяемыеПоля.Добавить("ГрафикРаботыАдресаОтправления");
		мсвИзменяемыеПоля.Добавить("ГрафикРаботыАдресаПолучения");
		мсвИзменяемыеПоля.Добавить("ОтправлениеГрузаС");
		мсвИзменяемыеПоля.Добавить("ОтправлениеГрузаПо");
		мсвИзменяемыеПоля.Добавить("ПолучениеГрузаС");
		мсвИзменяемыеПоля.Добавить("ПолучениеГрузаПо");
		мсвИзменяемыеПоля.Добавить("Отправитель");
		мсвИзменяемыеПоля.Добавить("КонтрагентОтправителя");
		мсвИзменяемыеПоля.Добавить("КонтактноеЛицоОтправителя");
		мсвИзменяемыеПоля.Добавить("Получатель");
		мсвИзменяемыеПоля.Добавить("КонтрагентПолучателя");
		мсвИзменяемыеПоля.Добавить("КонтактноеЛицоПолучателя");
		
		ТЧМодифицирована = Ложь;
		
		Для каждого СтрокаГрузовоеМесто Из ГрузовыеМеста Цикл
			Для каждого ИмяПоля Из мсвИзменяемыеПоля Цикл
				Если ЗначениеЗаполнено(Выборка[ИмяПоля]) 
					И НЕ ЗначениеЗаполнено(СтрокаГрузовоеМесто[ИмяПоля]) Тогда
					СтрокаГрузовоеМесто[ИмяПоля] = Выборка[ИмяПоля];
					ТЧМодифицирована = Истина;
				КонецЕсли;
			КонецЦикла;
		КонецЦикла;
		
		Если НЕ ТЧМодифицирована Тогда
			Если ТранзакцияАктивна() Тогда
				ОтменитьТранзакцию();
			КонецЕсли;
			Продолжить;
		КонецЕсли;
		
		Попытка
			ДокументОбъект.Записать(РежимЗаписиДокумента.Запись); 	
			КоличествоЗаписей = КоличествоЗаписей + 1;
			ЗафиксироватьТранзакцию();
		Исключение
			Если ТранзакцияАктивна() Тогда
				ОтменитьТранзакцию();
			КонецЕсли; 
			ТекстОшибки = НСтр("ru = 'Во время выполнения действия над ""%1"" произошла неизвестная ошибка.'");
			ТекстОшибки = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстОшибки, Выборка.Ссылка);
		    ЗаписьЖурналаРегистрации(НСтр("ru = 'ВыполнениеПроцедурыОбновления.Ошибка'"),УровеньЖурналаРегистрации.Ошибка, ,Выборка.Ссылка,
  			ТекстОшибки + Символы.ПС + ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		КонецПопытки;
	КонецЦикла;
	
	Комментарий = Нстр("ru = 'Перезаполнение реквизитов грузовых мест в заявках на перевозку груза успешно завершено. Изменено %1 документов'");	
	Комментарий = СтрШаблон(Комментарий, КоличествоЗаписей);
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
КонецПроцедуры //ЗаполнитьТабличнуюЧастьРейсыДокументаПутевойЛист()

// Вызывается при переходе на версию конфигурации 3.0.3.78
//
Процедура ПерезаполнитьТипыСобытийПоРейсу(Параметры) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упТипыСобытий.Ссылка
	|ИЗ
	|	Справочник.упТипыСобытий КАК упТипыСобытий
	|ГДЕ
	|	упТипыСобытий.ТипИсходногоДействия В (ЗНАЧЕНИЕ(Перечисление.упТипыДействийСобытий.ЗаписьРейса), ЗНАЧЕНИЕ(Перечисление.упТипыДействийСобытий.ИзменениеСтатусаРейса))";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			ТипСобытияОбъект = Выборка.Ссылка.ПолучитьОбъект();
			СхемаКомпоновкиДанных = ТипСобытияОбъект.СхемаКомпоновкиДанных.Получить();
			
			СхемаКомпоновкиДанныхНовая = Справочники.упТипыСобытий.ПолучитьМакет("Рейс");
			Если СхемаКомпоновкиДанных <> Неопределено Тогда 
				упСервисныеФункцииВызовСервера.СкопироватьЭлементы(СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.Отбор, СхемаКомпоновкиДанных.НастройкиПоУмолчанию.Отбор);
			КонецЕсли;
			
			ТипСобытияОбъект.СхемаКомпоновкиДанных = Новый ХранилищеЗначения(СхемаКомпоновкиДанныхНовая);
			ТипСобытияОбъект.Записать(); 
		КонецЦикла;
	КонецЕсли; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.3.78
//
Процедура ПерезаполнитьТипыСобытийПоМаршруту(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упТипыСобытий.Ссылка
	|ИЗ
	|	Справочник.упТипыСобытий КАК упТипыСобытий
	|ГДЕ
	|	упТипыСобытий.ТипИсходногоДействия = ЗНАЧЕНИЕ(Перечисление.упТипыДействийСобытий.ИзменениеМаршрутаПоРейсу)";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			ТипСобытияОбъект = Выборка.Ссылка.ПолучитьОбъект();
			СхемаКомпоновкиДанных = ТипСобытияОбъект.СхемаКомпоновкиДанных.Получить();
			
			СхемаКомпоновкиДанныхНовая = Справочники.упТипыСобытий.ПолучитьМакет("ИзменениеМаршрутаПоРейсу");
			Если СхемаКомпоновкиДанных <> Неопределено Тогда 
				упСервисныеФункцииВызовСервера.СкопироватьЭлементы(СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.Отбор, СхемаКомпоновкиДанных.НастройкиПоУмолчанию.Отбор);
			КонецЕсли;
			
			ТипСобытияОбъект.СхемаКомпоновкиДанных = Новый ХранилищеЗначения(СхемаКомпоновкиДанныхНовая);
			ТипСобытияОбъект.Записать(); 
		КонецЦикла;
	КонецЕсли; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.3.87
//
Процедура ПерезаписатьВсеПартнерыИГеографическиеЗоны(Параметры = Неопределено) Экспорт

	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	Отказ			= Ложь;
	
	Этап = Нстр("ru = 'Обновляется реквизит ""ДоступныеЗоны"" в справочнике транспорта");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);
	Выборка = Справочники.упТранспортныеСредства.Выбрать();
	КоличествоТС = 0;
	КоличествоОшибок = 0;
	Пока Выборка.Следующий() Цикл
		ТранспортноеСредствоОбъект = Выборка.ПолучитьОбъект();
		Если Не ЗначениеЗаполнено(ТранспортноеСредствоОбъект.ДоступныеЗоны) Тогда
			Попытка
			    ТранспортноеСредствоОбъект.Записать();
				КоличествоТС = КоличествоТС + 1;
			Исключение
				Отказ = Истина;
				ОписаниеОшибки = ОписаниеОшибки();
				Событие = Нстр("ru = 'Ошибка выполнения'");
				ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,,ТранспортноеСредствоОбъект, ОписаниеОшибки);    
				КоличествоОшибок = КоличествоОшибок + 1;
			КонецПопытки;
		КонецЕсли; 
	КонецЦикла;
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Этап);
	
	Этап = Нстр("ru = 'Обновляется реквизит ""ДоступныеЗоны"" в справочнике ""Типы транспорта""");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);
	Выборка = Справочники.упТипыТС.Выбрать();
	КоличествоТС = 0;
	КоличествоОшибок = 0;
	Пока Выборка.Следующий() Цикл
		ТипТранспортаОбъект = Выборка.ПолучитьОбъект();
		Если Не ЗначениеЗаполнено(ТипТранспортаОбъект.ДоступныеЗоны) Тогда
			Попытка
			    ТипТранспортаОбъект.Записать();
				КоличествоТС = КоличествоТС + 1;
			Исключение
				Отказ = Истина;
				ОписаниеОшибки = ОписаниеОшибки();
				Событие = Нстр("ru = 'Ошибка выполнения'");
				ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, ТипТранспортаОбъект, ОписаниеОшибки);    
				КоличествоОшибок = КоличествоОшибок + 1;
			КонецПопытки;
		КонецЕсли; 
	КонецЦикла;
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Этап);
	
	Этап = Нстр("ru = 'Обновляется реквизит ""ДоступныеРесурсы"" в справочнике ""Партнеры""");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);
	Выборка = Справочники.упПартнеры.Выбрать();
	КоличествоТС = 0;
	КоличествоОшибок = 0;
	Пока Выборка.Следующий() Цикл
		ПартнерОбъект = Выборка.ПолучитьОбъект();
		Если Не ЗначениеЗаполнено(ПартнерОбъект.ДоступныеРесурсы) Тогда
			Попытка
			    ПартнерОбъект.Записать();
				КоличествоТС = КоличествоТС + 1;
			Исключение
				Отказ = Истина;
				ОписаниеОшибки = ОписаниеОшибки();
				Событие = Нстр("ru = 'Ошибка выполнения'");
				ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, ПартнерОбъект, ОписаниеОшибки);    
				КоличествоОшибок = КоличествоОшибок + 1;
			КонецПопытки;
		КонецЕсли; 
	КонецЦикла;
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Этап);

КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.3.103
//
Процедура ЗаполнитьСпособУчетаВозвращенныхДокументов(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется реквизит ""Способ учета возвращенных документов"" справочника ""Виды перевозок""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упВидыПеревозок.Ссылка
	               |ИЗ
	               |	Справочник.упВидыПеревозок КАК упВидыПеревозок";
				   
	КоличествоЗаписей = 0;
	
	Выборка	= Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		
		ВидПеревозкиОбъект = Выборка.Ссылка.ПолучитьОбъект();
		ВидПеревозкиОбъект.СпособУчетаВозвращенныхДокументов = Перечисления.упСпособыУчетаВозвращенныхДокументов.СТочностьюДоТиповДокументов;
	    ВидПеревозкиОбъект.Записать(); 
		КоличествоЗаписей = КоличествоЗаписей + 1;
		
	КонецЦикла;
	
	Комментарий = Нстр("ru = 'Заполнение реквизита ""Способ учета возвращенных документов"" в справочнике ""Виды перевозок"" успешно завершено. Изменено %1 элементов'");	
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей);
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
КонецПроцедуры //ЗаполнитьСпособУчетаВозвращенныхДокументов()

// Вызывается при переходе на версию конфигурации 3.0.3.119
//
Процедура ЗаполнитьТипКонтактнойИнформации(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	Этап	= Нстр("ru = 'Заполняется реквизит ""Тип"" табличной части ""Контактная информация"" во всех справочниках'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);
	КоличествоОшибок = 0;
	ЗаполнитьРеквизитТипТабличнойЧастиКонтактнаяИнформацияВТаблице(Метаданные.Справочники.упКонтактныеЛицаПартнеров.ПолноеИмя(), КоличествоОшибок);
	ЗаполнитьРеквизитТипТабличнойЧастиКонтактнаяИнформацияВТаблице(Метаданные.Справочники.упКонтрагенты.ПолноеИмя(), КоличествоОшибок);
	ЗаполнитьРеквизитТипТабличнойЧастиКонтактнаяИнформацияВТаблице(Метаданные.Справочники.упПартнеры.ПолноеИмя(), КоличествоОшибок);
	ЗаполнитьРеквизитТипТабличнойЧастиКонтактнаяИнформацияВТаблице(Метаданные.Справочники.Организации.ПолноеИмя(), КоличествоОшибок);
	ЗаполнитьРеквизитТипТабличнойЧастиКонтактнаяИнформацияВТаблице(Метаданные.Справочники.Пользователи.ПолноеИмя(), КоличествоОшибок);
	Комментарий = Нстр("ru = '" + Этап + " завершено. При обработке возникло %1 ошибок.'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоОшибок);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
КонецПроцедуры

Процедура ЗаполнитьРеквизитТипТабличнойЧастиКонтактнаяИнформацияВТаблице(Знач ПолноеИмяМД, выхКоличествоОшибок = 0)
	
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ Ссылка ИЗ " + ПолноеИмяМД + ".КонтактнаяИнформация
	|";
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		СправочникОбъект = Выборка.Ссылка.ПолучитьОбъект();
		Если Ложь Тогда // Для контекстной подсказки
			СправочникОбъект = Справочники.упАдреса.СоздатьЭлемент();
		КонецЕсли;
		Для Каждого СтрокаКонтактнойИнформации Из СправочникОбъект.КонтактнаяИнформация Цикл
			СтрокаКонтактнойИнформации.Тип = СтрокаКонтактнойИнформации.Вид.Тип;
		КонецЦикла;
		СправочникОбъект.ОбменДанными.Загрузка = Истина;
		Попытка
			СправочникОбъект.Записать();
		Исключение
			Отказ = Истина;
			ОписаниеОшибки = ОписаниеОшибки();
			Событие = Нстр("ru = 'Ошибка выполнения'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка, СправочникОбъект.Метаданные(), СправочникОбъект.Ссылка, ОписаниеОшибки);    
			выхКоличествоОшибок = выхКоличествоОшибок + 1;
		КонецПопытки;
	КонецЦикла;

КонецПроцедуры //ЗаполнитьСпособУчетаВозвращенныхДокументов()

// Вызывается при переходе на версию конфигурации
//
Процедура ПерезаписатьПравилаДоступностиРесурсов(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Перезапись всех правил доступности ресурсов");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	Т.Ссылка
	               |ИЗ
	               |	Справочник.упПравилаДоступностиРесурсов КАК Т";
	КоличествоЗаписей = 0;
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		ВидПеревозкиОбъект = Выборка.Ссылка.ПолучитьОбъект();
	    ВидПеревозкиОбъект.Записать(); 
		КоличествоЗаписей = КоличествоЗаписей + 1;
	КонецЦикла;
	Комментарий = Нстр("ru = '" + Этап + " завершено. Изменено %1 элементов'");	
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
КонецПроцедуры //ЗаполнитьСпособУчетаВозвращенныхДокументов()

// Вызывается при переходе на версию конфигурации 3.0.4.8
//
Процедура ДобавитьСоглашенияВАналитическиеРазрезыПоПартнерамНаСервере(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется реквизит ""Соглашение"" справочника ""Аналитические разрезы по партнерам""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упАналитическиеРазрезыПоПартнерам.Ссылка КАК АналитическийРазрезПоПартнерам,
	               |	МАКСИМУМ(ЕСТЬNULL(упРасчетыСЗаказчиками.ОбъектРасчетов.Соглашение, ЗНАЧЕНИЕ(Справочник.упСоглашенияСКлиентами.ПустаяСсылка))) КАК ОбъектРасчетовСоглашение
	               |ИЗ
	               |	Справочник.упАналитическиеРазрезыПоПартнерам КАК упАналитическиеРазрезыПоПартнерам
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.упРасчетыСЗаказчиками КАК упРасчетыСЗаказчиками
	               |		ПО (упРасчетыСЗаказчиками.АналитическийРазрезПоПартнерам = упАналитическиеРазрезыПоПартнерам.Ссылка)
	               |ГДЕ
	               |	упАналитическиеРазрезыПоПартнерам.Соглашение = ЗНАЧЕНИЕ(Справочник.упАналитическиеРазрезыПоПартнерам.ПустаяСсылка)
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	упАналитическиеРазрезыПоПартнерам.Ссылка";
				   
	КоличествоЗаписей = 0;
	КоличествоЗаписейБезСоглашения = 0;
	
	Выборка	= Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		
		Если ЗначениеЗаполнено(Выборка.ОбъектРасчетовСоглашение) Тогда
			
			АналитическийРазрезПоПартнерам = Выборка.АналитическийРазрезПоПартнерам.ПолучитьОбъект();
			Организация = АналитическийРазрезПоПартнерам.Организация;
			Партнер		= АналитическийРазрезПоПартнерам.Партнер;
			Контрагент	= АналитическийРазрезПоПартнерам.Контрагент;
			Соглашение	= Выборка.ОбъектРасчетовСоглашение;
						
			АналитическийРазрезПоПартнерам.Наименование = Справочники.упАналитическиеРазрезыПоПартнерам.СформироватьНаименование(Организация, Партнер, Контрагент, Соглашение);
			
			Попытка
				АналитическийРазрезПоПартнерам.Записать();	
				КоличествоЗаписей = КоличествоЗаписей + 1;
			Исключение
				ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ТекстОшибки) Тогда 
					ТекстОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,,,ТекстОшибки, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			КонецПопытки;
		Иначе	
			КоличествоЗаписейБезСоглашения = КоличествоЗаписейБезСоглашения + 1;
		КонецЕсли;
		
	КонецЦикла;
	
	Комментарий = Нстр("ru = 'Заполнение реквизита ""Соглашение"" в справочнике ""Аналитические разрезы по партнерам"" успешно завершено. Изменено %1 элементов. Для %2 не удалось подобрать соглашение.'");	
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей, КоличествоЗаписейБезСоглашения);
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.8
//
Процедура ЗаполнитьРесурсСуммаРНРасчетыСЗаказчикамиНаСервере(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется ресурса ""Сумма"" регистра наколпления ""упРасчетыСЗаказчиками""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Если ПолучитьФункциональнуюОпцию("упВедетсяВалютныйУчет") Тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
		               |	упРасчетыСЗаказчиками.Регистратор КАК Регистратор
		               |ИЗ
		               |	РегистрНакопления.упРасчетыСЗаказчиками КАК упРасчетыСЗаказчиками";
		ВалютаУпр	= упСервисныеФункцииВызовСервера.ВалютаУправленческогоУчета();
				
		КоличествоЗаписей = 0;
				
		Выборка	= Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Пока Выборка.Следующий() Цикл
			
			НаборЗаписей = РегистрыНакопления.упРасчетыСЗаказчиками.СоздатьНаборЗаписей();
			НаборЗаписей.Отбор.Регистратор.Установить(Выборка.Регистратор); 
			НаборЗаписей.Прочитать();
			
			Для каждого Запись Из НаборЗаписей Цикл
				Если Запись.Сумма = 0 И Запись.СуммаВалюта > 0 Тогда
					Если НЕ Запись.Валюта = ВалютаУпр Тогда
						Запись.Сумма = упСервисныеФункцииВызовСервера.РассчитатьСуммуУпр(Запись.Валюта, Запись.СуммаВалюта, Запись.Период);
					Иначе	
					    Запись.Сумма = Запись.СуммаВалюта;
					КонецЕсли;	
				КонецЕсли;
				
				Если НЕ Запись.Валюта = ВалютаУпр Тогда
					Запись.КОплатеДоНачалаВыполненияРейса	= упСервисныеФункцииВызовСервера.РассчитатьСуммуУпр(Запись.Валюта, Запись.КОплатеДоНачалаВыполненияРейса, Запись.Период);
					Запись.КОплатеДоНачалаРаботыСЗаявкой	= упСервисныеФункцииВызовСервера.РассчитатьСуммуУпр(Запись.Валюта, Запись.КОплатеДоНачалаРаботыСЗаявкой, Запись.Период);
				КонецЕсли;
				
				КоличествоЗаписей	 = КоличествоЗаписей + 1;
			КонецЦикла;
			
			Попытка
				НаборЗаписей.Записать(); 
			Исключение
				ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
					ОписаниеОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,, Выборка.Регистратор, ОписаниеОшибки);
			КонецПопытки;
	
		КонецЦикла;
	КонецЕсли;
	Комментарий = Нстр("ru = 'Заполнение ресурса ""Сумма"" регистра наколпления ""упРасчетыСЗаказчиками"" успешно завершено. Изменено %1 записей.'");	
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей);
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.15
//
Процедура ЗаполнитьЗаявкиНаПеревозкуГрузаВФактическихДоходах(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упФактическиеДоходы.Ссылка
	|ИЗ
	|	Документ.упФактическиеДоходы КАК упФактическиеДоходы
	|ГДЕ
	|	упФактическиеДоходы.СпособВводаФактическихДоходов = ЗНАЧЕНИЕ(Перечисление.упСпособыВводаФактическихДоходов.ДоходыПоОднойЗаявке)
	|	И НЕ упФактическиеДоходы.ПометкаУдаления";
	РезультатЗапроса = Запрос.Выполнить();
	Если Не РезультатЗапроса.Пустой() Тогда
		Выборка = РезультатЗапроса.Выбрать();
		Пока Выборка.Следующий() Цикл
			НачатьТранзакцию();
			Попытка
				БлокировкаДанных = Новый БлокировкаДанных;
				ЭлементБлокировки = БлокировкаДанных.Добавить("Документ.упФактическиеДоходы");
				ЭлементБлокировки.УстановитьЗначение("Ссылка", Выборка.Ссылка);
				ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
				БлокировкаДанных.Заблокировать();
				
				ФактическиеДоходыОбъект = Выборка.Ссылка.ПолучитьОбъект();
				ФактическиеДоходыОбъект.ЗаявкиНаПеревозкуГруза.Очистить();
				НоваяСтрока = ФактическиеДоходыОбъект.ЗаявкиНаПеревозкуГруза.Добавить();
				НоваяСтрока.ЗаявкаНаПеревозкуГруза = ФактическиеДоходыОбъект.ЗаявкаНаПеревозкуГруза;
				
			Исключение
				Если ТранзакцияАктивна() Тогда
					ОтменитьТранзакцию();
				КонецЕсли; 
				
				ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
					ОписаниеОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,,ФактическиеДоходыОбъект,ОписаниеОшибки);
			КонецПопытки;
			
			Если ТранзакцияАктивна() Тогда
				ЗафиксироватьТранзакцию();
			КонецЕсли;
		КонецЦикла; 
	КонецЕсли; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.17
//
Процедура ЗаполнитьПоказательРасчетаРейс(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= НСтр("ru = 'Заполнение предопределенного показателя расчета ""Рейс""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Отказ = Ложь;
	Справочники.упПоказателиРасчета.ЗаполнитьПредопределенныйПоказательРейс(Отказ);
	
	Если Отказ Тогда
		Комментарий = Нстр("ru = 'При заполнении предопределенного показателя расчета ""Рейс"" произошла ошибка.'");		
	Иначе	
		Комментарий = Нстр("ru = 'Заполнение предопределенного показателя расчета ""Рейс"" успешно завершено.'");		
	КонецЕсли;
		
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.26
//
Процедура ОбновитьСоставПараметровВариантовНастроекРежимовСпутникогоМониторинга(Параметры = Неопределено) Экспорт

	мсвОбъектов = Новый Массив;
	мсвОбъектов.Добавить("Обработка.упРМСпутниковыйМониторинг.НастройкиМониторингРейсов");
	мсвОбъектов.Добавить("Обработка.упРМСпутниковыйМониторинг.НастройкиМониторингТранспорта");
	
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	упВариантыНастроек.Ссылка
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект В (&Объекты)
	|";
	Запрос.УстановитьПараметр("Объекты", мсвОбъектов);
	ВариантыНастроек = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку(0); 
	Этап = "Обновление состава параметров вариантов настроек спутникого мониторинга";
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Начало", УровеньЖурналаРегистрации.Предупреждение,,, Этап);	
	текНеУдалосьОбработатьОбъектов = 0;
	ПараметрыПоУмолчанию = упВариантыНастроек.ПараметрыСпутниковогоМониторингаРежимРейсыПоУмолчанию();
	Для Каждого Ссылка Из ВариантыНастроек Цикл
		Если Ложь Тогда // Для контекстной подсказки
		    Ссылка = Справочники.упВариантыНастроек.ПустаяСсылка();
		КонецЕсли;
		СправочникОбъект = Ссылка.ПолучитьОбъект();
		ХранимыеНастройки = СправочникОбъект.Настройки.Получить();
		Если Ложь Тогда // Для контекстной подсказки
		    ХранимыеНастройки = Новый Структура;
		КонецЕсли;
		Попытка
			НадоЗаписать = упСервисныеФункцииКлиентСервер.ДобавитьНедостающиеЭлементыСтруктуру(ПараметрыПоУмолчанию, ХранимыеНастройки.Результат);
			Если НадоЗаписать Тогда
				СправочникОбъект.Настройки = Новый ХранилищеЗначения(ХранимыеНастройки);
				СправочникОбъект.Записать();
			КонецЕсли; 
		Исключение
			ОписаниеОшибки = ОписаниеОшибки();
			текПредставление = "" + Ссылка;
			ТекстСообщения = Нстр("ru = 'Ошибка обработка объекта ""%1"": %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			текНеУдалосьОбработатьОбъектов = текНеУдалосьОбработатьОбъектов + 1;
			ЗаписьЖурналаРегистрации("ОшибкаОбработки", УровеньЖурналаРегистрации.Ошибка,, Ссылка, ТекстСообщения, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			Продолжить;
		КонецПопытки; 
	КонецЦикла; 
	Если текНеУдалосьОбработатьОбъектов > 0 Тогда
		ТекстСообщения = Нстр("ru = 'Не удалось обработать объектов: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текНеУдалосьОбработатьОбъектов);
	Иначе
		ТекстСообщения = Нстр("ru = 'Все объекты были обработаны: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, ВариантыНастроек.Количество());
	КонецЕсли;
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Конец", УровеньЖурналаРегистрации.Предупреждение,,, Этап + Символы.ПС + ТекстСообщения);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.29
//
Процедура ВключитьИспользованиеДопРеквизитовУВидаПеревозки(Параметры = Неопределено) Экспорт
		УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Справочник_упВидыПеревозок", Новый Структура("Используется", Истина));
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.37
//
Процедура УстановитьРазборПоКопиямВШаблонахПечатныхФорм(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упШаблоныПакетовПечатныхФорм.Ссылка
	|ИЗ
	|	Справочник.упШаблоныПакетовПечатныхФорм КАК упШаблоныПакетовПечатныхФорм
	|ГДЕ
	|	НЕ упШаблоныПакетовПечатныхФорм.ПометкаУдаления";
	РезультатЗапроса = Запрос.Выполнить();
	Если Не РезультатЗапроса.Пустой() Тогда
		Выборка = РезультатЗапроса.Выбрать();
		Пока Выборка.Следующий() Цикл
			ШаблонОбъект = Выборка.Ссылка.ПолучитьОбъект();
			ШаблонОбъект.РазбиратьПоКопиям = Истина;
			Попытка
				ШаблонОбъект.Записать();
			Исключение
				ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
					ОписаниеОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Ошибка записи", УровеньЖурналаРегистрации.Ошибка,, ШаблонОбъект, ОписаниеОшибки);
			КонецПопытки;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.47
//
Процедура СформироватьТарифныеСеткиИзПравилРасчета(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	
	Этап	= Нстр("ru = 'Формирование элементов ""Тарифных сеток"" на основании правила расчета со способом расчета ""Произвольный""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	КоличествоЭлементов = 0;
	КоличествоЭлементовОшибкаПриЗаписи = 0;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"
	|//{Запрос: 0 ////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПравилаРасчета.Ссылка КАК Ссылка,
	|	ПравилаРасчета.ПоказательТарифнойСеткиПоСтолбцам КАК ПоказательТарифнойСеткиПоСтолбцам,
	|	ПравилаРасчета.ПоказательТарифнойСеткиПоСтрокам КАК ПоказательТарифнойСеткиПоСтрокам,
	|	ПравилаРасчета.ДанныеПроизвольногоРасчета КАК ДанныеПроизвольногоРасчета,
	|	ПравилаРасчета.Наименование КАК Наименование
	|ПОМЕСТИТЬ втПравилаРасчета
	|ИЗ
	|	Справочник.упПравилаРасчета КАК ПравилаРасчета
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.упТарифныеСетки КАК ТарифныеСетки
	|	ПО ПравилаРасчета.Наименование = ТарифныеСетки.Наименование
	|ГДЕ
	|	ПравилаРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.упСпособыРасчета.Произвольный)
	|	И НЕ (ПравилаРасчета.ПометкаУдаления)
	|	И ТарифныеСетки.Ссылка ЕСТЬ NULL
	|	И НЕ (ПравилаРасчета.ПоказательТарифнойСеткиПоСтолбцам В (ЗНАЧЕНИЕ(Справочник.упПоказателиРасчета.ПустаяСсылка)))
	|	И НЕ (ПравилаРасчета.ПоказательТарифнойСеткиПоСтрокам В (ЗНАЧЕНИЕ(Справочник.упПоказателиРасчета.ПустаяСсылка)))
	|	И ПравилаРасчета.ВнешняяОбработка = ЗНАЧЕНИЕ(Справочник.Файлы.ПустаяСсылка)
	|;
	|//{Запрос: 1 ////////////////////////////////////////
	|//////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ИдентификаторыСсылок.Значение КАК Значение,
	|	ИдентификаторыСсылок.Идентификатор КАК Идентификатор,
	|	ИдентификаторыСсылок.НомерСтроки КАК НомерСтроки,
	|	ИдентификаторыСсылок.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.упПравилаРасчета.ИдентификаторыСсылок КАК ИдентификаторыСсылок
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ втПравилаРасчета КАК ПравилаРасчета
	|	ПО ПравилаРасчета.Ссылка = ИдентификаторыСсылок.Ссылка
	|УПОРЯДОЧИТЬ ПО
	|	ИдентификаторыСсылок.НомерСтроки
	|ИТОГИ
	|ПО
	|	Ссылка
	|;
	|//{Запрос: 2 ////////////////////////////////////////
	|ВЫБРАТЬ
	|	втПравилаРасчетаТ.ДанныеПроизвольногоРасчета КАК ДанныеПроизвольногоРасчета,
	|	втПравилаРасчетаТ.ПоказательТарифнойСеткиПоСтолбцам КАК ПоказательТарифнойСеткиПоСтолбцам,
	|	втПравилаРасчетаТ.ПоказательТарифнойСеткиПоСтрокам КАК ПоказательТарифнойСеткиПоСтрокам,
	|	втПравилаРасчетаТ.Ссылка КАК Ссылка,
	|	втПравилаРасчетаТ.Наименование КАК Наименование
	|ИЗ
	|	втПравилаРасчета КАК втПравилаРасчетаТ
	|";
		
	РезультатЗапроса 		 = Запрос.ВыполнитьПакет();
	дрвИдентификаторыСсылока = РезультатЗапроса[1].Выгрузить(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	ВыборкаПравилаРасчета = РезультатЗапроса[2].Выбрать();
	
	Пока ВыборкаПравилаРасчета.Следующий() Цикл
		
		ПравилоРасчетаСсылка = ВыборкаПравилаРасчета.Ссылка;
		
		НачатьТранзакцию(РежимУправленияБлокировкойДанных.Управляемый);		
		
		Попытка
			ТарифнаяСеткаОбъект = Справочники.упТарифныеСетки.СоздатьЭлемент();
			ТарифнаяСеткаОбъект.Наименование						= ВыборкаПравилаРасчета.Наименование;
			ТарифнаяСеткаОбъект.Код = упТарификацияКлиентСервер.ИдентификаторПоказателяПоНаименованию(ВыборкаПравилаРасчета.Наименование);
			ТарифнаяСеткаОбъект.ПоказательТарифнойСеткиПоСтолбцам 	= ВыборкаПравилаРасчета.ПоказательТарифнойСеткиПоСтолбцам;
			ТарифнаяСеткаОбъект.ПоказательТарифнойСеткиПоСтрокам 	= ВыборкаПравилаРасчета.ПоказательТарифнойСеткиПоСтрокам;
			ТарифнаяСеткаОбъект.ДанныеТарифнойСетки					= ВыборкаПравилаРасчета.ДанныеПроизвольногоРасчета;
			
			мсвСтрокиИдентификаторыСсылокПравило = дрвИдентификаторыСсылока.Строки.НайтиСтроки(Новый Структура("Ссылка",ПравилоРасчетаСсылка));
			Если мсвСтрокиИдентификаторыСсылокПравило.Количество() > 0 Тогда
				СтрокаПравилоИдентификаторыСсылок = мсвСтрокиИдентификаторыСсылокПравило[0];
				Для каждого СтрокаИдентификатор Из СтрокаПравилоИдентификаторыСсылок.Строки Цикл
					НоваяСтрока = ТарифнаяСеткаОбъект.ИдентификаторыСсылок.Добавить();
					НоваяСтрока.Идентификатор  	= СтрокаИдентификатор.Идентификатор;
					НоваяСтрока.Значение		= СтрокаИдентификатор.Значение;
				КонецЦикла;
			КонецЕсли;
						
			ТарифнаяСеткаОбъект.Записать();
			КоличествоЭлементов = КоличествоЭлементов + 1;
			ЗафиксироватьТранзакцию();
			
		Исключение
			ОтменитьТранзакцию();
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать элемент'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоЭлементовОшибкаПриЗаписи = КоличествоЭлементовОшибкаПриЗаписи + 1;    
		КонецПопытки;
	КонецЦикла;

	Комментарий = Нстр("ru = 'Количество элементов: успешно создано-%1, не удалось записать-%2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЭлементов, КоличествоЭлементовОшибкаПриЗаписи);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //СформироватьТарифныеСеткиИзПравилРасчета()

// Вызывается при переходе на версию конфигурации 3.0.4.61
//
Процедура ОбновитьВерсииФайлов(Параметры = Неопределено) Экспорт
	
	Выборка = Справочники.Файлы.Выбрать();
	Пока Выборка.Следующий() Цикл
		Если ЗначениеЗаполнено(Выборка.ТекущаяВерсия) Тогда
			Продолжить;
		КонецЕсли; 
		ФайлСсылка = Выборка.Ссылка;
		Попытка
			СведенияОФайле = РаботаСФайламиКлиентСервер.СведенияОФайле("ФайлСВерсией");
			СтруктураИмениФайла = ОбщегоНазначенияКлиентСервер.РазложитьПолноеИмяФайла(ФайлСсылка.Наименование);
			СведенияОФайле.ИмяБезРасширения = СтруктураИмениФайла.ИмяБезРасширения;
			СведенияОФайле.РасширениеБезТочки = ОбщегоНазначенияКлиентСервер.РасширениеБезТочки(СтруктураИмениФайла.Расширение);
			СведенияОФайле.ХранитьВерсии = ФайлСсылка.ХранитьВерсии;
			СведенияОФайле.ВремяИзмененияУниверсальное = ФайлСсылка.УдалитьДатаМодификацииУниверсальная;
			//СведенияОФайле.АдресВременногоХранилищаТекста = ПоместитьВоВременноеХранилище(ФайлСсылка.ТекстХранилище.Получить());
			СведенияОФайле.АдресВременногоХранилищаФайла = ПоместитьВоВременноеХранилище(ФайлСсылка.УдалитьФайлХранилище.Получить());
			//СведенияОФайле.ТипХраненияФайла = ФайлСсылка.УдалитьТипХраненияФайла;
			// Создадим версию сохраняемого файла для сохранения в карточке Файла.
			Версия = РаботаСФайламиСлужебныйВызовСервера.СоздатьВерсию(ФайлСсылка, СведенияОФайле);
			// Подставим ссылку на версию в карточку Файла.
			РаботаСФайламиСлужебныйВызовСервера.ОбновитьВерсиюВФайле(ФайлСсылка, Версия, СведенияОФайле.АдресВременногоХранилищаФайла);
			//УдалитьИзВременногоХранилища(СведенияОФайле.АдресВременногоХранилищаТекста);
			УдалитьИзВременногоХранилища(СведенияОФайле.АдресВременногоХранилищаФайла);
		Исключение
			ОписаниеОшибки = ОписаниеОшибки();
			ЗаписьЖурналаРегистрации("Ошибка записи", УровеньЖурналаРегистрации.Ошибка,, ФайлСсылка, ОписаниеОшибки);
		КонецПопытки;
	КонецЦикла;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.62
//
Процедура ЗаполнитьРейсыВФактическихРасходах(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется табличная часть ""Рейсы"" фактических расходов с способом ввода расходов ""Расходы по одному рейсу"" и ""Расходы по нескольким рейсам""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упФактическиеРасходы.Ссылка
	               |ИЗ
	               |	Документ.упФактическиеРасходы КАК упФактическиеРасходы
	               |ГДЕ
	               |	НЕ упФактическиеРасходы.ПометкаУдаления
	               |	И упФактическиеРасходы.СпособВводаРасходов В (ЗНАЧЕНИЕ(Перечисление.упСпособыВводаФактическихРасходов.РасходыПоОдномуРейсу), ЗНАЧЕНИЕ(Перечисление.упСпособыВводаФактическихРасходов.РасходыПоНесколькимРейсам))";
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоЗаписей = 0;
	Пока Выборка.Следующий() Цикл
		НачатьТранзакцию();
		ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
		Попытка
			ДокументОбъект.Записать(РежимЗаписиДокумента.Запись); 	
			КоличествоЗаписей = КоличествоЗаписей + 1;
		Исключение
			Если ТранзакцияАктивна() Тогда
				ОтменитьТранзакцию();
			КонецЕсли; 
			ТекстОшибки = НСтр("ru = 'Во время выполнения действия над ""%1"" произошла неизвестная ошибка.'");
			ТекстОшибки = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстОшибки, Выборка.Ссылка);
		    ЗаписьЖурналаРегистрации(НСтр("ru = 'ВыполнениеПроцедурыОбновления.Ошибка'"),УровеньЖурналаРегистрации.Ошибка, ,Выборка.Ссылка,
  			ТекстОшибки + Символы.ПС + ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		КонецПопытки;
		Если ТранзакцияАктивна() Тогда
			ЗафиксироватьТранзакцию();
		КонецЕсли;
	КонецЦикла; 
	
	Если КоличествоЗаписей > 0 Тогда
		Комментарий = Нстр("ru = 'Заполнение табличной части ""Рейсы"" фактических расходов завершено. Изменено %1 документов'");	
		Комментарий = СтрШаблон(Комментарий, КоличествоЗаписей);
	КонецЕсли;
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.66
//
Процедура ВключитьИспользованиеДопРеквизитовУДокументаПересчетГрузовыхМест(Параметры = Неопределено) Экспорт
		УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упПересчетГрузовыхМест", Новый Структура("Используется", Истина));
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.69
//
Процедура ВключитьИспользованиеАльтернативныхСайтов(Параметры = Неопределено) Экспорт
	Константы.ИспользоватьАльтернативныйСерверДляЗагрузкиКлассификатораБанков.Установить(Истина);
	Константы.ИспользоватьАльтернативныйСерверДляЗагрузкиКурсовВалют.Установить(Истина);
КонецПроцедуры

// Вызывается при первом входе после загрузки области данных
//
Процедура ПриЗагрузкеОбластиДанных() Экспорт 

	Для Каждого МетаКонстанта Из Метаданные.Константы Цикл
		Если Не ОбщегоНазначенияПовтИсп.ЭтоРазделенныйОбъектМетаданных(МетаКонстанта.ПолноеИмя(), Метаданные.ОбщиеРеквизиты.ОбластьДанныхОсновныеДанные.Имя) Тогда
			Продолжить;
		КонецЕсли; 
		МенеджерЗначения = Константы[МетаКонстанта.Имя].СоздатьМенеджерЗначения();
		Если упСервисныеФункции.МетодРеализован(МенеджерЗначения, "ПолучитьРазрешенноеЗначение") Тогда
			СтароеЗначение = МенеджерЗначения.Значение;
			Если СтароеЗначение <> МенеджерЗначения.ПолучитьРазрешенноеЗначение() Тогда 
				МенеджерЗначения.Записать();
			КонецЕсли; 
		КонецЕсли; 
	КонецЦикла;

КонецПроцедуры // ПриЗагрузкеОбластиДанных()

// Вызывается при переходе на версию конфигурации 3.0.4.75
//
Процедура ФормированиеЗаписейВРСАналитическиеРазрезыПоПартнерам(Параметры = Неопределено) Экспорт
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	
	Этап	= Нстр("ru = 'Заполнение регистра сведений ""Аналитические разрезы по партнерам"" элементами справочника""Аналитические разрезы по партнерам""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упАналитическиеРазрезыПоПартнерам.Ссылка,
	               |	упАналитическиеРазрезыПоПартнерам.Контрагент,
	               |	упАналитическиеРазрезыПоПартнерам.Организация,
	               |	упАналитическиеРазрезыПоПартнерам.Партнер,
	               |	упАналитическиеРазрезыПоПартнерам.Соглашение
	               |ИЗ
	               |	Справочник.упАналитическиеРазрезыПоПартнерам КАК упАналитическиеРазрезыПоПартнерам
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упАналитическиеРазрезыПоПартнерам КАК упАналитическиеРазрезыПоПартнерам1
	               |		ПО упАналитическиеРазрезыПоПартнерам.Ссылка = упАналитическиеРазрезыПоПартнерам1.АналитическийРазрезПоПартнерам
	               |ГДЕ
	               |	НЕ упАналитическиеРазрезыПоПартнерам.ПометкаУдаления
	               |	И упАналитическиеРазрезыПоПартнерам1.Партнер ЕСТЬ NULL";
	
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоЗаписей = 0;
	КоличествоЗаписейОшибкаПриЗаписи = 0;
	Пока Выборка.Следующий() Цикл
		Отказ = Ложь;
		упУправленияЗаявками.СформироватьАналитическиеРазрезыПоПартнерам(Выборка.Партнер,,Выборка.Организация,,Выборка.Соглашение,,Выборка.Контрагент,,Выборка.ССылка, Отказ);		
		Если НЕ Отказ Тогда
			КоличествоЗаписей = КоличествоЗаписей + 1;
		Иначе
			КоличествоЗаписейОшибкаПриЗаписи = КоличествоЗаписейОшибкаПриЗаписи + 1;
		КонецЕсли;
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество записей: успешно создано-%1, не удалось записать-%2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей, КоличествоЗаписейОшибкаПриЗаписи);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);

КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.86
//
Процедура УстановитьИменаНастройкамПланированияРейсов(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Установка имен настройкам планирования рейсов'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	КлючОбъекта = "Обработка.упРМПланированиеРейсов.ПараметрыПланирования";
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.Ссылка
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = &Объект 
	|	И упВариантыНастроек.Наименование = упВариантыНастроек.КлючВарианта
	|";
	Запрос.УстановитьПараметр("Объект", КлючОбъекта);
	Выборка = Запрос.Выполнить().Выбрать();
	КоличествоЗаписей = 0;
	Пока Выборка.Следующий() Цикл
		ВариантОбъект = Выборка.Ссылка.ПолучитьОбъект();
		Если Ложь Тогда // Для контекстной подсказки
		    ВариантОбъект = Справочники.упВариантыНастроек.СоздатьЭлемент();
		КонецЕсли;
		ВариантОбъект.Наименование = "Основной";
		ВариантОбъект.ОбменДанными.Загрузка = Истина;
		ВариантОбъект.Записать();
		КоличествоЗаписей = КоличествоЗаписей + 1;
	КонецЦикла;
	Комментарий = Этап + НСтр("ru = '. Изменено %1 документов'");
	Комментарий = СтрШаблон(Комментарий, КоличествоЗаписей);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.95
//
Процедура ЗаполнитьКоличествоГрузовыхМестВЗаявках(Параметры = Неопределено) Экспорт
	
	НеИспользуетсяГлобальнаяПодсистемаУправлениеПеревозками = ПолучитьФункциональнуюОпцию("упНеИспользуетсяГлобальнаяПодсистемаУправлениеПеревозками");
	
	Если НЕ НеИспользуетсяГлобальнаяПодсистемаУправлениеПеревозками Тогда

		СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
		СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ
		|	упЗаявкаНаПеревозкуГруза.Ссылка
		|ИЗ
		|	Документ.упЗаявкаНаПеревозкуГруза КАК упЗаявкаНаПеревозкуГруза
		|ГДЕ
		|	НЕ упЗаявкаНаПеревозкуГруза.ПометкаУдаления 
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	упЗаданиеНаПеревозкуГруза.Ссылка
		|ИЗ
		|	Документ.упЗаданиеНаПеревозкуГруза КАК упЗаданиеНаПеревозкуГруза
		|ГДЕ
		|	НЕ упЗаданиеНаПеревозкуГруза.ПометкаУдаления";
		
		мсвРезультатЗапроса	= Запрос.ВыполнитьПакет();
		
		Этап	= Нстр("ru = 'Заполнение количества грузовых мест в заявках на перевозку груза'");
		ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
		КоличествоЗаписей 					= 0;
		КоличествоЗаписейОшибкаПриЗаписи 	= 0;
		Выборка	= мсвРезультатЗапроса[0].Выбрать();
		Пока Выборка.Следующий() Цикл
			Отказ = Ложь;
			ДокументСсылка = Выборка.Ссылка;
			ДокументОбъект = ДокументСсылка.ПолучитьОбъект();
			Попытка
				ДокументОбъект.ДополнительныеСвойства.Вставить("НеРегистрироватьСобытие", Истина);
				ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
				КоличествоЗаписей = КоличествоЗаписей + 1;
			Исключение
				КоличествоЗаписейОшибкаПриЗаписи = КоличествоЗаписейОшибкаПриЗаписи + 1;
				ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ТекстОшибки) Тогда 
					ТекстОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка, ,ДокументСсылка, ТекстОшибки, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			КонецПопытки;
		КонецЦикла; 
		
		Комментарий = Нстр("ru = 'Количество документов: успешно перезаписано-%1, не удалось записать-%2'");
		Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей, КоличествоЗаписейОшибкаПриЗаписи);
		ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
		Этап	= Нстр("ru = 'Заполнение количества грузовых мест в заданиях на перевозку груза'");
		ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
		КоличествоЗаписей 					= 0;
		КоличествоЗаписейОшибкаПриЗаписи 	= 0;
		Выборка	= мсвРезультатЗапроса[1].Выбрать();
		Пока Выборка.Следующий() Цикл
			Отказ = Ложь;
			ДокументСсылка = Выборка.Ссылка;
			ДокументОбъект = ДокументСсылка.ПолучитьОбъект();
			Попытка
				ДокументОбъект.ДополнительныеСвойства.Вставить("НеРегистрироватьСобытие", Истина);
				ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
				КоличествоЗаписей = КоличествоЗаписей + 1;
			Исключение
				КоличествоЗаписейОшибкаПриЗаписи = КоличествоЗаписейОшибкаПриЗаписи + 1;
				ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ТекстОшибки) Тогда 
					ТекстОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка, ,ДокументСсылка, ТекстОшибки, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			КонецПопытки;
		КонецЦикла; 
		
		Комментарий = Нстр("ru = 'Количество документов: успешно перезаписано-%1, не удалось записать-%2'");
		Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей, КоличествоЗаписейОшибкаПриЗаписи);
		ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	КонецЕсли;


КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.95
//
Процедура ЗаполнитьКоличествоГрузовыхМестВПлановыхИФактическихПараметрах(Параметры = Неопределено) Экспорт
	
	НеИспользуетсяГлобальнаяПодсистемаУправлениеПеревозками = ПолучитьФункциональнуюОпцию("упНеИспользуетсяГлобальнаяПодсистемаУправлениеПеревозками");
	
	Если НЕ НеИспользуетсяГлобальнаяПодсистемаУправлениеПеревозками Тогда
		СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
		СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
		               |	упПлановыеПараметрыРейса.Рейс КАК Рейс
		               |ПОМЕСТИТЬ втРейсы
		               |ИЗ
		               |	РегистрСведений.упПлановыеПараметрыРейса КАК упПлановыеПараметрыРейса
		               |
		               |ОБЪЕДИНИТЬ ВСЕ
		               |
		               |ВЫБРАТЬ
		               |	упФактическиеПараметрыРейса.Рейс
		               |ИЗ
		               |	РегистрСведений.упФактическиеПараметрыРейса КАК упФактическиеПараметрыРейса
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	упРаботыПоРейсуСрезПоследних.Рейс,
		               |	упРаботыПоРейсуСрезПоследних.Идентификатор,
		               |	СУММА(ВЫБОР
		               |			КОГДА упРаботыПоРейсуСрезПоследних.Операция = ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.Погрузка)
		               |					ИЛИ упРаботыПоРейсуСрезПоследних.Операция = ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.ВыемкаЦенностей)
		               |				ТОГДА 1
		               |			ИНАЧЕ -1
		               |		КОНЕЦ * ВЫБОР
		               |			КОГДА упРаботыПоРейсуСрезПоследних.Тара = ЗНАЧЕНИЕ(Справочник.упГрузовыеМеста.ПустаяСсылка)
		               |				ТОГДА 1
		               |			ИНАЧЕ 0
		               |		КОНЕЦ) КАК КоличествоГрузовыхМестПлан,
		               |	СУММА(ВЫБОР
		               |			КОГДА упРаботыПоРейсуСрезПоследних.Выполнена
		               |					И упМаршрутПоРейсуСрезПоследних.Пройдена
		               |				ТОГДА ВЫБОР
		               |						КОГДА упРаботыПоРейсуСрезПоследних.Операция = ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.Погрузка)
		               |								ИЛИ упРаботыПоРейсуСрезПоследних.Операция = ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.ВыемкаЦенностей)
		               |							ТОГДА 1
		               |						ИНАЧЕ -1
		               |					КОНЕЦ * ВЫБОР
		               |						КОГДА упРаботыПоРейсуСрезПоследних.Тара = ЗНАЧЕНИЕ(Справочник.упГрузовыеМеста.ПустаяСсылка)
		               |							ТОГДА 1
		               |						ИНАЧЕ 0
		               |					КОНЕЦ
		               |			ИНАЧЕ 0
		               |		КОНЕЦ) КАК КоличествоГрузовыхМестФакт
		               |ПОМЕСТИТЬ втИтогиПоТочкамМаршрутаРейса
		               |ИЗ
		               |	РегистрСведений.упРаботыПоРейсу.СрезПоследних КАК упРаботыПоРейсуСрезПоследних
		               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.упМаршрутПоРейсу.СрезПоследних КАК упМаршрутПоРейсуСрезПоследних
		               |		ПО упРаботыПоРейсуСрезПоследних.Рейс = упМаршрутПоРейсуСрезПоследних.Рейс
		               |			И упРаботыПоРейсуСрезПоследних.Идентификатор = упМаршрутПоРейсуСрезПоследних.Идентификатор
		               |ГДЕ
		               |	НЕ упРаботыПоРейсуСрезПоследних.Отменена
		               |	И упРаботыПоРейсуСрезПоследних.Операция В (ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.Погрузка), ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.Разгрузка), ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.ВыемкаЦенностей), ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.ПередачаЦенностей))
		               |
		               |СГРУППИРОВАТЬ ПО
		               |	упРаботыПоРейсуСрезПоследних.Рейс,
		               |	упРаботыПоРейсуСрезПоследних.Идентификатор
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	втИтогиПоТочкамМаршрутаРейса.Рейс,
		               |	МАКСИМУМ(втИтогиПоТочкамМаршрутаРейса.КоличествоГрузовыхМестПлан) КАК КоличествоГрузовыхМестПлан,
		               |	МАКСИМУМ(втИтогиПоТочкамМаршрутаРейса.КоличествоГрузовыхМестФакт) КАК КоличествоГрузовыхМестФакт
		               |ИЗ
		               |	втИтогиПоТочкамМаршрутаРейса КАК втИтогиПоТочкамМаршрутаРейса
		               |
		               |СГРУППИРОВАТЬ ПО
		               |	втИтогиПоТочкамМаршрутаРейса.Рейс";
		
		Выборка	= Запрос.Выполнить().Выбрать();
	
		КоличествоЗаписейПлан 					= 0;
		КоличествоЗаписейПланОшибкаПриЗаписи 	= 0;
		КоличествоЗаписейФакт 					= 0;
		КоличествоЗаписейФактОшибкаПриЗаписи 	= 0;
		
		Пока Выборка.Следующий() Цикл
			
			Рейс 					= Выборка.Рейс;
			КоличествоГрузовыхМестПлан 	= Выборка.КоличествоГрузовыхМестПлан;
			КоличествоГрузовыхМестФакт	= Выборка.КоличествоГрузовыхМестФакт;
			
			Если КоличествоГрузовыхМестПлан > 0 Тогда
				
				ЗаписьПлановыеПараметры = РегистрыСведений.упПлановыеПараметрыРейса.СоздатьМенеджерЗаписи();
				ЗаписьПлановыеПараметры.Рейс = Рейс;
				ЗаписьПлановыеПараметры.Прочитать();
				
				Если ЗаписьПлановыеПараметры.Выбран() Тогда
					ЗаписьПлановыеПараметры.КоличествоГрузовыхМест = КоличествоГрузовыхМестПлан;
					Попытка
						ЗаписьПлановыеПараметры.Записать();	
						КоличествоЗаписейПлан = КоличествоЗаписейПлан + 1;
					Исключение
						КоличествоЗаписейПланОшибкаПриЗаписи = КоличествоЗаписейПланОшибкаПриЗаписи + 1;
						ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
						Если Не ЗначениеЗаполнено(ТекстОшибки) Тогда 
							ТекстОшибки = ОписаниеОшибки();
						КонецЕсли;
						ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка, ,Рейс, ТекстОшибки, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
					КонецПопытки;
				КонецЕсли;
			КонецЕсли;	
			
			Если КоличествоГрузовыхМестФакт > 0 Тогда
				ЗаписьФактическиеПараметры = РегистрыСведений.упФактическиеПараметрыРейса.СоздатьМенеджерЗаписи();
				ЗаписьФактическиеПараметры.Рейс = Рейс;
				ЗаписьФактическиеПараметры.Прочитать();
				
				Если ЗаписьФактическиеПараметры.Выбран() Тогда
					ЗаписьФактическиеПараметры.КоличествоГрузовыхМест = КоличествоГрузовыхМестФакт;
					Попытка
						ЗаписьФактическиеПараметры.Записать();
						КоличествоЗаписейФакт = КоличествоЗаписейФакт + 1;
					Исключение
						КоличествоЗаписейФактОшибкаПриЗаписи = КоличествоЗаписейПланОшибкаПриЗаписи + 1;
						ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
						Если Не ЗначениеЗаполнено(ТекстОшибки) Тогда 
							ТекстОшибки = ОписаниеОшибки();
						КонецЕсли;
						ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка, ,Рейс, ТекстОшибки, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
					КонецПопытки;	
				КонецЕсли;
			КонецЕсли;	
		КонецЦикла; 
		
		Комментарий = Нстр("ru = 'Количество записей: плановые параметры успешно перезаписано-%1, плановые параметры не удалось записать-%2, фактические параметры успешно перезаписано-%3, фактические параметры не удалось записать-%4'");
		Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписейПлан, КоличествоЗаписейПланОшибкаПриЗаписи, КоличествоЗаписейФакт, КоличествоЗаписейФактОшибкаПриЗаписи);
		ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	КонецЕсли;

КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.101
//
Процедура ЗаполнитьВариантРасходовВСтатьяхРасходов(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упСтатьиДоходовРасходов.Ссылка
	|ИЗ
	|	Справочник.упСтатьиДоходовРасходов КАК упСтатьиДоходовРасходов
	|ГДЕ
	|	НЕ упСтатьиДоходовРасходов.ПометкаУдаления
	|	И упСтатьиДоходовРасходов.ВариантРасходов = ЗНАЧЕНИЕ(Перечисление.упВариантыРасходов.ПустаяСсылка)
	|	И упСтатьиДоходовРасходов.ТипСтатьиДоходовИРасходов = ЗНАЧЕНИЕ(Перечисление.упТипыСтатейДоходовРасходов.СтатьяРасходов)";
	РезультатЗапроса = Запрос.Выполнить();
	Если Не РезультатЗапроса.Пустой() Тогда
		Выборка = РезультатЗапроса.Выбрать();
		Пока Выборка.Следующий() Цикл
			СтатьяОбъект = Выборка.Ссылка.ПолучитьОбъект();
			СтатьяОбъект.ВариантРасходов = Перечисления.упВариантыРасходов.Прямые;
			Попытка
				СтатьяОбъект.Записать();
			Исключение
				ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ТекстОшибки) Тогда 
					ТекстОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка, ,СтатьяОбъект, ТекстОшибки);
			КонецПопытки;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.5.9
//
Процедура ЗаполнитьЗональныеНастройкиМаршрутизацииПоУмолчанию(Параметры = Неопределено) Экспорт
	
	МенеджерЗаписи = РегистрыСведений.упЗональныеНастройкиМаршрутизации.СоздатьМенеджерЗаписи();
	//МенеджерЗаписи.Прочитать();
	//Если МенеджерЗаписи.Выбран() Тогда
	//	Возврат;
	//КонецЕсли; 
	МенеджерЗаписи.Граница = 200;
	МенеджерЗаписи.КоэффициентДоГраницы = 1.6;
	МенеджерЗаписи.КоэффициентПослеГраницы = 1.1;
	МенеджерЗаписи.Записать();
	
КонецПроцедуры

//// Вызывается при переходе на версию конфигурации 3.0.4.93
////
//Процедура ВключитьОшибочноВыключенныеКомпоненты(Параметры = Неопределено) Экспорт 
//	
//	// Задача 000091962 При включении общего реквизита эти константы сбрасываются, поэтому насильно однократно устанавливаем их.
//	ИспользуетсяУправлениеПеревозками = Константы.упИспользуетсяГлобальнаяПодсистемаУправлениеПеревозками.Получить();
//	ИспользуетсяУправлениеТранспортом = Константы.упИспользуетсяГлобальнаяПодсистемаУправлениеТранспортом.Получить();
//	ИспользуетсяСпутниковыйМониторинг = Константы.упИспользуетсяГлобальнаяПодсистемаСпутниковыйМониторинг.Получить();
//	упЗащищенныеФункции.ПроверитьЛицензиюСеанса();
//	сткВозврат = упЗащищенныеФункции.ДоступныеМодули();
//	ТекстИзмененСостав = "";
//	Если Не ИспользуетсяУправлениеПеревозками И сткВозврат.УправлениеПеревозками Тогда
//		ИзмененСостав = Истина;
//		ТекстИзмененСостав = ТекстИзмененСостав + НСтр(СтрШаблон("Включена компонента ""Управление перевозками""")) + Символы.ПС;
//	КонецЕсли; 
//	Если Не ИспользуетсяУправлениеТранспортом И сткВозврат.УправлениеТранспортом Тогда
//		ИзмененСостав = Истина;
//		ТекстИзмененСостав = ТекстИзмененСостав + НСтр(СтрШаблон("Включена компонента ""Управление транспортом""")) + Символы.ПС;
//	КонецЕсли; 
//	Если Не ИспользуетсяСпутниковыйМониторинг И сткВозврат.СпутниковыйМониторинг Тогда
//		ИзмененСостав = Истина;
//		ТекстИзмененСостав = ТекстИзмененСостав + НСтр(СтрШаблон("Включена компонента ""Спутниковый мониторинг""")) + Символы.ПС;
//	КонецЕсли;
//	Если ИзмененСостав Тогда
//		ЗаписьЖурналаРегистрации("Включены компоненты", УровеньЖурналаРегистрации.Предупреждение,,, ТекстИзмененСостав);
//	КонецЕсли; 
//	
//КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.4.99
//
Процедура ЗаполнитьСпособыПрохожденияТочек(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	Этап	= Нстр("ru = 'Заполнение способа прохождения точек в видах перевозок'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	упВидыПеревозок.Ссылка
	|ИЗ
	|	Справочник.упВидыПеревозок КАК упВидыПеревозок
	|ГДЕ
	|	упВидыПеревозок.СпособПрохожденияТочекМаршрута = ЗНАЧЕНИЕ(Перечисление.упСпособыПрохожденияТочекМаршрута.ПустаяСсылка)
	|	И НЕ упВидыПеревозок.ПометкаУдаления";
	Запрос.УстановитьПараметр("", );
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоЗаписей 					= 0;
	КоличествоЗаписейОшибкаПриЗаписи	= 0;
	Пока Выборка.Следующий() Цикл
		
		ВидПеревозки = Выборка.Ссылка.ПолучитьОбъект();
		ВидПеревозки.СпособПрохожденияТочекМаршрута = Перечисления.упСпособыПрохожденияТочекМаршрута.ОтдельнымДокументом;
		
		Попытка
			ВидПеревозки.Записать();
			КоличествоЗаписей = КоличествоЗаписей + 1;
		Исключение
			КоличествоЗаписейОшибкаПриЗаписи = КоличествоЗаписейОшибкаПриЗаписи + 1;
			ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ТекстОшибки) Тогда 
				ТекстОшибки = ОписаниеОшибки();
			КонецЕсли;
			ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка, ,Выборка.Ссылка, ТекстОшибки, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
		КонецПопытки;
		
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество элементов: успешно изменено-%1, не удалось записать-%2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей, КоличествоЗаписейОшибкаПриЗаписи);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);

КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.5.29
//
Процедура УстановитьРежимИспользованияДополнительногоОборудования(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Если в базе есть признаки дополнительного оборудования и включены соответствующие компоненты, то включить режим использования'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	упДополнительноеОборудование.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.упДополнительноеОборудование КАК упДополнительноеОборудование
	|ГДЕ
	|	НЕ упДополнительноеОборудование.ПометкаУдаления";
	РезультатЗапроса = Запрос.Выполнить();
	
	Если Истина
		И (Ложь 
			Или ПолучитьФункциональнуюОпцию("упИспользуетсяГлобальнаяПодсистемаУправлениеПеревозками")
			Или ПолучитьФункциональнуюОпцию("упИспользуетсяГлобальнаяПодсистемаУправлениеТранспортом"))
		И НЕ РезультатЗапроса.Пустой() Тогда
		Константы.упИспользуетсяУчетДополнительногоОборудования.Установить(Истина);
	КонецЕсли;
		
	Комментарий = "";
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //УстановитьРежимИспользованияДополнительногоОборудования()

// Вызывается при переходе на версию конфигурации 3.0.5.35
//
Процедура ВключитьИспользованиеДопРеквизитовУстановкаНормРасходаГСМ(Параметры = Неопределено) Экспорт
	
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упУстановкаНормРасходаГСМ", Новый Структура("Используется", Истина));
	
КонецПроцедуры //()

// Вызывается при переходе на версию конфигурации 3.0.5.54
//
Процедура ВключитьИспользованиеДопРеквизитовЗаявкаНаРемонтИТОТС(Параметры = Неопределено) Экспорт
	
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упЗаявкаНаРемонтИТОТС", Новый Структура("Используется", Истина));
	
КонецПроцедуры //ВключитьИспользованиеДопРеквизитовЗаявкаНаРемонтИТОТС()

// Вызывается при переходе на версию конфигурации 3.0.5.75
//
Процедура ВключитьИспользованиеДопРеквизитов_3_0_5_75(Параметры = Неопределено) Экспорт
	
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упПринятиеКУчетуТранспортногоСредства", Новый Структура("Используется", Истина));
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упСнятиеСУчетаТранспортногоСредства", Новый Структура("Используется", Истина));
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упПередачаТранспортногоСредстваПодразделению", Новый Структура("Используется", Истина));
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упИзменениеСостоянияТранспортногоСредства", Новый Структура("Используется", Истина));
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упПрисоединениеОтсоединениеПрицепа", Новый Структура("Используется", Истина));
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Справочник_упТипыДополнительногоОборудования", Новый Структура("Используется", Истина));
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Справочник_упТипыШинУзловИАгрегатов", Новый Структура("Используется", Истина));

КонецПроцедуры //ВключитьИспользованиеДопРеквизитов_3_0_5_75()

// Вызывается при переходе на версию конфигурации 3.0.5.72
//
Процедура ВключитьИспользованиеДопРеквизитовАвансовыйОтчет(Параметры = Неопределено) Экспорт
	
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упАвансовыйОтчет", Новый Структура("Используется", Истина));
	
КонецПроцедуры //ВключитьИспользованиеДопРеквизитовАвансовыйОтчет()

// Вызывается при переходе на версию конфигурации 3.0.5.59
//
Процедура ВключитьИспользованиеДопРеквизитовИзменениеНаправленияДеятельностиТранспортногоСредства(Параметры = Неопределено) Экспорт
	
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упИзменениеНаправленияДеятельностиТранспортногоСредства", Новый Структура("Используется", Истина));
	
КонецПроцедуры //ВключитьИспользованиеДопРеквизитовИзменениеНаправленияДеятельностиТранспортногоСредства()

// Вызывается при переходе на версию конфигурации 3.0.5.37
//
Процедура ВключитьИспользованиеДопРеквизитовУстановкаЛимитовРасходаГСМ(Параметры = Неопределено) Экспорт
	
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упУстановкаЛимитовРасходаГСМ", Новый Структура("Используется", Истина));
	
КонецПроцедуры //ВключитьИспользованиеДопРеквизитовУстановкаЛимитовРасходаГСМ()

// Вызывается при переходе на версию конфигурации 3.0.5.65
//
Процедура ЗаполнитьТипНормыГСМ(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется новый реквизит ""Тип нормы ГСМ"" справочника ""Нормы ГСМ""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упНормыРасходаГСМ.Ссылка КАК Ссылка,
	               |	упНормыРасходаГСМ.УдалитьТипНормы КАК УдалитьТипНормы
	               |ИЗ
	               |	Справочник.упНормыРасходаГСМ КАК упНормыРасходаГСМ
	               |ГДЕ
	               |	упНормыРасходаГСМ.ТипНормыРасходаГСМ = ЗНАЧЕНИЕ(Перечисление.упТипыНормРасходаГСМ.ПустаяСсылка)";
	
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоОбъектов = 0;
	КоличествоОбъектовОшибка = 0;
	Пока Выборка.Следующий() Цикл
		
		СправочникОбъект = Выборка.Ссылка.ПолучитьОбъект();
		СправочникОбъект.ТипНормыРасходаГСМ = ?(Выборка.УдалитьТипНормы, Перечисления.упТипыНормРасходаГСМ.НаСтоКилометров, Перечисления.упТипыНормРасходаГСМ.НаОдинЧасРаботы);
	     СпособыРасчетаНадбавокПроцент = ПредопределенноеЗначение("Перечисление.упСпособыРасчетаНадбавокГСМ.ПроцентОтОбщегоРасхода");
		ТипНормыРасходаГСМ			= ПредопределенноеЗначение("Перечисление.упТипыНормРасходаГСМ.НаСтоКилометров");
		
		СправочникОбъект.ТипРасходаГорнаяМестность 	= СпособыРасчетаНадбавокПроцент;	
		СправочникОбъект.ТипРасходаСложностьДорог 	= СпособыРасчетаНадбавокПроцент;	
		СправочникОбъект.ТипРасходаГорнаяМестность 	= СпособыРасчетаНадбавокПроцент;	
		СправочникОбъект.ТипРасходаНаселенныйПункт 	= СпособыРасчетаНадбавокПроцент;	
		СправочникОбъект.ТипРасходаГрузовой 		= СпособыРасчетаНадбавокПроцент;	
		СправочникОбъект.ТипРасходаКлиматКонтроль 	= СпособыРасчетаНадбавокПроцент;	
		СправочникОбъект.ТипРасходаСпециальноеОборудование 	= СпособыРасчетаНадбавокПроцент;	
		СправочникОбъект.ТипРасходаПростой 		= СпособыРасчетаНадбавокПроцент;	
		СправочникОбъект.ТипРасходаЗимний 			= СпособыРасчетаНадбавокПроцент;	
		СправочникОбъект.ТипРасходаКондиционер 		= СпособыРасчетаНадбавокПроцент;	
		Если НЕ СправочникОбъект.РасходОтопитель =  0 Тогда
			СправочникОбъект.ТипРасходаОтопитель = Перечисления.упСпособыРасчетаНадбавокГСМ.РасходВЛитрахЗаЧас;
		Иначе	
			СправочникОбъект.ТипРасходаОтопитель 	= СпособыРасчетаНадбавокПроцент;	
		КонецЕсли;
		СправочникОбъект.ТипРасходаДлительнаяЭксплуатация 	= СпособыРасчетаНадбавокПроцент;	
		
		Попытка
			СправочникОбъект.Записать();
			КоличествоОбъектов = КоличествоОбъектов + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать норму ГСМ'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоОбъектовОшибка = КоличествоОбъектовОшибка + 1;    
		КонецПопытки;
		
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество объектов: успешно изменено-%1, не удалось записать-%2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоОбъектов, КоличествоОбъектовОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
КонецПроцедуры //ЗаполнитьТипНормыГСМ()

// Вызывается при переходе на версию конфигурации 3.0.5.65
//
Процедура ЗаполнениеНормРасходаГСМДополнительногоОборудования(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	
	Этап	= Нстр("ru = 'Заполняются виды ГСМ в доп. оборудовании, устанавливаются нормы ГСМ.'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"
	|//{: Текст собран конструктором из подсистемы ""Инструменты разработчика"" (http://devtool1c.ucoz.ru), который сохраняет звездочки и комментарии.
	|//{Запрос: 0 ////////////////////////////////////////
	|ВЫБРАТЬ
	|	упДополнительноеОборудованиеНормыРасходаГСМ.Ссылка КАК ДополнительноеОборудование,
	|	упДополнительноеОборудованиеНормыРасходаГСМ.ВидГСМ КАК ВидГСМ,
	|	упДополнительноеОборудованиеНормыРасходаГСМ.Основной КАК Основной,
	|	упДополнительноеОборудованиеНормыРасходаГСМ.ДатаУстановки КАК ДатаУстановки,
	|	упНормыРасходаГСМ.*
	|ИЗ
	|	Справочник.упДополнительноеОборудование.УдалитьНормыРасходаГСМ КАК упДополнительноеОборудованиеНормыРасходаГСМ
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.упНормыРасходаГСМ КАК упНормыРасходаГСМ
	|	ПО упДополнительноеОборудованиеНормыРасходаГСМ.НормаРасхода = упНормыРасходаГСМ.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упНормыРасходаГСМ.СрезПоследних(
	|		,
	|		) КАК УпНормыРасходаГСМ_СрезПоследнихТ
	|	ПО ИСТИНА
	|		И УпНормыРасходаГСМ_СрезПоследнихТ.ВидГСМ = упДополнительноеОборудованиеНормыРасходаГСМ.ВидГСМ
	|		И УпНормыРасходаГСМ_СрезПоследнихТ.ОбъектНормРасхода = упДополнительноеОборудованиеНормыРасходаГСМ.Ссылка
	|ГДЕ УпНормыРасходаГСМ_СрезПоследнихТ.ВидГСМ ЕСТЬ NULL
	|ИТОГИ
	|ПО
	|	ДатаУстановки
	|;
	|//{Запрос: 1 ////////////////////////////////////////
	|ВЫБРАТЬ
	|	упДополнительноеОборудованиеНормыРасходаГСМ.Ссылка КАК Ссылка,
	|	упДополнительноеОборудованиеНормыРасходаГСМ.ВидГСМ КАК ВидГСМ,
	|	СУММА(ВЫБОР
	|		КОГДА упДополнительноеОборудованиеНормыРасходаГСМ.Основной
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ) КАК Основной
	|ПОМЕСТИТЬ втВидыГСМ
	|ИЗ
	|	Справочник.упДополнительноеОборудование.УдалитьНормыРасходаГСМ КАК упДополнительноеОборудованиеНормыРасходаГСМ
	|СГРУППИРОВАТЬ ПО
	|	упДополнительноеОборудованиеНормыРасходаГСМ.Ссылка,
	|	упДополнительноеОборудованиеНормыРасходаГСМ.ВидГСМ
	|;
	|//{Запрос: 2 ////////////////////////////////////////
	|ВЫБРАТЬ
	|	втВидыГСМ.ВидГСМ КАК ВидГСМ,
	|	втВидыГСМ.Основной КАК Основной,
	|	втВидыГСМ.Ссылка КАК Ссылка
	|ИЗ
	|	втВидыГСМ КАК втВидыГСМ
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.упДополнительноеОборудование.ВидыГСМ КАК упДополнительноеОборудованиеВидыГСМ
	|	ПО ИСТИНА
	|		И втВидыГСМ.Ссылка = упДополнительноеОборудованиеВидыГСМ.Ссылка
	|		И втВидыГСМ.ВидГСМ = упДополнительноеОборудованиеВидыГСМ.ВидГСМ
	|ГДЕ упДополнительноеОборудованиеВидыГСМ.Ссылка ЕСТЬ NULL
	|ИТОГИ
	|ПО
	|	Ссылка
	|;
	|//{Запрос: 3 ////////////////////////////////////////
	|ВЫБРАТЬ
	|	Организации.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.Организации КАК Организации
	|";


	мсвРезультат = Запрос.ВыполнитьПакет();
	
	ВыборкаДатаНачала	= мсвРезультат[0].Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	ВыборкаОрганизация	= мсвРезультат[3].Выбрать();
	
	Организация = Неопределено;
	Если ВыборкаОрганизация.Следующий() Тогда
		Организация = ВыборкаОрганизация.Ссылка;	
	Иначе
		ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Нстр("ru = 'Не удалось найти организацию для документа ""Установка норм ГСМ""'"));
		Возврат;
	КонецЕсли;
	
	КоличествоУспешно 	= 0;
	КоличествоОшибка	= 0;
	
	Пока ВыборкаДатаНачала.Следующий() Цикл
		
		ДокументУстановкаНормГСМ = Документы.упУстановкаНормРасходаГСМ.СоздатьДокумент();
		ДокументУстановкаНормГСМ.Дата 	= ТекущаяДатаСеанса();
		ДокументУстановкаНормГСМ.ДатаНачалаДействия = ВыборкаДатаНачала.ДатаУстановки;
		ДокументУстановкаНормГСМ.Автор		= ПользователиКлиентСервер.ТекущийПользователь();
		ДокументУстановкаНормГСМ.Комментарий	= Нстр("ru = 'Документ создан автоматически при переходе на версию 3.0.5.65'");
		ДокументУстановкаНормГСМ.Организация	= Организация;
		ДокументУстановкаНормГСМ.ОбъектНормРасходаГСМ	= Перечисления.упОбъектыНормРасходаГСМ.ДополнительноеОборудование;
		
		Выборка = ВыборкаДатаНачала.Выбрать();
		
		Пока Выборка.Следующий() Цикл
			НоваяСтрока = ДокументУстановкаНормГСМ.НормыДополнительногоОборудования.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, Выборка);
		КонецЦикла;
		
		Попытка
			ДокументУстановкаНормГСМ.Записать(РежимЗаписиДокумента.Проведение);
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать документ'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,,, ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;    
		КонецПопытки;
		
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество документов: успешно обработано-%1, не удалось записать-%2'");
	Комментарий = СтрШаблон(Комментарий, КоличествоУспешно, КоличествоОшибка);
	
	
	КоличествоУспешно 	= 0;
	КоличествоОшибка	= 0;
	
	ВыборкаДопОборудование	= мсвРезультат[2].Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаДопОборудование.Следующий() Цикл
		
		ДопОборудование = ВыборкаДопОборудование.Ссылка.ПолучитьОбъект();
		
		ВыборкаВидыГСМ	= ВыборкаДопОборудование.Выбрать();
		Пока ВыборкаВидыГСМ.Следующий() Цикл
			НоваяСтрока = ДопОборудование.ВидыГСМ.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, ВыборкаВидыГСМ);
			НоваяСтрока.Основной = ?(ВыборкаВидыГСМ.Основной > 0, Истина, Ложь);
		КонецЦикла;
		
		Попытка
			ДопОборудование.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать элемент'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,,ВыборкаДопОборудование.Ссылка, ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;    
		КонецПопытки;
		
	КонецЦикла; 
	
	Комментарий2 = Нстр("ru = 'Количество элементов: успешно обработано-%1, не удалось записать-%2'");
	Комментарий2 = СтрШаблон(Комментарий2, КоличествоУспешно, КоличествоОшибка) + Символы.ПС + Комментарий;
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий2);
	
КонецПроцедуры //ЗаполнениеНормРасходаГСМДополнительногоОборудования()

// Вызывается при переходе на версию конфигурации 3.0.5.65
//
Процедура ЗаполнитьВидыГСМВТранспортныхСредствах(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	
	Этап	= Нстр("ru = 'Заполняет табличную часть ""Виды ГСМ"" в транспортных средствах'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упТранспортныеСредства.Ссылка КАК ТранспортноеСредство,
	|	упТранспортныеСредства.УдалитьВидГСМОсновной КАК ВидГСМ,
	|	упМоделиТС.УдалитьОбъемБака КАК ОбъемБака
	|ИЗ
	|	Справочник.упТранспортныеСредства КАК упТранспортныеСредства
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.упТранспортныеСредства.УдалитьВидыГСМ КАК упТранспортныеСредстваВидыГСМ
	|		ПО (упТранспортныеСредстваВидыГСМ.Ссылка = упТранспортныеСредства.Ссылка)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.упМоделиТС КАК упМоделиТС
	|		ПО упТранспортныеСредства.Модель = упМоделиТС.Ссылка
	|ГДЕ
	|	НЕ упТранспортныеСредства.УдалитьВидГСМОсновной = ЗНАЧЕНИЕ(Справочник.упВидыГСМ.ПустаяСсылка)
	|	И НЕ упТранспортныеСредства.ПометкаУдаления
	|	И упТранспортныеСредстваВидыГСМ.Ссылка ЕСТЬ NULL
	|";
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоУспешно 	= 0;
	КоличествоОшибка 	= 0;
	Пока Выборка.Следующий() Цикл
		
		СправочникОбъект = Выборка.ТранспортноеСредство.ПолучитьОбъект();
		НоваяСтрока	= СправочникОбъект.УдалитьВидыГСМ.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, Выборка);
		НоваяСтрока.Основной 	= Истина;
		
		Попытка
			СправочникОбъект.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать элемент'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,,Выборка.ТранспортноеСредство, ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;    
		КонецПопытки;
		
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество элементов: успешно обработано-%1, не удалось записать-%2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //ЗаполнитьВидыГСМВТранспортныхСредствах()

// Вызывается при переходе на версию конфигурации 3.0.5.68
//
Процедура ЗаполнитьПредставлениеКоординатыВАдресах(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упАдреса.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.упАдреса КАК упАдреса
	|ГДЕ
	|	НЕ упАдреса.ПометкаУдаления
	|	И упАдреса.Широта <> 0
	|	И упАдреса.Долгота <> 0";
	РезультатЗапроса = Запрос.Выполнить();
	Если Не РезультатЗапроса.Пустой() Тогда
		Выборка = РезультатЗапроса.Выбрать();
		Пока Выборка.Следующий() Цикл
			НачатьТранзакцию();
			АдресОбъект = Выборка.Ссылка.ПолучитьОбъект();
			АдресОбъект.ПредставлениеКоординаты = упСервисныеФункцииКлиентСервер.СформироватьПредставлениеКоординаты(АдресОбъект.Широта, АдресОбъект.Долгота);
			АдресОбъект.ОбменДанными.Загрузка = Истина;
			Попытка
				АдресОбъект.Записать();
			Исключение
				ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
					ОписаниеОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,, АдресОбъект,ОписаниеОшибки, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			КонецПопытки;
			Если ТранзакцияАктивна() Тогда
				ЗафиксироватьТранзакцию();
			КонецЕсли; 
		КонецЦикла; 
	КонецЕсли; 

КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.5.71
//
Процедура ЗаполнитьНадбавкуРасходаТопливаОтопитель(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	
	Этап	= Нстр("ru = 'Перенос времени работы отопителя в табличную часть ""Нормы расхода""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"
	|//{: Текст собран конструктором из подсистемы ""Инструменты разработчика"" (http://devtool1c.ucoz.ru), который сохраняет звездочки и комментарии.
	|//{Запрос: 0 ////////////////////////////////////////
	|ВЫБРАТЬ
	|	упПутевойЛистТ.Ссылка КАК Ссылка,
	|	упПутевойЛистТ.УдалитьВремяРаботыОтопителя КАК ВремяРаботыОтопителя,
	|	упПутевойЛистТ.ТранспортноеСредство КАК ТранспортноеСредство,
	|	упПутевойЛистТ.Организация КАК Организация,
	|	упПутевойЛистТ.Подразделение КАК Подразделение
	|ПОМЕСТИТЬ втПутевыеЛисты
	|ИЗ
	|	Документ.упПутевойЛист КАК упПутевойЛистТ
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упСтатусыПутевыхЛистов.СрезПоследних(
	|		,
	|		) КАК УпСтатусыПутевыхЛистов_СрезПоследнихТ
	|	ПО УпСтатусыПутевыхЛистов_СрезПоследнихТ.Документ = упПутевойЛистТ.Ссылка
	|ГДЕ ИСТИНА
	|	И (ЛОЖЬ
	|		ИЛИ УпСтатусыПутевыхЛистов_СрезПоследнихТ.Статус В (ЗНАЧЕНИЕ(Перечисление.упСтатусыПутевогоЛиста.Новый),
	|				ЗНАЧЕНИЕ(Перечисление.упСтатусыПутевогоЛиста.Выдан),
	|				ЗНАЧЕНИЕ(Перечисление.упСтатусыПутевогоЛиста.Возвращен))
	|		ИЛИ УпСтатусыПутевыхЛистов_СрезПоследнихТ.Статус ЕСТЬ NULL)
	|	И упПутевойЛистТ.УдалитьВремяРаботыОтопителя > 0
	|;
	|//{Запрос: 1 ////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	втПутевыеЛистыТ.Ссылка КАК Ссылка
	|ПОМЕСТИТЬ втПутевыеЛистыСНадбавками
	|ИЗ
	|	втПутевыеЛисты КАК втПутевыеЛистыТ
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.упПутевойЛист.НормыРасходаГСМ КАК УпПутевойЛист_НормыРасходаГСМТ
	|	ПО втПутевыеЛистыТ.Ссылка = УпПутевойЛист_НормыРасходаГСМТ.Ссылка
	|ГДЕ УпПутевойЛист_НормыРасходаГСМТ.ВидЭксплуатационнойНормы = ЗНАЧЕНИЕ(Перечисление.упВидыЭксплуатационныхНормРасходаГСМ.Отопитель)
	|;
	|//{Запрос: 2 ////////////////////////////////////////
	|ВЫБРАТЬ
	|	втПутевыеЛистыТ.Ссылка КАК Ссылка,
	|	втПутевыеЛистыТ.ВремяРаботыОтопителя КАК Количество,
	|	УпТранспортныеСредства_ВидыГСМТ.ВидГСМ КАК ВидГСМ,
	|	УпНормыРасходаГСМ_СрезПоследнихТ.ТипРасходаОтопитель КАК ТипРасхода,
	|	УпНормыРасходаГСМ_СрезПоследнихТ.РасходОтопитель КАК Расход
	|ИЗ
	|	втПутевыеЛисты КАК втПутевыеЛистыТ
	|	ЛЕВОЕ СОЕДИНЕНИЕ втПутевыеЛистыСНадбавками КАК втПутевыеЛистыСНадбавкамиТ
	|	ПО втПутевыеЛистыСНадбавкамиТ.Ссылка = втПутевыеЛистыТ.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.упТранспортныеСредства.УдалитьВидыГСМ КАК УпТранспортныеСредства_ВидыГСМТ
	|	ПО втПутевыеЛистыТ.ТранспортноеСредство = УпТранспортныеСредства_ВидыГСМТ.Ссылка
	|		И УпТранспортныеСредства_ВидыГСМТ.Основной
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упНормыРасходаГСМ.СрезПоследних(
	|		,
	|		) КАК УпНормыРасходаГСМ_СрезПоследнихТ
	|	ПО ИСТИНА
	|		И втПутевыеЛистыТ.Организация = УпНормыРасходаГСМ_СрезПоследнихТ.Организация
	|		И втПутевыеЛистыТ.Подразделение = УпНормыРасходаГСМ_СрезПоследнихТ.Подразделение
	|		И УпТранспортныеСредства_ВидыГСМТ.ВидГСМ = УпНормыРасходаГСМ_СрезПоследнихТ.ВидГСМ
	|		И втПутевыеЛистыТ.ТранспортноеСредство = УпНормыРасходаГСМ_СрезПоследнихТ.ОбъектНормРасхода
	|ГДЕ втПутевыеЛистыСНадбавкамиТ.Ссылка ЕСТЬ NULL
	|";

	
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоУспех = 0;
	КоличествоНеудача = 0;
	Пока Выборка.Следующий() Цикл
		ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
		НормыРасходаГСМ = ДокументОбъект.НормыРасходаГСМ;
		НоваяСтрока = НормыРасходаГСМ.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, Выборка);
		НоваяСтрока.ВидЭксплуатационнойНормы = Перечисления.упВидыЭксплуатационныхНормРасходаГСМ.Отопитель;
		
		Попытка
			ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
			КоличествоУспех = КоличествоУспех + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать документ'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоНеудача = КоличествоНеудача + 1;    
		КонецПопытки;
		
		
	КонецЦикла; 

	Комментарий = Нстр("ru = 'Количество документов: успешно обработано-%1, не удалось записать-%2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоУспех, 
	КоличествоНеудача);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //ЗаполнитьНадбавкуРасходаТопливаОтопитель()

// Вызывается при переходе на версию конфигурации 3.0.5.74
//
Процедура ОбновитьСоставПараметровВариантовНастроекУправленияРемонтами(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	упВариантыНастроек.Ссылка
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = &Объект
	|";
	Запрос.УстановитьПараметр("Объект", "Обработка.упРМУправлениеРемонтами.ПараметрыУправленияРемонтами");
	ВариантыНастроек = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку(0); 
	Этап = "Обновление состава параметров вариантов настроек управления ремонтами";
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Начало", УровеньЖурналаРегистрации.Предупреждение,,, Этап);	
	текНеУдалосьОбработатьОбъектов = 0;
	ПараметрыПоУмолчанию = упВариантыНастроек.ПараметрыУправленияРемонтамиПоУмолчанию();
	Для Каждого Ссылка Из ВариантыНастроек Цикл
		Если Ложь Тогда // Для контекстной подсказки
		    Ссылка = Справочники.упВариантыНастроек.ПустаяСсылка();
		КонецЕсли;
		СправочникОбъект = Ссылка.ПолучитьОбъект();
		ХранимыеНастройки = СправочникОбъект.Настройки.Получить();
		Если Ложь Тогда // Для контекстной подсказки
		    ХранимыеНастройки = Новый Структура;
		КонецЕсли;
		Попытка
			НадоЗаписать = упСервисныеФункцииКлиентСервер.ДобавитьНедостающиеЭлементыСтруктуру(ПараметрыПоУмолчанию, ХранимыеНастройки);
			Если НадоЗаписать Тогда
				СправочникОбъект.Настройки = Новый ХранилищеЗначения(ХранимыеНастройки);
				СправочникОбъект.Записать();
			КонецЕсли; 
		Исключение
			ОписаниеОшибки = ОписаниеОшибки();
			текПредставление = "" + Ссылка;
			ТекстСообщения = Нстр("ru = 'Ошибка обработка объекта ""%1"": %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			текНеУдалосьОбработатьОбъектов = текНеУдалосьОбработатьОбъектов + 1;
			ЗаписьЖурналаРегистрации("ОшибкаОбработки", УровеньЖурналаРегистрации.Ошибка,, Ссылка, ТекстСообщения, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			Продолжить;
		КонецПопытки; 
	КонецЦикла; 
	Если текНеУдалосьОбработатьОбъектов > 0 Тогда
		ТекстСообщения = Нстр("ru = 'Не удалось обработать объектов: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текНеУдалосьОбработатьОбъектов);
	Иначе
		ТекстСообщения = Нстр("ru = 'Все объекты были обработаны: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, ВариантыНастроек.Количество());
	КонецЕсли;
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Конец", УровеньЖурналаРегистрации.Предупреждение,,, Этап + Символы.ПС + ТекстСообщения);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.5.76
//
Процедура ОбновитьОбъектРемонтаВДокументахРемонтИТОТС(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	Этап	= Нстр("ru = 'Заполнение объекта ремонта в документах ""Ремонт (ТО)""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	упРемонтИТОТС.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.упРемонтИТОТС КАК упРемонтИТОТС
	|ГДЕ
	|	упРемонтИТОТС.ОбъектРемонта = ЗНАЧЕНИЕ(Перечисление.упОбъектыРемонта.ПустаяСсылка)
	|	И НЕ упРемонтИТОТС.ТранспортноеСредство = ЗНАЧЕНИЕ(Справочник.упТранспортныеСредства.ПустаяСсылка)
	|	И НЕ упРемонтИТОТС.ПометкаУдаления";
	РезультатЗапроса = Запрос.Выполнить();
	Если Не РезультатЗапроса.Пустой() Тогда		
		Выборка	= РезультатЗапроса.Выбрать();
		КоличествоЗаписей 					= 0;
		КоличествоЗаписейОшибкаПриЗаписи	= 0;
		Пока Выборка.Следующий() Цикл
			РемонтОбъект = Выборка.Ссылка.ПолучитьОбъект();
			РемонтОбъект.ОбъектРемонта = Перечисления.упОбъектыРемонта.ТранспортноеСредство;
			Попытка
				РемонтОбъект.Записать(РежимЗаписиДокумента.Запись);
				КоличествоЗаписей = КоличествоЗаписей + 1;
			Исключение
				КоличествоЗаписейОшибкаПриЗаписи = КоличествоЗаписейОшибкаПриЗаписи + 1;
				ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ТекстОшибки) Тогда 
					ТекстОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка, ,Выборка.Ссылка, ТекстОшибки);
			КонецПопытки;
		КонецЦикла; 
	КонецЕсли;
	
	Комментарий = НСтр("ru = 'Количество элементов: успешно изменено-%1, не удалось записать-%2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписей, КоличествоЗаписейОшибкаПриЗаписи);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.5.79
//
Процедура ЗаполнитьПорядокИсполненияВВидеПеревозки(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	
	Этап	= Нстр("ru = 'Заполнение реквизитов ""Порядок исполнения заявки"" и ""Вид транспортной услуги"" в виде перевозки'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"
	|ВЫБРАТЬ
	|	упВидыПеревозок.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.упВидыПеревозок КАК упВидыПеревозок
	|ГДЕ ЛОЖЬ
	|	ИЛИ упВидыПеревозок.ПорядокИсполненияЗаявки = ЗНАЧЕНИЕ(Перечисление.упПорядокИсполненияЗаявок.ПустаяСсылка)
	|	ИЛИ упВидыПеревозок.ВидТранспортнойУслуги = ЗНАЧЕНИЕ(Перечисление.упВидыТранспортныхУслуг.ПустаяСсылка)
	|";
	
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	Пока Выборка.Следующий() Цикл
		
		ВидПеревозкиОбъект = Выборка.Ссылка.ПолучитьОбъект();
		ВидПеревозкиОбъект.ПорядокИсполненияЗаявки = Перечисления.упПорядокИсполненияЗаявок.Рейсом;
		ВидПеревозкиОбъект.ВидТранспортнойУслуги   = Перечисления.упВидыТранспортныхУслуг.ПеревозкаГрузов;
		Попытка
			ВидПеревозкиОбъект.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			КоличествоОшибка = КоличествоОшибка + 1;
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось изменить вид перевозки'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,,Выборка.Ссылка, ОписаниеОшибки); 
		КонецПопытки;
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество элементов: успешно обработано-%1, не удалось записать-%2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //ЗаполнитьПорядокИсполненияВВидеПеревозки()

// Вызывается при переходе на версию конфигурации 3.0.5.80
//
Процедура ЗаполнитьПорядокИсполненияВДокументеЗапросУсловийПеревозки(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	
	// Запрос условий перевозки.
	Этап	= Нстр("ru = 'Заполнение реквизитов ""Порядок исполнения заявки"" и ""Вид транспортной услуги"" в документе ""Запрос условий перевозки""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"
	|ВЫБРАТЬ
	|	упЗапросУсловийПеревозкиТ.Ссылка КАК Ссылка,
	|	упЗапросУсловийПеревозкиТ.ВидПеревозки.ВидТранспортнойУслуги КАК ВидТранспортнойУслуги,
	|	упЗапросУсловийПеревозкиТ.ВидПеревозки.ПорядокИсполненияЗаявки КАК ПорядокИсполненияЗаявки
	|ИЗ
	|	Документ.упЗапросУсловийПеревозки КАК упЗапросУсловийПеревозкиТ
	|ГДЕ ИСТИНА
	|	И НЕ (упЗапросУсловийПеревозкиТ.ПометкаУдаления)
	|	И (ЛОЖЬ
	|		ИЛИ упЗапросУсловийПеревозкиТ.ВидТранспортнойУслуги В (ЗНАЧЕНИЕ(Перечисление.упВидыТранспортныхУслуг.ПустаяСсылка))
	|		ИЛИ упЗапросУсловийПеревозкиТ.ПорядокИсполненияЗаявки В (ЗНАЧЕНИЕ(Перечисление.упПорядокИсполненияЗаявок.ПустаяСсылка)))
	|";

	
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	Пока Выборка.Следующий() Цикл
		
		ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
		ДокументОбъект.ПорядокИсполненияЗаявки = Выборка.ПорядокИсполненияЗаявки;
		ДокументОбъект.ВидТранспортнойУслуги   = Выборка.ВидТранспортнойУслуги;
		ДокументОбъект.ДополнительныеСвойства.Вставить("НеРегистрироватьСобытие", Истина);

		Попытка
			ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			КоличествоОшибка = КоличествоОшибка + 1;
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось изменить записать документ'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,,Выборка.Ссылка, ОписаниеОшибки); 
		КонецПопытки;
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество документов: успешно обработано-%1, не удалось записать-%2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.5.80
//
Процедура ЗаполнитьПорядокИсполненияВДокументеЗаявкаНаПеревозкуГруза(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");

	// Заявка на перевозку груза.
	Этап	= Нстр("ru = 'Заполнение реквизитов ""Порядок исполнения заявки"" и ""Вид транспортной услуги"" в документе ""Заявка на перевозку груза""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"
	|ВЫБРАТЬ
	|	упЗаявкаНаПеревозкуГруза.Ссылка КАК Ссылка,
	|	упЗаявкаНаПеревозкуГруза.ВидПеревозки.ВидТранспортнойУслуги КАК ВидТранспортнойУслуги,
	|	упЗаявкаНаПеревозкуГруза.ВидПеревозки.ПорядокИсполненияЗаявки КАК ПорядокИсполненияЗаявки
	|ИЗ
	|	Документ.упЗаявкаНаПеревозкуГруза КАК упЗаявкаНаПеревозкуГруза
	|ГДЕ ИСТИНА
	|	И НЕ (упЗаявкаНаПеревозкуГруза.ПометкаУдаления)
	|	И (ЛОЖЬ
	|		ИЛИ упЗаявкаНаПеревозкуГруза.ВидТранспортнойУслуги = ЗНАЧЕНИЕ(Перечисление.упВидыТранспортныхУслуг.ПустаяСсылка)
	|		ИЛИ упЗаявкаНаПеревозкуГруза.ПорядокИсполненияЗаявки = ЗНАЧЕНИЕ(Перечисление.упПорядокИсполненияЗаявок.ПустаяСсылка))
	|";

	
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	Пока Выборка.Следующий() Цикл
		
		ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
		ДокументОбъект.ПорядокИсполненияЗаявки = Выборка.ПорядокИсполненияЗаявки;
		ДокументОбъект.ВидТранспортнойУслуги   = Выборка.ВидТранспортнойУслуги;
		ДокументОбъект.ДополнительныеСвойства.Вставить("НеРегистрироватьСобытие", Истина);
		Попытка
			ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			КоличествоОшибка = КоличествоОшибка + 1;
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось изменить записать документ'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,,Выборка.Ссылка, ОписаниеОшибки); 
		КонецПопытки;
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество документов: успешно обработано-%1, не удалось записать-%2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.5.80
//
Процедура ЗаполнитьПорядокИсполненияВДокументеЗаданиеНаПеревозкуГруза(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	
	// Задание на перевозку груза.
	Этап	= Нстр("ru = 'Заполнение реквизитов ""Вид транспортной услуги"" в документе ""Задание на перевозку груза""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"
	|ВЫБРАТЬ
	|	упЗаданиеНаПеревозкуГруза.Ссылка КАК Ссылка,
	|	упЗаданиеНаПеревозкуГруза.ВидПеревозки.ВидТранспортнойУслуги КАК ВидТранспортнойУслуги
	|ИЗ
	|	Документ.упЗаданиеНаПеревозкуГруза КАК упЗаданиеНаПеревозкуГруза
	|ГДЕ ИСТИНА
	|	И НЕ (упЗаданиеНаПеревозкуГруза.ПометкаУдаления)
	|	И упЗаданиеНаПеревозкуГруза.ВидТранспортнойУслуги = ЗНАЧЕНИЕ(Перечисление.упВидыТранспортныхУслуг.ПустаяСсылка)
	|";
	
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	Пока Выборка.Следующий() Цикл
		
		ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
		ДокументОбъект.ВидТранспортнойУслуги   = Выборка.ВидТранспортнойУслуги;
		ДокументОбъект.ДополнительныеСвойства.Вставить("НеРегистрироватьСобытие", Истина);
		Попытка
			ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			КоличествоОшибка = КоличествоОшибка + 1;
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось изменить записать документ'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,,Выборка.Ссылка, ОписаниеОшибки); 
		КонецПопытки;
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество документов: успешно обработано-%1, не удалось записать-%2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);

КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.5.80
//
Процедура ЗаполнитьПорядокИсполненияВДокументеРейс(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	// Рейс.
	Этап	= Нстр("ru = 'Заполнение реквизитов ""Порядок исполнения заявки"" и ""Вид транспортной услуги"" в документе ""Рейс""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"
	|ВЫБРАТЬ
	|	упРейс.Ссылка КАК Ссылка,
	|	упРейс.ВидПеревозки.ВидТранспортнойУслуги КАК ВидТранспортнойУслуги,
	|	упРейс.ВидПеревозки.ПорядокИсполненияЗаявки КАК ПорядокИсполненияЗаявки
	|ИЗ
	|	Документ.упРейс КАК упРейс
	|ГДЕ ИСТИНА
	|	И НЕ (упРейс.ПометкаУдаления)
	|	И (ЛОЖЬ
	|		ИЛИ упРейс.ВидТранспортнойУслуги = ЗНАЧЕНИЕ(Перечисление.упВидыТранспортныхУслуг.ПустаяСсылка)
	|		ИЛИ упРейс.ПорядокИсполненияЗаявки = ЗНАЧЕНИЕ(Перечисление.упПорядокИсполненияЗаявок.ПустаяСсылка))
	|";


	
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	Пока Выборка.Следующий() Цикл
		
		ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
		ДокументОбъект.ПорядокИсполненияЗаявки = Выборка.ПорядокИсполненияЗаявки;
		ДокументОбъект.ВидТранспортнойУслуги   = Выборка.ВидТранспортнойУслуги;
		ДокументОбъект.ДополнительныеСвойства.Вставить("НеРегистрироватьСобытие", Истина);		
		Попытка
			ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			КоличествоОшибка = КоличествоОшибка + 1;
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось изменить записать документ'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,,Выборка.Ссылка, ОписаниеОшибки); 
		КонецПопытки;
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество документов: успешно обработано-%1, не удалось записать-%2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.5.80
//
Процедура ЗаполнитьПорядокИсполненияВДокументеПутевойЛист(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	
	// Путевой лист.
	Этап	= Нстр("ru = 'Заполнение реквизитов ""Вид транспортной услуги"" в документе ""Путевой лист""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"
	|ВЫБРАТЬ
	|	упПутевойЛист.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.упПутевойЛист КАК упПутевойЛист
	|ГДЕ ИСТИНА
	|	И НЕ (упПутевойЛист.ПометкаУдаления)
	|	И упПутевойЛист.ВидТранспортнойУслуги = ЗНАЧЕНИЕ(Перечисление.упВидыТранспортныхУслуг.ПустаяСсылка)
	|";
	
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	Пока Выборка.Следующий() Цикл
		
		ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
		Попытка
			ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
			ДокументОбъект.ДополнительныеСвойства.Вставить("НеРегистрироватьСобытие", Истина);			
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			КоличествоОшибка = КоличествоОшибка + 1;
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось изменить записать документ'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,,Выборка.Ссылка, ОписаниеОшибки); 
		КонецПопытки;
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество документов: успешно обработано-%1, не удалось записать-%2'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.5.88
//
Процедура ВключитьИспользованиеДопРеквизитовРаспределениеПрочихРасходов(Параметры = Неопределено) Экспорт
	
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упРаспределениеПрочихРасходов", Новый Структура("Используется", Истина));
	
КонецПроцедуры //ВключитьИспользованиеДопРеквизитовРаспределениеПрочихРасходов()

// Вызывается при переходе на версию конфигурации 3.0.5.90
//
Процедура ВключититьИспользованиеВидовТранспортныхУслуг(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Включение настроек ""Используются заявки на пассажирские перевозки"" и ""Используются заявки на спецтехнику""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Если ПолучитьФункциональнуюОпцию("упИспользуетсяГлобальнаяПодсистемаУправлениеПеревозками") Тогда
		
		сткВидыПеревозок = Справочники.упВидыПеревозок.ЕстьУслугиСпецтехникиИлиПассажирПеревозки();
		Если сткВидыПеревозок.ЕстьПассажирскиеПеревозки Тогда
			Константы.упИспользуютсяЗаявкиНаПассажирскиеПеревозки.Установить(Истина);	
		КонецЕсли;
		
		Если сткВидыПеревозок.ЕстьУслугиСпецтехники Тогда
			Константы.упИспользуютсяЗаявкиНаСпецтехнику.Установить(Истина);	
		КонецЕсли;
		
	КонецЕсли;
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,,);
	
КонецПроцедуры //ВключититьИспользованиеВидовТранспортныхУслуг()

// Вызывается при переходе на версию конфигурации 3.0.5.92
//
Процедура ПереносДанныхВРСВидыГСМ(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	
	Этап	= Нстр("ru = 'Перенос данных из табличной части ""ВидыГСМ"" транспортного средства в регистр сведений ""ВидыГСМТранспортногоСредства""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"
	|ВЫБРАТЬ
	|	упТранспортныеСредстваУдалитьВидыГСМ.ВидГСМ КАК ВидГСМ,
	|	упТранспортныеСредстваУдалитьВидыГСМ.ОбъемБака КАК ОбъемБака,
	|	упТранспортныеСредстваУдалитьВидыГСМ.Основной КАК Основной,
	|	упТранспортныеСредстваУдалитьВидыГСМ.ПроцентИспользования КАК ПроцентИспользования,
	|	упТранспортныеСредстваУдалитьВидыГСМ.Ссылка КАК ТранспортноеСредство
	|ИЗ
	|	Справочник.упТранспортныеСредства.УдалитьВидыГСМ КАК упТранспортныеСредстваУдалитьВидыГСМ
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упВидыГСМТранспортныхСредств.СрезПоследних КАК упВидыГСМТранспортныхСредствСрезПоследних
	|		ПО упТранспортныеСредстваУдалитьВидыГСМ.Ссылка = упВидыГСМТранспортныхСредствСрезПоследних.ТранспортноеСредство
	|			И упТранспортныеСредстваУдалитьВидыГСМ.ВидГСМ = упВидыГСМТранспортныхСредствСрезПоследних.ВидГСМ
	|ГДЕ
	|	упВидыГСМТранспортныхСредствСрезПоследних.ТранспортноеСредство ЕСТЬ NULL
	|";
	
	
	
	Выборка	= Запрос.Выполнить().Выбрать();
	ТекущийПериод = ТекущаяДатаСеанса();
	КоличествоЗаписей = 0;
	КоличествоЗаписейУспешно = 0;
	КоличествоЗаписейОшибка  = 0;
	
	Пока Выборка.Следующий() Цикл
		
		КоличествоЗаписей = КоличествоЗаписей + 1;
		
		Запись = РегистрыСведений.упВидыГСМТранспортныхСредств.СоздатьМенеджерЗаписи();
		ЗаполнитьЗначенияСвойств(Запись, Выборка);
		Запись.Период = ТекущийПериод;
		Запись.Используется = Истина;
		
		Попытка
			Запись.Записать();
			КоличествоЗаписейУспешно = КоличествоЗаписейУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать запись по ТС:%1 и виду ГСМ:%2'");
			СтрШаблон(Событие, Выборка.ТранспортноеСредство, Выборка.ВидГСМ);
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоЗаписейОшибка = КоличествоЗаписейОшибка + 1;    
		КонецПопытки;
		
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество записей: успешно обработано-%1, не удалось записать-%2, всего-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоЗаписейУспешно, 
	КоличествоЗаписейОшибка, КоличествоЗаписей);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
	
КонецПроцедуры //ПереносДанныхВРСВидыГСМ()

// Вызывается при переходе на версию конфигурации 3.0.5.93
//
Процедура СформироватьДвиженияСостоянияОборудования(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
	
	Этап = Нстр("ru = 'Выполнить установку Состояния Оборудования'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упСостоянияОборудованияСрезПоследних.Оборудование КАК Оборудование
	|ПОМЕСТИТЬ вт_ТекущиеСостояния
	|ИЗ
	|	РегистрСведений.упСостоянияОборудования.СрезПоследних КАК упСостоянияОборудованияСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	упАгрегатыТранспортныхСредствСрезПоследних.Агрегат КАК Агрегат,
	|	упАгрегатыТранспортныхСредствСрезПоследних.ТранспортноеСредство КАК ТранспортноеСредство,
	|	упАгрегатыТранспортныхСредствСрезПоследних.Операция КАК Операция,
	|	упАгрегатыТранспортныхСредствСрезПоследних.Период КАК Период
	|ИЗ
	|	РегистрСведений.упАгрегатыТранспортныхСредств.СрезПоследних(
	|			,
	|			НЕ Агрегат В
	|					(ВЫБРАТЬ
	|						вт_ТекущиеСостояния.Оборудование КАК Оборудование
	|					ИЗ
	|						вт_ТекущиеСостояния КАК вт_ТекущиеСостояния)) КАК упАгрегатыТранспортныхСредствСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	упСписаниеАгрегатовАгрегаты.Агрегат КАК Агрегат,
	|	упАгрегатыНаСкладах.Склад КАК Склад,
	|	упАгрегатыНаСкладах.Количество КАК Количество,
	|	упАгрегатыНаСкладах.Период КАК Период
	|ПОМЕСТИТЬ вт_Списанные
	|ИЗ
	|	Документ.упСписаниеАгрегатов.Агрегаты КАК упСписаниеАгрегатовАгрегаты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.упАгрегатыНаСкладах КАК упАгрегатыНаСкладах
	|		ПО упСписаниеАгрегатовАгрегаты.Агрегат = упАгрегатыНаСкладах.Агрегат
	|			И упСписаниеАгрегатовАгрегаты.Ссылка = упАгрегатыНаСкладах.Регистратор
	|ГДЕ
	|	НЕ упСписаниеАгрегатовАгрегаты.Агрегат В
	|				(ВЫБРАТЬ
	|					вт_ТекущиеСостояния.Оборудование КАК Оборудование
	|				ИЗ
	|					вт_ТекущиеСостояния КАК вт_ТекущиеСостояния)
	|	И упСписаниеАгрегатовАгрегаты.Ссылка.Проведен
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДопОборудование.ДополнительноеОборудование,
	|	упАгрегатыНаСкладах.Склад,
	|	упАгрегатыНаСкладах.Количество,
	|	упАгрегатыНаСкладах.Период
	|ИЗ
	|	Документ.упСписаниеАгрегатов.ДополнительноеОборудование КАК ДопОборудование
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.упАгрегатыНаСкладах КАК упАгрегатыНаСкладах
	|		ПО ДопОборудование.Ссылка = упАгрегатыНаСкладах.Регистратор
	|			И ДопОборудование.ДополнительноеОборудование = упАгрегатыНаСкладах.Агрегат
	|ГДЕ
	|	НЕ ДопОборудование.ДополнительноеОборудование В
	|				(ВЫБРАТЬ
	|					вт_ТекущиеСостояния.Оборудование КАК Оборудование
	|				ИЗ
	|					вт_ТекущиеСостояния КАК вт_ТекущиеСостояния)
	|	И ДопОборудование.Ссылка.Проведен
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	упАгрегатыНаСкладах.Агрегат КАК Агрегат,
	|	упАгрегатыНаСкладах.Склад КАК Склад,
	|	МАКСИМУМ(упАгрегатыНаСкладах.Период) КАК Период
	|ПОМЕСТИТЬ вт_Период
	|ИЗ
	|	РегистрНакопления.упАгрегатыНаСкладах КАК упАгрегатыНаСкладах
	|ГДЕ
	|	упАгрегатыНаСкладах.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|
	|СГРУППИРОВАТЬ ПО
	|	упАгрегатыНаСкладах.Агрегат,
	|	упАгрегатыНаСкладах.Склад
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	упАгрегатыНаСкладахОстатки.Агрегат КАК Агрегат,
	|	упАгрегатыНаСкладахОстатки.Склад КАК Склад,
	|	упАгрегатыНаСкладахОстатки.КоличествоОстаток КАК Количество,
	|	ЛОЖЬ КАК Списано,
	|	ЕСТЬNULL(вт_Период.Период, &ПериодСостояния) КАК Период
	|ИЗ
	|	РегистрНакопления.упАгрегатыНаСкладах.Остатки(
	|			,
	|			НЕ Агрегат В
	|					(ВЫБРАТЬ
	|						вт_ТекущиеСостояния.Оборудование КАК Оборудование
	|					ИЗ
	|						вт_ТекущиеСостояния КАК вт_ТекущиеСостояния)) КАК упАгрегатыНаСкладахОстатки
	|		ЛЕВОЕ СОЕДИНЕНИЕ вт_Период КАК вт_Период
	|		ПО упАгрегатыНаСкладахОстатки.Агрегат = вт_Период.Агрегат
	|			И упАгрегатыНаСкладахОстатки.Склад = вт_Период.Склад
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	вт_Списанные.Агрегат,
	|	вт_Списанные.Склад,
	|	вт_Списанные.Количество,
	|	ИСТИНА,
	|	вт_Списанные.Период
	|ИЗ
	|	вт_Списанные КАК вт_Списанные";
	
	ДатаДокумента = ТекущаяДатаСеанса();
	Запрос.УстановитьПараметр("ПериодСостояния", ДатаДокумента);
	ПакетЗапросов = Запрос.ВыполнитьПакет();
	Если НЕ ПакетЗапросов[1].Пустой() ИЛИ НЕ ПакетЗапросов[4].Пустой() Тогда
		ОбъектДокумента = Документы.упИзменениеСостоянийОборудования.СоздатьДокумент();
		ОбъектДокумента.Дата = ДатаДокумента;
		ОбъектДокумента.Автор = ПользователиКлиентСервер.ТекущийПользователь();
		МассивСнято = Новый Массив;
		ТаблицаДанныхСклада = ПакетЗапросов[4].Выгрузить();
		КопияДанныхСклада = ТаблицаДанныхСклада.Скопировать();
		КопияДанныхСклада.Сортировать("Период УБЫВ");
		Для каждого ТекущаястрокаДанных Из ТаблицаДанныхСклада Цикл			
			ОтборПоСтрокам = Новый Структура();
			ОтборПоСтрокам.Вставить("Агрегат", ТекущаястрокаДанных.Агрегат);
			ОтборПоСтрокам.Вставить("Склад", ТекущаястрокаДанных.Склад);
			НайденныеСтроки = КопияДанныхСклада.НайтиСтроки(ОтборПоСтрокам);
			ПерейдемКСледующей = Ложь;
			Для каждого СтрокаПроверки Из НайденныеСтроки Цикл		
				Если СтрокаПроверки.Период > ТекущаястрокаДанных.Период Тогда
					ПерейдемКСледующей = Истина;
					Прервать;
				КонецЕсли;
			КонецЦикла;
			Если ПерейдемКСледующей Тогда
				Продолжить;
			КонецЕсли;				
			НоваяСтрока = ОбъектДокумента.Оборудование.Добавить();
			НоваяСтрока.ДатаИзмененияСостояния=ТекущаястрокаДанных.Период;
			НоваяСтрока.Оборудование=ТекущаястрокаДанных.Агрегат;
			НоваяСтрока.Состояние=Справочники.упСостоянияОборудования.ОприходованоНаСклад;
			Если ТекущаястрокаДанных.Списано Тогда
				НоваяСтрока.Состояние=Справочники.упСостоянияОборудования.Списано;
			КонецЕсли;
			НоваяСтрока.ТранспортноеСредство=Справочники.упТранспортныеСредства.ПустаяСсылка();
			НоваяСтрока.Склад=ТекущаястрокаДанных.Склад;
			МассивСнято.Добавить(ТекущаястрокаДанных.Агрегат);
		КонецЦикла;
		Выборка = ПакетЗапросов[1].Выбрать();
		Пока Выборка.Следующий() Цикл
			Если Выборка.Операция = Перечисления.упТипыОперацийМонтажа.Снято
				И НЕ МассивСнято.Найти(Выборка.Агрегат)=Неопределено Тогда
				Продолжить;
			КонецЕсли;
			НоваяСтрока = ОбъектДокумента.Оборудование.Добавить();
			НоваяСтрока.ДатаИзмененияСостояния=Выборка.Период;
			НоваяСтрока.Оборудование=Выборка.Агрегат;
			НоваяСтрока.Состояние=Справочники.упСостоянияОборудования.УстановленоНаТС;
			Если Выборка.Операция = Перечисления.упТипыОперацийМонтажа.Снято Тогда
				НоваяСтрока.Состояние=Справочники.упСостоянияОборудования.Списано;
			КонецЕсли;
			НоваяСтрока.ТранспортноеСредство=Выборка.ТранспортноеСредство;
			НоваяСтрока.Склад=Справочники.упСклады.ПустаяСсылка();
		КонецЦикла;
		Попытка
			ОбъектДокумента.Записать(РежимЗаписиДокумента.Запись);
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки);
		КонецПопытки;
	КонецЕсли;
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,,);
	
КонецПроцедуры //СформироватьДвиженияСостоянияОборудования()

// Вызывается при переходе на версию конфигурации 3.0.5.95
//
Процедура ПереносДанныхИзПробегиТСВНаработкуОборудования(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Перенос данных по доп. оборудованию из регистра накопления ""Пробеги ТС"" в регистр ""Наработки оборудования""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |	упПробегТС.Регистратор КАК Регистратор
	               |ИЗ
	               |	РегистрНакопления.упПробегТС КАК упПробегТС
	               |ГДЕ
	               |	упПробегТС.ТранспортноеСредство ССЫЛКА Справочник.упДополнительноеОборудование";

	КоличествоВсего   = 0;
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	
	ВыборкаРегистратор	= Запрос.Выполнить().Выбрать();
	Пока ВыборкаРегистратор.Следующий() Цикл
		
		КоличествоВсего = КоличествоВсего + 1;
		
		Отказ = Ложь;
		
		РегистраторТекущий = ВыборкаРегистратор.Регистратор;
		
		НачатьТранзакцию(РежимУправленияБлокировкойДанных.Управляемый);
		
		НаборЗаписейНаработкаОборудования = РегистрыНакопления.упНаработкаОборудования.СоздатьНаборЗаписей();
		НаборЗаписейНаработкаОборудования.Отбор.Регистратор.Установить(РегистраторТекущий);
			
		НаборЗаписейПробегТС = РегистрыНакопления.упПробегТС.СоздатьНаборЗаписей();
		НаборЗаписейПробегТС.Отбор.Регистратор.Установить(РегистраторТекущий);
		НаборЗаписейПробегТС.Прочитать();
		
		мсвЗаписейДляУдаления = Новый Массив;
		Для каждого Запись Из НаборЗаписейПробегТС Цикл
			Если ТипЗнч(Запись.ТранспортноеСредство) = Тип("СправочникСсылка.упДополнительноеОборудование") Тогда
				мсвЗаписейДляУдаления.Добавить(Запись);	
				ЗаписьНаработка = НаборЗаписейНаработкаОборудования.Добавить();
				ЗаполнитьЗначенияСвойств(ЗаписьНаработка, Запись);
				ЗаписьНаработка .Оборудование = Запись.ТранспортноеСредство;
			КонецЕсли;
		КонецЦикла;
		
		Для каждого Запись Из мсвЗаписейДляУдаления Цикл
			НаборЗаписейПробегТС.Удалить(Запись);
		КонецЦикла;
		
		Попытка
			НаборЗаписейПробегТС.Записать();
			НаборЗаписейНаработкаОборудования.Записать();
			ЗафиксироватьТранзакцию();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОтменитьТранзакцию();
			ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ТекстОшибки) Тогда 
				ТекстОшибки = ОписаниеОшибки();
			КонецЕсли;
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстОшибки, ,,,Отказ);
			//ЗаписьЖурналаРегистрации("Ошибка при переносе пробег по допоборудованию", УровеньЖурналаРегистрации.Ошибка, ,, ТекстОшибки);
			КоличествоОшибка = КоличествоОшибка + 1;
		КонецПопытки;
	
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество документов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //ПереносДанныхИзПробегиТСВНаработкуОборудования()

// Вызывается при переходе на версию конфигурации 3.0.5.97
//
Процедура ОбновитьСхемуКомпоновкиВВариантахРаспределений(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Обновляется схема компоновки данных в вариантах распределений'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	упВариантыРаспределенияРасходов.СхемаКомпоновкиДанных КАК СхемаКомпоновкиДанных,
	|	упВариантыРаспределенияРасходов.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.упВариантыРаспределенияРасходов КАК упВариантыРаспределенияРасходов
	|ГДЕ
	|	НЕ упВариантыРаспределенияРасходов.ПометкаУдаления";
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоВсего   = 0;
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	
	Пока Выборка.Следующий() Цикл
		
		КоличествоВсего = КоличествоВсего + 1;
		
		ВариантРаспределения = Выборка.Ссылка.ПолучитьОбъект();
				
		СхемаКомпоновкиДанных = ВариантРаспределения.СхемаКомпоновкиДанных.Получить();
		СхемаКомпоновкиДанныхНовая = Справочники.упВариантыРаспределенияРасходов.ПолучитьМакет("Рейс");
		Если СхемаКомпоновкиДанныхНовая  <> Неопределено Тогда 
			упСервисныеФункцииВызовСервера.СкопироватьЭлементы(СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.Отбор, СхемаКомпоновкиДанных.НастройкиПоУмолчанию.Отбор);
			упСервисныеФункцииВызовСервера.ЗаполнитьЭлементы(СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.ПараметрыДанных, СхемаКомпоновкиДанных.НастройкиПоУмолчанию.ПараметрыДанных);
		КонецЕсли;
		
		ВариантРаспределения.СхемаКомпоновкиДанных = Новый ХранилищеЗначения(СхемаКомпоновкиДанныхНовая);
		
		Попытка
			ВариантРаспределения.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			КоличествоОшибка = КоличествоОшибка + 1;
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать вариант распределения'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
		КонецПопытки;

	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество элементов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //ОбновитьСхемуКомпоновкиВВариантахРаспределений()

// Вызывается при переходе на версию конфигурации 3.0.5.100
//
Процедура ОбновитьСхемуКомпоновкиВВариантахРаспределенийПерезаполнитьПараметры(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Обновляется схема компоновки данных в вариантах распределений'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	упВариантыРаспределенияРасходов.СхемаКомпоновкиДанных КАК СхемаКомпоновкиДанных,
	|	упВариантыРаспределенияРасходов.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.упВариантыРаспределенияРасходов КАК упВариантыРаспределенияРасходов
	|ГДЕ
	|	НЕ упВариантыРаспределенияРасходов.ПометкаУдаления";
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоВсего   = 0;
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	
	ПараметрАналитическийРазрез     = Новый ПараметрКомпоновкиДанных("АналитическийРазрез");
	ПараметрНаправлениеДеятельности = Новый ПараметрКомпоновкиДанных("НаправлениеДеятельности");
	ПараметрИспользуетсяОтборПоАналитическомуРазрезу   = Новый ПараметрКомпоновкиДанных("ИспользуетсяОтборПоАналитическомуРазрезу");
	ПараметрИспользуетсяОтборПоНаправлениюДеятельности = Новый ПараметрКомпоновкиДанных("ИспользуетсяОтборПоНаправлениюДеятельности");
	
	
	Пока Выборка.Следующий() Цикл
		
		КоличествоВсего = КоличествоВсего + 1;
		
		ВариантРаспределения = Выборка.Ссылка.ПолучитьОбъект();
				
		СхемаКомпоновкиДанных = ВариантРаспределения.СхемаКомпоновкиДанных.Получить();
		СхемаКомпоновкиДанныхНовая = Справочники.упВариантыРаспределенияРасходов.ПолучитьМакет("Рейс");
		Если СхемаКомпоновкиДанныхНовая  <> Неопределено Тогда 
			упСервисныеФункцииВызовСервера.СкопироватьЭлементы(СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.Отбор, СхемаКомпоновкиДанных.НастройкиПоУмолчанию.Отбор);
			ПараметрыДанных      = СхемаКомпоновкиДанных.НастройкиПоУмолчанию.ПараметрыДанных;
			ПараметрыДанныхНовые = СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.ПараметрыДанных;
			
			ЗначениеПараметраАналитическийРазрез = ПараметрыДанных.НайтиЗначениеПараметра(ПараметрАналитическийРазрез);
			ЗначениеПараметраПараметрИспользуетсяОтборПоАналитическомуРазрезу = ПараметрыДанныхНовые.НайтиЗначениеПараметра(ПараметрИспользуетсяОтборПоАналитическомуРазрезу);
			Если Истина
				И ЗначениеПараметраАналитическийРазрез <> Неопределено
				И ЗначениеПараметраПараметрИспользуетсяОтборПоАналитическомуРазрезу <> Неопределено
			Тогда
				ЗначениеПараметраПараметрИспользуетсяОтборПоАналитическомуРазрезу.Использование = ЗначениеПараметраАналитическийРазрез.Использование;	
			КонецЕсли;
			
			ЗначениеПараметраНаправлениеДеятельности = ПараметрыДанных.НайтиЗначениеПараметра(ПараметрНаправлениеДеятельности);
			ЗначениеПараметраПараметрИспользуетсяОтборПоНаправлениюДеятельности = ПараметрыДанныхНовые.НайтиЗначениеПараметра(ПараметрИспользуетсяОтборПоНаправлениюДеятельности);
			Если Истина
				И ЗначениеПараметраНаправлениеДеятельности <> Неопределено
				И ЗначениеПараметраПараметрИспользуетсяОтборПоНаправлениюДеятельности <> Неопределено
			Тогда
				ЗначениеПараметраПараметрИспользуетсяОтборПоНаправлениюДеятельности.Использование = ЗначениеПараметраНаправлениеДеятельности.Использование;	
			КонецЕсли;
			
		КонецЕсли;
		
		ВариантРаспределения.СхемаКомпоновкиДанных = Новый ХранилищеЗначения(СхемаКомпоновкиДанныхНовая);
		
		Попытка
			ВариантРаспределения.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			КоличествоОшибка = КоличествоОшибка + 1;
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать вариант распределения'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
		КонецПопытки;

	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество элементов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //ОбновитьСхемуКомпоновкиВВариантахРаспределений()

// Вызывается при переходе на версию конфигурации 3.0.5.102
//
Процедура ОбновитьПорядокПрямогоРасчетаГеографическиБлизкихТочек(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Обновить порядок расчета географически близких точек'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	ПорядокПрямогоРасчетаГеографическиБлизкихТочек  = Константы.упПорядокПрямогоРасчетаГеографическиБлизкихТочек.Получить();
	ПрямойРасчетГеографическиБлизкихТочекПриНеудаче = Константы.упПрямойРасчетГеографическиБлизкихТочекПриНеудаче.Получить();
	
	Если Истина
		И ПрямойРасчетГеографическиБлизкихТочекПриНеудаче
		И НЕ ЗначениеЗаполнено(ПорядокПрямогоРасчетаГеографическиБлизкихТочек) 
	Тогда
		Константы.упПорядокПрямогоРасчетаГеографическиБлизкихТочек.Установить(Перечисления.упПорядокПрямогоРасчетаГеографическиБлизкихТочек.ПриНеудачеМаршрутизатора);	
	КонецЕсли;
		
	Комментарий = "";
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //ОбновитьПорядокПрямогоРасчетаГеографическиБлизкихТочек()

// Вызывается при переходе на версию конфигурации 3.0.5.103
//
Процедура ОбновитьСхемуКомпоновкиВВариантахРаспределенийПерезаполнитьПараметрПодразделение(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Обновляется схема компоновки данных в вариантах распределений перезаполняется использование подразделений'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	упВариантыРаспределенияРасходов.СхемаКомпоновкиДанных КАК СхемаКомпоновкиДанных,
	|	упВариантыРаспределенияРасходов.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.упВариантыРаспределенияРасходов КАК упВариантыРаспределенияРасходов
	|ГДЕ
	|	НЕ упВариантыРаспределенияРасходов.ПометкаУдаления";
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоВсего   = 0;
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	
	ПараметрПодразделение     = Новый ПараметрКомпоновкиДанных("Подразделение");
	
	ПараметрИспользуетсяИспользуетсяОтборПоПодразделению = Новый ПараметрКомпоновкиДанных("ИспользуетсяОтборПоПодразделению");
		
	Пока Выборка.Следующий() Цикл
		
		КоличествоВсего = КоличествоВсего + 1;
		
		ВариантРаспределения = Выборка.Ссылка.ПолучитьОбъект();
				
		СхемаКомпоновкиДанных = ВариантРаспределения.СхемаКомпоновкиДанных.Получить();
		СхемаКомпоновкиДанныхНовая = Справочники.упВариантыРаспределенияРасходов.ПолучитьМакет("Рейс");
		Если СхемаКомпоновкиДанныхНовая  <> Неопределено Тогда 
			упСервисныеФункцииВызовСервера.СкопироватьЭлементы(СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.Отбор, СхемаКомпоновкиДанных.НастройкиПоУмолчанию.Отбор);
			
			ПараметрыДанных      = СхемаКомпоновкиДанных.НастройкиПоУмолчанию.ПараметрыДанных;
			ПараметрыДанныхНовые = СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.ПараметрыДанных;
			
			упСервисныеФункцииВызовСервера.ЗаполнитьЭлементы(ПараметрыДанных, ПараметрыДанныхНовые);
			
			ЗначениеПараметраПодразделение = ПараметрыДанных.НайтиЗначениеПараметра(ПараметрПодразделение);
			ЗначениеПараметраИспользуетсяИспользуетсяОтборПоПодразделению = ПараметрыДанныхНовые.НайтиЗначениеПараметра(ПараметрИспользуетсяИспользуетсяОтборПоПодразделению);
			Если Истина
				И ЗначениеПараметраПодразделение <> Неопределено
				И ЗначениеПараметраИспользуетсяИспользуетсяОтборПоПодразделению <> Неопределено
			Тогда
				ЗначениеПараметраИспользуетсяИспользуетсяОтборПоПодразделению.Использование = ЗначениеПараметраПодразделение.Использование;	
			КонецЕсли;
			
		КонецЕсли;
		
		ВариантРаспределения.СхемаКомпоновкиДанных = Новый ХранилищеЗначения(СхемаКомпоновкиДанныхНовая);
		
		Попытка
			ВариантРаспределения.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			КоличествоОшибка = КоличествоОшибка + 1;
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать вариант распределения'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
		КонецПопытки;

	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество элементов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //ОбновитьСхемуКомпоновкиВВариантахРаспределений()

// Вызывается при переходе на версию конфигурации 3.0.5.105
//
Процедура ЗаполнитьВариантРасходовВариантовРаспределения(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'По умолчанию у всех вариантов распределения заполняется вариант расходов как ""косвенные расходы""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	КоличествоВсего   = 0;
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	упВариантыРаспределенияРасходов.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.упВариантыРаспределенияРасходов КАК упВариантыРаспределенияРасходов
	|ГДЕ
	|	НЕ упВариантыРаспределенияРасходов.ПометкаУдаления
	|	И упВариантыРаспределенияРасходов.ВариантРасходов = ЗНАЧЕНИЕ(Перечисление.упВариантыРасходов.ПустаяСсылка)";
	
	Выборка	= Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		
		КоличествоВсего = КоличествоВсего + 1;
		
		СправочникОбъект = Выборка.Ссылка.ПолучитьОбъект();
		СправочникОбъект.ВариантРасходов = Перечисления.упВариантыРасходов.Косвенные;
		
		Попытка
			СправочникОбъект.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать элемент'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;
		КонецПопытки;
			
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество элементов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //ЗаполнитьВариантРасходовВариантовРаспределения()

// Вызывается при переходе на версию конфигурации 3.0.5.108
//
Процедура ВключитьИспользованиеДопРеквизитовУРаспределенияПрямыхРасходов(Параметры = Неопределено) Экспорт
		УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упРаспределениеПрямыхРасходов", Новый Структура("Используется", Истина));
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.5.110
//
Процедура УстановитьРесурсСитиГИД() Экспорт
	ИспользуетсяПостроительМаршрутов = упСервисныеФункции.ПолучитьЗначениеКонстанты("упИспользуетсяПостроительМаршрутов");
	ТипМаршрутизатора = упСервисныеФункции.ПолучитьЗначениеКонстанты("упТипМаршрутизатора");
	                       
	Если ИспользуетсяПостроительМаршрутов 
		И ТипМаршрутизатора = Перечисления.упТипыМаршрутизаторов.СитиГИД Тогда
		Константы.упРесурсСитиГИД.Установить("/cgsdk_v3/api/route");
	КонецЕсли;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.5.112
//
Процедура ОбновитьСхемуКомпоновкиВВариантахРаспределенийФактическаяСуммаРасходов(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Обновляется схема компоновки данных в вариантах распределений'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	упВариантыРаспределенияРасходов.СхемаКомпоновкиДанных КАК СхемаКомпоновкиДанных,
	|	упВариантыРаспределенияРасходов.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.упВариантыРаспределенияРасходов КАК упВариантыРаспределенияРасходов
	|ГДЕ
	|	НЕ упВариантыРаспределенияРасходов.ПометкаУдаления";
	Выборка	= Запрос.Выполнить().Выбрать();
	КоличествоВсего   = 0;
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	
	ПараметрПодразделение     = Новый ПараметрКомпоновкиДанных("Подразделение");
	
	ПараметрИспользуетсяИспользуетсяОтборПоПодразделению = Новый ПараметрКомпоновкиДанных("ИспользуетсяОтборПоПодразделению");
		
	Пока Выборка.Следующий() Цикл
		
		КоличествоВсего = КоличествоВсего + 1;
		
		ВариантРаспределения = Выборка.Ссылка.ПолучитьОбъект();
				
		СхемаКомпоновкиДанных = ВариантРаспределения.СхемаКомпоновкиДанных.Получить();
		СхемаКомпоновкиДанныхНовая = Справочники.упВариантыРаспределенияРасходов.ПолучитьМакет("Рейс");
		Если СхемаКомпоновкиДанныхНовая  <> Неопределено Тогда 
			упСервисныеФункцииВызовСервера.СкопироватьЭлементы(СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.Отбор, СхемаКомпоновкиДанных.НастройкиПоУмолчанию.Отбор);
			
			ПараметрыДанных      = СхемаКомпоновкиДанных.НастройкиПоУмолчанию.ПараметрыДанных;
			ПараметрыДанныхНовые = СхемаКомпоновкиДанныхНовая.НастройкиПоУмолчанию.ПараметрыДанных;
			
			упСервисныеФункцииВызовСервера.ЗаполнитьЭлементы(ПараметрыДанныхНовые, ПараметрыДанных);
			
		КонецЕсли;
		
		ВариантРаспределения.СхемаКомпоновкиДанных = Новый ХранилищеЗначения(СхемаКомпоновкиДанныхНовая);
		
		Попытка
			ВариантРаспределения.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			КоличествоОшибка = КоличествоОшибка + 1;
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать вариант распределения'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
		КонецПопытки;

	КонецЦикла; 
	

	
	Комментарий = Нстр("ru = 'Количество элементов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //ОбновитьСхемуКомпоновкиВВариантахРаспределений()

// Вызывается при переходе на версию конфигурации 3.0.5.114
//
Процедура ВключитьИспользованиеДопРеквизитовУСписаниеПрочихРасходов(Параметры = Неопределено) Экспорт
		УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упСписаниеПрочихРасходов", Новый Структура("Используется", Истина));
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.6.9
//
Процедура ЗаполнениеВидовТочекОтправленияВидаПеревозки(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Первоначальное заполнение табличной части ""Виды точек отправления"" видов перевозок.'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	упВидыПеревозок.Ссылка КАК Ссылка,
	|	упВидыПеревозок.ВидТочкиОтправления КАК ВидТочкиОтправления
	|ИЗ
	|	Справочник.упВидыПеревозок КАК упВидыПеревозок
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.упВидыПеревозок.ВидыТочекОтправления КАК упВидыПеревозокВидыТочекОтправления
	|		ПО упВидыПеревозокВидыТочекОтправления.Ссылка = упВидыПеревозок.Ссылка
	|ГДЕ
	|	НЕ упВидыПеревозок.ПометкаУдаления
	|	И упВидыПеревозокВидыТочекОтправления.Ссылка ЕСТЬ NULL";
	
	КоличествоВсего   = 0;
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	
	Выборка	= Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		ВидПеревозкиОбъект = Выборка.Ссылка.ПолучитьОбъект();
		НоваяСтрока = ВидПеревозкиОбъект.ВидыТочекОтправления.Добавить();
		НоваяСтрока.ВидТочкиОтправления    = Выборка.ВидТочкиОтправления;
		НоваяСтрока.ПриоритетИспользования = 1;
		
		Попытка
			ВидПеревозкиОбъект.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать вид перевозки'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;    
		КонецПопытки;

		КоличествоВсего = КоличествоВсего + 1;
		
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество элементов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
	
КонецПроцедуры //ЗаполнениеВидовТочекОтправленияВидаПеревозки()

// Вызывается при переходе на версию конфигурации 3.0.6.12
//
Процедура ВключитьИспользованиеДопРеквизитовУВводаНачальныхОстатков(Параметры = Неопределено) Экспорт
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упВводНачальныхОстатков", Новый Структура("Используется", Истина));
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.6.15
//
Процедура УдалениеПустыхСтрокВидовТочекОтправленияВидаПеревозки(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Удаляются строки из табличной части ""Виды точек отправления"" видов перевозок, с незаполнеными значениями видов точек отправления. Присутствуют в видах перевозки упрощенного порядка исполнения.'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	упВидыПеревозокВидыТочекОтправления.Ссылка КАК Ссылка,
	|	упВидыПеревозокВидыТочекОтправления.НомерСтроки КАК НомерСтроки
	|ИЗ
	|	Справочник.упВидыПеревозок.ВидыТочекОтправления КАК упВидыПеревозокВидыТочекОтправления
	|ГДЕ
	|	упВидыПеревозокВидыТочекОтправления.ВидТочкиОтправления = ЗНАЧЕНИЕ(Справочник.упВидыАдресов.ПустаяСсылка)
	|	И НЕ упВидыПеревозокВидыТочекОтправления.Ссылка.ПометкаУдаления
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки УБЫВ
	|ИТОГИ ПО
	|	Ссылка
	|";
	
	КоличествоВсего   = 0;
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	
	ВыборкаВидПеревозки	= Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаВидПеревозки.Следующий() Цикл
		ВидПеревозкиОбъект = ВыборкаВидПеревозки.Ссылка.ПолучитьОбъект();
		
		ВыборкаСтрока = ВыборкаВидПеревозки.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		
		Пока ВыборкаСтрока.Следующий() Цикл
			ИндексСтроки = ВыборкаСтрока.НомерСтроки - 1;
			ВидПеревозкиОбъект.ВидыТочекОтправления.Удалить(ИндексСтроки);
		КонецЦикла; 
		 		
		Попытка
			ВидПеревозкиОбъект.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать вид перевозки'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;    
		КонецПопытки;

		КоличествоВсего = КоличествоВсего + 1;
		
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество элементов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
	
КонецПроцедуры //ЗаполнениеВидовТочекОтправленияВидаПеревозки()

// Вызывается при переходе на версию конфигурации 3.0.6.24
//
Процедура ЗаполнениеВидаКассовойТехникиПоУмолчанию(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упКассыККМ.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.упКассыККМ КАК упКассыККМ
	|ГДЕ
	|	НЕ упКассыККМ.ПометкаУдаления
	|	И упКассыККМ.Вид = ЗНАЧЕНИЕ(Перечисление.упВидыКассовойТехники.ПустаяСсылка)";
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл
		КассаОбъект = Выборка.Ссылка.ПолучитьОбъект();
		КассаОбъект.Вид = Перечисления.упВидыКассовойТехники.АТОЛ;
		КассаОбъект.Записать();
	КонецЦикла;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.6.33
//
Процедура ЗаполнениеПризнакаПодбораГаражаПриВозвращении(Параметры = Неопределено) Экспорт
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'По умолчанию устанавливается признак подбора гаража при возвращении  у всех ТС для которых автоматически подбирались гаражи'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	упТранспортныеСредства.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.упТранспортныеСредства КАК упТранспортныеСредства
	|ГДЕ
	|	НЕ упТранспортныеСредства.ПометкаУдаления
	|	И упТранспортныеСредства.АвтоматическиПодбиратьГаражВРейсе";
	
	КоличествоВсего   = 0;
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	
	Выборка	= Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		
		ТранспортноеСредствоОбъект = Выборка.Ссылка.ПолучитьОбъект();
		ТранспортноеСредствоОбъект.АвтоматическиПодбиратьВозвращениеВГаражВРейсе = Истина;
		
		Попытка
			ТранспортноеСредствоОбъект.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать элемент'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;    
		КонецПопытки;
		
		КоличествоВсего = КоличествоВсего + 1;
		
	КонецЦикла; 

	Комментарий = Нстр("ru = 'Количество элементов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //ЗаполнениеПризнакаПодбораГаражаПриВозвращении()

// Вызывается при переходе на версию конфигурации 3.0.6.51
//
Процедура ОбновитьНастройкиДоступногоТранспортаПланированияРейсов(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	упВариантыНастроек.Ссылка
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = &Объект
	|И НЕ упВариантыНастроек.ПометкаУдаления";
	Запрос.УстановитьПараметр("Объект", "Обработка.упРМПланированиеРейсов.ДоступныеТС");
	ВариантыНастроек = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку(0); 
	Этап = "Обновление настроек доступного транспорта планирования рейсов";
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Начало", УровеньЖурналаРегистрации.Предупреждение,,, Этап);	
	текНеУдалосьОбработатьОбъектов = 0;
	Для Каждого Ссылка Из ВариантыНастроек Цикл
		Если Ложь Тогда // Для контекстной подсказки
			Ссылка = Справочники.упВариантыНастроек.ПустаяСсылка();
		КонецЕсли;
		СправочникОбъект = Ссылка.ПолучитьОбъект();
		ХранимыеНастройки = СправочникОбъект.Настройки.Получить();
		Если Ложь Тогда // Для контекстной подсказки
			ХранимыеНастройки = Новый Структура;
		КонецЕсли;
		
		Попытка
			РезультатТаблицы = ХранимыеНастройки.Результат;
			Если Ложь Тогда // Для контекстной подсказки
				РезультатТаблицы = Новый ТаблицаЗначений;
			КонецЕсли;
			
			НадоЗаписать = Ложь;
			Если ТипЗнч(РезультатТаблицы) = Тип("ТаблицаЗначений") Тогда
				Если РезультатТаблицы.Колонки.Найти("КоличествоЦиклов") = Неопределено Тогда
					РезультатТаблицы.Колонки.Добавить("КоличествоЦиклов", Новый ОписаниеТипов("Число"));
					Для каждого текТС Из РезультатТаблицы Цикл
						Если ЗначениеЗаполнено(текТС.ТранспортноеСРедство) Тогда // реальное ТС
							текТС.КоличествоЦиклов = 2;
						КонецЕсли; 
					КонецЦикла; 
					НадоЗаписать = Истина;
				КонецЕсли;
				
				Если РезультатТаблицы.Колонки.Найти("ПланироватьЦиклически") = Неопределено Тогда
					РезультатТаблицы.Колонки.Добавить("ПланироватьЦиклически", Новый ОписаниеТипов("Булево"));
					НадоЗаписать = Истина;
				КонецЕсли;
			КонецЕсли; 
			Если НадоЗаписать Тогда
				СправочникОбъект.Настройки = Новый ХранилищеЗначения(ХранимыеНастройки);
				СправочникОбъект.Записать();
			КонецЕсли; 
		Исключение
			ОписаниеОшибки = ОписаниеОшибки();
			текПредставление = "" + Ссылка;
			ТекстСообщения = Нстр("ru = 'Ошибка обработка объекта ""%1"": %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			текНеУдалосьОбработатьОбъектов = текНеУдалосьОбработатьОбъектов + 1;
			ЗаписьЖурналаРегистрации("ОшибкаОбработки", УровеньЖурналаРегистрации.Ошибка,, Ссылка, ТекстСообщения, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			Продолжить;
		КонецПопытки;
	КонецЦикла;
	
	Если текНеУдалосьОбработатьОбъектов > 0 Тогда
		ТекстСообщения = Нстр("ru = 'Не удалось обработать объектов: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текНеУдалосьОбработатьОбъектов);
	Иначе
		ТекстСообщения = Нстр("ru = 'Все объекты были обработаны: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, ВариантыНастроек.Количество());
	КонецЕсли;
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Конец", УровеньЖурналаРегистрации.Предупреждение,,, Этап + Символы.ПС + ТекстСообщения);
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.6.66
//
Процедура ВключитьИспользованиеДопРеквизитовУИзменениеПараметровГрузовыхМест(Параметры = Неопределено) Экспорт
		УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упИзменениеПараметровГрузовыхМест", Новый Структура("Используется", Истина));
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.6.68
//
Процедура ЗаполнитьНомерВЦепиПоставокКонец(Параметры = Неопределено) Экспорт
	
	СобытиеНачало = Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец = Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняет в регистрах и документе задание номер конечной точки прибытия для заявок мультимодальной перевозки'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"
	|//{Запрос: 0 ////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	упЗаявкиКВыполнениюТ.Регистратор КАК Регистратор,
	|	ПРЕДСТАВЛЕНИЕССЫЛКИ(упЗаявкиКВыполнениюТ.Регистратор) КАК Представление
	|ИЗ
	|	РегистрНакопления.упЗаявкиКВыполнению КАК упЗаявкиКВыполнениюТ
	|ГДЕ ИСТИНА
	|	И упЗаявкиКВыполнениюТ.НомерВЦепиПоставок > 0
	|	И упЗаявкиКВыполнениюТ.НомерВЦепиПоставокКонец = 0
	|;
	|//{Запрос: 1 ////////////////////////////////////////
	|ВЫБРАТЬ
	|	упЗаданиеНаПеревозкуГрузаТ.Ссылка КАК Ссылка,
	|	ПРЕДСТАВЛЕНИЕССЫЛКИ(упЗаданиеНаПеревозкуГрузаТ.Ссылка) КАК Представление
	|ИЗ
	|	Документ.упЗаданиеНаПеревозкуГруза КАК упЗаданиеНаПеревозкуГрузаТ
	|ГДЕ ИСТИНА
	|	И упЗаданиеНаПеревозкуГрузаТ.НомерВЦепиПоставок > 0
	|	И упЗаданиеНаПеревозкуГрузаТ.НомерВЦепиПоставокКонец = 0
	|	И упЗаданиеНаПеревозкуГрузаТ.ПометкаУдаления = ЛОЖЬ";
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	
	Выборка = РезультатЗапроса[0].Выбрать();
	
	КоличествоВсего = 0;
	КоличествоУспешно = 0;
	КоличествоОшибка = 0;
	
	Пока Выборка.Следующий() Цикл
		
		КоличествоВсего = КоличествоВсего + 1;
		
		РегистраторПредставление = Выборка.Представление;
		
		НаборЗаписей = РегистрыНакопления.упЗаявкиКВыполнению.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.Регистратор.Установить(Выборка.Регистратор);
		НаборЗаписей.Прочитать();
		
		Для каждого Запись Из НаборЗаписей Цикл
			Если Запись.НомерВЦепиПоставок > 0 Тогда
				Запись.НомерВЦепиПоставокКонец = Запись.НомерВЦепиПоставок + 1;	
			КонецЕсли;
		КонецЦикла;
		
		Попытка
			НаборЗаписей.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать набор записей ""Заявки к выполнению"" по регистратору:%1'");
			Событие = СтрШаблон(Событие, РегистраторПредставление);
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;
		КонецПопытки;
		
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество документов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	Событие = Нстр("ru = 'Изменение записей РН.упЗаявкиКВыполнению'");
	ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
	Выборка = РезультатЗапроса[1].Выбрать();
	
	КоличествоВсего = 0;
	КоличествоУспешно = 0;
	КоличествоОшибка = 0;
	
	Пока Выборка.Следующий() Цикл
		
		КоличествоВсего = КоличествоВсего + 1;
		
		РегистраторПредставление = Выборка.Представление;
		ДокументОбъект = Выборка.Ссылка.Получитьобъект();
		ДокументОбъект.НомерВЦепиПоставокКонец = Документобъект.НомерВЦепиПоставок + 1;	
		Попытка
			Документобъект.Записать(РежимЗаписиДокумента.Запись);
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать документ %1'");
			Событие = СтрШаблон(Событие, РегистраторПредставление);
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;
		КонецПопытки;
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество документов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	Событие = Нстр("ru = 'Изменение конечного номера в цепи поставок в документе ""Задание на перевозку груза""'");
	ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
КонецПроцедуры //ЗаполнитьНомерВЦепиПоставокКонец()

// Вызывается при переходе на версию конфигурации 3.0.6.77
//
Процедура ЗаполнитьИзмерениеДокументРСупРасписаниеРаботыЭкипажей(Параметры = Неопределено) Экспорт
	
	СобытиеНачало= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняет значение измерения ""Документ"" в регистре сведений ""Расписание работы экипажей"" регистратором'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	упРасписаниеРаботыЭкипажей.Регистратор КАК Регистратор
	|ИЗ
	|	РегистрСведений.упРасписаниеРаботыЭкипажей КАК упРасписаниеРаботыЭкипажей
	|ГДЕ упРасписаниеРаботыЭкипажей.Документ = ЗНАЧЕНИЕ(Документ.упРейс.ПустаяСсылка)
	|";
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	КоличествоВсего= 0;
	КоличествоУспешно = 0;
	КоличествоОшибка= 0;
	
	Пока Выборка.Следующий() Цикл
		
		КоличествоВсего = КоличествоВсего + 1;
		
		НаборЗаписей = РегистрыСведений.упРасписаниеРаботыЭкипажей.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.Регистратор.Установить(Выборка.Регистратор);
		
		НаборЗаписей.Прочитать();
		
		Для каждого Запись Из НаборЗаписей Цикл
			Запись.Документ = Запись.Регистратор;
		КонецЦикла;
						
		Попытка
			НаборЗаписей.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать набор записей'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;    
		КонецПопытки;
		
	КонецЦикла;
	
	Комментарий = Нстр("ru = 'Изменено наборов по регистраторам: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
	
КонецПроцедуры //ЗаполнитьИзмерениеДокументРСупРасписаниеРаботыЭкипажей()

// Вызывается при переходе на версию конфигурации 3.0.6.78
//
Процедура ВключитьИспользованиеДопРеквизитов_3_0_6_78(Параметры = Неопределено) Экспорт
	
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Справочник_упКонтрагенты", Новый Структура("Используется", Истина));

КонецПроцедуры //ВключитьИспользованиеДопРеквизитов_3_0_6_78()

// Вызывается при переходе на версию конфигурации 3.0.6.80
//
Процедура ЗаполнитьРеквизитыРолиОтветственныйЗаПодтверждениеАдресов(Параметры = Неопределено) Экспорт
	
	СобытиеНачало= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняются реквизиты роли исполнителя ""Ответственный за подтверждение адресов""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Перевозчик = ПланыВидовХарактеристик.ОбъектыАдресацииЗадач.ВсеОбъектыАдресации;
	
	РольОбъект = Справочники.РолиИсполнителей.ОтветственныйЗаПодтверждениеАдресов.ПолучитьОбъект();
	ЗаблокироватьДанныеДляРедактирования(РольОбъект.Ссылка);
	РольОбъект.ИспользуетсяБезОбъектовАдресации = Истина;
	РольОбъект.ИспользуетсяСОбъектамиАдресации  = Истина;
	РольОбъект.ТипыОсновногоОбъектаАдресации    = Перевозчик;
	РольОбъект.Записать();
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация);
		
КонецПроцедуры //ЗаполнитьРеквизитыРолиОтветственныйЗаПодтверждениеАдресов()

// Вызывается при переходе на версию конфигурации 3.0.6.81
//
Процедура ЗаполнениеПараметровГрузовПоЗаданиям(Параметры = Неопределено) Экспорт
	
	// сначала очистим все записи в регистрах
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	упПараметрыЗаданияНаПеревозку.Регистратор КАК Регистратор
	|ИЗ
	|	РегистрСведений.упПараметрыЗаданияНаПеревозку КАК упПараметрыЗаданияНаПеревозку
	|ГДЕ
	|	упПараметрыЗаданияНаПеревозку.Регистратор ССЫЛКА Документ.упЗаданиеНаПеревозкуГруза";
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	НаборЗаписей = РегистрыСведений.упПараметрыЗаданияНаПеревозку.СоздатьНаборЗаписей();
	Пока Выборка.Следующий() Цикл
		НаборЗаписей.Отбор.Регистратор.Установить(Выборка.Регистратор);
		НаборЗаписей.Записать();	
	КонецЦикла;
	Выборка.Сбросить();
	НаборЗаписей = РегистрыСведений.упПараметрыЗаявкиНаПеревозку.СоздатьНаборЗаписей();
	Пока Выборка.Следующий() Цикл
		НаборЗаписей.Отбор.Регистратор.Установить(Выборка.Регистратор);
		НаборЗаписей.Записать();	
	КонецЦикла;
	
	СобытиеНачало	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец 	= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Для всех заданий c незаполненными регистрами ""Параметры заданий на перевозку"" и ""Параметры заявок на перевозку"" заполняются параметры грузовых мест'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	КОЛИЧЕСТВО(упЗаданиеНаПеревозкуГруза.Ссылка) КАК КоличествоДокументов
	|ИЗ
	|	Документ.упЗаданиеНаПеревозкуГруза КАК упЗаданиеНаПеревозкуГруза
	|";
	
	КоличествоЗаданий = Неопределено;
	
	Выборка	= Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		КоличествоЗаданий = Выборка.КоличествоДокументов;
	КонецЕсли;  
	
	КоличествоДокументовВПорции = 100;
	
	КоличествоПорций = КоличествоЗаданий / КоличествоДокументовВПорции;
	
	Если КоличествоПорций - Цел(КоличествоПорций) > 0 Тогда
		КоличествоПорций = КоличествоПорций + 1;
	КонецЕсли;
	
	ЗавершенаОбработка = Ложь;
	КоличествоВсего   = 0;
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	
	Для НомерПорции = 1 По КоличествоПорций Цикл
		СформироватьПараметрыГрузовПоПорцииЗаданий(ЗавершенаОбработка, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
		Если ЗавершенаОбработка Тогда
			Прервать;
		КонецЕсли;
	КонецЦикла;

	Комментарий = Нстр("ru = 'Количество документов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
	
КонецПроцедуры //ЗаполнениеПараметровГрузовПоЗаданиям()

// Вызывается при переходе на версию конфигурации 3.0.6.83
//
Процедура ПерезаполнитьТипыСобытийПоСобытиямМониторинга(Параметры = Неопределено) Экспорт
	
	СобытиеНачало= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	
	Этап	= Нстр("ru = 'Перезаполняются схемы в элементах событий с типом исходных действий ""Запись события мониторинга""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	мсвТипыИсходныхДействий = Новый Массив;
	мсвТипыИсходныхДействий.Добавить(Перечисления.упТипыДействийСобытий.ЗаписьСобытияМониторинга);
	упСобытия.ПерезаполнитьТипыСобытийПоТипуИсходногоДействия(мсвТипыИсходныхДействий,"СобытияМониторинга");
	
КонецПроцедуры //ПерезаполнитьТипыСобытийПоСобытиямМониторинга()

// Вызывается при переходе на версию конфигурации 3.0.6.84
//
Процедура ЗаполнитьПрочиеРасходыПоДокументамРБП(Параметры = Неопределено) Экспорт
	
	СобытиеНачало= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняет табличную часть""Прочие расходы"" документов ""Распределение расходов будущих периодов""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упРаспределениеРасходовБудущихПериодов.Сумма КАК Сумма,
	               |	упРаспределениеРасходовБудущихПериодов.СуммаНДС КАК СуммаНДС,
	               |	упРаспределениеРасходовБудущихПериодов.Валюта КАК Валюта,
	               |	упРаспределениеРасходовБудущихПериодов.СуммаВалюта КАК СуммаВалюта,
	               |	упРаспределениеРасходовБудущихПериодов.СуммаВалютаНДС КАК СуммаВалютаНДС,
	               |	упРаспределениеРасходовБудущихПериодов.НаправлениеДеятельности КАК НаправлениеДеятельности,
	               |	упРаспределениеРасходовБудущихПериодов.Подразделение КАК Подразделение,
	               |	упРаспределениеРасходовБудущихПериодов.АналитическийРазрез КАК АналитическийРазрез,
	               |	упРаспределениеРасходовБудущихПериодов.Ссылка КАК Ссылка,
	               |	упРаспределениеРасходовБудущихПериодов.КоличествоМесяцев КАК КоличествоМесяцев,
	               |	упРаспределениеРасходовБудущихПериодов.НачалоПериода КАК НачалоПериода,
	               |	упРаспределениеРасходовБудущихПериодов.СтатьяРасходов КАК СтатьяРасходов
	               |ИЗ
	               |	Документ.упРаспределениеРасходовБудущихПериодов КАК упРаспределениеРасходовБудущихПериодов
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.упРаспределениеРасходовБудущихПериодов.ПрочиеРасходы КАК упРаспределениеРасходовБудущихПериодовПрочиеРасходы
	               |		ПО (упРаспределениеРасходовБудущихПериодовПрочиеРасходы.Ссылка = упРаспределениеРасходовБудущихПериодов.Ссылка)
	               |ГДЕ
	               |	НЕ упРаспределениеРасходовБудущихПериодов.ПометкаУдаления
	               |	И упРаспределениеРасходовБудущихПериодовПрочиеРасходы.Ссылка ЕСТЬ NULL";
	
	КоличествоВсего= 0;
	КоличествоУспешно = 0;
	КоличествоОшибка= 0;
		
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		КоличествоВсего = КоличествоВсего + 1;
		ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
		
		ПрочиеРасходы = ДокументОбъект.ПрочиеРасходы;
		НоваяСтрока = ПрочиеРасходы.Добавить(); 
		ЗаполнитьЗначенияСвойств(НоваяСтрока, Выборка);
		
		РезультатРаспределения = ДокументОбъект.РезультатыРаспределения;
		
		Для каждого Строка Из РезультатРаспределения Цикл
			Строка.Валюта = Выборка.Валюта;
			Строка.НаправлениеДеятельности = Выборка.НаправлениеДеятельности;
		КонецЦикла;
		
		Попытка
			ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать документ'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;
		КонецПопытки;
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество документов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);

КонецПроцедуры //ЗаполнитьПрочиеРасходыПоДокументамРБП()

// Вызывается при переходе на версию конфигурации 3.0.6.97
//
Процедура ОбновитьСоставПараметровВариантовНастроекПланированияРейсов(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	упВариантыНастроек.Ссылка
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = &Объект
	|";
	Запрос.УстановитьПараметр("Объект", "Обработка.упРМПланированиеРейсов.ПараметрыПланирования");
	ВариантыНастроек = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку(0); 
	Этап = "Обновление состава параметров вариантов настроек планирования рейсов";
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Начало", УровеньЖурналаРегистрации.Предупреждение,,, Этап);	
	текНеУдалосьОбработатьОбъектов = 0;
	ПараметрыПоУмолчанию = упВариантыНастроек.ПараметрыПланированияРейсовПоУмолчанию();
	Для Каждого Ссылка Из ВариантыНастроек Цикл
		Если Ложь Тогда // Для контекстной подсказки
		    Ссылка = Справочники.упВариантыНастроек.ПустаяСсылка();
		КонецЕсли;
		СправочникОбъект = Ссылка.ПолучитьОбъект();
		ХранимыеНастройки = СправочникОбъект.Настройки.Получить();
		Если Ложь Тогда // Для контекстной подсказки
		    ХранимыеНастройки = Новый Структура;
		КонецЕсли;
		Попытка
			НадоЗаписать = упСервисныеФункцииКлиентСервер.ДобавитьНедостающиеЭлементыСтруктуру(ПараметрыПоУмолчанию, ХранимыеНастройки.Результат);
			Если НадоЗаписать Тогда
				СправочникОбъект.Настройки = Новый ХранилищеЗначения(ХранимыеНастройки);
				СправочникОбъект.Записать();
			КонецЕсли; 
		Исключение
			ОписаниеОшибки = ОписаниеОшибки();
			текПредставление = "" + Ссылка;
			ТекстСообщения = Нстр("ru = 'Ошибка обработка объекта ""%1"": %2'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текПредставление, ОписаниеОшибки);
			текНеУдалосьОбработатьОбъектов = текНеУдалосьОбработатьОбъектов + 1;
			ЗаписьЖурналаРегистрации("ОшибкаОбработки", УровеньЖурналаРегистрации.Ошибка,, Ссылка, ТекстСообщения, РежимТранзакцииЗаписиЖурналаРегистрации.Транзакционная);
			Продолжить;
		КонецПопытки; 
	КонецЦикла; 
	Если текНеУдалосьОбработатьОбъектов > 0 Тогда
		ТекстСообщения = Нстр("ru = 'Не удалось обработать объектов: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, текНеУдалосьОбработатьОбъектов);
	Иначе
		ТекстСообщения = Нстр("ru = 'Все объекты были обработаны: %1'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, ВариантыНастроек.Количество());
	КонецЕсли;
	ЗаписьЖурналаРегистрации("ВыполнениеПроцедурыОбновления.Конец", УровеньЖурналаРегистрации.Предупреждение,,, Этап + Символы.ПС + ТекстСообщения);
	
КонецПроцедуры

#КонецОбласти 


// Вызывается при переходе на версию конфигурации 3.0.6.85
//
Процедура ЗаполнитьСпособРегистраЗадолженностиПоДокументамВидаПеревозки(Параметры = Неопределено) Экспорт
	
	СобытиеНачало= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется по умолчанию способ регистрации задолженности по документам в справочнике ""Виды перевозок""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упВидыПеревозок.Ссылка КАК Ссылка
	               |ИЗ
	               |	Справочник.упВидыПеревозок КАК упВидыПеревозок
	               |ГДЕ
	               |	ИСТИНА
	               |	И НЕ упВидыПеревозок.ПометкаУдаления
	               |	И упВидыПеревозок.СпособРегистрацииЗадолженностиПоДокументамРейса = ЗНАЧЕНИЕ(Перечисление.упСпособыРегистрацииЗадолженностиПоДокументамРейса.ПустаяСсылка)";
				   
	КоличествоВсего   = 0;
	КоличествоУспешно = 0;
	КоличествоОшибка  = 0;
	
	Выборка = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока Выборка.Следующий() Цикл
		
		ВидПеревозкиОбъект = Выборка.Ссылка.ПолучитьОбъект();
		ВидПеревозкиОбъект.СпособРегистрацииЗадолженностиПоДокументамРейса = Перечисления.упСпособыРегистрацииЗадолженностиПоДокументамРейса.Рейсом;
		
		Попытка
			ВидПеревозкиОбъект.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать вид перевозки'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;    
		КонецПопытки;

		КоличествоВсего = КоличествоВсего + 1;
		
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество элементов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);

КонецПроцедуры //ЗаполнитьСпособРегистраЗадолженностиПоДокументамВидаПеревозки()

// Вызывается при переходе на версию конфигурации 3.0.6.87
//
Процедура ВключитьИспользованиеДопРеквизитовУДокументаРегистрацияЗадолженностиПоДокументамРейса(Параметры = Неопределено) Экспорт
	
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упРегистрацияЗадолженностиПоДокументамРейса", Новый Структура("Используется", Истина));
		
	
КонецПроцедуры //ВключитьИспользованиеДопРеквизитовУДокументаРегистрацияЗадолженностиПоДокументамРейса()

// Вызывается при переходе на версию конфигурации 3.0.6.88
//
Процедура ЗаполнитьДействиеУПредопределеннойПроблемы(Параметры = Неопределено) Экспорт
	
	СобытиеНачало= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется действие у предопределенной проблемы ""Досрочное прохождение""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	Справочники.упПроблемы.ПервоначальноеЗаполнение();
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,,);
		
КонецПроцедуры //ЗаполнитьДействиеУПредопределеннойПроблемы()

// Вызывается при переходе на версию конфигурации 3.0.6.90
//
Процедура ВключитьИспользованиеДопРеквизитовЗапросУсловийПеревозки(Параметры = Неопределено) Экспорт
	
	УправлениеСвойствами.УстановитьПараметрыНабораСвойств("Документ_упЗапросУсловийПеревозки", Новый Структура("Используется", Истина));
	
КонецПроцедуры //ВключитьИспользованиеДопРеквизитовЗапросУсловийПеревозки()

// Вызывается при переходе на версию конфигурации 3.0.6.106
//
Процедура ЗаполнитьРеквизитыРолиОтветственныйЗаСогласованиеИзмененийМаршрута(Параметры = Неопределено) Экспорт
	
	СобытиеНачало= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняются реквизиты роли исполнителя ""Ответственный за согласование изменений маршрута""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Перевозчик = ПланыВидовХарактеристик.ОбъектыАдресацииЗадач.ВсеОбъектыАдресации;
	
	РольОбъект = Справочники.РолиИсполнителей.ОтветственныйЗаСогласованиеИзмененийМаршрута.ПолучитьОбъект();
	ЗаблокироватьДанныеДляРедактирования(РольОбъект.Ссылка);
	РольОбъект.ИспользуетсяБезОбъектовАдресации = Истина;
	РольОбъект.ИспользуетсяСОбъектамиАдресации  = Истина;
	РольОбъект.ТипыОсновногоОбъектаАдресации    = Перевозчик;
	РольОбъект.Записать();
	
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация);
		
КонецПроцедуры //ЗаполнитьРеквизитыРолиОтветственныйЗаПодтверждениеАдресов()

// Вызывается при переходе на версию конфигурации 3.0.7.6
//
Процедура ЗаполнитьИсходногоРодителяВРегистреРазделенияГрузовыхМест(Параметры = Неопределено) Экспорт
	
	СобытиеНачало= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется исходный родитель в регистре разделения грузовых мест'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	упРазделениеГрузовыхМест.Регистратор КАК Регистратор,
	               |	ПРЕДСТАВЛЕНИЕ(упРазделениеГрузовыхМест.Регистратор) КАК Представление
	               |ИЗ
	               |	РегистрСведений.упРазделениеГрузовыхМест КАК упРазделениеГрузовыхМест
	               |ГДЕ
	               |	упРазделениеГрузовыхМест.РодительИсходный = ЗНАЧЕНИЕ(Справочник.упГрузовыеМеста.ПустаяСсылка)";
	
	Выборка = Запрос.Выполнить().Выбрать();
	КоличествоВсего = 0;
	КоличествоОшибка = 0;
	КоличествоУспешно = 0;
	
	Пока Выборка.Следующий() Цикл
		
		КоличествоВсего = КоличествоВсего + 1;
		РегистраторПредставление = Выборка.Представление;
		
		НаборЗаписей = РегистрыСведений.упРазделениеГрузовыхМест.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.Регистратор.Установить(Выборка.Регистратор);
		НаборЗаписей.Прочитать();
		
		Для каждого Запись Из НаборЗаписей Цикл
			Если Не ЗначениеЗаполнено(Запись.РодительИсходный) Тогда
				Запись.РодительИсходный = Запись.Родитель;	
			КонецЕсли;
		КонецЦикла;
		
		Попытка
			НаборЗаписей.Записать();
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать набор записей ""Разделение грузовых мест"" по регистратору:%1'");
			Событие = СтрШаблон(Событие, РегистраторПредставление);
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;
		КонецПопытки;
		
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество документов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
			
КонецПроцедуры //ЗаполнитьИсходногоРодителяВРегистреРазделенияРабот()

// Вызывается при переходе на версию конфигурации 3.0.7.9
//
Процедура ОбновитьНаименованияОбъектовВариантовНастроек(Параметры = Неопределено) Экспорт
	
	мсвИзменяемыхОбъектов = Новый Массив;
	мсвИзменяемыхОбъектов.Добавить("Обработка.упРМПланированиеРейсов.НастройкаСпискаЗаданий");
	мсвИзменяемыхОбъектов.Добавить("Обработка.упРМПланированиеРейсов.ПараметрыПланирования");
	мсвИзменяемыхОбъектов.Добавить("Обработка.упРМПланированиеРейсов.ОбщиеНастройки");
	мсвИзменяемыхОбъектов.Добавить("Обработка.упРМПланированиеРейсов.ДоступныеТС");
	мсвИзменяемыхОбъектов.Добавить("Обработка.упРМПланированиеРейсов.СписокЗон");
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.Ссылка
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект В (&МассивОбъектов)
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Запрос.УстановитьПараметр("МассивОбъектов", мсвИзменяемыхОбъектов);
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			ВыборкаОбъект = Выборка.Ссылка.ПолучитьОбъект();
			ВыборкаОбъект.Объект = ВыборкаОбъект.Объект + ".ПеревозкаГрузов";
			ВыборкаОбъект.Записать();
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры //ЗаполнитьИсходногоРодителяВРегистреРазделенияРабот()

// Вызывается при переходе на версию конфигурации 3.0.7.10
//
Процедура ОбновитьНастройкиОтбораСпискаЗаданий() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упВариантыНастроек.КлючВарианта
	|ИЗ
	|	Справочник.упВариантыНастроек КАК упВариантыНастроек
	|ГДЕ
	|	упВариантыНастроек.Объект = ""Обработка.упРМПланированиеРейсов.НастройкаСпискаЗаданий""
	|	И НЕ упВариантыНастроек.ПометкаУдаления";
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		
		СхемаКомпоновкиДанных = Обработки.упРМПланированиеРейсов.ПолучитьМакет("ЗаданияНаПеревозку");
		АдресСхемыКомпоновкиДанных = ПоместитьВоВременноеХранилище(СхемаКомпоновкиДанных, Новый УникальныйИдентификатор);
		ИсточникНастроек = Новый ИсточникДоступныхНастроекКомпоновкиДанных(АдресСхемыКомпоновкиДанных);
		КомпоновщикНастроек = Новый КомпоновщикНастроекКомпоновкиДанных;
		КомпоновщикНастроек.Инициализировать(ИсточникНастроек);
		
		Пока Выборка.Следующий() Цикл
			сткНастройки = ХранилищаНастроек.упХранилищеНастроек.Загрузить("Обработка.упРМПланированиеРейсов.НастройкаСпискаЗаданий", Выборка.КлючВарианта);
			КомпоновщикНастроек.ЗагрузитьНастройки(СхемаКомпоновкиДанных.НастройкиПоУмолчанию);
			упСервисныеФункцииВызовСервера.СкопироватьЭлементы(КомпоновщикНастроек.Настройки.Отбор, сткНастройки.НастройкиКомпоновкиДанных.Отбор);
			сткНастройки.НастройкиКомпоновкиДанных = КомпоновщикНастроек.Настройки;
			ХранилищаНастроек.упХранилищеНастроек.Сохранить("Обработка.упРМПланированиеРейсов.НастройкаСпискаЗаданий", Выборка.КлючВарианта, сткНастройки);
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.7.12
//
Процедура ЗаполнитьРегистрыСтатусовWMS() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упЗаявкаНаПеревозкуГруза.Ссылка КАК Ссылка,
	|	упЗаявкаНаПеревозкуГруза.УдалитьСтатусWMS КАК СтатусWMS
	|ПОМЕСТИТЬ втСтатусыЗаявок
	|ИЗ
	|	Документ.упЗаявкаНаПеревозкуГруза КАК упЗаявкаНаПеревозкуГруза
	|ГДЕ
	|	упЗаявкаНаПеревозкуГруза.ПометкаУдаления = ЛОЖЬ
	|	И НЕ упЗаявкаНаПеревозкуГруза.УдалитьСтатусWMS = """"
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	упРейс.Ссылка КАК Ссылка,
	|	упРейс.УдалитьСтатусWMS КАК СтатусWMS
	|ПОМЕСТИТЬ втСтатусыРейсов
	|ИЗ
	|	Документ.упРейс КАК упРейс
	|ГДЕ
	|	упРейс.ПометкаУдаления = ЛОЖЬ
	|	И НЕ упРейс.УдалитьСтатусWMS = """"
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Статусы.СтатусWMS КАК СтатусWMS,
	|	МАКСИМУМ(ЕСТЬNULL(упСтатусыДокументовWMS.Ссылка, ЗНАЧЕНИЕ(Справочник.упСтатусыДокументовWMS.ПустаяСсылка))) КАК НовыйСтатусWMS,
	|	МАКСИМУМ(Статусы.ПрименениеЗаявкаНаПеревозкуГруза) КАК ПрименениеЗаявкаНаПеревозкуГруза,
	|	МАКСИМУМ(Статусы.ПрименениеРейс) КАК ПрименениеРейс
	|ПОМЕСТИТЬ втСтатусыWMS
	|ИЗ
	|	(ВЫБРАТЬ
	|		втСтатусыЗаявок.СтатусWMS КАК СтатусWMS,
	|		ИСТИНА КАК ПрименениеЗаявкаНаПеревозкуГруза,
	|		ЛОЖЬ КАК ПрименениеРейс
	|	ИЗ
	|		втСтатусыЗаявок КАК втСтатусыЗаявок
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		втСтатусыРейсов.СтатусWMS,
	|		ЛОЖЬ,
	|		ИСТИНА
	|	ИЗ
	|		втСтатусыРейсов КАК втСтатусыРейсов) КАК Статусы
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.упСтатусыДокументовWMS КАК упСтатусыДокументовWMS
	|		ПО Статусы.СтатусWMS = упСтатусыДокументовWMS.Наименование
	|
	|СГРУППИРОВАТЬ ПО
	|	Статусы.СтатусWMS
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСтатусыWMS.СтатусWMS КАК СтатусWMS,
	|	втСтатусыWMS.НовыйСтатусWMS КАК НовыйСтатусWMS,
	|	втСтатусыWMS.ПрименениеЗаявкаНаПеревозкуГруза КАК ПрименениеЗаявкаНаПеревозкуГруза,
	|	втСтатусыWMS.ПрименениеРейс КАК ПрименениеРейс
	|ИЗ
	|	втСтатусыWMS КАК втСтатусыWMS
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСтатусыЗаявок.Ссылка.Дата КАК Период,
	|	втСтатусыЗаявок.Ссылка КАК Ссылка,
	|	втСтатусыWMS.СтатусWMS КАК СтатусWMS,
	|	втСтатусыWMS.НовыйСтатусWMS КАК НовыйСтатусWMS
	|ИЗ
	|	втСтатусыЗаявок КАК втСтатусыЗаявок
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втСтатусыWMS КАК втСтатусыWMS
	|		ПО втСтатусыЗаявок.СтатусWMS = втСтатусыWMS.СтатусWMS
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСтатусыРейсов.Ссылка.Дата КАК Период,
	|	втСтатусыРейсов.Ссылка КАК Ссылка,
	|	втСтатусыWMS.СтатусWMS КАК СтатусWMS,
	|	втСтатусыWMS.НовыйСтатусWMS КАК НовыйСтатусWMS
	|ИЗ
	|	втСтатусыРейсов КАК втСтатусыРейсов
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втСтатусыWMS КАК втСтатусыWMS
	|		ПО втСтатусыРейсов.СтатусWMS = втСтатусыWMS.СтатусWMS";
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	КоличествоТаблиц = РезультатЗапроса.Количество();
	Если Не РезультатЗапроса[КоличествоТаблиц - 3].Пустой() Тогда
		ВыборкаСтатусы       = РезультатЗапроса[КоличествоТаблиц - 3].Выбрать();
		ВыборкаСтатусыЗаявок = РезультатЗапроса[КоличествоТаблиц - 2].Выбрать();
		ВыборкаСтатусыРейсов = РезультатЗапроса[КоличествоТаблиц - 1].Выбрать();
		
		соотСтатусов = Новый Соответствие;
		Пока ВыборкаСтатусы.Следующий() Цикл
			Если Не ЗначениеЗаполнено(ВыборкаСтатусы.НовыйСтатусWMS) Тогда
				НовыйСтатус = Справочники.упСтатусыДокументовWMS.СоздатьЭлемент();
				НовыйСтатус.Наименование = ВыборкаСтатусы.СтатусWMS;
				НовыйСтатус.ПрименениеЗаявкаНаПеревозкуГруза = ВыборкаСтатусы.ПрименениеЗаявкаНаПеревозкуГруза;
				НовыйСтатус.ПрименениеРейс = ВыборкаСтатусы.ПрименениеРейс;
				НовыйСтатус.Комментарий = НСтр("ru = 'Создан автоматически при изменении механизма учета статусов WMS.'");
				НовыйСтатус.Записать();
				соотСтатусов.Вставить(ВыборкаСтатусы.СтатусWMS, НовыйСтатус.Ссылка);
			КонецЕсли; 
		КонецЦикла;
		
		Пока ВыборкаСтатусыЗаявок.Следующий() Цикл
			НоваяЗапись = РегистрыСведений.упСтатусыЗаявокНаПеревозкуГрузаWMS.СоздатьМенеджерЗаписи();
			НоваяЗапись.Период   = ВыборкаСтатусыЗаявок.Период;
			НоваяЗапись.Документ = ВыборкаСтатусыЗаявок.Ссылка;
			НоваяЗапись.Прочитать();
			
			НоваяЗапись.Период   = ВыборкаСтатусыЗаявок.Период;
			НоваяЗапись.Документ = ВыборкаСтатусыЗаявок.Ссылка;
			Если ЗначениеЗаполнено(ВыборкаСтатусыЗаявок.НовыйСтатусWMS) Тогда
				НоваяЗапись.Статус = ВыборкаСтатусыЗаявок.НовыйСтатусWMS;
			Иначе
				НоваяЗапись.Статус = соотСтатусов.Получить(ВыборкаСтатусыЗаявок.СтатусWMS);
			КонецЕсли; 
			
			Попытка
				НоваяЗапись.Записать();
			Исключение
				ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ТекстОшибки) Тогда 
					ТекстОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка, ,, ТекстОшибки);
			КонецПопытки;
		КонецЦикла;
		
		Пока ВыборкаСтатусыРейсов.Следующий() Цикл
			НоваяЗапись = РегистрыСведений.упСтатусыРейсовWMS.СоздатьМенеджерЗаписи();
			НоваяЗапись.Период   = ВыборкаСтатусыРейсов.Период;
			НоваяЗапись.Документ = ВыборкаСтатусыРейсов.Ссылка;
			НоваяЗапись.Прочитать();
			
			НоваяЗапись.Период   = ВыборкаСтатусыРейсов.Период;
			НоваяЗапись.Документ = ВыборкаСтатусыРейсов.Ссылка;
			Если ЗначениеЗаполнено(ВыборкаСтатусыРейсов.НовыйСтатусWMS) Тогда
				НоваяЗапись.Статус = ВыборкаСтатусыРейсов.НовыйСтатусWMS;
			Иначе
				НоваяЗапись.Статус = соотСтатусов.Получить(ВыборкаСтатусыРейсов.СтатусWMS);
			КонецЕсли;
			Попытка
				НоваяЗапись.Записать();
			Исключение
				ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ТекстОшибки) Тогда 
					ТекстОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка, ,, ТекстОшибки);
			КонецПопытки;
		КонецЦикла;
	КонецЕсли; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 3.0.7.26
//
Процедура ЗаполнитьВидТранспортнойУслугиВПрохожденииТочки(Параметры = Неопределено) Экспорт
	
	СобытиеНачало= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется вид транспортной услуги в документе Прохождении точки'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	УпПрохождениеТочки_РаботыТ.Ссылка КАК Ссылка,
	|	СУММА(ВЫБОР
	|			КОГДА УпПрохождениеТочки_РаботыТ.Операция = ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.Погрузка)
	|				ТОГДА 1
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК КоличествоПогрузок
	|ПОМЕСТИТЬ втПрохожденияСКонтейнерами
	|ИЗ
	|	Документ.упРейс КАК упРейсТ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.упПрохождениеТочки.Работы КАК УпПрохождениеТочки_РаботыТ
	|		ПО (УпПрохождениеТочки_РаботыТ.Ссылка.Рейс = упРейсТ.Ссылка)
	|ГДЕ
	|	ИСТИНА
	|	И упРейсТ.ВидТранспортнойУслуги = ЗНАЧЕНИЕ(Перечисление.упВидыТранспортныхУслуг.ОперацииСКонтейнерами)
	|	И УпПрохождениеТочки_РаботыТ.Отменена = ЛОЖЬ
	|
	|СГРУППИРОВАТЬ ПО
	|	УпПрохождениеТочки_РаботыТ.Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	упПрохождениеТочкиТ.Ссылка КАК Ссылка,
	|	упПрохождениеТочкиТ.Рейс.ВидТранспортнойУслуги КАК ВидТранспортнойУслуги,
	|	ВЫБОР
	|		КОГДА втПрохожденияСКонтейнерами.КоличествоПогрузок ЕСТЬ NULL
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.упВидыКонтейнерныхОпераций.ПустаяСсылка)
	|		КОГДА втПрохожденияСКонтейнерами.КоличествоПогрузок > 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.упВидыКонтейнерныхОпераций.Формирование)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.упВидыКонтейнерныхОпераций.РасФормирование)
	|	КОНЕЦ КАК ВидКонтейнернойОперации
	|ИЗ
	|	Документ.упПрохождениеТочки КАК упПрохождениеТочкиТ
	|		ЛЕВОЕ СОЕДИНЕНИЕ втПрохожденияСКонтейнерами КАК втПрохожденияСКонтейнерами
	|		ПО упПрохождениеТочкиТ.Ссылка = втПрохожденияСКонтейнерами.Ссылка
	|ГДЕ
	|	упПрохождениеТочкиТ.ВидТранспортнойУслуги В (ЗНАЧЕНИЕ(Перечисление.упВидыТранспортныхУслуг.ПустаяСсылка))";
		
	КоличествоВсего= 0;
	КоличествоУспешно = 0;
	КоличествоОшибка= 0;
	
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		
		ПрохождениеОбъект = Выборка.Ссылка.ПолучитьОбъект();
		ПрохождениеОбъект.ВидТранспортнойУслуги = Выборка.ВидТранспортнойУслуги;
		ПрохождениеОбъект.ВидКонтейнернойОперации = Выборка.ВидКонтейнернойОперации;
		
		Попытка
			ПрохождениеОбъект.Записать(РежимЗаписиДокумента.Запись);
			КоличествоУспешно = КоличествоУспешно + 1;
		Исключение
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
				ОписаниеОшибки = ОписаниеОшибки();
			КонецЕсли;
			Событие = Нстр("ru = 'Не удалось записать документ'");
			ЗаписьЖурналаРегистрации(Событие, УровеньЖурналаРегистрации.Ошибка,, , ОписаниеОшибки); 
			КоличествоОшибка = КоличествоОшибка + 1;
		КонецПопытки;
		
		КоличествоВсего = КоличествоВсего + 1;
		
	КонецЦикла; 
	
	Комментарий = Нстр("ru = 'Количество документов: всего обработано-%1, успешно-%2, с ошибкой-%3'");
	Комментарий = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(Комментарий, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,, Комментарий);
		
КонецПроцедуры //ЗаполнитьВидТранспортнойУслугиВПрохожденииТочки()

// Вызывается при переходе на версию конфигурации 4.0.1.5
//
Процедура ЗаполнитьДействиеУПредопределеннойПроблемыНетДействийСлужебная(Параметры = Неопределено) Экспорт
	
	СобытиеНачало= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Начало'");
	СобытиеКонец= Нстр("ru = 'ВыполнениеПроцедурыОбновления.Конец'");
		
	Этап	= Нстр("ru = 'Заполняется действие у предопределенной проблемы ""Нет действий""'");
	ЗаписьЖурналаРегистрации(СобытиеНачало, УровеньЖурналаРегистрации.Информация,,, Этап);	
	
	Справочники.упПроблемы.ПервоначальноеЗаполнение();
	ЗаписьЖурналаРегистрации(СобытиеКонец, УровеньЖурналаРегистрации.Информация,,,);
	
КонецПроцедуры //ЗаполнитьДействиеУПредопределеннойПроблемыНетДействий()

// Вызывается при переходе на версию конфигурации 4.0.1.6
//
Процедура ЗаполнениеПодтвержденийЗаявокНаТСТипомТС(Параметры = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	упПодтверждениеЗаявкиНаТС.Ссылка КАК Ссылка,
	|	упПодтверждениеЗаявкиНаТС.ТранспортноеСредство.ТипТС КАК ТипТС
	|ИЗ
	|	Документ.упПодтверждениеЗаявкиНаТС КАК упПодтверждениеЗаявкиНаТС
	|ГДЕ
	|	НЕ упПодтверждениеЗаявкиНаТС.ТранспортноеСредство = ЗНАЧЕНИЕ(Справочник.упТранспортныеСредства.ПустаяСсылка)
	|	И НЕ упПодтверждениеЗаявкиНаТС.ПометкаУдаления";
	РезультатЗапроса = Запрос.Выполнить();
	Если Не РезультатЗапроса.Пустой() Тогда
		Выборка = РезультатЗапроса.Выбрать();
		Пока Выборка.Следующий() Цикл
			ПодтверждениеОбъект = Выборка.Ссылка.ПолучитьОбъект();
			ПодтверждениеОбъект.ОбменДанными.Загрузка = Истина;
			ПодтверждениеОбъект.ТипТС = Выборка.ТипТС;			
			Попытка
				ПодтверждениеОбъект.Записать(РежимЗаписиДокумента.Запись);
			Исключение
				ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
					ОписаниеОшибки = ОписаниеОшибки();
				КонецЕсли;
				ЗаписьЖурналаРегистрации("ЗаписьПодтвержденияЗаявкиНаТС", УровеньЖурналаРегистрации.Ошибка,, Выборка.Ссылка, ОписаниеОшибки);
			КонецПопытки;
		КонецЦикла; 
	КонецЕсли; 
	
КонецПроцедуры

// Вызывается при переходе на версию конфигурации 4.0.1.6
//
Процедура ЗаполнитьВерсиюМобильногоКлиента(Параметры = Неопределено) Экспорт
	
	Константы.упВерсияМобильногоКлиента.Установить(Перечисления.упВерсииМобильногоКлиента.TMSMobile3);
		
КонецПроцедуры

#Область СлужебныеПроцедурыИфункции

&НаСервере
Процедура СформироватьПараметрыГрузовПоПорцииЗаданий(ЗавершенаОбработка, КоличествоВсего, КоличествоУспешно, КоличествоОшибка);
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ ПЕРВЫЕ 100
	|	ЗаданиеНаПеревозкуГруза.Ссылка КАК ЗаданиеНаПеревозкуГруза,
	|	ЗаданиеНаПеревозкуГруза.ЗаявкаНаПеревозкуГруза КАК ЗаявкаНаПеревозкуГруза,
	|	ЕСТЬNULL(СтатусыЗаданийКПланированию.Период, ЗаданиеНаПеревозкуГруза.Дата) КАК Период,
	|	ВидыПеревозок.ПараметрыВводаИнформацииОГрузовыхМестах КАК ПараметрыВводаИнформацииОГрузовыхМестах,
	|	ПРЕДСТАВЛЕНИЕ(ЗаданиеНаПеревозкуГруза.Ссылка) КАК ЗаданиеНаПеревозкуПредставление
	|ИЗ
	|	Документ.упЗаданиеНаПеревозкуГруза КАК ЗаданиеНаПеревозкуГруза
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упПараметрыЗаданияНаПеревозку КАК ПараметрыЗадания
	|		ПО (ПараметрыЗадания.Регистратор = ЗаданиеНаПеревозкуГруза.Ссылка)
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.упСтатусыЗаданийНаПеревозкуГруза.СрезПоследних(, ) КАК СтатусыЗаданий
	|		ПО (СтатусыЗаданий.Документ = ЗаданиеНаПеревозкуГруза.Ссылка)
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.упВидыПеревозок КАК ВидыПеревозок
	|		ПО (ВидыПеревозок.Ссылка = ЗаданиеНаПеревозкуГруза.ВидПеревозки)
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упСтатусыЗаданийНаПеревозкуГруза.СрезПоследних(, Статус = ЗНАЧЕНИЕ(Перечисление.упСтатусыЗаданияНаПеревозкуГруза.КПланированию)) КАК СтатусыЗаданийКПланированию
	|		ПО (СтатусыЗаданийКПланированию.Документ = ЗаданиеНаПеревозкуГруза.Ссылка)
	|ГДЕ
	|	ИСТИНА
	|	И НЕ СтатусыЗаданий.Статус В (ЗНАЧЕНИЕ(Перечисление.упСтатусыЗаданияНаПеревозкуГруза.Отменено), ЗНАЧЕНИЕ(Перечисление.упСтатусыЗаданияНаПеревозкуГруза.Новое))
	|	И ЗаданиеНаПеревозкуГруза.Проведен
	|	И ПараметрыЗадания.ЗаданиеНаПеревозку ЕСТЬ NULL";
	РезультатЗапроса = Запрос.Выполнить();
	Если РезультатЗапроса.Пустой() Тогда
		ЗавершенаОбработка = Истина;
	Иначе
		Выборка = РезультатЗапроса.Выбрать();
		Пока Выборка.Следующий() Цикл
			КоличествоВсего = КоличествоВсего + 1;
			ЗаданиеНаПеревозкуГруза = Выборка.ЗаданиеНаПеревозкуГруза;
			ЗаявкаНаПеревозкуГруза  = Выборка.ЗаявкаНаПеревозкуГруза;
			
			НачатьТранзакцию();
			НаборЗаписейЗадания = РегистрыСведений.упПараметрыЗаданияНаПеревозку.СоздатьНаборЗаписей();
			НаборЗаписейЗадания.Отбор.Регистратор.Установить(ЗаданиеНаПеревозкуГруза); 
			Если ЗначениеЗаполнено(ЗаявкаНаПеревозкуГруза) Тогда
				НаборЗаписейЗаявки = РегистрыСведений.упПараметрыЗаявкиНаПеревозку.СоздатьНаборЗаписей();
				НаборЗаписейЗаявки.Отбор.Регистратор.Установить(ЗаданиеНаПеревозкуГруза); 
			КонецЕсли; 
			
			ДополнительныеСвойства = Новый Структура;
			ДополнительныеСвойства.Вставить("ПараметрыВводаИнформацииОГрузовыхМестахПоЗаданию", Выборка.ПараметрыВводаИнформацииОГрузовыхМестах);
			ДополнительныеСвойства.Вставить("Статус", Перечисления.упСтатусыЗаданияНаПеревозкуГруза.КПланированию);
			ЗаданиеОбъект = ЗаданиеНаПеревозкуГруза.ПолучитьОбъект();
			Если Выборка.ПараметрыВводаИнформацииОГрузовыхМестах = Перечисления.упПараметрыВводаИнформацииОГрузовыхМестах.НеВводится Тогда
				сткВозврат = упРасчетПоказателейЗагрузки.РассчитатьИтоговыеПараметрыПоНаборуГрузов(ЗаданиеОбъект.ГрузовыеМеста.Выгрузить());
				ДополнительныеСвойства.Вставить("СтруктураИтоговыхПараметров", сткВозврат);
			КонецЕсли;
			
			Отказ = Ложь;
			ПараметрыНаПеревозку = упРасчетПоказателейЗагрузки.РассчитатьТаблицуПараметровГрузовДляПроведения(ДополнительныеСвойства, ЗаданиеНаПеревозкуГруза, Новый Структура("Дата", Выборка.Период), Отказ);
			
			Для каждого текСтрока Из ПараметрыНаПеревозку Цикл
				НоваяЗаписьЗадание = НаборЗаписейЗадания.Добавить(); 
				НоваяЗаписьЗадание.Период = Выборка.Период;
				НоваяЗаписьЗадание.ЗаданиеНаПеревозку = ЗаданиеНаПеревозкуГруза;
				ЗаполнитьЗначенияСвойств(НоваяЗаписьЗадание, текСтрока);
				НоваяЗаписьЗадание.Регистратор = ЗаданиеНаПеревозкуГруза;
				
				Если ЗначениеЗаполнено(ЗаявкаНаПеревозкуГруза) Тогда
					НоваяЗаписьЗаявка = НаборЗаписейЗаявки.Добавить();
					НоваяЗаписьЗаявка.Период = Выборка.Период;
					НоваяЗаписьЗаявка.ЗаявкаНаПеревозку = ЗаявкаНаПеревозкуГруза;
					ЗаполнитьЗначенияСвойств(НоваяЗаписьЗаявка, текСтрока);
					НоваяЗаписьЗаявка.Регистратор = ЗаданиеНаПеревозкуГруза;
				КонецЕсли;
			КонецЦикла;
			
			Попытка
				НаборЗаписейЗадания.Записать();
				Если ЗначениеЗаполнено(ЗаявкаНаПеревозкуГруза) Тогда
					НаборЗаписейЗаявки.Записать();
				КонецЕсли; 
				КоличествоУспешно = КоличествоУспешно + 1;
			Исключение
				ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
				Если Не ЗначениеЗаполнено(ОписаниеОшибки) Тогда 
					ОписаниеОшибки = ОписаниеОшибки();
				КонецЕсли;
				ТекстОшибки = СтрШаблон("%1: %2", Выборка.ЗаданиеНаПеревозкуПредставление, ОписаниеОшибки());
				
				ЗаписьЖурналаРегистрации("ЗаписьПараметровЗадания", УровеньЖурналаРегистрации.Ошибка,,,ТекстОшибки);
				КоличествоОшибка = КоличествоОшибка + 1;
				Отказ  = Истина;
			КонецПопытки;
			
			Если НЕ Отказ Тогда
				ЗафиксироватьТранзакцию();
			Иначе	
				ОтменитьТранзакцию();
			КонецЕсли;
		КонецЦикла; 
	КонецЕсли; 
		
КонецПроцедуры

#КонецОбласти 