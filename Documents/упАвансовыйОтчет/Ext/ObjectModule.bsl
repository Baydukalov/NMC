
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
	
#Область ОбработчикиСобытий

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	
	
		//тбзРейсы = РейсыДляРаспределения(); 
	
		БлокировкаДанных = Новый БлокировкаДанных;
		
		//ЭлементБлокировки = БлокировкаДанных.Добавить("РегистрНакопления.упРасходы");
		//ЭлементБлокировки.ИсточникДанных = тбзРейсы;
		//ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Рейс", "Рейс");
		//ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
		
		Попытка
			БлокировкаДанных.Заблокировать();
		Исключение
			Отказ = Истина;
			Возврат;
		КонецПопытки;
		
		РеквизитыОбъекта = Новый Структура();
		РеквизитыОбъекта.Вставить("Дата", 					Дата);
		//РеквизитыОбъекта.Вставить("СпособВводаРасходов",		Перечисления.упСпособыВводаФактическихРасходов.ОбобщенныеРасходыПоНесколькимРейсам);
		//РеквизитыОбъекта.Вставить("Рейсы", 				тбзРейсы);
		РеквизитыОбъекта.Вставить("Организация", 			Организация);
		РеквизитыОбъекта.Вставить("Подразделение", 			Подразделение);
		РеквизитыОбъекта.Вставить("НаправлениеДеятельности", 	Справочники.упНаправленияДеятельности.ПустаяСсылка());
		
		// Формируются расходы
		//упРаспределениеРасходов.СформироватьРасходыПоФактическимРасходамПоРейсу(ДополнительныеСвойства, Ссылка, Движения, РеквизитыОбъекта, Отказ);	
		//
		//// Прочие расходы
		//упУправлениеЗапасами.СформироватьДвиженияПрочиеРасходы(ДополнительныеСвойства, Ссылка, Движения, РеквизитыОбъекта, Отказ);
	
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	Изменил = упСервисныеФункцииКлиентСервер.АвторПоследнегоИзмененияОбъекта(ДополнительныеСвойства);	
	
	Если РежимЗаписи = РежимЗаписиДокумента.Проведение Тогда
		ВедетсяВалютныйУчет	= ПолучитьФункциональнуюОпцию("упВедетсяВалютныйУчет");
		ДополнительныеСвойства.Вставить("ВедетсяВалютныйУчет", ВедетсяВалютныйУчет);
		
		//упРаспределениеРасходов.ЗаполнитьАналитическиеРазрезы(ЭтотОбъект, Отказ);	
		//
		//// Вынесено сюда для корректного подсчета итоговых сумм в валюте управленческого учета.
		//упРаспределениеРасходов.ЗаполнитьИтоговыеСуммыДоходовРасходов(ЭтотОбъект);	
	КонецЕсли;
КонецПроцедуры

#КонецОбласти 

#Область СлужебныеПроцедурыИФункции

#КонецОбласти 

#КонецЕсли