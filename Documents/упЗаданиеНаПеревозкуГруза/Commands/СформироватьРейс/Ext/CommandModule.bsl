
#Область ОбработчикиСобытий

&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	Отказ = Ложь;
	ТекстОшибки = "";
	мсвРейсов = СформироватьРейсыНаСервере(ПараметрКоманды, ТекстОшибки, Отказ);
	Если Не Отказ Тогда
		Если мсвРейсов.Количество() > 0  Тогда
			
			Для каждого текЗадание Из ПараметрКоманды Цикл
				Оповестить("СменаСтатуса",, текЗадание);				
			КонецЦикла; 
			
			Для каждого текРейс Из мсвРейсов Цикл
				ОткрытьФорму("Документ.упРейс.ФормаОбъекта", Новый Структура("Ключ", текРейс), ПараметрыВыполненияКоманды.Источник);
			КонецЦикла;
			
			Если ТекстОшибки <> "" Тогда
				ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстОшибки);
			КонецЕсли; 
			
			мсвЗаявки = упЗаданиеНаПеревозкуВызовСервера.ПолучитьЗаявкиПоЗаданиям(ПараметрКоманды);
			
			Для каждого текЗаявка Из мсвЗаявки Цикл
				Оповестить("СменаСтатуса",, текЗаявка);				
			КонецЦикла;
			
		Иначе
			Если ТекстОшибки = ""  Тогда
				ТекстОшибки = НСтр("ru = 'Рейсы не сформированы'");
			КонецЕсли; 
			ПоказатьПредупреждение(, ТекстОшибки);
		КонецЕсли;
	Иначе
		ПоказатьОповещениеПользователя(НСтр("ru = 'Рейсы не сформированы'"),, ТекстОшибки, БиблиотекаКартинок.Ошибка32);
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти 

#Область СлужебныеПроцедурыИФункции

&НаСервере
Функция СформироватьРейсыНаСервере(мсвЗаданийНаПеревозку, ТекстОшибки, Отказ)
	
	РеквизитыПоУмолчанию = Новый Структура;
	РеквизитыПоУмолчанию.Вставить("Автор",ПользователиКлиентСервер.ТекущийПользователь());
	
	Возврат Документы.упЗаданиеНаПеревозкуГруза.СформироватьРейсы(мсвЗаданийНаПеревозку,,РеквизитыПоУмолчанию,, ТекстОшибки, Отказ);
	
КонецФункции

#КонецОбласти 