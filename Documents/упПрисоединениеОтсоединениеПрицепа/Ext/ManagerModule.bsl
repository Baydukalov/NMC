#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

////////////////////////////////////////////////////////////////////////////////
// Интерфейс для работы с подсистемой ЗапретРедактированияРеквизитовОбъектов.

// Возвращает описание блокируемых реквизитов.
//
// Возвращаемое значение:
//     Массив - содержит строки в формате ИмяРеквизита[;ИмяЭлементаФормы,...]
//              где ИмяРеквизита - имя реквизита объекта, ИмяЭлементаФормы - имя элемента формы, связанного с
//              реквизитом.
//
Функция ПолучитьБлокируемыеРеквизитыОбъекта() Экспорт
	
	БлокируемыеРеквизиты = Новый Массив;
	
	БлокируемыеРеквизиты.Добавить("Организация");
	БлокируемыеРеквизиты.Добавить("Подразделение");
	БлокируемыеРеквизиты.Добавить("ТранспортноеСредство");
	
	Возврат БлокируемыеРеквизиты;
	
КонецФункции


#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область Проведение

// Процедура - выполнить контроль прицепа.
//
Процедура ВыполнитьКонтрольПрицепа(Ссылка, Отказ) Экспорт
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ЕСТЬNULL(упПрицепы.Операция, ЗНАЧЕНИЕ(Перечисление.упТипыОперацийМонтажа.ПустаяСсылка)) КАК Операция,
	               |	упТранспортныеСредства.Ссылка КАК Прицеп,
	               |	упПрицепы.ТранспортноеСредство
	               |ИЗ
	               |	Справочник.упТранспортныеСредства КАК упТранспортныеСредства
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упПрицепыТранспортныхСредств.СрезПоследних(&Дата, Прицеп = &Прицеп) КАК упПрицепы
	               |		ПО упТранспортныеСредства.Ссылка = упПрицепы.Прицеп
	               |ГДЕ
	               |	упТранспортныеСредства.Прицеп = ИСТИНА
	               |	И упТранспортныеСредства.ПометкаУдаления = ЛОЖЬ
	               |	И упТранспортныеСредства.Ссылка = &Прицеп";
	
	Запрос.УстановитьПараметр("Дата",Новый Граница(Ссылка.ДатаОперации, ВидГраницы.Включая));
	Запрос.УстановитьПараметр("Прицеп", Ссылка.Прицеп);

	Результат = Запрос.Выполнить();
	Если НЕ Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Выборка.Следующий();  		
	
		ТекстОшибки = "";
  
		Если Выборка.Операция = Перечисления.упТипыОперацийМонтажа.Установлено 
			 И Ссылка.Операция = Перечисления.упТипыОперацийМонтажа.Установлено Тогда 
			
			ТекстОшибки = НСтр(СтрШаблон("ru = 'Прицеп: ""%1"" уже закреплен за ТС: ""%2"".'", Ссылка.Прицеп, Выборка.ТранспортноеСредство));
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстОшибки, Ссылка,,, Отказ);
			
		ИначеЕсли Выборка.Операция = Перечисления.упТипыОперацийМонтажа.Снято
					и Ссылка.Операция = Перечисления.упТипыОперацийМонтажа.Снято Тогда 
								
            ТекстОшибки = НСтр(СтрШаблон("ru = 'Прицеп: ""%1"" уже  снят с ТС.'", Ссылка.Прицеп));
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстОшибки, Ссылка,,, Отказ);
			
		ИначеЕсли Выборка.Операция = Перечисления.упТипыОперацийМонтажа.Установлено 
			и Ссылка.Операция = Перечисления.упТипыОперацийМонтажа.Снято
			и Выборка.ТранспортноеСредство <> ссылка.ТранспортноеСредство Тогда 
			ТекстОшибки = НСтр(СтрШаблон("ru = 'Прицеп: ""%1"" закреплен за другим ТС: ""%2"".'", Ссылка.Прицеп, Выборка.ТранспортноеСредство));
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстОшибки, Ссылка,,, Отказ);
			
		ИначеЕсли Выборка.Операция = Перечисления.упТипыОперацийМонтажа.ПустаяСсылка() 
			и Ссылка.Операция = Перечисления.упТипыОперацийМонтажа.Снято Тогда 
			ТекстОшибки = НСтр(СтрШаблон("ru = 'Прицеп: ""%1"" не закреплен ни за одним ТС. Операция не выполнена.'", Ссылка.Прицеп));
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстОшибки, Ссылка,,, Отказ);
	
		КонецЕсли;
		
				
	КонецЕсли;
	
	
КонецПроцедуры //ПолучитьСписокСвободныхПрицеповНаСервереБезКонтекста()

#КонецОбласти

#Область ПроцедурыФункцииПечати

// Заполняет список команд печати.
//
// Параметры:
//   КомандыПечати - ТаблицаЗначений - состав полей см. в функции УправлениеПечатью.СоздатьКоллекциюКомандПечати
//
Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
	
  // Нет.
   	
КонецПроцедуры // ДобавитьКомандыПечати()

// Формирует печатные формы.
//
// Параметры:
//  МассивОбъектов  - Массив    - ссылки на объекты, которые нужно распечатать.
//  ПараметрыПечати - Структура - дополнительные настройки печати.
//  КоллекцияПечатныхФорм - ТаблицаЗначений - сформированные табличные документы (выходной параметр).
//  ОбъектыПечати - СписокЗначений - объекты печати: 
//											  * значение - ссылка на объект.
//                                            * представление - имя области в которой был выведен объект (выходной параметр).
//  ПараметрыВывода - Структура - дополнительные параметры сформированных табличных документов (выходной параметр).
//
Процедура Печать(МассивОбъектов, ПараметрыПечати, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт
	
	// Нет.
	
КонецПроцедуры // Печать()

#КонецОбласти

#КонецОбласти

#КонецЕсли
