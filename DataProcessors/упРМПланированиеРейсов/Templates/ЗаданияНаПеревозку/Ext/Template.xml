<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>ЗаданияНаПеревозку</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>ГрузовоеМесто</dataPath>
			<field>ГрузовоеМесто</field>
			<useRestriction>
				<condition>true</condition>
			</useRestriction>
			<attributeUseRestriction>
				<condition>true</condition>
			</attributeUseRestriction>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Задание</dataPath>
			<field>Задание</field>
			<useRestriction>
				<condition>true</condition>
			</useRestriction>
			<attributeUseRestriction>
				<condition>true</condition>
			</attributeUseRestriction>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПрозрачностьЛинии</dataPath>
			<field>ПрозрачностьЛинии</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Прозрачность линии</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПолучениеГрузаС</dataPath>
			<field>ПолучениеГрузаС</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЦветЛинии</dataPath>
			<field>ЦветЛинии</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Цвет линии</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Отправитель</dataPath>
			<field>Отправитель</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ШиротаТочкиПолучения</dataPath>
			<field>ШиротаТочкиПолучения</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Широта точки получения</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>АдресОтправления</dataPath>
			<field>АдресОтправления</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КоличествоГрузов</dataPath>
			<field>КоличествоГрузов</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Количество грузов</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПредставлениеГруза</dataPath>
			<field>ПредставлениеГруза</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Представление груза</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДолготаТочкиОтправления</dataPath>
			<field>ДолготаТочкиОтправления</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Долгота точки отправления</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>НомерВЦепиПоставок</dataPath>
			<field>НомерВЦепиПоставок</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Получатель</dataPath>
			<field>Получатель</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ШиротаТочкиОтправления</dataPath>
			<field>ШиротаТочкиОтправления</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Широта точки отправления</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КоличествоМест</dataPath>
			<field>КоличествоМест</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Количество мест</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Активно</dataPath>
			<field>Активно</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Активно</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВидАдресаОтправления</dataPath>
			<field>ВидАдресаОтправления</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Вид адреса отправления</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВремяРазгрузки</dataPath>
			<field>ВремяРазгрузки</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Время разгрузки</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ТипПеревозки</dataPath>
			<field>ТипПеревозки</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Тип перевозки</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗаданиеНаПеревозку</dataPath>
			<field>ЗаданиеНаПеревозку</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Задание на перевозку</v8:content>
				</v8:item>
			</title>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДолготаТочкиПолучения</dataPath>
			<field>ДолготаТочкиПолучения</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Долгота точки получения</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ГрафикОтправления</dataPath>
			<field>ГрафикОтправления</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>График отправления</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Заказчик</dataPath>
			<field>Заказчик</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВремяПогрузки</dataPath>
			<field>ВремяПогрузки</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Время погрузки</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПолучениеГрузаПо</dataPath>
			<field>ПолучениеГрузаПо</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ТолщинаЛинии</dataPath>
			<field>ТолщинаЛинии</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Толщина линии</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗонаПолучения</dataPath>
			<field>ЗонаПолучения</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Путь</dataPath>
			<field>Путь</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Путь</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>АдресПолучения</dataPath>
			<field>АдресПолучения</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Масса</dataPath>
			<field>Масса</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Масса</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Организация</dataPath>
			<field>Организация</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КоличествоЗагрузочныхМетров</dataPath>
			<field>КоличествоЗагрузочныхМетров</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Количество загрузочных метров</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Срочность</dataPath>
			<field>Срочность</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Срочность</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ГрафикПолучения</dataPath>
			<field>ГрафикПолучения</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>График получения</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗонаОтправления</dataPath>
			<field>ЗонаОтправления</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Объем</dataPath>
			<field>Объем</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Объем</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ОценочнаяСтоимость</dataPath>
			<field>ОценочнаяСтоимость</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Оценочная стоимость</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВидАдресаПолучения</dataPath>
			<field>ВидАдресаПолучения</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Вид адреса получения</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПредыдущееЗадание</dataPath>
			<field>ПредыдущееЗадание</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Предыдущее задание</v8:content>
				</v8:item>
			</title>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СтатусПредыдущегоМультимодальногоЗадания</dataPath>
			<field>СтатусПредыдущегоМультимодальногоЗадания</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Статус предыдущего мультимодального задания</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Тара</dataPath>
			<field>Тара</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПолеУпорядочивания1</dataPath>
			<field>ПолеУпорядочивания1</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Поле упорядочивания1</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПолеУпорядочивания2</dataPath>
			<field>ПолеУпорядочивания2</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Поле упорядочивания2</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Дата</dataPath>
			<field>Дата</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЭтоВозвратГруза</dataPath>
			<field>ЭтоВозвратГруза</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Это возврат груза</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ОтправлениеГрузаПо</dataPath>
			<field>ОтправлениеГрузаПо</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ОтправлениеГрузаС</dataPath>
			<field>ОтправлениеГрузаС</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КоординатыПолучения</dataPath>
			<field>КоординатыПолучения</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Координаты получения</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КоординатыОтправления</dataPath>
			<field>КоординатыОтправления</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Координаты отправления</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗаявкаНаПеревозкуГруза</dataPath>
			<field>ЗаявкаНаПеревозкуГруза</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИмяОтправления</dataPath>
			<field>ИмяОтправления</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Имя отправления</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИмяПолучения</dataPath>
			<field>ИмяПолучения</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Имя получения</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Документ</dataPath>
			<field>Документ</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗаявкаНаПеревозку</dataPath>
			<field>ЗаявкаНаПеревозку</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЭтоИнкассация</dataPath>
			<field>ЭтоИнкассация</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Это инкассация</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>НомерВЦепиПоставокКонец</dataPath>
			<field>НомерВЦепиПоставокКонец</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Номер в цепи поставок конец</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЕстьДоставкиВТочкуНаПериодПланирования</dataPath>
			<field>ЕстьДоставкиВТочкуНаПериодПланирования</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Есть доставки на период планирования (для возвратов)</v8:content>
				</v8:item>
			</title>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ОстаткиКПланированию.Задание КАК _ЗаданиеНаПеревозку,
	ОстаткиКПланированию.ГрузовоеМесто КАК ГрузовоеМесто,
	ОстаткиКПланированию.КоличествоКПланированиюОстаток КАК Количество
ПОМЕСТИТЬ втОстаткиПодготовка
ИЗ
	РегистрНакопления.упЗаданияКПланированию.Остатки(, ) КАК ОстаткиКПланированию
ГДЕ
	ОстаткиКПланированию.КоличествоКПланированиюОстаток &gt; 0
	И ОстаткиКПланированию.Задание.ВидПеревозки = &amp;ВидПеревозки
	И ОстаткиКПланированию.Задание.ОтправлениеГрузаС &lt; &amp;КонецПериода
	И ВЫБОР
			КОГДА ОстаткиКПланированию.Задание.ПолучениеГрузаПо = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
				ТОГДА ДАТАВРЕМЯ(3999, 12, 31, 23, 59, 59)
			ИНАЧЕ ОстаткиКПланированию.Задание.ПолучениеГрузаПо
		КОНЕЦ &gt; &amp;НачалоПериода
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	втОстаткиПодготовка._ЗаданиеНаПеревозку КАК ЗаданиеНаПеревозку,
	упЗаданиеНаПеревозкуГруза.ЗаявкаНаПеревозкуГруза КАК ЗаявкаНаПеревозкуГруза,
	упЗаданиеНаПеревозкуГруза.АдресОтправления,
	упЗаданиеНаПеревозкуГруза.АдресПолучения,
	упЗаданиеНаПеревозкуГруза.НомерВЦепиПоставок
ПОМЕСТИТЬ втЗадания03
ИЗ втОстаткиПодготовка КАК втОстаткиПодготовка
ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.упЗаданиеНаПеревозкуГруза КАК упЗаданиеНаПеревозкуГруза
		ПО втОстаткиПодготовка._ЗаданиеНаПеревозку = упЗаданиеНаПеревозкуГруза.Ссылка
			И (ВЫБОР
				КОГДА упЗаданиеНаПеревозкуГруза.ОтправлениеГрузаПо = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
					ТОГДА ДАТАВРЕМЯ(3999, 12, 31, 23, 59, 59)
				ИНАЧЕ упЗаданиеНаПеревозкуГруза.ОтправлениеГрузаПо
			КОНЕЦ &gt;= &amp;НачалоПериода)
			И (ВЫБОР
				КОГДА упЗаданиеНаПеревозкуГруза.ПолучениеГрузаС = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
					ТОГДА ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
				ИНАЧЕ упЗаданиеНаПеревозкуГруза.ПолучениеГрузаС
			КОНЕЦ &lt; &amp;КонецПериода)

;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	втЗадания.АдресПолучения
ПОМЕСТИТЬ втАдресаПолучения
ИЗ 
	втЗадания03 КАК втЗадания
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	втЗадания.ЗаданиеНаПеревозку КАК ЗаданиеНаПеревозкуГруза,
	МИНИМУМ(упСтатусыЗаданий.Статус) КАК СтатусПредыдущегоЗадания
ПОМЕСТИТЬ втПредшествующиеЗадания
ИЗ
	втЗадания03 КАК втЗадания
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.упЗаданиеНаПеревозкуГруза КАК упЗаданиеНаПеревозкуГруза
			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упСтатусыЗаданийНаПеревозкуГруза.СрезПоследних КАК упСтатусыЗаданий
			ПО упЗаданиеНаПеревозкуГруза.Ссылка = упСтатусыЗаданий.Документ
		ПО втЗадания.ЗаявкаНаПеревозкуГруза = упЗаданиеНаПеревозкуГруза.ЗаявкаНаПеревозкуГруза
			И втЗадания.НомерВЦепиПоставок = упЗаданиеНаПеревозкуГруза.НомерВЦепиПоставок + 1

СГРУППИРОВАТЬ ПО
	втЗадания.ЗаданиеНаПеревозку
	
ИНДЕКСИРОВАТЬ ПО
	втЗадания.ЗаданиеНаПеревозку	
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВидыТочекОтправления.ВидТочкиОтправления
ПОМЕСТИТЬ втВидыТочекОтправления
ИЗ Справочник.упВидыПеревозок.ВидыТочекОтправления КАК ВидыТочекОтправления
ГДЕ
	ВидыТочекОтправления.Ссылка = &amp;ВидПеревозки
;



////////////////////////////////////////////////////////////////////////////////
// 820т17аипв
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ЗаданиеЗависимоеГрузовыеМеста._ЗаданиеНаПеревозку КАК ЗависимоеЗадание,
	ЗаданиеЗависимоеГрузовыеМеста.ГрузовоеМесто КАК ГрузовоеМесто,
	МАКСИМУМ(ЗаданиеОсновноеГрузовыеМеста._ЗаданиеНаПеревозку) КАК ОсновноеЗадание
ПОМЕСТИТЬ ЗависимыеЗадания
ИЗ
	Справочник.упПравилаСвязиТиповГрузов.Связи КАК ПравилаСвязиТиповГрузов
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втОстаткиПодготовка КАК ЗаданиеОсновноеГрузовыеМеста
		ПО ПравилаСвязиТиповГрузов.ОсновнойТипГруза.Ссылка = ЗаданиеОсновноеГрузовыеМеста.ГрузовоеМесто.ТипГруза
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втОстаткиПодготовка КАК ЗаданиеЗависимоеГрузовыеМеста
		ПО (ИСТИНА)
			И ПравилаСвязиТиповГрузов.ЗависимыйТипГруза.Ссылка = ЗаданиеЗависимоеГрузовыеМеста.ГрузовоеМесто.ТипГруза
			И (ЗаданиеОсновноеГрузовыеМеста._ЗаданиеНаПеревозку.НомерВЦепиПоставок = ЗаданиеЗависимоеГрузовыеМеста._ЗаданиеНаПеревозку.НомерВЦепиПоставок)
			И (ЗаданиеОсновноеГрузовыеМеста._ЗаданиеНаПеревозку.ЗаявкаНаПеревозкуГруза = ЗаданиеЗависимоеГрузовыеМеста._ЗаданиеНаПеревозку.ЗаявкаНаПеревозкуГруза)
			И (ПравилаСвязиТиповГрузов.Ссылка = ВЫРАЗИТЬ(&amp;ВидПеревозки КАК Справочник.упВидыПеревозок).ПравилоСвязиТиповГрузовВРейсе)			
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втЗадания03 КАК втЗадания03
		ПО втЗадания03.ЗаданиеНаПеревозку В (ЗаданиеОсновноеГрузовыеМеста._ЗаданиеНаПеревозку, ЗаданиеЗависимоеГрузовыеМеста._ЗаданиеНаПеревозку) 	

СГРУППИРОВАТЬ ПО
	ЗаданиеЗависимоеГрузовыеМеста._ЗаданиеНаПеревозку,
	ЗаданиеЗависимоеГрузовыеМеста.ГрузовоеМесто
;

////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втЗадания.ЗаявкаНаПеревозкуГруза КАК ЗаявкаНаПеревозкуГруза,
	втОстаткиПодготовка._ЗаданиеНаПеревозку КАК ЗаданиеНаПеревозку,
	втОстаткиПодготовка.ГрузовоеМесто КАК ГрузовоеМесто,
	втОстаткиПодготовка.Количество КАК Количество,
	ЕСТЬNULL(ЗависимыеЗадания.ОсновноеЗадание, ЗНАЧЕНИЕ(Документ.упЗаданиеНаПеревозкуГруза.ПустаяСсылка)) КАК ПредыдущееЗадание
ПОМЕСТИТЬ втОстатки
ИЗ
	втОстаткиПодготовка КАК втОстаткиПодготовка
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втЗадания03 КАК втЗадания
		ПО втОстаткиПодготовка._ЗаданиеНаПеревозку = втЗадания.ЗаданиеНаПеревозку
		ЛЕВОЕ СОЕДИНЕНИЕ ЗависимыеЗадания КАК ЗависимыеЗадания
		ПО втОстаткиПодготовка._ЗаданиеНаПеревозку = ЗависимыеЗадания.ЗависимоеЗадание
			И втОстаткиПодготовка.ГрузовоеМесто = ЗависимыеЗадания.ГрузовоеМесто
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
			ОстаткиВедущих._ЗаданиеНаПеревозку КАК _ЗаданиеНаПеревозку
		ИЗ
			втОстаткиПодготовка КАК ОстаткиВедущих) КАК ОстаткиВедущих
		ПО (ОстаткиВедущих._ЗаданиеНаПеревозку = ЗависимыеЗадания.ОсновноеЗадание)
{ГДЕ
	(ВЫБОР
			КОГДА ОстаткиВедущих._ЗаданиеНаПеревозку ЕСТЬ NULL
				ТОГДА ЗНАЧЕНИЕ(Документ.упЗаданиеНаПеревозкуГруза.ПустаяСсылка)
			ИНАЧЕ ЗависимыеЗадания.ОсновноеЗадание
		КОНЕЦ) КАК ПредыдущееЗадание}
ИНДЕКСИРОВАТЬ ПО
	ЗаявкаНаПеревозкуГруза
;

////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	втОстатки.ЗаданиеНаПеревозку КАК ЗаданиеНаПеревозку,
	втОстатки.ГрузовоеМесто КАК ГрузовоеМесто,
	МАКСИМУМ(втОстатки.ПредыдущееЗадание) КАК ПредыдущееЗадание
ПОМЕСТИТЬ втЗадания05
ИЗ
	втОстатки КАК втОстатки

СГРУППИРОВАТЬ ПО
	втОстатки.ЗаданиеНаПеревозку,
	втОстатки.ГрузовоеМесто
	
ИНДЕКСИРОВАТЬ ПО
	ЗаданиеНаПеревозку	
;


//////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втОстатки.ЗаданиеНаПеревозку КАК ЗаданиеНаПеревозку,
	втОстатки.ПредыдущееЗадание КАК ПредыдущееЗадание,
	ПРЕДСТАВЛЕНИЕССЫЛКИ(втОстатки.ГрузовоеМесто) КАК ПредставлениеГруза,
	втОстатки.ГрузовоеМесто КАК ГрузовоеМесто,
    ЕСТЬNULL(упВремяВыполненияПогрузочныхРабот.Время, 0) * втОстатки.Количество КАК ВремяПогрузки,
	ЕСТЬNULL(упВремяВыполненияРазгрузочныхРабот.Время, 0) * втОстатки.Количество КАК ВремяРазгрузки,
	втОстатки.Количество КАК КоличествоГрузов,
	ЕСТЬNULL(упПараметрыЗаявкиНаПеревозку.КоличествоМест,ЕСТЬNULL( упПараметрыЗаданияНаПеревозку.КоличествоМест, 0)) * втОстатки.Количество КАК КоличествоМест,
	ЕСТЬNULL(упПараметрыЗаявкиНаПеревозку.КоличествоЗагрузочныхМетров, ЕСТЬNULL(упПараметрыЗаданияНаПеревозку.КоличествоЗагрузочныхМетров, 0)) * втОстатки.Количество КАК КоличествоЗагрузочныхМетров,
	ЕСТЬNULL(упПараметрыЗаявкиНаПеревозку.Объем, ЕСТЬNULL(упПараметрыЗаданияНаПеревозку.Объем, 0)) * втОстатки.Количество КАК Объем,
	ЕСТЬNULL(упПараметрыЗаявкиНаПеревозку.Масса, ЕСТЬNULL(упПараметрыЗаданияНаПеревозку.Масса, 0)) * втОстатки.Количество КАК Масса,
	втОстатки.ГрузовоеМесто.ОценочнаяСтоимость * втОстатки.Количество КАК ОценочнаяСтоимость
ПОМЕСТИТЬ втПоказателиПеревозки
ИЗ
	втОстатки КАК втОстатки
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втЗадания05 КАК втЗадания
		ПО (ИСТИНА)
			И втОстатки.ЗаданиеНаПеревозку = втЗадания.ЗаданиеНаПеревозку
			И втОстатки.ГрузовоеМесто = втЗадания.ГрузовоеМесто
			И &amp;РазбиватьЗаданияПоГрузовымМестам
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упПараметрыЗаявкиНаПеревозку.СрезПоследних(, ЗаявкаНаПеревозку В (ВЫБРАТЬ втОстатки.ЗаявкаНаПеревозкуГруза ИЗ втОстатки КАК втОстатки ГДЕ НЕ втОстатки.ЗаявкаНаПеревозкуГруза = ЗНАЧЕНИЕ(Документ.упЗаявкаНаПеревозкуГруза.ПустаяСсылка))) КАК упПараметрыЗаявкиНаПеревозку
		ПО втОстатки.ЗаявкаНаПеревозкуГруза = упПараметрыЗаявкиНаПеревозку.ЗаявкаНаПеревозку
			И втОстатки.ГрузовоеМесто = упПараметрыЗаявкиНаПеревозку.ГрузовоеМесто
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упПараметрыЗаданияНаПеревозку.СрезПоследних(, ЗаданиеНаПеревозку В (ВЫБРАТЬ втОстатки.ЗаданиеНаПеревозку ИЗ втОстатки КАК втОстатки)) КАК упПараметрыЗаданияНаПеревозку
		ПО втОстатки.ЗаданиеНаПеревозку = упПараметрыЗаданияНаПеревозку.ЗаданиеНаПеревозку
			И втОстатки.ГрузовоеМесто = упПараметрыЗаданияНаПеревозку.ГрузовоеМесто
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упВремяВыполненияРабот КАК упВремяВыполненияПогрузочныхРабот
		ПО (ИСТИНА)
			И втОстатки.ЗаданиеНаПеревозку.АдресОтправления.ВидАдреса = упВремяВыполненияПогрузочныхРабот.ВидТочки
			И (упВремяВыполненияПогрузочныхРабот.ТипОперации = ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.Погрузка))
			И (втЗадания.ГрузовоеМесто.ТипГруза = упВремяВыполненияПогрузочныхРабот.ТипГруза)
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упВремяВыполненияРабот КАК упВремяВыполненияРазгрузочныхРабот
		ПО (ИСТИНА)
			И втОстатки.ЗаданиеНаПеревозку.АдресПолучения.ВидАдреса = упВремяВыполненияРазгрузочныхРабот.ВидТочки
			И (упВремяВыполненияРазгрузочныхРабот.ТипОперации = ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.Разгрузка))
			И (втЗадания.ГрузовоеМесто.ТипГруза = упВремяВыполненияРазгрузочныхРабот.ТипГруза)
	
ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	втОстатки.ЗаданиеНаПеревозку,
	втОстатки.ПредыдущееЗадание,
	NULL,
	ЗНАЧЕНИЕ(Справочник.упГрузовыеМеста.ПустаяСсылка),
	втЗадания.ЗаданиеНаПеревозку.ВремяПогрузки,
	втЗадания.ЗаданиеНаПеревозку.ВремяРазгрузки,
	1,
	ЕСТЬNULL(упПараметрыЗаявкиНаПеревозку.КоличествоМест, ЕСТЬNULL(упПараметрыЗаданияНаПеревозку.КоличествоМест, 0)),
	ЕСТЬNULL(упПараметрыЗаявкиНаПеревозку.КоличествоЗагрузочныхМетров, ЕСТЬNULL(упПараметрыЗаданияНаПеревозку.КоличествоЗагрузочныхМетров, 0)),
	ЕСТЬNULL(упПараметрыЗаявкиНаПеревозку.Объем, ЕСТЬNULL(упПараметрыЗаданияНаПеревозку.Объем, 0)),
	ЕСТЬNULL(упПараметрыЗаявкиНаПеревозку.Масса, ЕСТЬNULL(упПараметрыЗаданияНаПеревозку.Масса, 0)),
	втЗадания.ЗаданиеНаПеревозку.ОценочнаяСтоимость КАК ОценочнаяСтоимость
ИЗ
	втОстатки КАК втОстатки
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втЗадания05 КАК втЗадания
		ПО втОстатки.ЗаданиеНаПеревозку = втЗадания.ЗаданиеНаПеревозку
			//И ВЫРАЗИТЬ(&amp;ВидПеревозки КАК Справочник.упВидыПеревозок).ПараметрыВводаИнформацииОГрузовыхМестах = ЗНАЧЕНИЕ(Перечисление.упПараметрыВводаИнформацииОГрузовыхМестах.НеВводится)
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упПараметрыЗаявкиНаПеревозку.СрезПоследних(, ЗаявкаНаПеревозку В (ВЫБРАТЬ втОстатки.ЗаявкаНаПеревозкуГруза ИЗ втОстатки КАК втОстатки ГДЕ НЕ втОстатки.ЗаявкаНаПеревозкуГруза = ЗНАЧЕНИЕ(Документ.упЗаявкаНаПеревозкуГруза.ПустаяСсылка))) КАК упПараметрыЗаявкиНаПеревозку
		ПО втОстатки.ЗаявкаНаПеревозкуГруза = упПараметрыЗаявкиНаПеревозку.ЗаявкаНаПеревозку
			И втОстатки.ГрузовоеМесто = упПараметрыЗаявкиНаПеревозку.ГрузовоеМесто
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упПараметрыЗаданияНаПеревозку.СрезПоследних(, ЗаданиеНаПеревозку В (ВЫБРАТЬ втОстатки.ЗаданиеНаПеревозку ИЗ втОстатки КАК втОстатки)) КАК упПараметрыЗаданияНаПеревозку
		ПО втОстатки.ЗаданиеНаПеревозку = упПараметрыЗаданияНаПеревозку.ЗаданиеНаПеревозку
			И втОстатки.ГрузовоеМесто = упПараметрыЗаданияНаПеревозку.ГрузовоеМесто
ГДЕ ВЫРАЗИТЬ(&amp;ВидПеревозки КАК Справочник.упВидыПеревозок).ПараметрыВводаИнформацииОГрузовыхМестах = ЗНАЧЕНИЕ(Перечисление.упПараметрыВводаИнформацииОГрузовыхМестах.НеВводится)				
	
ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	втОстатки.ЗаданиеНаПеревозку,
	втОстатки.ПредыдущееЗадание,
	NULL,
	ЗНАЧЕНИЕ(Справочник.упГрузовыеМеста.ПустаяСсылка),
	СУММА(упВремяВыполненияПогрузочныхРабот.Время * упГрузовыеМеста.КоличествоГрузов),
	СУММА(упВремяВыполненияРазгрузочныхРабот.Время * упГрузовыеМеста.КоличествоГрузов),
	СУММА(1),
	СУММА(ЕСТЬNULL(упПараметрыЗаявкиНаПеревозку.КоличествоМест, ЕСТЬNULL(упПараметрыЗаданияНаПеревозку.КоличествоМест, 0)) * упГрузовыеМеста.КоличествоГрузов) КАК КоличествоМест,
	СУММА(ЕСТЬNULL(упПараметрыЗаявкиНаПеревозку.КоличествоЗагрузочныхМетров,  ЕСТЬNULL(упПараметрыЗаданияНаПеревозку.КоличествоЗагрузочныхМетров, 0)) * упГрузовыеМеста.КоличествоГрузов) КАК КоличествоЗагрузочныхМетров,
	СУММА(ЕСТЬNULL(упПараметрыЗаявкиНаПеревозку.Объем,  ЕСТЬNULL(упПараметрыЗаданияНаПеревозку.Объем, 0)) * упГрузовыеМеста.КоличествоГрузов) КАК Объем,
	СУММА(ЕСТЬNULL(упПараметрыЗаявкиНаПеревозку.Масса, ЕСТЬNULL( упПараметрыЗаданияНаПеревозку.Масса, 0)) * упГрузовыеМеста.КоличествоГрузов) КАК Масса,
	СУММА(упГрузовыеМеста.ГрузовоеМесто.ОценочнаяСтоимость * ЕСТЬNULL(упГрузовыеМеста.КоличествоГрузов, 0)) КАК ОценочнаяСтоимость
ИЗ
	втОстатки КАК втОстатки
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втЗадания05 КАК втЗадания
		ПО втОстатки.ЗаданиеНаПеревозку = втЗадания.ЗаданиеНаПеревозку
			//И ВЫРАЗИТЬ(&amp;ВидПеревозки КАК Справочник.упВидыПеревозок).ПараметрыВводаИнформацииОГрузовыхМестах = ЗНАЧЕНИЕ(Перечисление.упПараметрыВводаИнформацииОГрузовыхМестах.ВводитсяВЗаданииДоНачалаВыполненияРейса)
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.упЗаданиеНаПеревозкуГруза.ГрузовыеМеста КАК упГрузовыеМеста
		ПО втОстатки.ЗаданиеНаПеревозку = упГрузовыеМеста.Ссылка
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упПараметрыЗаявкиНаПеревозку.СрезПоследних(, ЗаявкаНаПеревозку В (ВЫБРАТЬ втОстатки.ЗаявкаНаПеревозкуГруза ИЗ втОстатки КАК втОстатки ГДЕ НЕ втОстатки.ЗаявкаНаПеревозкуГруза = ЗНАЧЕНИЕ(Документ.упЗаявкаНаПеревозкуГруза.ПустаяСсылка))) КАК упПараметрыЗаявкиНаПеревозку
		ПО упГрузовыеМеста.Ссылка.ЗаявкаНаПеревозкуГруза = упПараметрыЗаявкиНаПеревозку.ЗаявкаНаПеревозку
			И упГрузовыеМеста.ГрузовоеМесто = упПараметрыЗаявкиНаПеревозку.ГрузовоеМесто
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упПараметрыЗаданияНаПеревозку.СрезПоследних(, ЗаданиеНаПеревозку В (ВЫБРАТЬ втОстатки.ЗаданиеНаПеревозку ИЗ втОстатки КАК втОстатки)) КАК упПараметрыЗаданияНаПеревозку
		ПО упГрузовыеМеста.Ссылка = упПараметрыЗаданияНаПеревозку.ЗаданиеНаПеревозку
			И упГрузовыеМеста.ГрузовоеМесто = упПараметрыЗаданияНаПеревозку.ГрузовоеМесто		
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упВремяВыполненияРабот КАК упВремяВыполненияПогрузочныхРабот
		ПО (ИСТИНА)
			И втОстатки.ЗаданиеНаПеревозку.АдресОтправления.ВидАдреса = упВремяВыполненияПогрузочныхРабот.ВидТочки
			И (упВремяВыполненияПогрузочныхРабот.ТипОперации = ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.Погрузка))
			И (упГрузовыеМеста.ГрузовоеМесто.ТипГруза = упВремяВыполненияПогрузочныхРабот.ТипГруза)
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упВремяВыполненияРабот КАК упВремяВыполненияРазгрузочныхРабот
		ПО (ИСТИНА)
			И втОстатки.ЗаданиеНаПеревозку.АдресПолучения.ВидАдреса = упВремяВыполненияРазгрузочныхРабот.ВидТочки
			И (упВремяВыполненияРазгрузочныхРабот.ТипОперации = ЗНАЧЕНИЕ(Перечисление.упТипыОпераций.Разгрузка))
			И (упГрузовыеМеста.ГрузовоеМесто.ТипГруза = упВремяВыполненияРазгрузочныхРабот.ТипГруза)

ГДЕ 
	ВЫРАЗИТЬ(&amp;ВидПеревозки КАК Справочник.упВидыПеревозок).ПараметрыВводаИнформацииОГрузовыхМестах = ЗНАЧЕНИЕ(Перечисление.упПараметрыВводаИнформацииОГрузовыхМестах.ВводитсяВЗаданииДоНачалаВыполненияРейса)
	
СГРУППИРОВАТЬ ПО
	втОстатки.ЗаданиеНаПеревозку,
	втОстатки.ПредыдущееЗадание

;

////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втЗадания.ЗаданиеНаПеревозку,
	МАКСИМУМ(ВЫБОР КОГДА втВидыТочекОтправления1.ВидТочкиОтправления ЕСТЬ NULL ТОГДА ЛОЖЬ ИНАЧЕ ИСТИНА КОНЕЦ) КАК ОтправлениеДепо,
	МАКСИМУМ(ВЫБОР КОГДА втВидыТочекОтправления2.ВидТочкиОтправления ЕСТЬ NULL ТОГДА ЛОЖЬ ИНАЧЕ ИСТИНА КОНЕЦ) КАК ПолучениеДепо
ПОМЕСТИТЬ втПоказателиАдресов	
ИЗ втЗадания03 КАК втЗадания
ЛЕВОЕ СОЕДИНЕНИЕ втВидыТочекОтправления КАК втВидыТочекОтправления1
ПО втЗадания.АдресОтправления.ВидАдреса = втВидыТочекОтправления1.ВидТочкиОтправления
ЛЕВОЕ СОЕДИНЕНИЕ втВидыТочекОтправления КАК втВидыТочекОтправления2
ПО втЗадания.АдресПолучения.ВидАдреса = втВидыТочекОтправления2.ВидТочкиОтправления
СГРУППИРОВАТЬ ПО
	втЗадания.ЗаданиеНаПеревозку
;

ВЫБРАТЬ
	втЗадания05.ЗаданиеНаПеревозку КАК ЗаданиеНаПеревозку,
	СУММА(УпЗаданиеНаПеревозкуГруза_ГрузовыеМестаТ.КоличествоГрузов) КАК КоличествоГрузовПоЗаданию,
	СУММА(ВЫБОР
		КОГДА УпЗаданиеНаПеревозкуГруза_ГрузовыеМестаТ.ГрузовоеМесто.ТипГруза.ВидГруза = ЗНАЧЕНИЕ(Перечисление.упВидыГрузов.ИнкассируемаяЦенность)
			ТОГДА ЕСТЬNULL(УпЗаданиеНаПеревозкуГруза_ГрузовыеМестаТ.КоличествоГрузов, 0)
		ИНАЧЕ 0
	КОНЕЦ) КАК КоличествоГрузовПоЗаданиюИнкассация
ПОМЕСТИТЬ втИнкассация
ИЗ
	втЗадания05 КАК втЗадания05
	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.упЗаданиеНаПеревозкуГруза.ГрузовыеМеста КАК УпЗаданиеНаПеревозкуГруза_ГрузовыеМестаТ
	ПО УпЗаданиеНаПеревозкуГруза_ГрузовыеМестаТ.Ссылка = втЗадания05.ЗаданиеНаПеревозку
СГРУППИРОВАТЬ ПО
	втЗадания05.ЗаданиеНаПеревозку
;


////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втЗадания.ЗаданиеНаПеревозку КАК ЗаданиеНаПеревозку,
	втЗадания.ПредыдущееЗадание КАК ПредыдущееЗадание,
	втПоказателиПеревозки.ГрузовоеМесто КАК ГрузовоеМесто,
	втПоказателиПеревозки.ПредставлениеГруза КАК ПредставлениеГруза,
	втПоказателиПеревозки.ВремяПогрузки КАК ВремяПогрузки,
	втПоказателиПеревозки.ВремяРазгрузки КАК ВремяРазгрузки,
	ВЫБОР
		КОГДА упЗаданиеНаПеревозкуГруза.ПолучениеГрузаПо = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
			ТОГДА ЗНАЧЕНИЕ(Перечисление.упВариантыВажности.Низкая)
		КОГДА НАЧАЛОПЕРИОДА(упЗаданиеНаПеревозкуГруза.ПолучениеГрузаПо, ДЕНЬ) = НАЧАЛОПЕРИОДА(&amp;НачалоПериода, ДЕНЬ)
			ТОГДА ЗНАЧЕНИЕ(Перечисление.упВариантыВажности.Высокая)
		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.упВариантыВажности.Обычная)
	КОНЕЦ КАК Срочность,
	упЗаданиеНаПеревозкуГруза.Организация КАК Организация,
	ЕСТЬNULL(упЗаданиеНаПеревозкуГруза.НомерВЦепиПоставок, 0) КАК НомерВЦепиПоставок,
	ЕСТЬNULL(упЗаданиеНаПеревозкуГруза.НомерВЦепиПоставокКонец, 0) КАК НомерВЦепиПоставокКонец,
	ВЫБОР
		КОГДА втЗадания.ПредыдущееЗадание &lt;&gt; ЗНАЧЕНИЕ(Документ.упЗаданиеНаПеревозкуГруза.ПустаяСсылка)
			ТОГДА 4
		КОГДА втПоказателиАдресов.ОтправлениеДепо И втПоказателиАдресов.ПолучениеДепо
			ТОГДА 5
		КОГДА втПоказателиАдресов.ОтправлениеДепо
			ТОГДА 0	
		КОГДА втПоказателиАдресов.ПолучениеДепо
			ТОГДА 2
		КОГДА упЗаданиеНаПеревозкуГруза.НомерВЦепиПоставок &gt; 0
			ТОГДА 1	
		ИНАЧЕ 3
	КОНЕЦ КАК ТипПеревозки,
	упЗаданиеНаПеревозкуГруза.АдресОтправления КАК АдресОтправления,
	упЗаданиеНаПеревозкуГруза.АдресОтправления.Наименование КАК ИмяОтправления,
	упЗаданиеНаПеревозкуГруза.АдресОтправления.Широта КАК ШиротаТочкиОтправления,
	упЗаданиеНаПеревозкуГруза.АдресОтправления.Долгота КАК ДолготаТочкиОтправления,
	упЗаданиеНаПеревозкуГруза.АдресОтправления.ПредставлениеКоординаты КАК КоординатыОтправления,
	упЗаданиеНаПеревозкуГруза.АдресОтправления.ВидАдреса КАК ВидАдресаОтправления,
	упЗаданиеНаПеревозкуГруза.АдресПолучения КАК АдресПолучения,
	упЗаданиеНаПеревозкуГруза.АдресПолучения.Наименование КАК ИмяПолучения,
	упЗаданиеНаПеревозкуГруза.АдресПолучения.Широта КАК ШиротаТочкиПолучения,
	упЗаданиеНаПеревозкуГруза.АдресПолучения.Долгота КАК ДолготаТочкиПолучения,
	упЗаданиеНаПеревозкуГруза.АдресПолучения.ПредставлениеКоординаты КАК КоординатыПолучения,
	упЗаданиеНаПеревозкуГруза.АдресПолучения.ВидАдреса КАК ВидАдресаПолучения,
	ЕСТЬNULL(упЗаданиеНаПеревозкуГруза.Заказчик.СтильОтображенияМаршрута.Цвет, ВЫРАЗИТЬ(ЗНАЧЕНИЕ(Справочник.упСтилиЛиний.Основной) КАК Справочник.упСтилиЛиний).Цвет) КАК ЦветЛинии,
	ЕСТЬNULL(упЗаданиеНаПеревозкуГруза.Заказчик.СтильОтображенияМаршрута.Толщина, ВЫРАЗИТЬ(ЗНАЧЕНИЕ(Справочник.упСтилиЛиний.Основной) КАК Справочник.упСтилиЛиний).Толщина) КАК ТолщинаЛинии,
	ЕСТЬNULL(упЗаданиеНаПеревозкуГруза.Заказчик.СтильОтображенияМаршрута.Прозрачность, ВЫРАЗИТЬ(ЗНАЧЕНИЕ(Справочник.упСтилиЛиний.Основной) КАК Справочник.упСтилиЛиний).Прозрачность) КАК ПрозрачностьЛинии,
	упЗаданиеНаПеревозкуГруза.Заказчик КАК Заказчик,
	упЗаданиеНаПеревозкуГруза.Отправитель КАК Отправитель,
	упЗаданиеНаПеревозкуГруза.Получатель КАК Получатель,
	ВЫБОР
		КОГДА ВЫБОР
		КОГДА втЗадания.ПредыдущееЗадание &lt;&gt; ЗНАЧЕНИЕ(Документ.упЗаданиеНаПеревозкуГруза.ПустаяСсылка)
			ТОГДА 4
		КОГДА втПоказателиАдресов.ОтправлениеДепо И втПоказателиАдресов.ПолучениеДепо
			ТОГДА 5
		КОГДА втПоказателиАдресов.ОтправлениеДепо
			ТОГДА 0	
		КОГДА втПоказателиАдресов.ПолучениеДепо
			ТОГДА 2
		КОГДА упЗаданиеНаПеревозкуГруза.НомерВЦепиПоставок &gt; 0
			ТОГДА 1
		ИНАЧЕ 3
	КОНЕЦ &lt;&gt; 3
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК Активно,
	ЕСТЬNULL(упРасстоянияМеждуТочками.Путь, "") КАК Путь,
	втПоказателиПеревозки.КоличествоГрузов КАК КоличествоГрузов,
	втПоказателиПеревозки.КоличествоМест КАК КоличествоМест,
	втПоказателиПеревозки.КоличествоЗагрузочныхМетров КАК КоличествоЗагрузочныхМетров,
	втПоказателиПеревозки.Объем КАК Объем,
	втПоказателиПеревозки.Масса КАК Масса,
	втПоказателиПеревозки.ОценочнаяСтоимость КАК ОценочнаяСтоимость,
	упЗаданиеНаПеревозкуГруза.ЗонаОтправления КАК ЗонаОтправления,
	упЗаданиеНаПеревозкуГруза.ЗонаПолучения КАК ЗонаПолучения,
	упЗаданиеНаПеревозкуГруза.ОтправлениеГрузаС КАК ОтправлениеГрузаС,
	упЗаданиеНаПеревозкуГруза.ОтправлениеГрузаПо КАК ОтправлениеГрузаПо,
	упЗаданиеНаПеревозкуГруза.ПолучениеГрузаС КАК ПолучениеГрузаС,
	упЗаданиеНаПеревозкуГруза.ПолучениеГрузаПо КАК ПолучениеГрузаПо,
	упЗаданиеНаПеревозкуГруза.ГрафикРаботыАдресаОтправления КАК ГрафикОтправления,
	упЗаданиеНаПеревозкуГруза.ГрафикРаботыАдресаПолучения КАК ГрафикПолучения,
	упЗаданиеНаПеревозкуГруза.ЗаявкаНаПеревозкуГруза КАК ЗаявкаНаПеревозкуГруза,
	упЗаданиеНаПеревозкуГруза.Дата КАК Дата,	
	ЕСТЬNULL(втПредшествующиеЗадания.СтатусПредыдущегоЗадания, ЗНАЧЕНИЕ(Перечисление.упСтатусыЗаданияНаПеревозкуГруза.ПустаяСсылка)) КАК СтатусПредыдущегоМультимодальногоЗадания,
	ВЫБОР
		КОГДА втЗадания.ПредыдущееЗадание = ЗНАЧЕНИЕ(Документ.упЗаданиеНаПеревозкуГруза.ПустаяСсылка)
			ТОГДА втЗадания.ЗаданиеНаПеревозку
		ИНАЧЕ втЗадания.ПредыдущееЗадание
	КОНЕЦ КАК ПолеУпорядочивания1,
	ВЫБОР
		КОГДА втЗадания.ПредыдущееЗадание = ЗНАЧЕНИЕ(Документ.упЗаданиеНаПеревозкуГруза.ПустаяСсылка)
			ТОГДА 0
		ИНАЧЕ 1
	КОНЕЦ КАК ПолеУпорядочивания2,
	ВЫБОР
		КОГДА НЕ втПоказателиАдресов.ОтправлениеДепо И втПоказателиАдресов.ПолучениеДепо
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоВозвратГруза,
	ВЫБОР
		КОГДА 
			ВЫБОР
				КОГДА НЕ втПоказателиАдресов.ОтправлениеДепо И втПоказателиАдресов.ПолучениеДепо
					ТОГДА ИСТИНА
				ИНАЧЕ ЛОЖЬ
			КОНЕЦ 
				И НЕ втАдресаПолучения.АдресПолучения ЕСТЬ NULL
		ТОГДА
			ИСТИНА
		ИНАЧЕ
			ЛОЖЬ
	КОНЕЦ КАК ЕстьДоставкиВТочкуНаПериодПланирования
	,					
	ВЫБОР
		КОГДА ЕстьNull(втИнкассация.КоличествоГрузовПоЗаданию,0) = ЕстьNull(втИнкассация.КоличествоГрузовПоЗаданиюИнкассация,0)
				И ЕстьNull(втИнкассация.КоличествоГрузовПоЗаданиюИнкассация,0) &gt; 0
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоИнкассация

ИЗ
	втЗадания05 КАК втЗадания
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.упЗаданиеНаПеревозкуГруза КАК упЗаданиеНаПеревозкуГруза
		ПО втЗадания.ЗаданиеНаПеревозку = упЗаданиеНаПеревозкуГруза.Ссылка
		ЛЕВОЕ СОЕДИНЕНИЕ втАдресаПолучения КАК втАдресаПолучения
		ПО упЗаданиеНаПеревозкуГруза.АдресОтправления = втАдресаПолучения.АдресПолучения
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упРасстоянияМеждуТочками КАК упРасстоянияМеждуТочками
		ПО (ИСТИНА)
			И упЗаданиеНаПеревозкуГруза.АдресОтправления.Широта = упРасстоянияМеждуТочками.НачальнаяШирота
			И упЗаданиеНаПеревозкуГруза.АдресОтправления.Долгота = упРасстоянияМеждуТочками.НачальнаяДолгота
			И упЗаданиеНаПеревозкуГруза.АдресПолучения.Широта = упРасстоянияМеждуТочками.КонечнаяШирота
			И упЗаданиеНаПеревозкуГруза.АдресПолучения.Долгота = упРасстоянияМеждуТочками.КонечнаяДолгота
			И (упРасстоянияМеждуТочками.Ограничение = ЗНАЧЕНИЕ(Перечисление.упОграниченияМаршрутизаторов.ПустаяСсылка))
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втПоказателиПеревозки КАК втПоказателиПеревозки
		ПО (ИСТИНА)
			И втЗадания.ЗаданиеНаПеревозку = втПоказателиПеревозки.ЗаданиеНаПеревозку
			И втЗадания.ГрузовоеМесто = втПоказателиПеревозки.ГрузовоеМесто
		ЛЕВОЕ СОЕДИНЕНИЕ втПредшествующиеЗадания КАК втПредшествующиеЗадания
		ПО втЗадания.ЗаданиеНаПеревозку = втПредшествующиеЗадания.ЗаданиеНаПеревозкуГруза
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втПоказателиАдресов КАК втПоказателиАдресов
		ПО втЗадания.ЗаданиеНаПеревозку = втПоказателиАдресов.ЗаданиеНаПеревозку
        ЛЕВОЕ СОЕДИНЕНИЕ втИнкассация КАК втИнкассация
		ПО втЗадания.ЗаданиеНаПеревозку = втИнкассация.ЗаданиеНаПеревозку</query>
	</dataSet>
	<parameter>
		<name>ВидПеревозки</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Вид перевозки</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.упВидыПеревозок</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>Период</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Период</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>РазбиватьЗаданияПоГрузовымМестам</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Разбивать задания по грузовым местам</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:boolean</v8:Type>
		</valueType>
		<value xsi:type="xs:boolean">false</value>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>КонецПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Конец периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>НачалоПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Начало периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="xs:string">Основной</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>АдресОтправления</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>АдресПолучения</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Активно</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ГрузовоеМесто</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДолготаТочкиОтправления</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДолготаТочкиПолучения</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЗаданиеНаПеревозку</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Заказчик</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КоличествоЗагрузочныхМетров</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КоличествоМест</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Масса</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПредыдущееЗадание</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Объем</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Организация</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПрозрачностьЛинии</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Путь</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ТолщинаЛинии</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЦветЛинии</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ШиротаТочкиОтправления</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ШиротаТочкиПолучения</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ВидАдресаОтправления</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ВидАдресаПолучения</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПолеУпорядочивания1</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПолеУпорядочивания2</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ИмяОтправления</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ИмяПолучения</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПредставлениеГруза</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЗонаОтправления</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЗонаПолучения</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ОтправлениеГрузаС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ОтправлениеГрузаПо</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПолучениеГрузаС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПолучениеГрузаПо</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ВремяПогрузки</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ВремяРазгрузки</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ТипПеревозки</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>НомерВЦепиПоставок</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>НомерВЦепиПоставокКонец</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КоличествоГрузов</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Отправитель</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Получатель</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ГрафикОтправления</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ГрафикПолучения</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Срочность</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ОценочнаяСтоимость</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СтатусПредыдущегоМультимодальногоЗадания</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПредыдущееЗадание</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Дата</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЭтоВозвратГруза</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КоординатыОтправления</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КоординатыПолучения</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЭтоИнкассация</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЕстьДоставкиВТочкуНаПериодПланирования</dcsset:field>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
				</dcsset:selection>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>