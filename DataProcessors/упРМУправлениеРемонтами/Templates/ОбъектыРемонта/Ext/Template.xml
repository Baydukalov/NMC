<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>ОбъектыРемонта</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>Агрегат</dataPath>
			<field>Агрегат</field>
			<useRestriction>
				<condition>true</condition>
			</useRestriction>
			<attributeUseRestriction>
				<condition>true</condition>
			</attributeUseRestriction>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ОбъектРемонта</dataPath>
			<field>ОбъектРемонта</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Объект ремонта</v8:content>
				</v8:item>
			</title>
			<useRestriction>
				<condition>true</condition>
			</useRestriction>
			<attributeUseRestriction>
				<condition>true</condition>
			</attributeUseRestriction>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПоследнийРемонт</dataPath>
			<field>ПоследнийРемонт</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Последний ремонт</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПрогнозируемаяДатаСледующегоТО</dataPath>
			<field>ПрогнозируемаяДатаСледующегоТО</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Прогнозируемая дата следующего ТО</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПоследнееТО</dataPath>
			<field>ПоследнееТО</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Последнее ТО</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИндексКартинкиСостояния</dataPath>
			<field>ИндексКартинкиСостояния</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Индекс картинки состояния</v8:content>
				</v8:item>
			</title>
			<useRestriction>
				<condition>true</condition>
			</useRestriction>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ТранспортноеСредство</dataPath>
			<field>ТранспортноеСредство</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СостояниеРемонта</dataPath>
			<field>СостояниеРемонта</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Состояние ремонта</v8:content>
				</v8:item>
			</title>
			<valueType>
				<v8:Type>xs:decimal</v8:Type>
				<v8:NumberQualifiers>
					<v8:Digits>1</v8:Digits>
					<v8:FractionDigits>0</v8:FractionDigits>
					<v8:AllowedSign>Nonnegative</v8:AllowedSign>
				</v8:NumberQualifiers>
			</valueType>
			<availableValue>
				<value xsi:nil="true"/>
				<presentation xsi:type="v8:LocalStringType">
					<v8:item>
						<v8:lang>ru</v8:lang>
						<v8:content>Сроки наступления ТО находятся за пределами периода ожидания</v8:content>
					</v8:item>
				</presentation>
			</availableValue>
			<availableValue>
				<value xsi:type="xs:decimal">1</value>
				<presentation xsi:type="v8:LocalStringType">
					<v8:item>
						<v8:lang>ru</v8:lang>
						<v8:content>Подходит срок ТО</v8:content>
					</v8:item>
				</presentation>
			</availableValue>
			<availableValue>
				<value xsi:type="xs:decimal">2</value>
				<presentation xsi:type="v8:LocalStringType">
					<v8:item>
						<v8:lang>ru</v8:lang>
						<v8:content>Ведется ремонт</v8:content>
					</v8:item>
				</presentation>
			</availableValue>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Состояние</dataPath>
			<field>Состояние</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Состояние ТС</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Местоположение</dataPath>
			<field>Местоположение</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Местоположение</v8:content>
				</v8:item>
			</title>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Склад</dataPath>
			<field>Склад</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДатаСледующегоТО</dataPath>
			<field>ДатаСледующегоТО</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Дата следующего ТО</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПробегОсталось</dataPath>
			<field>ПробегОсталось</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Пробег осталось</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДополнительноеОборудование</dataPath>
			<field>ДополнительноеОборудование</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Дополнительное оборудование</v8:content>
				</v8:item>
			</title>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Подразделение</dataPath>
			<field>Подразделение</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Подразделение</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВидОбъектаРемонта</dataPath>
			<field>ВидОбъектаРемонта</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Вид объекта ремонта</v8:content>
				</v8:item>
			</title>
			<valueType>
				<v8:Type>xs:decimal</v8:Type>
				<v8:NumberQualifiers>
					<v8:Digits>1</v8:Digits>
					<v8:FractionDigits>0</v8:FractionDigits>
					<v8:AllowedSign>Nonnegative</v8:AllowedSign>
				</v8:NumberQualifiers>
			</valueType>
			<availableValue>
				<value xsi:nil="true"/>
				<presentation xsi:type="v8:LocalStringType">
					<v8:item>
						<v8:lang>ru</v8:lang>
						<v8:content>Транспортное средство</v8:content>
					</v8:item>
				</presentation>
			</availableValue>
			<availableValue>
				<value xsi:type="xs:decimal">1</value>
				<presentation xsi:type="v8:LocalStringType">
					<v8:item>
						<v8:lang>ru</v8:lang>
						<v8:content>Дополнительное оборудование</v8:content>
					</v8:item>
				</presentation>
			</availableValue>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИндексКартинки</dataPath>
			<field>ИндексКартинки</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Индекс картинки</v8:content>
				</v8:item>
			</title>
			<useRestriction>
				<condition>true</condition>
			</useRestriction>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>МоточасыОсталось</dataPath>
			<field>МоточасыОсталось</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Моточасы осталось</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЕстьНормаТО</dataPath>
			<field>ЕстьНормаТО</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Есть норма ТО</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВидРемонта</dataPath>
			<field>ВидРемонта</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Вид ремонта</v8:content>
				</v8:item>
			</title>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВремяРаботПлан</dataPath>
			<field>ВремяРаботПлан</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Время работ план</v8:content>
				</v8:item>
			</title>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ РАЗРЕШЕННЫЕ
	упТранспортныеСредства.Ссылка КАК ТранспортноеСредство,
	упТранспортныеСредства.Модель КАК Модель,
	ВЫБОР
		КОГДА упУчетныеПараметры.ДатаОтсчетаТО = ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА упУчетныеПараметры.ДатаПринятияКУчету
		ИНАЧЕ упУчетныеПараметры.ДатаОтсчетаТО
	КОНЕЦ КАК ДатаОтсчетаТО,
	упУчетныеПараметры.ПробегОтсчетаТО КАК ПробегОтсчетаТО,
	упУчетныеПараметры.МоточасыОтсчетаТО КАК МоточасыОтсчетаТО
ПОМЕСТИТЬ втУчетныйТранспорт
ИЗ
	Справочник.упТранспортныеСредства КАК упТранспортныеСредства
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.упУчетныеПараметрыТранспортныхСредств.СрезПоследних(, ) КАК упУчетныеПараметры
		ПО (упТранспортныеСредства.Ссылка = упУчетныеПараметры.ТранспортноеСредство)
			И (упТранспортныеСредства.СобственноеТранспортноеСредство)
			И (упУчетныеПараметры.ПринятоКУчету)
			И (НЕ упТранспортныеСредства.ПометкаУдаления)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	упАгрегатыНаСкладахОстатки.Агрегат КАК ДополнительноеОборудование,
	упАгрегатыНаСкладахОстатки.Склад КАК Склад,
	NULL КАК ТранспортноеСредство
ПОМЕСТИТЬ втУчетноеОборудование
ИЗ
	РегистрНакопления.упАгрегатыНаСкладах.Остатки(, ТИПЗНАЧЕНИЯ(Агрегат) = ТИП(Справочник.упДополнительноеОборудование)) КАК упАгрегатыНаСкладахОстатки

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	упАгрегатыТранспортныхСредствСрезПоследних.Агрегат,
	NULL,
	упАгрегатыТранспортныхСредствСрезПоследних.ТранспортноеСредство
ИЗ
	РегистрСведений.упАгрегатыТранспортныхСредств.СрезПоследних(, ТИПЗНАЧЕНИЯ(Агрегат) = ТИП(Справочник.упДополнительноеОборудование)) КАК упАгрегатыТранспортныхСредствСрезПоследних
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втУчетныйТранспорт КАК втУчетныйТранспорт
		ПО упАгрегатыТранспортныхСредствСрезПоследних.ТранспортноеСредство = втУчетныйТранспорт.ТранспортноеСредство
			И (упАгрегатыТранспортныхСредствСрезПоследних.Операция = ЗНАЧЕНИЕ(Перечисление.упТипыОперацийМонтажа.Установлено))
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	0 КАК ВидОбъектаРемонта,
	втУчетныйТранспорт.ТранспортноеСредство.ВидТранспорта.Порядок КАК ИндексКартинки,
	втУчетныйТранспорт.ТранспортноеСредство КАК ОбъектРемонта,
	втУчетныйТранспорт.ТранспортноеСредство КАК ТранспортноеСредство,
	NULL КАК ДополнительноеОборудование,
	NULL КАК Склад,
	втУчетныйТранспорт.Модель КАК Модель,
	втУчетныйТранспорт.ДатаОтсчетаТО КАК ДатаОтсчетаТО,
	втУчетныйТранспорт.ПробегОтсчетаТО КАК ПробегОтсчетаТО,
	втУчетныйТранспорт.МоточасыОтсчетаТО КАК МоточасыОтсчетаТО
ПОМЕСТИТЬ втОбъектыРемонта
ИЗ
	втУчетныйТранспорт КАК втУчетныйТранспорт

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	1,
	ВЫБОР
		КОГДА втУчетноеОборудование.ТранспортноеСредство ЕСТЬ NULL
			ТОГДА 7
		ИНАЧЕ 6
	КОНЕЦ,
	втУчетноеОборудование.ДополнительноеОборудование,
	втУчетноеОборудование.ТранспортноеСредство,
	втУчетноеОборудование.ДополнительноеОборудование,
	втУчетноеОборудование.Склад,
	втУчетноеОборудование.ДополнительноеОборудование.ТипДополнительногоОборудования,
	втУчетноеОборудование.ДополнительноеОборудование.ДатаОтсчетаТО,
	втУчетноеОборудование.ДополнительноеОборудование.ПробегОтсчетаТО,
	втУчетноеОборудование.ДополнительноеОборудование.МоточасыОтсчетаТО
ИЗ
	втУчетноеОборудование КАК втУчетноеОборудование
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втОбъектыРемонта.ВидОбъектаРемонта КАК ВидОбъектаРемонта,
	втОбъектыРемонта.ИндексКартинки КАК ИндексКартинки,
	втОбъектыРемонта.ОбъектРемонта КАК ОбъектРемонта,
	втОбъектыРемонта.ТранспортноеСредство КАК ТранспортноеСредство,
	втОбъектыРемонта.ДополнительноеОборудование КАК ДополнительноеОборудование,
	втОбъектыРемонта.Склад КАК Склад,
	втОбъектыРемонта.Модель КАК Модель,
	ЕСТЬNULL(упПройденныеТО.Период, ДАТАВРЕМЯ(1, 1, 1)) КАК ПоследнееТО,
	ЕСТЬNULL(упПройденныеТО.Регистратор, ЗНАЧЕНИЕ(Документ.упРемонтИТОТС.ПустаяСсылка)) КАК ПоследнийРемонт,
	втОбъектыРемонта.ДатаОтсчетаТО КАК ДатаОтсчетаТО,
	(ЕСТЬNULL(упПробегТСОстатки.ПробегОстаток, 0) - ЕСТЬNULL(упПробегТСОстаткиНачало.ПробегОстаток, 0)) / &amp;СрокОтсчета КАК СреднийПробегЗаДень,
	упПробегТСОстатки.ПробегОстаток КАК ПробегОстаток,
	СУММА(упПробегТСОбороты.ПробегОборот) КАК ПробегНаДатуРемонта,
	ВЫБОР
		КОГДА СУММА(упПробегТСОбороты.ПробегОборот) &gt; втОбъектыРемонта.ПробегОтсчетаТО
			ТОГДА СУММА(упПробегТСОбороты.ПробегОборот)
		ИНАЧЕ втОбъектыРемонта.ПробегОтсчетаТО
	КОНЕЦ КАК ПробегОтсчетаТО,
	(ЕСТЬNULL(упПробегТСОстатки.МоточасыОстаток, 0) - ЕСТЬNULL(упПробегТСОстаткиНачало.МоточасыОстаток, 0)) / &amp;СрокОтсчета КАК СреднийМоточасыЗаДень,
	упПробегТСОстатки.МоточасыОстаток КАК МоточасыОстаток,
	СУММА(упПробегТСОбороты.МоточасыОборот) КАК МоточасыНаДатуРемонта,
	ВЫБОР
		КОГДА СУММА(упПробегТСОбороты.МоточасыОборот) &gt; втОбъектыРемонта.МоточасыОтсчетаТО
			ТОГДА СУММА(упПробегТСОбороты.МоточасыОборот)
		ИНАЧЕ втОбъектыРемонта.МоточасыОтсчетаТО
	КОНЕЦ КАК МоточасыОтсчетаТО
ПОМЕСТИТЬ втПодготовленныйТранспорт
ИЗ
	втОбъектыРемонта КАК втОбъектыРемонта
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упПройденныеТО.СрезПоследних(, ) КАК упПройденныеТО
		ПО втОбъектыРемонта.ОбъектРемонта = упПройденныеТО.ТранспортноеСредство
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.упПробегТС.Обороты(, , Запись, ) КАК упПробегТСОбороты
		ПО (упПробегТСОбороты.ТранспортноеСредство = упПройденныеТО.ТранспортноеСредство)
			И (упПробегТСОбороты.Период &lt; упПройденныеТО.Период)
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.упПробегТС.Остатки(, ) КАК упПробегТСОстатки
		ПО втОбъектыРемонта.ОбъектРемонта = упПробегТСОстатки.ТранспортноеСредство
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.упПробегТС.Остатки(&amp;ДатаНачальныхОстатков, ) КАК упПробегТСОстаткиНачало
		ПО (упПробегТСОстатки.ТранспортноеСредство = упПробегТСОстаткиНачало.ТранспортноеСредство)

СГРУППИРОВАТЬ ПО
	втОбъектыРемонта.ВидОбъектаРемонта,
	втОбъектыРемонта.ИндексКартинки,
	втОбъектыРемонта.ОбъектРемонта,
	втОбъектыРемонта.ТранспортноеСредство,
	втОбъектыРемонта.ДополнительноеОборудование,
	втОбъектыРемонта.Склад,
	втОбъектыРемонта.Модель,
	ЕСТЬNULL(упПройденныеТО.Период, ДАТАВРЕМЯ(1, 1, 1)),
	ЕСТЬNULL(упПройденныеТО.Регистратор, ЗНАЧЕНИЕ(Документ.упРемонтИТОТС.ПустаяСсылка)),
	втОбъектыРемонта.ДатаОтсчетаТО,
	(ЕСТЬNULL(упПробегТСОстатки.ПробегОстаток, 0) - ЕСТЬNULL(упПробегТСОстаткиНачало.ПробегОстаток, 0)) / &amp;СрокОтсчета,
	упПробегТСОстатки.ПробегОстаток,
	втОбъектыРемонта.ПробегОтсчетаТО,
	(ЕСТЬNULL(упПробегТСОстатки.МоточасыОстаток, 0) - ЕСТЬNULL(упПробегТСОстаткиНачало.МоточасыОстаток, 0)) / &amp;СрокОтсчета,
	упПробегТСОстатки.МоточасыОстаток,
	втОбъектыРемонта.МоточасыОтсчетаТО
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втПодготовленныйТранспорт.ВидОбъектаРемонта КАК ВидОбъектаРемонта,
	втПодготовленныйТранспорт.ИндексКартинки КАК ИндексКартинки,
	втПодготовленныйТранспорт.ОбъектРемонта КАК ОбъектРемонта,
	втПодготовленныйТранспорт.ТранспортноеСредство КАК ТранспортноеСредство,
	втПодготовленныйТранспорт.ДополнительноеОборудование КАК ДополнительноеОборудование,
	втПодготовленныйТранспорт.Склад КАК Склад,
	втПодготовленныйТранспорт.ПоследнееТО КАК ПоследнееТО,
	втПодготовленныйТранспорт.ПоследнийРемонт КАК ПоследнийРемонт,
	втПодготовленныйТранспорт.СреднийПробегЗаДень КАК СреднийПробегЗаДень,
	втПодготовленныйТранспорт.СреднийМоточасыЗаДень КАК СреднийМоточасыЗаДень,
	ЕСТЬNULL(упНормыТО.МодельТС, ЗНАЧЕНИЕ(Справочник.упМоделиТС.ПустаяСсылка)) КАК МодельТС,
	ЕСТЬNULL(упНормыТО.ВидРемонта, ЗНАЧЕНИЕ(Справочник.упВидыРемонтов.ПустаяСсылка)) КАК ВидРемонта,
	ВЫБОР
		КОГДА упНормыТО.ТипТО ЕСТЬ NULL
			ТОГДА NULL
		КОГДА упНормыТО.ТипТО = ЗНАЧЕНИЕ(Перечисление.упТипыТО.Разовое)
				И ЕСТЬNULL(втПодготовленныйТранспорт.ПробегОстаток, 0) &lt;= ЕСТЬNULL(упНормыТО.Пробег, 0)
			ТОГДА ЕСТЬNULL(упНормыТО.Пробег, 0) - ЕСТЬNULL(втПодготовленныйТранспорт.ПробегОстаток, 0)
		КОГДА упНормыТО.ТипТО = ЗНАЧЕНИЕ(Перечисление.упТипыТО.Периодическое)
				И ЕСТЬNULL(втПодготовленныйТранспорт.ПробегОстаток, 0) &lt; ЕСТЬNULL(упНормыТО.ПробегПо, 0)
			ТОГДА ВЫБОР
					КОГДА втПодготовленныйТранспорт.ПробегОстаток &lt; ЕСТЬNULL(упНормыТО.ПробегС, 0)
						ТОГДА ЕСТЬNULL(упНормыТО.ПробегС, 0)
					ИНАЧЕ (1 + (ВЫРАЗИТЬ((втПодготовленныйТранспорт.ПробегОстаток - втПодготовленныйТранспорт.ПробегОтсчетаТО) / ЕСТЬNULL(упНормыТО.Пробег, 0) - 0.5 КАК ЧИСЛО(10, 0)))) * упНормыТО.Пробег
				КОНЕЦ - (втПодготовленныйТранспорт.ПробегОстаток - втПодготовленныйТранспорт.ПробегОтсчетаТО)
		ИНАЧЕ NULL
	КОНЕЦ КАК ПробегОсталось,
	ВЫБОР
		КОГДА упНормыТО.ТипТО ЕСТЬ NULL
			ТОГДА NULL
		КОГДА упНормыТО.ТипТО = ЗНАЧЕНИЕ(Перечисление.упТипыТО.Разовое)
				И &amp;ТекущаяДата &lt; ДОБАВИТЬКДАТЕ(втПодготовленныйТранспорт.ДатаОтсчетаТО, МЕСЯЦ, ЕСТЬNULL(упНормыТО.Срок, 0))
			ТОГДА ДОБАВИТЬКДАТЕ(втПодготовленныйТранспорт.ДатаОтсчетаТО, МЕСЯЦ, ЕСТЬNULL(упНормыТО.Срок, 0))
		КОГДА упНормыТО.ТипТО = ЗНАЧЕНИЕ(Перечисление.упТипыТО.Периодическое)
				И &amp;ТекущаяДата &lt; ДОБАВИТЬКДАТЕ(втПодготовленныйТранспорт.ДатаОтсчетаТО, МЕСЯЦ, ЕСТЬNULL(упНормыТО.СрокПо, 0))
			ТОГДА ВЫБОР
					КОГДА &amp;ТекущаяДата &lt; ДОБАВИТЬКДАТЕ(втПодготовленныйТранспорт.ДатаОтсчетаТО, МЕСЯЦ, ЕСТЬNULL(упНормыТО.СрокС, 0))
						ТОГДА ДОБАВИТЬКДАТЕ(втПодготовленныйТранспорт.ДатаОтсчетаТО, МЕСЯЦ, ЕСТЬNULL(упНормыТО.СрокС, 0))
					ИНАЧЕ ДОБАВИТЬКДАТЕ(ВЫБОР
								КОГДА втПодготовленныйТранспорт.ПоследнееТО &gt; втПодготовленныйТранспорт.ДатаОтсчетаТО
									ТОГДА втПодготовленныйТранспорт.ПоследнееТО
								ИНАЧЕ втПодготовленныйТранспорт.ДатаОтсчетаТО
							КОНЕЦ, МЕСЯЦ, ЕСТЬNULL(упНормыТО.Срок, 0))
				КОНЕЦ
		ИНАЧЕ NULL
	КОНЕЦ КАК ДатаСледующегоТО,
	ВЫБОР
		КОГДА упНормыТО.ТипТО ЕСТЬ NULL
			ТОГДА NULL
		КОГДА упНормыТО.ТипТО = ЗНАЧЕНИЕ(Перечисление.упТипыТО.Разовое)
				И ЕСТЬNULL(втПодготовленныйТранспорт.МоточасыОстаток, 0) &lt;= ЕСТЬNULL(упНормыТО.Моточасы, 0)
			ТОГДА ЕСТЬNULL(упНормыТО.Моточасы, 0) - ЕСТЬNULL(втПодготовленныйТранспорт.МоточасыОстаток, 0)
		КОГДА упНормыТО.ТипТО = ЗНАЧЕНИЕ(Перечисление.упТипыТО.Периодическое)
				И ЕСТЬNULL(втПодготовленныйТранспорт.МоточасыОстаток, 0) &lt; ЕСТЬNULL(упНормыТО.МоточасыПо, 0)
			ТОГДА ВЫБОР
					КОГДА втПодготовленныйТранспорт.ПробегОстаток &lt; ЕСТЬNULL(упНормыТО.МоточасыС, 0)
						ТОГДА ЕСТЬNULL(упНормыТО.МоточасыС, 0)
					ИНАЧЕ (1 + (ВЫРАЗИТЬ((втПодготовленныйТранспорт.МоточасыОстаток - втПодготовленныйТранспорт.МоточасыОтсчетаТО) / ЕСТЬNULL(упНормыТО.Моточасы, 0) - 0.5 КАК ЧИСЛО(10, 0)))) * упНормыТО.Моточасы
				КОНЕЦ - (втПодготовленныйТранспорт.МоточасыОстаток - втПодготовленныйТранспорт.МоточасыОтсчетаТО)
		ИНАЧЕ NULL
	КОНЕЦ КАК МоточасыОсталось,
	ВЫБОР
		КОГДА упНормыТО.ТипТО ЕСТЬ NULL
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ЕстьНормаТО
ПОМЕСТИТЬ втДанныеТОПоНормам
ИЗ
	втПодготовленныйТранспорт КАК втПодготовленныйТранспорт
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упНормыТО КАК упНормыТО
		ПО втПодготовленныйТранспорт.Модель = упНормыТО.МодельТС
			И (НЕ (втПодготовленныйТранспорт.ОбъектРемонта, упНормыТО.ВидРемонта, упНормыТО.ТипТО) В
					(ВЫБРАТЬ
						упПройденныеТО.ТранспортноеСредство,
						упПройденныеТО.ВидРемонта,
						ЗНАЧЕНИЕ(Перечисление.упТипыТО.Разовое)
					ИЗ
						РегистрСведений.упПройденныеТО КАК упПройденныеТО))

ИНДЕКСИРОВАТЬ ПО
	втПодготовленныйТранспорт.ОбъектРемонта
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втДанныеТОПоНормам.ВидОбъектаРемонта КАК ВидОбъектаРемонта,
	втДанныеТОПоНормам.ИндексКартинки КАК ИндексКартинки,
	втДанныеТОПоНормам.ОбъектРемонта КАК ОбъектРемонта,
	втДанныеТОПоНормам.ТранспортноеСредство КАК ТранспортноеСредство,
	втДанныеТОПоНормам.ДополнительноеОборудование КАК ДополнительноеОборудование,
	втДанныеТОПоНормам.Склад КАК Склад,
	втДанныеТОПоНормам.ПоследнееТО КАК ПоследнееТО,
	втДанныеТОПоНормам.ПоследнийРемонт КАК ПоследнийРемонт,
	втДанныеТОПоНормам.СреднийПробегЗаДень КАК СреднийПробегЗаДень,
	втДанныеТОПоНормам.СреднийМоточасыЗаДень КАК СреднийМоточасыЗаДень,
	МИНИМУМ(втДанныеТОПоНормам.ПробегОсталось) КАК ПробегОсталось,
	МИНИМУМ(втДанныеТОПоНормам.ДатаСледующегоТО) КАК ДатаСледующегоТО,
	МИНИМУМ(втДанныеТОПоНормам.МоточасыОсталось) КАК МоточасыОсталось,
	МАКСИМУМ(втДанныеТОПоНормам.ЕстьНормаТО) КАК ЕстьНормаТО
ПОМЕСТИТЬ втДанныеТОПодготовка
ИЗ
	втДанныеТОПоНормам КАК втДанныеТОПоНормам

СГРУППИРОВАТЬ ПО
	втДанныеТОПоНормам.ВидОбъектаРемонта,
	втДанныеТОПоНормам.ИндексКартинки,
	втДанныеТОПоНормам.ОбъектРемонта,
	втДанныеТОПоНормам.ТранспортноеСредство,
	втДанныеТОПоНормам.ДополнительноеОборудование,
	втДанныеТОПоНормам.Склад,
	втДанныеТОПоНормам.ПоследнееТО,
	втДанныеТОПоНормам.ПоследнийРемонт,
	втДанныеТОПоНормам.СреднийПробегЗаДень,
	втДанныеТОПоНормам.СреднийМоточасыЗаДень

ИНДЕКСИРОВАТЬ ПО
	втДанныеТОПоНормам.ОбъектРемонта
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втДанныеТО.ВидОбъектаРемонта КАК ВидОбъектаРемонта,
	втДанныеТО.ИндексКартинки КАК ИндексКартинки,
	втДанныеТО.ОбъектРемонта КАК ОбъектРемонта,
	втДанныеТО.ТранспортноеСредство КАК ТранспортноеСредство,
	втДанныеТО.ДополнительноеОборудование КАК ДополнительноеОборудование,
	втДанныеТО.Склад КАК Склад,
	втДанныеТО.ПоследнееТО КАК ПоследнееТО,
	втДанныеТО.ПоследнийРемонт КАК ПоследнийРемонт,
	втДанныеТО.СреднийПробегЗаДень КАК СреднийПробегЗаДень,
	втДанныеТО.СреднийМоточасыЗаДень КАК СреднийМоточасыЗаДень,
	втДанныеТО.ПробегОсталось КАК ПробегОсталось,
	втДанныеТО.ДатаСледующегоТО КАК ДатаСледующегоТО,
	втДанныеТО.МоточасыОсталось КАК МоточасыОсталось,
	МАКСИМУМ(втДанныеТОПоНормам.ВидРемонта) КАК ВидРемонта,
	ВЫБОР
		КОГДА втДанныеТО.СреднийПробегЗаДень = 0
			ТОГДА ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1))
		КОГДА ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА ДОБАВИТЬКДАТЕ(&amp;ТекущаяДата, ДЕНЬ, втДанныеТО.ПробегОсталось / втДанныеТО.СреднийПробегЗаДень)
		КОГДА ДОБАВИТЬКДАТЕ(&amp;ТекущаяДата, ДЕНЬ, втДанныеТО.ПробегОсталось / втДанныеТО.СреднийПробегЗаДень) &lt; ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1))
			ТОГДА ДОБАВИТЬКДАТЕ(&amp;ТекущаяДата, ДЕНЬ, втДанныеТО.ПробегОсталось / втДанныеТО.СреднийПробегЗаДень)
		ИНАЧЕ ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1))
	КОНЕЦ КАК ПрогнозируемаяДатаСледующегоТОПробег,
	ВЫБОР
		КОГДА втДанныеТО.СреднийМоточасыЗаДень = 0
			ТОГДА ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1))
		КОГДА ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА ДОБАВИТЬКДАТЕ(&amp;ТекущаяДата, ДЕНЬ, втДанныеТО.МоточасыОсталось / втДанныеТО.СреднийМоточасыЗаДень)
		КОГДА ДОБАВИТЬКДАТЕ(&amp;ТекущаяДата, ДЕНЬ, втДанныеТО.МоточасыОсталось / втДанныеТО.СреднийМоточасыЗаДень) &lt; ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1))
			ТОГДА ДОБАВИТЬКДАТЕ(&amp;ТекущаяДата, ДЕНЬ, втДанныеТО.МоточасыОсталось / втДанныеТО.СреднийМоточасыЗаДень)
		ИНАЧЕ ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1))
	КОНЕЦ КАК ПрогнозируемаяДатаСледующегоТОМоточасы,
	втДанныеТО.ЕстьНормаТО КАК ЕстьНормаТО
ПОМЕСТИТЬ втДанныеТО
ИЗ
	втДанныеТОПодготовка КАК втДанныеТО
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втДанныеТОПоНормам КАК втДанныеТОПоНормам
		ПО втДанныеТО.ОбъектРемонта = втДанныеТОПоНормам.ОбъектРемонта
			И (ЕСТЬNULL(втДанныеТО.ПробегОсталось, 0) = ЕСТЬNULL(втДанныеТОПоНормам.ПробегОсталось, 0))
			И (ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1)) = ЕСТЬNULL(втДанныеТОПоНормам.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1)))
			И (ЕСТЬNULL(втДанныеТО.МоточасыОсталось, 0) = ЕСТЬNULL(втДанныеТОПоНормам.МоточасыОсталось, 0))
СГРУППИРОВАТЬ ПО
	втДанныеТО.ВидОбъектаРемонта,
	втДанныеТО.ИндексКартинки,
	втДанныеТО.ОбъектРемонта,
	втДанныеТО.ТранспортноеСредство,
	втДанныеТО.ДополнительноеОборудование,
	втДанныеТО.Склад,
	втДанныеТО.ПоследнееТО,
	втДанныеТО.ПоследнийРемонт,
	втДанныеТО.СреднийПробегЗаДень,
	втДанныеТО.СреднийМоточасыЗаДень,
	втДанныеТО.ПробегОсталось,
	втДанныеТО.ДатаСледующегоТО,
	втДанныеТО.МоточасыОсталось,
	ВЫБОР
		КОГДА втДанныеТО.СреднийПробегЗаДень = 0
			ТОГДА ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1))
		КОГДА ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА ДОБАВИТЬКДАТЕ(&amp;ТекущаяДата, ДЕНЬ, втДанныеТО.ПробегОсталось / втДанныеТО.СреднийПробегЗаДень)
		КОГДА ДОБАВИТЬКДАТЕ(&amp;ТекущаяДата, ДЕНЬ, втДанныеТО.ПробегОсталось / втДанныеТО.СреднийПробегЗаДень) &lt; ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1))
			ТОГДА ДОБАВИТЬКДАТЕ(&amp;ТекущаяДата, ДЕНЬ, втДанныеТО.ПробегОсталось / втДанныеТО.СреднийПробегЗаДень)
		ИНАЧЕ ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1))
	КОНЕЦ,
	ВЫБОР
		КОГДА втДанныеТО.СреднийМоточасыЗаДень = 0
			ТОГДА ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1))
		КОГДА ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА ДОБАВИТЬКДАТЕ(&amp;ТекущаяДата, ДЕНЬ, втДанныеТО.МоточасыОсталось / втДанныеТО.СреднийМоточасыЗаДень)
		КОГДА ДОБАВИТЬКДАТЕ(&amp;ТекущаяДата, ДЕНЬ, втДанныеТО.МоточасыОсталось / втДанныеТО.СреднийМоточасыЗаДень) &lt; ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1))
			ТОГДА ДОБАВИТЬКДАТЕ(&amp;ТекущаяДата, ДЕНЬ, втДанныеТО.МоточасыОсталось / втДанныеТО.СреднийМоточасыЗаДень)
		ИНАЧЕ ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1))
	КОНЕЦ,
	втДанныеТО.ЕстьНормаТО
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	втДанныеТО.ВидОбъектаРемонта КАК ВидОбъектаРемонта,
	втДанныеТО.ИндексКартинки КАК ИндексКартинки,
	втДанныеТО.ОбъектРемонта КАК ОбъектРемонта,
	ЕСТЬNULL(втДанныеТО.Склад, втДанныеТО.ТранспортноеСредство) КАК Местоположение,
	втДанныеТО.ТранспортноеСредство КАК ТранспортноеСредство,
	втДанныеТО.ДополнительноеОборудование КАК ДополнительноеОборудование,
	втДанныеТО.Склад КАК Склад,
	ЕСТЬNULL(упСостоянияТССрезПоследних.СостояниеТС, ЗНАЧЕНИЕ(Справочник.упСостоянияТС.Свободно)) КАК Состояние,
	ЕСТЬNULL(упСостоянияТССрезПоследних.СостояниеТС.ТипСостоянияТС.Порядок, 0) КАК ИндексКартинкиСостояния,
	ЕСТЬNULL(втДанныеТО.ПробегОсталось, 0) КАК ПробегОсталось,
	ЕСТЬNULL(втДанныеТО.МоточасыОсталось, 0) КАК МоточасыОсталось,
	ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаСледующегоТО,
	ВЫБОР
		КОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОПробег = ДАТАВРЕМЯ(1, 1, 1)
				И втДанныеТО.ПрогнозируемаяДатаСледующегоТОМоточасы = ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОПробег &lt;&gt; ДАТАВРЕМЯ(1, 1, 1)
				И втДанныеТО.ПрогнозируемаяДатаСледующегоТОМоточасы = ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОПробег
		КОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОПробег = ДАТАВРЕМЯ(1, 1, 1)
				И втДанныеТО.ПрогнозируемаяДатаСледующегоТОМоточасы &lt;&gt; ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОМоточасы
		КОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОПробег &gt; втДанныеТО.ПрогнозируемаяДатаСледующегоТОМоточасы
			ТОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОМоточасы
		ИНАЧЕ втДанныеТО.ПрогнозируемаяДатаСледующегоТОПробег
	КОНЕЦ КАК ПрогнозируемаяДатаСледующегоТО,
	втДанныеТО.ПоследнийРемонт КАК ПоследнийРемонт,
	втДанныеТО.ПоследнееТО КАК ПоследнееТО,
	МАКСИМУМ(ВЫБОР
			КОГДА ЕСТЬNULL(упСостоянияТССрезПоследних.СостояниеТС, ЗНАЧЕНИЕ(Справочник.упСостоянияТС.Свободно)) = ЗНАЧЕНИЕ(Справочник.упСостоянияТС.Ремонт)
				ТОГДА 2
			КОГДА ЕСТЬNULL(втДанныеТО.ПробегОсталось, 0) &gt; 0
					И ЕСТЬNULL(втДанныеТО.ПробегОсталось, 0) &lt;= ЕСТЬNULL(ВЫБОР
							КОГДА упТранспортныеСредстваГаражи.Гараж.СрокПредупрежденияОТОПробег = 0
								ТОГДА NULL
							ИНАЧЕ упТранспортныеСредстваГаражи.Гараж.СрокПредупрежденияОТОПробег
						КОНЕЦ, &amp;СрокПредупрежденияОТОПробег)
				ТОГДА 1
			КОГДА ЕСТЬNULL(втДанныеТО.МоточасыОсталось, 0) &gt; 0
					И ЕСТЬNULL(втДанныеТО.МоточасыОсталось, 0) &lt;= ЕСТЬNULL(ВЫБОР
							КОГДА упТранспортныеСредстваГаражи.Гараж.СрокПредупрежденияОТОМоточасы = 0
								ТОГДА NULL
							ИНАЧЕ упТранспортныеСредстваГаражи.Гараж.СрокПредупрежденияОТОМоточасы
						КОНЕЦ, &amp;СрокПредупрежденияОТОМоточасы)
				ТОГДА 1
			КОГДА ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА 0
			КОГДА РАЗНОСТЬДАТ(&amp;ТекущаяДата, ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1)), ДЕНЬ) &lt;= ЕСТЬNULL(ВЫБОР
						КОГДА упТранспортныеСредстваГаражи.Гараж.СрокПредупрежденияОТОДней = 0
							ТОГДА NULL
						ИНАЧЕ упТранспортныеСредстваГаражи.Гараж.СрокПредупрежденияОТОДней
					КОНЕЦ, ВЫБОР
						КОГДА &amp;СрокПредупрежденияОТОМоточасы = 0
							ТОГДА -1
						ИНАЧЕ &amp;СрокПредупрежденияОТОМоточасы
					КОНЕЦ)
				ТОГДА 1
			ИНАЧЕ 0
		КОНЕЦ) КАК СостояниеРемонта,
	ЕСТЬNULL(упПодразделенияТранспортныхСредствСрезПоследних.Подразделение, ЗНАЧЕНИЕ(Справочник.упСтруктураПредприятия.ПустаяСсылка)) КАК Подразделение,
	втДанныеТО.ЕстьНормаТО КАК ЕстьНормаТО,
	втДанныеТО.ВидРемонта КАК ВидРемонта,
    МАКСИМУМ(ЕстьNull(упВидыРемонтов.ВремяРаботПлан, 0)) КАК ВремяРаботПлан
ИЗ
	втДанныеТО КАК втДанныеТО
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упСостоянияТранспортныхСредств.СрезПоследних(
				,
				ТранспортноеСредство В
					(ВЫБРАТЬ
						втУчетныйТранспорт.ТранспортноеСредство
					ИЗ
						втУчетныйТранспорт)) КАК упСостоянияТССрезПоследних
		ПО (втДанныеТО.ВидОбъектаРемонта = 0)
			И втДанныеТО.ОбъектРемонта = упСостоянияТССрезПоследних.ТранспортноеСредство
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.упТранспортныеСредства.Гаражи КАК упТранспортныеСредстваГаражи
		ПО втДанныеТО.ТранспортноеСредство = упТранспортныеСредстваГаражи.Ссылка
        ЛЕВОЕ СОЕДИНЕНИЕ Справочник.упВидыРемонтов КАК упВидыРемонтов
		ПО упВидыРемонтов.Ссылка = втДанныеТО.ВидРемонта
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.упПодразделенияТранспортныхСредств.СрезПоследних(
				,
				ТранспортноеСредство В
					(ВЫБРАТЬ
						втУчетныйТранспорт.ТранспортноеСредство
					ИЗ
						втУчетныйТранспорт)) КАК упПодразделенияТранспортныхСредствСрезПоследних
		ПО (втДанныеТО.ВидОбъектаРемонта = 0)
			И втДанныеТО.ОбъектРемонта = упПодразделенияТранспортныхСредствСрезПоследних.ТранспортноеСредство
{ГДЕ
	(упТранспортныеСредстваГаражи.Гараж = &amp;Гараж)}

СГРУППИРОВАТЬ ПО
	втДанныеТО.ВидОбъектаРемонта,
	втДанныеТО.ИндексКартинки,
	втДанныеТО.ОбъектРемонта,
	ЕСТЬNULL(втДанныеТО.Склад, втДанныеТО.ТранспортноеСредство),
	втДанныеТО.ТранспортноеСредство,
	втДанныеТО.ДополнительноеОборудование,
	втДанныеТО.Склад,
	втДанныеТО.ПоследнееТО,
	втДанныеТО.ПоследнийРемонт,
	ЕСТЬNULL(упСостоянияТССрезПоследних.СостояниеТС, ЗНАЧЕНИЕ(Справочник.упСостоянияТС.Свободно)),
	ЕСТЬNULL(упСостоянияТССрезПоследних.СостояниеТС.ТипСостоянияТС.Порядок, 0),
	ЕСТЬNULL(втДанныеТО.ПробегОсталось, 0),
	ЕСТЬNULL(втДанныеТО.МоточасыОсталось, 0),
	ЕСТЬNULL(втДанныеТО.ДатаСледующегоТО, ДАТАВРЕМЯ(1, 1, 1)),
	ВЫБОР
		КОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОПробег = ДАТАВРЕМЯ(1, 1, 1)
				И втДанныеТО.ПрогнозируемаяДатаСледующегоТОМоточасы = ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОПробег &lt;&gt; ДАТАВРЕМЯ(1, 1, 1)
				И втДанныеТО.ПрогнозируемаяДатаСледующегоТОМоточасы = ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОПробег
		КОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОПробег = ДАТАВРЕМЯ(1, 1, 1)
				И втДанныеТО.ПрогнозируемаяДатаСледующегоТОМоточасы &lt;&gt; ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОМоточасы
		КОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОПробег &gt; втДанныеТО.ПрогнозируемаяДатаСледующегоТОМоточасы
			ТОГДА втДанныеТО.ПрогнозируемаяДатаСледующегоТОМоточасы
		ИНАЧЕ втДанныеТО.ПрогнозируемаяДатаСледующегоТОПробег
	КОНЕЦ,
	ЕСТЬNULL(упПодразделенияТранспортныхСредствСрезПоследних.Подразделение, ЗНАЧЕНИЕ(Справочник.упСтруктураПредприятия.ПустаяСсылка)),
	втДанныеТО.ЕстьНормаТО,
	втДанныеТО.ВидРемонта

УПОРЯДОЧИТЬ ПО
	втДанныеТО.ТранспортноеСредство,
	втДанныеТО.ВидОбъектаРемонта</query>
	</dataSet>
	<parameter>
		<name>НачалоПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Начало периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>КонецПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Конец периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>Период</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Период</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ДатаНачальныхОстатков</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата начальных остатков</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>СрокОтсчета</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Срок отсчета</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:decimal</v8:Type>
			<v8:NumberQualifiers>
				<v8:Digits>0</v8:Digits>
				<v8:FractionDigits>0</v8:FractionDigits>
				<v8:AllowedSign>Any</v8:AllowedSign>
			</v8:NumberQualifiers>
		</valueType>
		<value xsi:type="xs:decimal">0</value>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ТекущаяДата</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Текущая дата</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>СрокПредупрежденияОТОМоточасы</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Срок предупреждения ОТОМоточасы</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>v8:Null</v8:Type>
			<v8:Type>xs:decimal</v8:Type>
			<v8:TypeId>5d414b69-37c8-4035-b633-c894f4184037</v8:TypeId>
			<v8:NumberQualifiers>
				<v8:Digits>0</v8:Digits>
				<v8:FractionDigits>0</v8:FractionDigits>
				<v8:AllowedSign>Any</v8:AllowedSign>
			</v8:NumberQualifiers>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>СрокПредупрежденияОТОПробег</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Срок предупреждения ОТОПробег</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>v8:Null</v8:Type>
			<v8:TypeId>6129e10e-0138-4bbb-9f74-c799df7ff2d8</v8:TypeId>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>Гараж</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Гараж</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.упГаражи</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>false</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="xs:string">Основной</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ИндексКартинкиСостояния</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ВидОбъектаРемонта</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДатаСледующегоТО</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДополнительноеОборудование</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Местоположение</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ОбъектРемонта</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Подразделение</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПоследнееТО</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПоследнийРемонт</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПробегОсталось</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПрогнозируемаяДатаСледующегоТО</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Склад</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Состояние</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СостояниеРемонта</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ТранспортноеСредство</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ИндексКартинки</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>МоточасыОсталось</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ВидРемонта</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ВремяРаботПлан</dcsset:field>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
				</dcsset:selection>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>