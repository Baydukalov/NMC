
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Список = Новый СписокЗначений();
	Список.Добавить(ТипОтображенияСерииСлояГеографическойСхемы.Текст,"Текст");
	Список.Добавить(ТипОтображенияСерииСлояГеографическойСхемы.НеОтображать,"НеОтображать");
	Список.Добавить(ТипОтображенияСерииСлояГеографическойСхемы.Гистограмма,"Гистограмма");
	Список.Добавить(ТипОтображенияСерииСлояГеографическойСхемы.Круговая,"Круговая");
	Список.Добавить(ТипОтображенияСерииСлояГеографическойСхемы.КруговаяСРазмером,"КруговаяСРазмером");
	Список.Добавить(ТипОтображенияСерииСлояГеографическойСхемы.ОттенокЦветаФигуры,"ОттенокЦветаФигуры");
	Список.Добавить(ТипОтображенияСерииСлояГеографическойСхемы.РазмерФигуры,"РазмерФигуры");
	Элементы.ТипОтображенияСерии.СписокВыбора.ЗагрузитьЗначения(Список.ВыгрузитьЗначения());
	
	Список = Новый СписокЗначений();
	Список.Добавить(РежимОтображенияЗначенийСерии.ОтображатьКакЗначение);
	Список.Добавить(РежимОтображенияЗначенийСерии.ОтображатьКакДолю);
	Элементы.РежимОтображенияЗначенийСерии.СписокВыбора.ЗагрузитьЗначения(Список.ВыгрузитьЗначения());	
	
	Список = Новый СписокЗначений();
	Список.Добавить(ТипПроекцииГеографическойСхемы.ЦилиндрическаяПроекцияМиллера);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ЦилиндрическаяПроекцияРавныхОбластейЛамберта);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ЦилиндрическаяРавноудаленнаяПроекция);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ЦилиндрическаяСтереографическаяПроекцияГалла);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПлоскоПолярнаяПараболическаяПроекцияМакБрайдаТомаса);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПлоскоПолярнаяПроекцияЧетвертогоПорядкаМакБрайдаТомаса);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПлоскоПолярнаяСинусоидальнаяПроекцияМакБрайдаТомаса);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПроекцияВинкеля1);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПроекцияЛоксимутала);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПроекцияМолвейда);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПроекцияНесимметричныхРавныхОбластейХатано);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПроекцияПутнинаP2);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПроекцияПутнинаP5);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПроекцияРобинсона);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПроекцияЭкерта1);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПроекцияЭкерта2);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПроекцияЭкерта3);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПроекцияЭкерта4);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПроекцияЭкерта5);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяПроекцияЭкерта6);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяСинусоидальнаяПроекция);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПсевдоцилиндрическаяНормальнаяПроекцияБоггса);
	Список.Добавить(ТипПроекцииГеографическойСхемы.АзимутальнаяПроекцияАитофа);
	Список.Добавить(ТипПроекцииГеографическойСхемы.АзимутальнаяПроекцияВагнера7);
	Список.Добавить(ТипПроекцииГеографическойСхемы.АзимутальнаяПроекцияВинкеляТрипеля);
	Список.Добавить(ТипПроекцииГеографическойСхемы.АзимутальнаяПроекцияХамера);
	Список.Добавить(ТипПроекцииГеографическойСхемы.АзимутальнаяПроекцияРавныхПлощадейЛамберта);
	Список.Добавить(ТипПроекцииГеографическойСхемы.АзимутальнаяРавноудаленнаяПроекция);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПрочаяОвальнаяПроекцияОртелиуса);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПрочаяПроекцияВанДерГринтена1);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПрочаяПроекцияВанДерГринтена2);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПрочаяПроекцияВанДерГринтена3);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПрочаяШароваяПроекцияБекона);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПрочаяШароваяПроекцияНиколоси);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПрочаяСотоваяШаровая1Проекция);
	Список.Добавить(ТипПроекцииГеографическойСхемы.ПрочаяЭпициклоидальнаяПроекцияАвгуста);
	Список.Добавить(ТипПроекцииГеографическойСхемы.КоническаяПроекцияРавныхПлощадейЛамберта);
	Элементы.Проекция.СписокВыбора.ЗагрузитьЗначения(Список.ВыгрузитьЗначения());	
	
	ЗаполнитьЗначенияСвойств(ЭтаФорма, Параметры.ПараметрыОтображения);
	ОбновитьВидимость();
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗакрытием(Отказ, ЗавершениеРаботы, ТекстПредупреждения, СтандартнаяОбработка)
	
	Если Модифицированность Тогда

		Отказ = Истина;
		// если есть изминения нужно предложить их сохранить
		Режим = РежимДиалогаВопрос.ДаНет;
		Оповещение = Новый ОписаниеОповещения("ПослеЗакрытияВопроса_Применить", ЭтаФорма);
		ПоказатьВопрос(Оповещение, НСтр("ru = 'Закрыть и сохранить изминения выбранных настроек?';"
		+ " en = 'Do you want to Save changes the selected settings'"), Режим, 0);
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийКоманд

&НаКлиенте
Процедура кмдПрименить(Команда)
	
	Если Не ПроверкаЗаполненияПройдена() Тогда
		Возврат;
	КонецЕсли; 
	
    сткРезультат = Новый Структура;
	сткРезультат.Вставить("ОтображатьРегионыГеоСхемы"             , ОтображатьРегионыГеоСхемы);
	сткРезультат.Вставить("ОтображатьНазваниеРегионовВСлоеРегионы", ОтображатьНазваниеРегионовВСлоеРегионы);
	сткРезультат.Вставить("ОтображатьНаименованиеЗон"             , ОтображатьНаименованиеЗон);
	сткРезультат.Вставить("ОтображатьТаблицуДанных"               , ОтображатьТаблицуДанных);
	сткРезультат.Вставить("ТипОтображенияСерии"                   , ТипОтображенияСерии);
	сткРезультат.Вставить("РежимОтображения "                     , РежимОтображения);
	сткРезультат.Вставить("Проекция"                              , Проекция);
	сткРезультат.Вставить("ЦветФонаОбласти"                       , ЦветФонаОбласти);
	
	Модифицированность = Ложь;
	Закрыть(сткРезультат);
	
КонецПроцедуры

&НаКлиенте
Процедура УстановитьНастройкиПоУмолчанию(Команда)
	
	Режим = РежимДиалогаВопрос.ДаНет;
	Оповещение = Новый ОписаниеОповещения("ПослеЗакрытияВопроса_Сброс", ЭтаФорма);
	ПоказатьВопрос(Оповещение, НСтр("ru = 'Установить значения настроек отображения географической схемы, по умолчанию?';"
	+ " en = 'Do you want to configure display geographic schema settings by default?'"), Режим, 0);
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовФормы

&НаКлиенте
Процедура ОтображатьРегионыГеоСхемыПриИзменении(Элемент)
	
	ОбновитьВидимость();
	Модифицированность = Истина;
	
КонецПроцедуры

&НаКлиенте
Процедура ТекущийЭлементПриИзменении(Элемент)
	Модифицированность = Истина;
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиенте
// Процедура сброса настроек отчета на типовые.
//
Процедура ПослеЗакрытияВопроса_Сброс(Результат, Параметры) Экспорт
	
    Если Результат = КодВозвратаДиалога.Нет Тогда
        Возврат;
	КонецЕсли;
    ВыполнитьСбросНастроекНаСервере();
	Модифицированность = Истина;

КонецПроцедуры

&НаКлиенте
// Процедура сохранения настроек отчета.
//
Процедура ПослеЗакрытияВопроса_Применить(Результат, Параметры) Экспорт
	
    Если Результат = КодВозвратаДиалога.Нет Тогда
        Возврат;
	КонецЕсли;
	
	Если Не ПроверкаЗаполненияПройдена() Тогда
		Возврат;
	КонецЕсли; 
	
    сткРезультат = Новый Структура;
	сткРезультат.Вставить("ОтображатьРегионыГеоСхемы"             , ОтображатьРегионыГеоСхемы);
	сткРезультат.Вставить("ОтображатьНазваниеРегионовВСлоеРегионы", ОтображатьНазваниеРегионовВСлоеРегионы);
	сткРезультат.Вставить("ОтображатьНаименованиеЗон"             , ОтображатьНаименованиеЗон);
	сткРезультат.Вставить("ОтображатьТаблицуДанных"               , ОтображатьТаблицуДанных);
	сткРезультат.Вставить("ТипОтображенияСерии"                   , ТипОтображенияСерии);
	сткРезультат.Вставить("РежимОтображения "                     , РежимОтображения);
	сткРезультат.Вставить("Проекция"                              , Проекция);
	сткРезультат.Вставить("ЦветФонаОбласти"                       , ЦветФонаОбласти);
	
	Модифицированность = Ложь;
	Закрыть(сткРезультат);

КонецПроцедуры // ПослеЗакрытияВопроса_Применить()

&Наклиенте 
Функция ПроверкаЗаполненияПройдена()
	
	Отказ = Ложь;
	Если Не ЗначениеЗаполнено(ТипОтображенияСерии) Тогда
		ТекстСообщения = НСтр("ru = 'Укажите тип отображения серии слоя географической схемы'");
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения,, "ТипОтображенияСерии",, Отказ);
	КонецЕсли;
	Если Не ЗначениеЗаполнено(РежимОтображения) Тогда
		ТекстСообщения = НСтр("ru = 'Укажите режим отображения значений серий географической схемы'");
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения,, "РежимОтображенияЗначенийСерии",, Отказ);
	КонецЕсли;
	Если Не ЗначениеЗаполнено(Проекция) Тогда
		ТекстСообщения = НСтр("ru = 'Укажите проекцию географической схемы'");
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения,, "Проекция",, Отказ);
	КонецЕсли;	
	
	Возврат Не Отказ;
	
КонецФункции

&НаСервере
// Установим значение настроек по умолчанию
//
// Параметры:
//  Нет.
//
Процедура ВыполнитьСбросНастроекНаСервере()

	ОтображатьРегионыГеоСхемы              = Ложь;
	ОтображатьНазваниеРегионовВСлоеРегионы = Ложь;
	ОтображатьНаименованиеЗон              = Истина;
	ОтображатьТаблицуДанных                = Ложь;
	ТипОтображенияСерии                    = ТипОтображенияСерииСлояГеографическойСхемы.Гистограмма;
	РежимОтображения                       = РежимОтображенияЗначенийСерии.ОтображатьКакЗначение;
	Проекция                               = ТипПроекцииГеографическойСхемы.АзимутальнаяПроекцияРавныхПлощадейЛамберта;
	ЦветФонаОбласти                        = Новый Цвет(153, 204, 255);

КонецПроцедуры // ВыполнитьСбросНастроекНаСервере()

&НаСервере
Процедура ОбновитьВидимость()
	
	Элементы.ОтображатьНазваниеРегионовВСлоеРегионы.Доступность = ОтображатьРегионыГеоСхемы;
	
КонецПроцедуры

#КонецОбласти
